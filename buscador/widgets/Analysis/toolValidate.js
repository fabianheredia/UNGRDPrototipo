// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define(["dojo/_base/lang","dojo/_base/array"],function(g,d){return{isValid:function(a,b,c){var e=!1;-1!==b.dijitID.indexOf("MergeLayers")?e=this.mergeAvailable(a):-1!==b.dijitID.indexOf("ExtractData")?e=this.extractAvailable(a,c):(c=null,"requiredParam"in b&&(c=b.requiredParam),e=this.paramAvailable(a,b.analysisLayer,c));return e},mergeAvailable:function(a){return d.some(a,function(b){return d.some(a,function(a){return a!==b&&a.geometryType===b.geometryType})})},extractAvailable:function(a,b){var c;
d.forEach(a,function(a){var h="esri.layers.GeoRSSLayer"===a.declaredClass,d="esri.layers.CSVLayer"===a.declaredClass,f="esri.layers.FeatureLayer"===a.declaredClass;f&&!a.url||h||d?this._addExtractCapability(a):f&&a.url&&(c=b.getUser(),b.isAdmin()&&-1<a.url.indexOf("/"+c.orgId+"/")&&this._addExtractCapability(a))},this);return d.some(a,function(a){return a.capabilities&&0<=a.capabilities.indexOf("Extract")})},_addExtractCapability:function(a){a.capabilities?-1===a.capabilities.indexOf("Extract")&&
(a.capabilities+=",Extract"):a.capabilities="Extract";return!0},paramAvailable:function(a,b,c){var e,d=!1;e=b.geomTypes;b=this.findMatchedFeatureLayers(a,e);0<b.length&&(c?(e=c.geomTypes,a=this.findMatchedFeatureLayers(a,e),0<a.length&&(b.length!==a.length?d=!0:1<b.length?d=!0:b[0]!==a[0]&&(d=!0))):d=!0);return d},findMatchedFeatureLayers:function(a,b){var c=[];d.forEach(a,g.hitch(this,function(a){a&&(1===b.length?("*"===b[0]||b[0]===a.geometryType)&&c.push(a.id):-1<b.indexOf(a.geometryType)&&c.push(a.id))}));
return c}}});