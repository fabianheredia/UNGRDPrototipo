// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/LoadingIndicator esri/config esri/tasks/GeometryService".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m){function t(b,c){var d=f.clone(b),m=a.widgetProperties;"undefined"===typeof c&&(c=!1);delete d.mode;a.visitElement(d,function(b,x){b.widgets?(delete b.isOnScreen,
delete b.gid,"jimu.js/images/group_icon.png"===b.icon&&delete b.icon,delete b.openType,x.isOnScreen&&b.panel&&a.isEqual(b.panel,d.widgetOnScreen.panel)&&delete b.panel):(b.icon&&b.icon===b.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete b.icon,delete b.panel,delete b.folderUrl,delete b.amdFolder,delete b.thumbnail,delete b.configFile,delete b.gid,delete b.isOnScreen,delete b.isRemote,m.forEach(function(a){delete b[a]}),c?"undefined"===typeof b.openAtStart&&(b.openAtStart=!1):(b.visible&&
delete b.visible,b.manifest&&b.label===b.manifest.label&&delete b.label,b.isDefaultConfig&&(delete b.config,delete b.isDefaultConfig)),delete b.manifest)});delete d.rawAppConfig;delete d._ssl;delete d.getConfigElementById;delete d.getConfigElementsByName;delete d.processNoUriWidgets;delete d.addElementId;delete d.getCleanConfig;delete d.visitElement;delete d.agolConfig;delete d._itemData;delete d.oldWabVersion;return d}var b=null,v;v=n(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,
portalSelf:null,constructor:function(b){this.urlParams=b||{};this.listenBuilderEvents();this.versionManager=new d;this.widgetManager=l.getInstance();this.configLoader=s.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&(window.parent.setConfigViewerTopic&&f.isFunction(window.parent.setConfigViewerTopic))&&window.parent.setConfigViewerTopic(e);"preview"===this.urlParams.mode&&(window.parent.setPreviewViewerTopic&&f.isFunction(window.parent.setPreviewViewerTopic))&&
window.parent.setPreviewViewerTopic(e);a.isMobileUa()||r(window,"resize",f.hitch(this,this._onWindowResize));r(window,"orientationchange",f.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){e.subscribe("builder/widgetChanged",f.hitch(this,this._onWidgetChanged));e.subscribe("builder/groupChanged",f.hitch(this,this._onGroupChanged));e.subscribe("builder/widgetPoolChanged",f.hitch(this,this._onWidgetPoolChanged));e.subscribe("builder/openAtStartChange",f.hitch(this,this._onOpenAtStartChanged));
e.subscribe("builder/mapChanged",f.hitch(this,this._onMapChanged));e.subscribe("builder/mapOptionsChanged",f.hitch(this,this._onMapOptionsChanged));e.subscribe("builder/appAttributeChanged",f.hitch(this,this._onAppAttributeChanged));e.subscribe("builder/setAppConfig",f.hitch(this,this._onAppConfigSet));e.subscribe("builder/themeChanged",f.hitch(this,this._onThemeChanged));e.subscribe("builder/layoutChanged",f.hitch(this,this._onLayoutChanged));e.subscribe("builder/styleChanged",f.hitch(this,this._onStyleChanged));
e.subscribe("builder/syncExtent",f.hitch(this,this._onSyncExtent));e.subscribe("builder/loadingPageChanged",f.hitch(this,this._onLoadingPageChanged));e.subscribe("builder/templateConfigChanged",f.hitch(this,this._onTemplateConfigChanged));e.subscribe("builder/appProxyForMapChanged",f.hitch(this,this._onAppProxyForMapChanged));e.subscribe("builder/appProxyForUrlChanged",f.hitch(this,this._onAppProxyForUrlChanged))},loadConfig:function(){if(!("preview"===this.urlParams.mode||"config"===this.urlParams.mode)){var b=
new k;b.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(f.hitch(this,function(c){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(c);window.appInfo.isRunInMobile=a.inMobileSize();console.timeEnd("Load Config");c=this.getAppConfig();b.destroy();e.publish("appConfigLoaded",c);return c}),f.hitch(this,function(a){b.destroy();console.error(a);a&&(a.message&&"string"===typeof a.message)&&this._showErrorMessage(a.message)}))}},_showErrorMessage:function(b){h.create("div",
{"class":"app-error",innerHTML:b},document.body)},getAppConfig:function(){var b;window.appInfo.isRunInMobile?(b=f.clone(this._getMobileConfig(this.appConfig)),b._originConfig=f.clone(this.appConfig)):b=f.clone(this.appConfig);b.getConfigElementById=function(b){return a.getConfigElementById(this,b)};b.getConfigElementsByName=function(b){return a.getConfigElementsByName(this,b)};b.getCleanConfig=function(b){return this._originConfig?t(this._originConfig,b):t(this,b)};b.visitElement=function(b){a.visitElement(this,
b)};return b},_onOrientationChange:function(){this.appConfig&&e.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var b=a.inMobileSize();window.appInfo.isRunInMobile!==b&&(window.appInfo.isRunInMobile=b,this.appConfig&&e.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(b){return a.mixinAppConfigPosition(b,b.mobileLayout)},_onWidgetChanged:function(b){var c=a.reCreateObject(b);b=a.getConfigElementById(this.appConfig,
b.id);!1===c.inPanel&&!b.uri&&(c.closeable=!0);for(var d in c)b[d]=c[d];delete b.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"widgetChange",c)},_onGroupChanged:function(b){var c=a.reCreateObject(b);b=a.getConfigElementById(this.appConfig,b.id);for(var d in c)b[d]=c[d];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),
"groupChange",c)},_onWidgetPoolChanged:function(b){var c=a.reCreateObject(b);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=c.widgets,this.appConfig.widgetPool.groups=c.groups):(b=a.getConfigElementById(this.appConfig,c.controllerId),g.forEach(b.controlledWidgets,function(b){this._removeWidgetOrGroupFromPoolById(this.appConfig,b)},this),g.forEach(b.controlledGroups,function(b){this._removeWidgetOrGroupFromPoolById(this.appConfig,b)},this),this.appConfig.widgetPool.widgets=
"undefined"===typeof this.appConfig.widgetPool.widgets?c.widgets:this.appConfig.widgetPool.widgets.concat(c.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?c.groups:this.appConfig.widgetPool.groups.concat(c.groups),this.configLoader.addNeedValues(this.appConfig),b.controlledWidgets=g.map(c.widgets,function(b){return b.id}),b.controlledGroups=g.map(c.groups,function(b){return b.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,
function(b){this.appConfig=b;this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",c)}))},_removeWidgetOrGroupFromPoolById:function(b,a){g.some(b.widgetPool.widgets,function(c,d){if(c.id===a)return b.widgetPool.widgets.splice(d,1),!0});g.some(b.widgetPool.groups,function(c,d){if(c.id===a)return b.widgetPool.groups.splice(d,1),!0})},_onOpenAtStartChanged:function(b){var c=a.reCreateObject(b),d=this.appConfig;b.isOnScreen?(d=d.widgetOnScreen&&d.widgetOnScreen.widgets)&&
0<d.length&&g.forEach(d,f.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})):((d=d.widgetPool)&&(d.groups&&0<d.groups.length)&&g.forEach(d.groups,f.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})),d&&(d.widgets&&0<d.widgets.length)&&g.forEach(d.widgets,f.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})));e.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",c)},_onAppAttributeChanged:function(b){b=
a.reCreateObject(b);f.mixin(this.appConfig,b);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"attributeChange",b)},_onLoadingPageChanged:function(b){b=a.reCreateObject(b);var c;"backgroundColor"in b?this.appConfig.loadingPage.backgroundColor=b.backgroundColor:"backgroundImage"in b?(c=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=
f.mixin(c,b.backgroundImage)):"loadingGif"in b&&(c=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=f.mixin(c,b.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",b)},_onAppProxyForMapChanged:function(b){b=a.reCreateObject(b);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==b.mapItemId?this.appConfig.map.appProxy=b:g.forEach(b.proxyItems,
f.hitch(this,function(b){g.some(this.appConfig.map.appProxy.proxyItems,function(a){if(a.sourceUrl===b.sourceUrl)return a.useProxy=b.useProxy,a.proxyUrl=b.proxyUrl||"",a.proxyId=b.proxyId||"",!0})})):this.appConfig.map.appProxy=b;e.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",b)},_onAppProxyForUrlChanged:function(b){b=a.reCreateObject(b);this.appConfig.appProxies=b;e.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",b)},_onTemplateConfigChanged:function(b){b=a.reCreateObject(b);
this.appConfig.templateConfig=b;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",b)},_onMapChanged:function(b){var c=a.reCreateObject(b);this.appConfig.map.mapOptions&&a.deleteMapOptions(this.appConfig.map.mapOptions);f.mixin(this.appConfig.map,c);this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(b){this.appConfig=
b;this._addDefaultValues(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"mapChange",c)}))},_onMapOptionsChanged:function(b){b=a.reCreateObject(b);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});f.mixin(this.appConfig.map.mapOptions,b);e.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",b)},_onThemeChanged:function(b){this._getAppConfigFromTheme(b).then(f.hitch(this,function(a){this.appConfig=a;e.publish("appConfigChanged",this.getAppConfig(),"themeChange",
b.getName())}))},_onLayoutChanged:function(b){this.appConfig=a.mixinAppConfigPosition(this.appConfig,b.layoutConfig);this._addDefaultPanelAndPosition(this.appConfig);e.publish("appConfigChanged",this.getAppConfig(),"layoutChange",b.name)},_onStyleChanged:function(b){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,b.name);b.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:b.styleColor}:delete this.appConfig.theme.customStyles;e.publish("appConfigChanged",this.getAppConfig(),
"styleChange",b.name)},_onSyncExtent:function(b){e.publish("syncExtent",b)},_genStyles:function(b,a){var c=[];c.push(a);g.forEach(b,function(b){0>c.indexOf(b)&&c.push(b)});return c},_getAppConfigFromTheme:function(b){var a=new p,c,d=[],d=this.getAppConfig().getCleanConfig();d.mode=this.urlParams.mode;g.forEach(d.widgetPool.groups,function(b){delete b.panel},this);if(b.appConfig)c=f.clone(b.appConfig),c.map=d.map,c.map.position=b.appConfig.map.position,this._copyPoolToThemePool(d,c),c.links=d.links,
c.title=d.title,c.subtitle=d.subtitle,c.logo=d.logo;else{var m=b.getCurrentLayout(),k=b.getCurrentStyle();c=f.clone(d);m=f.clone(m.layoutConfig);c.widgetOnScreen=m.widgetOnScreen;m.widgetPool&&(g.forEach(m.widgetPool.widgets,function(b){b.isPreconfiguredInTheme=!0}),g.forEach(m.widgetPool.groups,function(b){b.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(d,m);c.widgetPool=m.widgetPool;m.map&&m.map.position&&(c.map.position=m.map.position);c.mobileLayout=m.mobileLayout;d=this._genStyles(g.map(b.getStyles(),
function(b){return b.name}),k.name);c.theme={name:b.getName(),styles:d,version:b.getVersion()}}this.configLoader.addNeedValues(c);this.configLoader.loadWidgetsManifest(c).then(f.hitch(this,function(b){return this.configLoader.loadAndUpgradeAllWidgetsConfig(b)})).then(f.hitch(this,function(){this._addDefaultValues(c);a.resolve(c)}));return a},_copyPoolToThemePool:function(b,a){var c=b.widgetPool;a.widgetPool||(a.widgetPool={});var d=a.widgetPool,m=g.filter(d.widgets,function(b){if(b.isPreconfiguredInTheme||
!g.some(c.widgets,function(a){return a.name===b.name}))return!0}),k=g.filter(d.groups,function(b){return b.isPreconfiguredInTheme}),l=g.filter(c.widgets,function(b){return!b.isPreconfiguredInTheme}),q=g.filter(c.groups,function(b){return!b.isPreconfiguredInTheme}),l=this._getPoolWidgetsWithoutDuplicated(l,a.widgetOnScreen.widgets||[]);d.widgets=l.concat(m);d.groups=q.concat(k)},_getPoolWidgetsWithoutDuplicated:function(b,c){for(var d=f.clone(b),m=this.getAppConfig(),k=b.length-1;0<=k;k--)for(var l=
c.length-1;0<=l;l--)if(c[l].uri){var q=c[l].name;q||(q=a.getWidgetNameFromUri(c[l].uri));var t=m.getConfigElementById(b[k].id);b[k]&&(b[k].name===q&&!1===t.supportMultiInstance)&&(console.log("Widget",b[k].name,"is not copied to new theme because this widget exists in new theme."),d.splice(k,1))}return d},_onAppConfigSet:function(b){b=a.reCreateObject(b);window.appInfo.isRunInMobile=a.inMobileSize();this.configLoader.processProxy(b);this.configLoader.addNeedValues(b);this.configLoader.loadAndUpgradeAllWidgetsConfig(b).then(f.hitch(this,
function(b){this._addDefaultValues(b);q.setPortalUrl(b.portalUrl);window.portalUrl=b.portalUrl;this.appConfig?(a.deleteMapOptions(b.map.mapOptions),this.appConfig=b,e.publish("appConfigChanged",this.getAppConfig(),"resetConfig",b)):(this.appConfig=b,e.publish("appConfigLoaded",this.getAppConfig()))}))},_addDefaultValues:function(b){this._addDefaultPortalUrl(b);this._addDefaultGeometryService(b);this._addDefaultStyle(b);this._addDefaultMap(b);this._addDefaultVisible(b);"undefined"===typeof b.widgetOnScreen&&
(b.widgetOnScreen={});"undefined"===typeof b.widgetPool&&(b.widgetPool={});this._addDefaultPanelAndPosition(b);this._addDefaultOfWidgetGroup(b);(b.widgetPool.widgets&&0<b.widgetPool.widgets.length&&void 0===b.widgetPool.widgets[0].index||b.widgetPool.groups&&0<b.widgetPool.groups.length&&void 0===b.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(b);return b},_addDefaultPortalUrl:function(b){"undefined"===typeof b.portalUrl&&(b.portalUrl="http://www.arcgis.com/");b.portalUrl&&"/"!==b.portalUrl.substr(b.portalUrl.length-
1)&&(b.portalUrl+="/")},_addDefaultGeometryService:function(b){var a=b&&b.geometryService,a=a&&"string"===typeof a&&f.trim(a)?f.trim(a):this.portalSelf.helperServices.geometry.url;b.geometryService=a;c.defaults.geometryService=new m(b.geometryService)},_addDefaultStyle:function(b){if(b.theme&&(!b.theme.styles||0===b.theme.styles.length))b.theme.styles=["default"]},_addDefaultMap:function(b){b.map.id="map";"undefined"===typeof b.map["3D"]&&"undefined"===typeof b.map["2D"]&&(b.map["2D"]=!0);"undefined"===
typeof b.map.position&&(b.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof b.map.portalUrl&&(b.map.portalUrl=b.portalUrl)},_addDefaultVisible:function(b){a.visitElement(b,function(b){void 0===b.visible&&(b.visible=!0)})},_addDefaultPanelAndPosition:function(b){this._addOnScreenDefaultPanelAndPosition(b);this._addPoolDefaultPanelAndPosition(b)},_addOnScreenDefaultPanelAndPosition:function(b){var a,c;if(b=b.widgetOnScreen){a=b.panel&&b.panel.positionRelativeTo?b.panel.positionRelativeTo:
"map";"undefined"===typeof b.panel||"undefined"===typeof b.panel.uri?b.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:"undefined"===typeof b.panel.position?b.panel.position={relativeTo:a}:"undefined"===typeof b.panel.position.relativeTo&&(b.panel.position.relativeTo=a);if(b.widgets)for(a=0;a<b.widgets.length;a++)b.widgets[a].position||(b.widgets[a].position={}),b.widgets[a].position.relativeTo||(b.widgets[a].position.relativeTo=b.widgets[a]&&b.widgets[a].positionRelativeTo?b.widgets[a].positionRelativeTo:
"map"),!0===b.widgets[a].inPanel&&!b.widgets[a].panel&&(b.widgets[a].panel=f.clone(b.panel),b.widgets[a].panel.position=b.widgets[a].position,b.widgets[a].panel.position.relativeTo=b.widgets[a].position.relativeTo);if(b.groups)for(a=0;a<b.groups.length;a++){b.groups[a].panel||(b.groups[a].panel=b.panel);b.groups[a].panel&&!b.groups[a].panel.position&&(b.groups[a].panel.position={});b.groups[a].panel.position.relativeTo||(b.groups[a].panel.position.relativeTo=b.groups[a].panel.positionRelativeTo?b.groups[a].panel.positionRelativeTo:
"map");b.groups[a].widgets||(b.groups[a].widgets=[]);for(c=0;c<b.groups[a].widgets.length;c++)b.groups[a].widgets[c].panel=b.groups[a].panel}}},_addPoolDefaultPanelAndPosition:function(b){var a,c,d=b.widgetPool;if(d){a=d.panel&&d.panel.positionRelativeTo?d.panel.positionRelativeTo:"map";"undefined"===typeof d.panel||"undefined"===typeof d.panel.uri?d.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:"undefined"===typeof d.panel.position?d.panel.position={relativeTo:a}:"undefined"===typeof d.panel.position.relativeTo&&
(d.panel.position.relativeTo=a);if(d.groups)for(a=0;a<d.groups.length;a++){d.groups[a].panel?d.groups[a].panel.position.relativeTo||(d.groups[a].panel.position.relativeTo=d.groups[a].panel.positionRelativeTo?d.groups[a].panel.positionRelativeTo:"map"):d.groups[a].panel=d.panel;d.groups[a].widgets||(d.groups[a].widgets=[]);for(c=0;c<d.groups[a].widgets.length;c++)d.groups[a].widgets[c].panel=d.groups[a].panel}if(d.widgets)for(a=0;a<d.widgets.length;a++)!1===d.widgets[a].inPanel?(c=d.widgets[a].positionRelativeTo?
d.widgets[a].positionRelativeTo:"map",d.widgets[a].position?d.widgets[a].position.relativeTo||(d.widgets[a].position.relativeTo=c):d.widgets[a].position={relativeTo:c}):d.widgets[a].panel||(d.widgets[a].panel=b.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(b){a.visitElement(b,f.hitch(this,function(b,a){b.isOnScreen=a.isOnScreen;b.widgets?(b.gid=b.id,1===b.widgets.length?(b.label||(b.label=b.widgets[0].label?b.widgets[0].label:"Group"),b.icon||(b.icon=b.widgets[0].uri?this._getDefaultIconFromUri(b.widgets[0].uri):
"jimu.js/images/group_icon.png")):(b.icon=b.icon?b.icon:"jimu.js/images/group_icon.png",b.label=b.label?b.label:"Group_"+a.index)):b.gid=a.groupId}))},_getDefaultIconFromUri:function(b){b=b.split("/");b.pop();return b.join("/")+"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(b){var a=0,c,d;if(b.widgetPool.widgets)for(c=0;c<b.widgetPool.widgets.length;c++)b.widgetPool.widgets[c].index=a,a++;if(b.widgetPool.groups)for(c=0;c<b.widgetPool.groups.length;c++){b.widgetPool.groups[c].index=
a;a++;for(d=0;d<b.widgetPool.groups[c].widgets.length;d++)b.widgetPool.groups[c].widgets[d].index=d}}});v.getInstance=function(a){null===b?b=new v(a):a&&(b.urlParams=a,b.configLoader&&(b.configLoader.urlParams=a));window.getAppConfig=f.hitch(b,b.getAppConfig);return b};return v})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils jimu/portalUrlUtils ./shared/utils".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A,w,C,u,E,D,B,G,I,K,R,N,P,J,H,O){function L(b,a){b=b||"";for(var c=0,d=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!z.file.isEnabledFlash(),failure:[b+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){c++;c===d.length&&a()}}],m=0;m<d.length;m++)testLoad(d[m])}function M(b,a){var c=b.match(/url\([^)]+\)/gi),d,m;if(null===c||""===a)return b;for(d=0;d<c.length;d++)if(m=c[d].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=m.length){var k=
m[2];a.endWith("/")||(a+="/");b=b.replace(m[1]+k+m[3],m[1]+a+k+m[3])}return b}function F(b,a){var c=Array.isArray(a),d=c&&[]||{};c?(b=b||[],d=d.concat(b),a.forEach(function(a,c){"undefined"===typeof b[c]?d[c]=a:"object"===typeof a?d[c]=F(b[c],a):-1===b.indexOf(a)&&d.push(a)})):(b&&"object"===typeof b&&Object.keys(b).forEach(function(a){d[a]=b[a]}),Object.keys(a).forEach(function(c){d[c]="object"!==typeof a[c]||!a[c]?a[c]:b[c]?F(b[c],a[c]):a[c]}));return d}function Q(b,a,c){a=function(b){var a=[];
b.split("_").forEach(function(b){var c=!1,d;"--"===b.slice(b.length-2)&&(c=!0,b=b.slice(0,b.length-2));d=b.search(/\[[0-9]+\]/);-1===d&&(d=b.length);a.push({key:b.slice(0,d),index:Number(b.slice(d+1,-1)),deleteFlag:c})});return a}(a);for(var d=1;d<a.length-1;d++)if(b=n.isArray(b[a[d].key])?b[a[d].key][a[d].index]:b[a[d].key],!b)return;if(a[a.length-1].deleteFlag)!0===c&&(n.isArray(b[a[a.length-1].key])?delete b[a[a.length-1].key][a[a.length-1].index]:delete b[a[a.length-1].key]);else if(n.isArray(b[a[a.length-
1].key])){if(void 0===c)return b[a[a.length-1].key][a[a.length-1].index];b[a[a.length-1].key][a[a.length-1].index]=c}else{if(void 0===c)return b[a[a.length-1].key];b[a[a.length-1].key]=c}}function U(b,a,c){function d(c){c=z.template.getSearchRange(a,c,"]");var m=a.slice(c.firstPos,c.lastPos);return-1!==c.firstPos?(m=a.slice(c.firstPos+m.indexOf("[")+1,c.lastPos-1),c=a.slice(c.lastPos+1),(m=z.getConfigElementById(b,m))?{object:m,key:"section_"+c,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}
var m=b,k=a=a.replace(/\//g,"_"),l=d("groups\\[.+\\]");if("deleted"!==l.state&&("isSection"===l.state&&(m=l.object,k=l.key),l=d("widgets\\[.+\\]"),"delete"!==l.state))return"isSection"===l.state&&(m=l.object,k=l.key),Q(m,k,c)}var z={},aa={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};n.mixin(z,O);window.atob||(window.atob=function(b){b=t.decode(b);for(var a="",c=0,d=b.length;c<d;c++)a+=String.fromCharCode(b[c]);return a});window.btob||(window.btob=
function(b){for(var a=[],c=0,d=b.length;c<d;c++)a.push(String.charCodeAt(b[c]));return t.encode(a)});var W="unload",Y=[];require.on("error",function(b){f.forEach(Y,function(a){b.info[0]&&-1<b.info[0].indexOf(a.resKey)&&a.def.reject(b);for(var c in b.info)-1<c.indexOf(a.resKey)&&a.def.reject(b)})});z.checkError=function(b,a){Y.push({resKey:b,def:a})};z.replacePlaceHolder=function(b,a){var c=s.stringify(b),d=c.match(/\$\{(\w)+\}/g),m;if(null===d)return b;for(m=0;m<d.length;m++){var k=d[m].match(/(\w)+/g)[0];
a[k]&&(c=c.replace(d[m],a[k]))}return s.parse(c)};z.changeUnit=function(b){var a=Math.abs(b),c;b=Math.floor(a);c=Math.floor(60*(a-b));a=(60*(60*(a-b)-c)).toFixed(2);return b+"\u00b0"+(10>c?"0"+c:c)+"'"+(10>a?"0"+a:a)+'"'};z.formatTime=function(b){var a=b/1E3;b=Math.floor(a/60);a=Number(a-60*b).toFixed(1);return(10>b?"0"+b:b)+":"+(10>a?"0"+a:a)};z.parseTime=function(b){var a=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!a.test(b))return console.log("wrong time format."),-1;b=b.match(a);return 1E3*(60*parseInt(b[1],
10)+parseInt(b[2],10)+parseInt(b[3],10)/10)};z.preloadImg=function(b,a){var c=[],c="string"===typeof b?[b]:b;f.forEach(c,function(b){(new Image).src=a?a+b:b})};var T=null;z.getImagesSize=function(b){var a=new l;if(!b||0!==b.indexOf("http"))return a.reject(),a;null===T&&(T=g.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var c=d(T,"load",function(){clearTimeout(m);m=null;c.remove();var b=g.getContentBox(T);1===b.w&&1===b.h||0===b.w||0===
b.h?a.reject():a.resolve([b.w,b.h])},{}),m=setTimeout(function(){clearTimeout(m);m=null;a.reject()},5E3);g.setAttr(T,"src",b);return a};z.getPositionStyle=function(b){var a={};if(!b)return a;b=n.clone(b);if(window.isRTL){var c;"undefined"!==typeof b.left&&"undefined"!==typeof b.right?(c=b.left,b.left=b.right,b.right=c):"undefined"!==typeof b.left?(b.right=b.left,delete b.left):"undefined"!==typeof b.right&&(b.left=b.right,delete b.right);"undefined"!==typeof b.paddingLeft&&"undefined"!==typeof b.paddingRight?
(c=b.paddingLeft,b.paddingLeft=b.paddingRight,b.paddingRight=c):"undefined"!==typeof b.paddingLeft?(b.paddingRight=b.paddingLeft,delete b.paddingLeft):"undefined"!==typeof b.paddingRight&&(b.paddingLeft=b.paddingRight,delete b.paddingRight)}c="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var d=0;d<c.length;d++){var m=c[d];"number"===typeof b[m]?a[m]=b[m]+"px":"undefined"!==typeof b[m]?a[m]=b[m]:"padding"===m.substr(0,7)?a[m]=0:a[m]="auto"}a.zIndex=
"undefined"===typeof b.zIndex?"auto":b.zIndex;return a};z.isEqual=function(b,a){function c(b,a){var k;if(null===b&&null===a||"undefined"===typeof b&&"undefined"===typeof a)return!0;if(null===b&&null!==a||null===a&&null!==b||"undefined"===typeof b&&"undefined"!==typeof a||"undefined"===typeof a&&"undefined"!==typeof b)return!1;if(isNaN(b)&&isNaN(a)&&"number"===typeof b&&"number"===typeof a||b===a)return!0;if("function"===typeof b&&"function"===typeof a||b instanceof Date&&a instanceof Date||b instanceof
RegExp&&a instanceof RegExp||b instanceof String&&a instanceof String||b instanceof Number&&a instanceof Number)return b.toString()===a.toString();if(-1<d.indexOf(b)||-1<m.indexOf(a))return!1;if(null!==a){for(k in a)if(a.hasOwnProperty(k)!==b.hasOwnProperty(k)||typeof a[k]!==typeof b[k])return!1;for(k in b){if(a.hasOwnProperty(k)!==b.hasOwnProperty(k)||typeof a[k]!==typeof b[k])return!1;switch(typeof b[k]){case "object":case "function":d.push(b);m.push(a);if(!c(b[k],a[k]))return!1;d.pop();m.pop();
break;default:if(isNaN(b[k])&&isNaN(a[k])&&"number"===typeof b[k]&&"number"===typeof a[k])return!0;if(b[k]!==a[k])return!1}}}return!0}var d,m;d=[];m=[];return!c(b,a)?!1:!0};z.file={loadFileAPI:function(){var b=new l;if("unload"===W){var a=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:a+"libs/polyfills/fileAPI/",flashUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};L(a,n.hitch(this,function(){W="loaded";
b.resolve()}));W="loading"}else"loaded"===W&&b.resolve();return b},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return h("safari")&&6>h("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var b=null;if(document.all)try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(a){b=null}else navigator.plugins&&0<navigator.plugins.length&&(b=navigator.plugins["Shockwave Flash"]);return!!b},
containSeparator:function(b){return 0<=b.indexOf("/")?!0:0<=b.indexOf("\\")?!0:!1},getNameFromPath:function(b){var a="",a=0<=b.indexOf("/")?"/":"\\";b=b.split(a);return 0<b.length?b[b.length-1]:null},getFolderFromPath:function(b){return b.substr(0,b.length-z.file.getNameFromPath(b).length)},readFile:function(b,a,c,d){if(this.supportHTML5()){var m=b.target.files[0];m&&(m.type.match(a)?m.size>=c?d({errCode:"exceed"}):(b=new FileReader,b.onload=function(b){d(null,m.name,b.target.result)},b.readAsDataURL(m)):
d({errCode:"invalidType"}))}else if(this.supportFileAPI()){var k=window.FileAPI.getFiles(b);k[0].type.match(a)?k[0].size>=c?d({errCode:"exceed"}):window.FileAPI.readAsDataURL(k[0],function(b){b&&b.result?d(null,k[0].name,b.result):d({errCode:"readError"})}):d({errCode:"invalidType"})}}};z.getUriInfo=function(b){var a,c={};a=b.indexOf("/");b.substring(0,a);a=b.substring(0,b.lastIndexOf("/")+1);c.folderUrl=require(z.getRequireConfig()).toUrl(a);c.amdFolder=a;c.url=c.folderUrl;if(/^http(s)?:\/\//.test(b)||
/^\/\//.test(b))c.isRemote=!0;return c};z.widgetJson=function(){return{addManifest2WidgetJson:function(b,a){n.mixin(b,a.properties);b.name=a.name;b.label||(b.label=a.label);b.manifest=a;b.isRemote=a.isRemote;b.isRemote&&(b.itemId=a.itemId);a.featureActions&&(b.featureActions=a.featureActions);b.icon||(b.icon=a.icon);b.thumbnail||(b.thumbnail=a.thumbnail);b.folderUrl=a.folderUrl;b.amdFolder=a.amdFolder},removeManifestFromWidgetJson:function(b){if(b.manifest){for(var a in b.manifest.properties)b[a]=
void 0;b.name=void 0;b.label=void 0;b.featureActions=void 0;b.manifest=void 0}}}}();z.getRequireConfig=function(){if(jimuConfig){var b=[];jimuConfig.widgetsPackage&&(b=b.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(b=b.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(b=b.concat(jimuConfig.configsPackage));return{packages:b}}return{}};z.getTypeByGeometryType=function(b){var a="",c="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),
d=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(b)?a="point":0<=c.indexOf(b)?a="polyline":0<=d.indexOf(b)&&(a="polygon");return a};z.getSymbolTypeByGeometryType=function(b){var a=null;b=z.getTypeByGeometryType(b);"point"===b?a="marker":"polyline"===b?a="line":"polygon"===b&&(a="fill");return a};z.getServices=function(){return aa};z.getArcGISDefaultGeometryService=function(){return new D(aa.geometryService)};z.restoreToDefaultWebMapExtent=
function(b,a,c){var d=new l;if(!(b&&"esri.Map"===b.declaredClass))return setTimeout(function(){d.reject("Invalid map.")},0),d;a=a&&a.itemInfo;if(!a)return setTimeout(function(){d.reject("Invalid itemInfo")},0),d;a=a.item&&a.item.extent;if(!a)return setTimeout(function(){d.reject("Invalid itemInfo.item.extent")}),d;var m=new y({wkid:4326}),m=new A(a[0][0],a[0][1],a[1][0],a[1][1],m);if(4326===parseInt(b.spatialReference.wkid,10))return b.setExtent(m);if(b.spatialReference.isWebMercator())return m=E.geographicToWebMercator(m),
b.setExtent(m);a=new B;a.geometries=[m];a.outSR=b.spatialReference;m=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;m&&"esri.tasks.GeometryService"===m.declaredClass||(c&&"string"===typeof c&&n.trim(c)?(c=n.trim(c),m=new D(c)):m=z.getArcGISDefaultGeometryService());m.project(a).then(function(a){if(a=a&&a[0])return b.setExtent(a);d.reject("Invalid projected geometry.");return d},function(b){console.error(b);d.reject(b);return d});return d};z.getAncestorWindow=function(){for(var b=
window;b&&b.parent&&b!==b.parent;)b=b.parent;return b};z.getAncestorDom=function(b,a,c){if(b&&1===b.nodeType&&a&&"function"===typeof a){var d=100,m=document.body;c&&("number"===typeof c?(c=parseInt(c,10),0<c&&(d=c)):1===c.nodeType&&(m=c));for(c=0;b.parentNode&&c<d&&g.isDescendant(b.parentNode,m);){if(a(b.parentNode))return b.parentNode;b=b.parentNode;c++}}return null};z.bindClickAndDblclickEvents=function(b,a,c,m){var k=null;if(b&&1===b.nodeType&&a&&"function"===typeof a&&c&&"function"===typeof c){var l=
200;m&&"number"===typeof m&&(m=parseInt(m,10),0<m&&(l=m));var q=0,k=d(b,"click",function(b){q++;1===q?setTimeout(function(){1===q&&(q=0,a(b))},l):2===q&&(q=0,c(b))})}return k};z.isScrollToBottom=function(b){var a=g.getContentBox(b);return 1>b.scrollHeight-(b.scrollTop+a.h)};z.getAllItemTypes=function(){var b=[],b=b.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return b=b.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};z.getItemQueryStringByTypes=function(b){var a="",c=z.getAllItemTypes();if(b&&0<b.length&&0<b.length){var d="";f.forEach(b,function(a,c){d+=' type:"'+a+'" ';c!==b.length-1&&(d+=" OR ")});a=" ( "+d+" ) ";c=b.concat(c);c=f.filter(c,function(a){return f.every(b,
function(b){return 0>b.toLowerCase().indexOf(a.toLowerCase())})});f.forEach(c,function(b){a+=' -type:"'+b+'" '})}return a};z.getItemQueryStringByTypeKeywords=function(b){var a="";b&&0<b.length&&(a=' typekeywords:"'+b.join(",")+'" ');return a};z.isNotEmptyString=function(b,a){var c=b&&"string"===typeof b;return c?a?c&&n.trim(b):!0:!1};z.isValidNumber=function(b){return"number"===typeof b&&!isNaN(b)};z.isObject=function(b){return b&&"object"===typeof b};z.createWebMap=function(b,a,c,d){b=H.getStandardPortalUrl(b);
b=H.getBaseItemUrl(b);v.arcgisUrl=b;return v.createMap(a,c,d)};z.getRandomString=function(){var b=Math.random().toString();return b=b.slice(2,b.length)};z._getDomainsByServerName=function(b){var a=b.split("."),c=a.length;return f.map(a,n.hitch(this,function(b,d){var m=a.slice(d,c),k="",l=m.length-1;f.forEach(m,n.hitch(this,function(b,a){k+=b;a!==l&&(k+=".")}));return k}))};z.removeCookie=function(b,a){var c=this._getDomainsByServerName(window.location.hostname);f.forEach(c,n.hitch(this,function(c){q(b,
null,{expires:-1,path:a});q(b,null,{expires:-1,path:a,domain:c});q(b,null,{expires:-1,path:a,domain:"."+c})}))};z.isLocaleChanged=function(b,a){return!b.startWith(a)};z.hashToObject=function(b){b=b.replace("#","");b=p.queryToObject(b);for(var a in b)if(b.hasOwnProperty(a))try{b[a]=s.parse(b[a])}catch(c){}return b};z.reCreateObject=function(b){function a(b){var d=[];b.forEach(function(b){Array.isArray(b)?d.push(a(b)):"object"===typeof b?d.push(c(b)):d.push(b)});return d}function c(b){var d={},m;for(m in b)b.hasOwnProperty(m)&&
(null===b[m]?d[m]=null:Array.isArray(b[m])?d[m]=a(b[m]):d[m]="object"===typeof b[m]?c(b[m]):b[m]);return d}return Array.isArray(b)?a(b):c(b)};z.setVerticalCenter=function(b){setTimeout(function(){var a=r(".jimu-vcenter-text",b),c,d;f.forEach(a,function(b){c=g.getContentBox(b).h;g.setStyle(b,{lineHeight:c+"px"})},this);a=r(".jimu-vcenter",b);f.forEach(a,function(b){c=g.getContentBox(b).h;d=g.getContentBox(r(b).parent()[0]).h;g.setStyle(b,{marginTop:(d-c)/2+"px"})},this)},10)};z.merge=F;z.loadStyleLink=
function(b,a,c){var m=new l,k,q=require(z.getRequireConfig()).toUrl(a);if(require.cache["url:"+q]){k=require.cache["url:"+q];var t=q.split("/").pop(),q=q.substr(0,q.length-t.length);k=M(k,q);b=c?g.create("style",{id:b,type:"text/css"},g.byId(c),"before"):g.create("style",{id:b,type:"text/css"},document.getElementsByTagName("head")[0]);b.styleSheet&&!b.sheet?b.styleSheet.cssText=k:b.appendChild(g.toDom(k));m.resolve("load");return m}k=c?g.create("link",{id:b,rel:"stylesheet",type:"text/css",href:q+
"?wab_dv\x3d"+window.deployVersion},g.byId(c),"before"):g.create("link",{id:b,rel:"stylesheet",type:"text/css",href:q+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);d(k,"load",function(){m.resolve("load")});var e=setInterval(function(){var b;if(f.some(document.styleSheets,function(c){if(c.href&&c.href.substr(c.href.indexOf(a),c.href.length)===a)return b=c,!0}))try{!m.isFulfilled()&&(b.cssRules&&b.cssRules.length||b.rules&&b.rules.length)&&m.resolve("load"),clearInterval(e)}catch(c){}},
50);return m};z.changeLocation=function(b){window.history.pushState&&window.history.pushState({path:b},"",b)};z.urlToObject=function(b){var a=null;-1===b.indexOf("#")?(a=K.urlToObject(b),a.hash=null):(b=b.split("#"),a=K.urlToObject(b[0]),a.hash=b[1]?-1<b[1].indexOf("\x3d")?p.queryToObject(b[1]):b[1]:null);return a};z.manifest=function(){function b(a){a.panels.forEach(function(b){b.uri="panels/"+b.name+"/Panel.js"});a.styles.forEach(function(b){b.uri="styles/"+b.name+"/style.css"});a.layouts.forEach(function(b){b.uri=
"layouts/"+b.name+"/config.json";b.icon="layouts/"+b.name+"/icon.png";b.RTLIcon="layouts/"+b.name+"/icon_rtl.png"})}return{addManifestProperies:function(a){a.icon||(a.icon=a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);a.thumbnail||(a.thumbnail=a.folderUrl+"images/thumbnail.png");"theme"===a.category?b(a):("undefined"!==typeof a["2D"]&&(a.support2D=a["2D"]),"undefined"!==typeof a["3D"]&&(a.support3D=a["3D"]),"undefined"===typeof a["2D"]&&"undefined"===typeof a["3D"]&&(a.support2D=
!0),delete a["2D"],delete a["3D"],"undefined"===typeof a.properties&&(a.properties={}),O.processWidgetProperties(a))},processManifestLabel:function(b,a){var c=a.split("-")[0];b.label=b.i18nLabels&&(b.i18nLabels[a]||b.i18nLabels[c]||b.i18nLabels.defaultLabel)||b.label||b.name;b.layouts&&f.forEach(b.layouts,function(c){var d="i18nLabels_layout_"+c.name;c.label=b[d]&&(b[d][a]||b[d].defaultLabel)||c.label||c.name});b.styles&&f.forEach(b.styles,function(c){var d="i18nLabels_style_"+c.name;c.label=b[d]&&
(b[d][a]||b[d].defaultLabel)||c.label||c.name})},addI18NLabel:function(b){var a=new l;if(b.i18nLabels)return a.resolve(b),a;b.i18nLabels={};if(b.properties&&!1===b.properties.hasLocale)return a.resolve(b),a;var c;c=b.isRemote?b.amdFolder+"nls/strings.js":b.amdFolder+"nls/strings";require(z.getRequireConfig(),["dojo/i18n!"+c],function(c){var d={};d[dojoConfig.locale]=c;O.addI18NLabelToManifest(b,null,d);a.resolve(b)});return a}}}();z.getUniqueValues=function(b,a,c){var d=new l;b=b.replace(/\/*$/g,
"");c||(c="1\x3d1");return d=/\/ImageServer$/gi.test(b)?z._getUniqueValuesByQueryTask(b,a,c):z._getUniqueValuesByGenerateRenderer(b,a,c)};z._getUniqueValuesByQueryTask=function(b,a,c){var d=new N;d.where=c;d.returnDistinctValues=!0;d.returnGeometry=!1;d.outFields=[a];return(new P(b)).execute(d).then(function(b){var c=[];b.features&&0<b.features.length&&f.forEach(b.features,function(b){b&&b.attributes&&c.push(b.attributes[a])});return c})};z._getUniqueValuesByGenerateRenderer=function(b,a,c){var d=
new l;b=b.replace(/\/*$/g,"")+"/generateRenderer";a=s.stringify({type:"uniqueValueDef",uniqueValueFields:[a]});R({url:b,content:{classificationDef:a,f:"json",where:c},handleAs:"json",callbackParamName:"callback"}).then(n.hitch(this,function(b){var a=[];(b=b&&b.uniqueValueInfos)&&0<b.length&&(a=f.map(b,n.hitch(this,function(b){return b.value})));d.resolve(a)}),n.hitch(this,function(b){d.reject(b)}));return d};z.combineRadioCheckBoxWithLabel=function(b,a){var c=!1;if(b&&1===b.nodeType&&"input"===b.tagName.toLowerCase()){var d=
b.getAttribute("type")||"",d=d.toLowerCase();if("radio"===d||"checkbox"===d)c=!0}d=!1;a&&(1===a.nodeType&&"label"===a.tagName.toLowerCase())&&(d=!0);c&&d&&(c=b.getAttribute("id"),c||(c="input_"+z.getRandomString(),b.setAttribute("id",c)),a.setAttribute("for",c),g.setStyle(a,"cursor","pointer"))};z.groupRadios=function(b,a){var c=[],m="radiogroup_"+z.getRandomString();f.forEach(b,function(b){b.name=m;a&&(b=d(b,"change",a),c.push(b))});return c};z.convertExtentToPolygon=function(b){var a=b.xmin,c=b.xmax,
d=b.ymin,m=b.ymax;return new u({rings:[[[a,m],[c,m],[c,d],[a,d],[a,m]]],spatialReference:b.toJson()})};z.combineGeometries=function(b){function a(b){var c={points:[],spatialReference:b[0].spatialReference.toJson()};f.forEach(b,function(b){"point"===b.type?c.points=c.points.concat([[b.x,b.y]]):"multipoint"===b.type&&(c.points=c.points.concat(b.points))});return new w(c)}function c(b){var a={paths:[],spatialReference:b[0].spatialReference.toJson()};f.forEach(b,function(b){a.paths=a.paths.concat(b.paths)});
return new C(a)}function d(b){var a={rings:[],spatialReference:b[0].spatialReference.toJson()};f.forEach(b,function(b){"polygon"===b.type?a.rings=a.rings.concat(b.rings):"extent"===b.type&&(b=z.convertExtentToPolygon(b),a.rings=a.rings.concat(b.rings))});return new u(a)}var m=null;if(b&&0<b.length)if(1===b.length)m=b[0];else{for(var k=null,l=null,q=null,t=null,e=0;e<b.length;e++){k=b[e];switch(k.type){case "point":case "multipoint":t="point";break;case "polyline":t="polyline";break;case "polygon":case "extent":t=
"polygon";break;default:return null}if(0===e)q=t;else if(q!==t)return null;if(e!==b.length-1&&(l=b[e+1],!k.spatialReference.equals(l.spatialReference)))return null}"point"===t?m=a(b):"polyline"===t?m=c(b):"polygon"===t&&(m=d(b))}return m};z.combineGeometriesByGraphics=function(b){var a=null;b&&0<b.length&&(b=f.map(b,function(b){return b.geometry}),a=z.combineGeometries(b));return a};z.isFeaturelayerUrlSupportQuery=function(b,a){var c=!1,d=/\/featureserver\//gi.test(b),m=/\/mapserver\//gi.test(b);
a=(a||"").toLowerCase();d?c=0<=a.indexOf("query"):m&&(c=0<=a.indexOf("data"));return c};z.isImageServiceSupportQuery=function(b){return 0<=(b||"").toLowerCase().indexOf("catalog")};z.isStringEndWith=function(b,a){return b.lastIndexOf(a)+a.length===b.length};z.localizeNumber=function(b,a){var c=(b.toString().split(".")[1]||"").length,d="",d=a&&isFinite(a.places)&&a.places,d=0<d||0<c?"#,###,###,##0.0"+Array.prototype.join.call({length:0<d?d+1:c},"0"):"#,###,###,##0",c={locale:e.locale,pattern:d};n.mixin(c,
a||{});try{return k.format(b,c)}catch(m){return console.error(m),b.toLocaleString()}};z.parseNumber=function(b,a){var c={locale:e.locale};n.mixin(c,a||{});try{return k.parse(b,c)}catch(d){return console.error(d),b}};z.localizeDate=function(b,a){var d={locale:e.locale,fullYear:!0};n.mixin(d,a||{});try{return c.format(b,d)}catch(m){return console.error(m),"date"===d.selector?b.toLocaleDateString():"time"===d.selector?b.toLocaleTimeString():b.toLocaleString()}};z.localizeNumberByFieldInfo=function(b,
a){var c=null,c=n.exists("format.places",a)&&a.format.places,c=z.localizeNumber(b,{places:c});return n.exists("format.digitSeparator",a)&&!a.format.digitSeparator?c.toString().replace(RegExp("\\"+m.group,"g"),""):c};z.localizeDateByFieldInfo=function(a,c){var d=null;try{var m={date:a instanceof Date?a.getTime():a},k=n.exists("format.dateFormat",c)?c.format.dateFormat:"longMonthDayYear",d=b.substitute(m,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+x.prototype._dateFormats[k]}})}catch(l){console.error(l),
d=a}return d};z.fieldFormatter={getFormattedUrl:function(b){if(b&&"string"===typeof b){var a=b.indexOf("http:");-1===a&&(a=b.indexOf("https:"));if(-1<a&&-1===b.indexOf("href\x3d")){var c=b.indexOf(" ",a);-1===c&&(c=b.length);var d=b.substring(a,c);b=b.substring(0,a)+'\x3cA href\x3d"'+d+'" target\x3d"_blank"\x3e'+d+"\x3c/A\x3e"+b.substring(c,b.length)}}return b||""},getFormattedNumber:function(b,a){if("number"===typeof b){var c=(b.toString().split(".")[1]||"").length;b=z.localizeNumberByFieldInfo(b,
{format:{places:a&&"number"===typeof a.places?parseInt(a.places,10):c,digitSeparator:a&&a.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(b||"")+"\x3c/span\x3e"}return b},getFormattedDate:function(b,a){if("number"===typeof b||b instanceof Date)b=z.localizeDateByFieldInfo(b,{format:a});return b||""},getCodedValue:function(a,c){if(a&&a.codedValues){for(var d=0,m=a.codedValues.length;d<m;d++){var k=a.codedValues[d];if(b.isDefined(c)&&n.exists("code",k)&&c.toString()===k.code.toString())return k.name}return c}return c||
null},getTypeName:function(b,a){for(var c=a.length,d=0;d<c;d++)if(b===a[d].id)return a[d].name;return b}};z.addRelativePathInCss=M;z.url={isAbsolute:function(b){return!b?!1:b.startWith("http")||b.startWith("/")},removeQueryParamFromUrl:function(b,a){var c=K.urlToObject(b);c.query&&delete c.query[a];var d=c.path,m;for(m in c.query)d=d===c.path?d+"?"+m+"\x3d"+c.query[m]:d+"\x26"+m+"\x3d"+c.query[m];return d},addQueryParamToUrl:function(b,a,c){b=K.urlToObject(b);b.query||(b.query={});b.query[a]=c;a=
b.path;for(var d in b.query)a=a===b.path?a+"?"+d+"\x3d"+b.query[d]:a+"\x26"+d+"\x3d"+b.query[d];return a}};z.processUrlInWidgetConfig=function(b,a){if(b)return b.startWith("data:")||b.startWith("http")||b.startWith("/")?b:b.startWith("${appPath}")?b.replace("${appPath}",window.appInfo.appPath):a+b};z.processUrlInAppConfig=function(b){if(b)return b.startWith("data:")||b.startWith("http")||b.startWith("/")?b:window.appInfo.appPath+b};z.getLocationUrlWithoutHashAndQueryParams=function(){var b=window.location,
a=b.protocol+"//"+b.host+b.pathname,b=K.urlToObject(b.href);b.query&&b.query.apiurl&&(a=z.url.addQueryParamToUrl(a,"apiurl",b.query.apiurl));return a};z.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};z.invertColor=function(b){b=b.substring(1);3===b.length&&(b=b.slice(0,1)+b.slice(0,1)+b.slice(1,1)+b.slice(1,1)+b.slice(2,1)+b.slice(2,1));b=parseInt(b,16);return 7829367<b?"#000000":"#ffffff"};z.mixinAppConfigPosition=function(b,a){var c=n.clone(b);if(!a)return c;
a=n.clone(a);var d=c.widgetOnScreen,m=a.widgetOnScreen;m&&m.widgets&&("[object Object]"===Object.prototype.toString.call(m.widgets)?f.forEach(d.widgets,function(b,a){var c;c=b.uri?b.uri:"ph_"+a;m.widgets[c]&&m.widgets[c].position&&(m.widgets[c].position.relativeTo||(m.widgets[c].position.relativeTo="map"),b.position=m.widgets[c].position)},this):f.forEach(m.widgets,function(b,a){b.position&&!b.position.relativeTo&&(b.position.relativeTo="map");d.widgets[a]&&b.position&&(d.widgets[a].position=b.position)}));
m&&m.groups&&("[object Object]"===Object.prototype.toString.call(m.groups)?f.forEach(d.groups,function(b,a){var c;c=b.label?b.label:"g_"+a;m.groups[c]&&(m.groups[c].panel&&m.groups[c].panel.position)&&(m.groups[c].panel.position.relativeTo||(m.groups[c].panel.position.relativeTo="map"),b.panel.position=m.groups[c].panel.position)},this):f.forEach(m.groups,function(b,a){b.panel&&(b.panel.position&&!b.panel.position.relativeTo)&&(b.panel.position.relativeTo="map");d.groups[a]&&b.panel.position&&(d.groups[a].panel.position=
b.panel.position)}));a.map&&a.map.position&&(c.map?c.map.position=a.map.position:c.map={position:a.map.position});a.widgetPool&&a.widgetPool.panel&&(a.widgetPool.panel.position&&!a.widgetPool.panel.position.relativeTo&&(a.widgetPool.panel.position.relativeTo="map"),c.widgetPool.panel.position=a.widgetPool.panel.position);a.mobileLayout&&(c.mobileLayout=a.mobileLayout);return c};z.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(b,a,c){var d=
-1;a=b.search(RegExp(a));0<=a&&(b=b.slice(a,b.length),b=b.indexOf(c),d=a+b+c.length);return{firstPos:a,lastPos:d}},setConfigValue:function(b,a,c){Q(b,a,c)},getConfigValue:function(b,a){return Q(b,a)},setConfigValueWithId:function(b,a,c){U(b,a,c)},getConfigValueWithId:function(b,a){return U(b,a)},getKeyInfo:function(b){var a=this.getWidgetIdByKey(b);if(null!==a)return{type:"widget",id:a};b=this.getGroupIdByKey(b);return null!==b?{type:"group",id:b}:{type:"unknow",id:null}},getWidgetIdByKey:function(b){var a=
z.template.getSearchRange(b,z.template.widgetIdentification,"]");if(-1===a.firstPos)b=null;else{var c=b.slice(a.firstPos,a.lastPos);b=b.slice(a.firstPos+c.indexOf("[")+1,a.lastPos-1)}return b},getGroupIdByKey:function(b){var a=z.template.getSearchRange(b,z.template.groupIdentification,"]");if(-1===a.firstPos)b=null;else{var c=b.slice(a.firstPos,a.lastPos);b=b.slice(a.firstPos+c.indexOf("[")+1,a.lastPos-1)}return b},getConfigedWidgetsByTemplateConfig:function(b){var a=[],c=z.template.widgetIdentification+
"_config",d;f.forEach(b.configurationSettings,function(b){f.forEach(b.fields,function(b){b.fieldName&&(d=z.template.getSearchRange(b.fieldName,c,"]"),0<=d.firstPos&&(b=z.template.getWidgetIdByKey(b.fieldName),-1===a.indexOf(b)&&a.push(b)))},this)},this);return a},mergeTemplateAppConfigToAppConfig:function(b,a,c){function d(b){var a=[];f.forEach(b,function(b){b&&a.push(b)},this);return a}var m=b.widgetOnScreen,k=b.portalUrl;a.values.webmap&&(b.map.itemId=a.values.webmap);c&&(b.map.mapOptions&&z.deleteMapOptions(b.map.mapOptions),
b.map.portalUrl=k,a.values.app_title||(a.values.app_title=c.title),a.values.app_subtitle||(a.values.app_subtitle=c.snippet));for(var l in a.values)"webmap"!==l&&z.template.setConfigValueWithId(b,l,a.values[l]);b.widgetPool.widgets=d(b.widgetPool.widgets);m.widgets=d(m.widgets);if(b.widgetPool.groups)for(a=0;a<b.widgetPool.groups.length;a++)b.widgetPool.groups[a].widgets=d(b.widgetPool.groups[a].widgets);if(m.groups)for(a=0;a<m.groups.length;a++)m.groups[a].widgets=d(m.groups[a].widgets);return b}};
z.deleteMapOptions=function(b){b&&(delete b.extent,delete b.lods,delete b.center,delete b.scale,delete b.zoom,delete b.maxScale,delete b.maxZoom,delete b.minScale,delete b.minZoom)};z.graphicsExtent=function(b,a){var c=null;try{0<b.length&&(c=J.graphicsExtent(b))&&"number"===typeof a&&0<a&&(c=c.expand(a))}catch(d){console.error(d)}return c};z.sanitizeHTML=function(b){return html_sanitize(b,function(b){return b},function(b){return b})};z.stripHTML=function(b){return!b?b:-1<b.indexOf("\x3c")&&-1<b.indexOf("\x3e")?
b.replace(/<(?:.|\s)*?>/g,""):b};z.removeSuffixSlashes=function(b){return b.replace(/\/*$/g,"")};z.getBestDisplayAttributes=function(b,a){var c={},d=null,m;for(m in b)d=z.getBestDisplayValue(m,b,a),c[m]=d;return c};z.getBestDisplayValue=function(b,a,c){var d="",m=null;n.isArrayLike(c)?m=z.getFieldInfoByFieldName(c,b):"object"===typeof c&&c.name===b&&(m=c);m&&(d=a[b],"esriFieldTypeDate"===m.type?d&&(b=new Date(parseInt(d,10)),d=z._tryLocaleDate(b)):"number"===typeof d&&(m.domain&&"codedValue"===m.domain.type?
f.some(m.domain.codedValues,function(b){if(b.code===d)return d=b.name,!0}):d=z._tryLocaleNumber(d)));if(null===d||void 0===d)d="";return d};z.getDefaultPortalFieldInfo=function(b){var a=b.name,a={fieldName:a,label:b.alias||a,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(b.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":a.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":a.format={places:2,digitSeparator:!0};break;
case "esriFieldTypeDate":a.format={dateFormat:"longMonthDayYear"}}return a};z._tryLocaleNumber=function(b){var a=z.localizeNumber(b);if(null===a||void 0===a)a=b;return a};z._tryLocaleDate=function(b){var a=z.localizeDate(b);a||(a=b.toLocaleDateString());return a};z.getFieldInfoByFieldName=function(b,a){var c=null;b&&0<b.length&&f.some(b,n.hitch(this,function(b){return b.name===a?(c=b,!0):!1}));return c};z.containsNonLatinCharacter=function(b){for(var a=0;a<b.length;a++)if(255<b.charCodeAt(a))return!0;
return!1};z.has=function(b){var a=h(b);if(a)return a;if("ie"===b.toLowerCase()){b=0;var c=/MSIE (\d+\.\d+);/.test(navigator.userAgent),d=!!navigator.userAgent.match(/Trident\/7.0/),m=navigator.userAgent.indexOf("rv:11.0");c&&(b=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(b=10);d&&-1!==m&&(b=11);return 11===b&&11||a}if("edge"===b.toLowerCase())return navigator.userAgent.split("Edge/")[1]||a};z.detectUserAgent=function(){var b={},a={},c=navigator.userAgent,d=navigator.platform,
m=c.match(/Web[kK]it[\/]{0,1}([\d.]+)/),k=c.match(/(Android);?[\s\/]+([\d.]+)?/),l=!!c.match(/\(Macintosh\; Intel /),q=c.match(/(iPad).*OS\s([\d_]+)/),t=c.match(/(iPod)(.*OS\s([\d_]+))?/),e=!q&&c.match(/(iPhone\sOS)\s([\d_]+)/),x=c.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),d=/Win\d{2}|Windows/.test(d),f=c.match(/Windows Phone ([\d.]+)/),v=x&&c.match(/TouchPad/),s=c.match(/Kindle\/([\d.]+)/),p=c.match(/Silk\/([\d._]+)/),r=c.match(/(BlackBerry).*Version\/([\d.]+)/),g=c.match(/(BB10).*Version\/([\d.]+)/),
w=c.match(/(RIM\sTablet\sOS)\s([\d.]+)/),h=c.match(/PlayBook/),u=c.match(/Chrome\/([\d.]+)/)||c.match(/CriOS\/([\d.]+)/),y=c.match(/Firefox\/([\d.]+)/),C=c.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),A=c.match(/MSIE\s([\d.]+)/)||c.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),E=!u&&c.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),n=E||c.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);a.webkit=!!m;a.webkit&&(a.version=m[1]);k&&(b.android=!0,b.version=k[2]);
e&&!t&&(b.ios=b.iphone=!0,b.version=e[2].replace(/_/g,"."));q&&(b.ios=b.ipad=!0,b.version=q[2].replace(/_/g,"."));t&&(b.ios=b.ipod=!0,b.version=t[3]?t[3].replace(/_/g,"."):null);f&&(b.wp=!0,b.version=f[1]);x&&(b.webos=!0,b.version=x[2]);v&&(b.touchpad=!0);r&&(b.blackberry=!0,b.version=r[2]);g&&(b.bb10=!0,b.version=g[2]);w&&(b.rimtabletos=!0,b.version=w[2]);h&&(a.playbook=!0);s&&(b.kindle=!0,b.version=s[1]);p&&(a.silk=!0,a.version=p[1]);!p&&(b.android&&c.match(/Kindle Fire/))&&(a.silk=!0);u&&(a.chrome=
!0,a.version=u[1]);y&&(a.firefox=!0,a.version=y[1]);C&&(b.firefoxos=!0,b.version=C[1]);A&&(a.ie=!0,a.version=A[1]);if(n&&(l||b.ios||d))a.safari=!0,b.ios||(a.version=n[1]);E&&(a.webview=!0);b.tablet=!(!q&&!h&&!(k&&!c.match(/Mobile/)||y&&c.match(/Tablet/)||A&&!c.match(/Phone/)&&c.match(/Touch/)));b.phone=!(b.tablet||b.ipod||!k&&!e&&!x&&!r&&!g&&!(u&&c.match(/Android/)||u&&c.match(/CriOS\/([\d.]+)/)||y&&c.match(/Mobile/)||A&&c.match(/Touch/)));return{os:b,browser:a}};z.isMobileUa=function(){var b=z.detectUserAgent();
return!0===b.os.phone||!0===b.os.tablet?!0:!1};z.inMobileSize=function(){var b=g.getMarginBox(window.jimuConfig.layoutId);if(b.w<=window.jimuConfig.breakPoints[0]||b.h<=window.jimuConfig.breakPoints[0])return g.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;g.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};z.getObjectIdField=function(b){if(b.objectIdField)return b.objectIdField;b=b.fields;for(var a=0;a<b.length;a++){var c=b[a];if("esriFieldTypeOID"===c.type)return c.name}return null};
z.isNeedHttpsButNot=function(){return window.hasOwnProperty("isSecureContext")&&!window.isSecureContext?!0:!1};z.toFeatureSet=function(b){var a=new G;"[object Object]"===Object.prototype.toString.call(b)&&(b=[b]);a.features=b;if(0<b.length){var c;f.some(b,function(b){if(b.geometry)return c=b,!0});if(c){b=c.getLayer();var d={};b&&(a.displayFieldName=b.displayField,f.forEach(b.fields,n.hitch(this,function(b){var a=b.name;d[a]=b.alias||a})),a.fieldAliases=d);a.geometryType=c.geometry.type;a.spatialReference=
c.geometry.spatialReference}}return a};z.showValidationErrorTipForFormDijit=function(b){try{!b.validate()&&b.domNode&&b.focusNode&&(b.focusNode.focus(),setTimeout(n.hitch(this,function(){b.focusNode.blur()}),100))}catch(a){console.error(a)}};z.getFeatureLayerDefinition=function(b){var a=null,c=b.graphics;b.graphics=[];var d=b.toJson();b.graphics=c;d&&(a=d.layerDefinition);return a};z.simulateClickEvent=function(b){if(h("safari")){var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0);
b.dispatchEvent(a)}else b.click()};z.getFeatureSetByLayerAndFeatures=function(b,a){var c=new G;c.fields=n.clone(b.fields);c.features=a;c.geometryType=b.geometryType;c.fieldAliases={};f.forEach(c.fields,n.hitch(this,function(b){var a=b.name;c.fieldAliases[a]=b.alias||a}));return c};z.featureAction=function(){return{zoomTo:function(b,a,c){c||(c={});c.hasOwnProperty("extentFactor")||(c.extentFactor=1.2);if(b&&a&&0<a.length){var d=f.every(a,function(b){return b&&b.spatialReference&&b.type});if(f.every(a,
function(b){return b&&b.geometry&&b.geometry.spatialReference&&b.geometry.type})||d)d&&(a=f.map(a,function(b){return{geometry:b}})),1===a.length&&"point"===a[0].type?(c=15,c=-1<b.getMaxZoom()?b.getMaxZoom():0.1,b.centerAndZoom(a[0].geometry,c)):(a=J.graphicsExtent(a),b.setExtent(a.expand(c.extentFactor)))}},flash:function(b,a){function c(b,a){f.forEach(m,function(c,d){c.setSymbol(a?b:l[d]||q)})}function d(b){return function(){setTimeout(function(){c(t,!0);m[0]&&a&&a.redraw();setTimeout(function(){c(null,
!1);m[0]&&a&&a.redraw();b()},200)},200)}}if(f.every(b||[],function(b){return b&&b.geometry})){var m=b,k=m[0],l=f.map(m,function(b){return b.symbol}),q=k.symbol||n.getObject("renderer.symbol",!1,a),t=null;a&&"esriGeometryPoint"===a.geometryType?t=new I(require.toUrl("jimu")+"/images/flash.gif",20,20):(t=n.clone(q))&&(t.outline?t.outline.setColor("#ffc500"):t.setColor("#ffc500"));k&&(q&&t&&a)&&("esriGeometryPoint"===a.geometryType?(c(t,!0),a.redraw(),setTimeout(function(){c(null,!1);a.redraw()},2E3)):
d(d(d(function(){})))())}},panTo:function(b,a){if(f.every(a||[],function(b){return b&&b.geometry})){var c;0<a.length?c=J.graphicsExtent(a).getCenter():(c=a[0].geometry,c="polyline"===c.type||"polygon"===c.type?c.getExtent().getCenter():"extent"===c.type?c.getCenter():"multipoint"===c.type?1<c.points.length?c.getExtent().getCenter():c.getPoint(0):c);b.centerAt(c)}},showPopup:function(b,a){if(f.every(a||[],function(b){return b&&b.geometry})){var c=b.infoWindow;c.setFeatures(a);var d=a[0];"point"===
d.geometry.type?c.show(d.geometry,{closetFirst:!0}):c.show(d.geometry.getExtent().getCenter(),{closetFirst:!0})}}}}();z.getAppIdFromUrl=function(){var b=!0,a=window.top.location.href;if(-1!==a.indexOf("id\x3d")||-1!==a.indexOf("appid\x3d")||-1!==a.indexOf("apps"))b=!1;if(!0===b)return a;b=this.urlToObject(window.location.href);if(b.query&&(b.query.id||b.query.appid))return b.query.id||b.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(b=window.appInfo.appPath.split("/"),
b.length&&2<b.length)return b[b.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};z.getEditorContentHeight=function(b,a,c){var d=new l;this._content=b;this._dom=a;this._domParam=c;var m=setTimeout(n.hitch(this,function(){clearTimeout(m);m=null;var b=0,a=this._domParam.contentWidth;try{var c=document.createElement("div");c.setAttribute("id","fakeContent");g.setStyle(c,"background-size","contain");c.innerHTML=this._content;this._dom.appendChild(c);if(c){var k=r("img",c);k&&k.length&&k.style({maxWidth:a-
20+"px"});g.setStyle(c,"position","absolute");g.setStyle(c,"width",a+"px");g.setStyle(c,"left","-99999px");g.setStyle(c,"top","-99999px");g.setStyle(c,"visibility","hidden");var l=g.getContentBox(c);l.h&&(b=l.h,b+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(q){console.error("can't getEditorContentHeight"+q),b=200}d.resolve(b)}),1500);return d};return z})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(n,f,g){var h=n.NodeList;
f.extend(h,{_buildArrayFromCallback:function(e){for(var f=[],r=0;r<this.length;r++){var a=e.call(this[r],this[r],f);a&&(f=f.concat(a))}return f},_getUniqueAsNodeList:function(e){for(var f=[],r=0,a;a=e[r];r++)1==a.nodeType&&-1==g.indexOf(f,a)&&f.push(a);return this._wrap(f,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(e,f){var r=this._getUniqueAsNodeList(e),r=f?n._filterResult(r,f):r;return r._stash(this)},_getRelatedUniqueNodes:function(e,f){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(f),
e)},children:function(e){return this._getRelatedUniqueNodes(e,function(e,r){return f._toArray(e.childNodes)})},closest:function(e,f){return this._getRelatedUniqueNodes(null,function(r,a){do if(n._filterResult([r],e,f).length)return r;while(r!=f&&(r=r.parentNode)&&1==r.nodeType);return null})},parent:function(e){return this._getRelatedUniqueNodes(e,function(e,f){return e.parentNode})},parents:function(e){return this._getRelatedUniqueNodes(e,function(e,f){for(var a=[];e.parentNode;)e=e.parentNode,a.push(e);
return a})},siblings:function(e){return this._getRelatedUniqueNodes(e,function(e,f){for(var a=[],l=e.parentNode&&e.parentNode.childNodes,d=0;d<l.length;d++)l[d]!=e&&a.push(l[d]);return a})},next:function(e){return this._getRelatedUniqueNodes(e,function(e,f){for(var a=e.nextSibling;a&&1!=a.nodeType;)a=a.nextSibling;return a})},nextAll:function(e){return this._getRelatedUniqueNodes(e,function(e,f){for(var a=[],l=e;l=l.nextSibling;)1==l.nodeType&&a.push(l);return a})},prev:function(e){return this._getRelatedUniqueNodes(e,
function(e,f){for(var a=e.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;return a})},prevAll:function(e){return this._getRelatedUniqueNodes(e,function(e,f){for(var a=[],l=e;l=l.previousSibling;)1==l.nodeType&&a.push(l);return a})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(e,f){return 0!=f%2})},odd:function(){return this.filter(function(e,
f){return 0==f%2})}});return h})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(n){n=n.getObject("dojox.encoding.base64",!0);n.encode=function(f){for(var g=[],h=f.length,e=h%3,h=h-e,p=0;p<h;){var r=f[p++]<<16|f[p++]<<8|f[p++];g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>18&63));g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>12&63));g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>
6&63));g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r&63))}switch(e){case 2:r=f[p++]<<16|f[p++]<<8;g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>18&63));g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>12&63));g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6&63));g.push("\x3d");break;case 1:r=f[p++]<<16,g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>
18&63)),g.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>12&63)),g.push("\x3d"),g.push("\x3d")}return g.join("")};n.decode=function(f){f=f.split("");for(var g=[],h=f.length;"\x3d"==f[--h];);for(var e=0;e<h;){var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<18;e<=h&&(p|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<12);e<=h&&(p|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++])<<
6);e<=h&&(p|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[e++]));g.push(p>>>16&255);g.push(p>>>8&255);g.push(p&255)}for(;0==g[g.length-1];)g.pop();return g};return n})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(n,f,g,h,e,p,r,a){return n(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,
transformForward:null,toJson:function(){var l=g.map(this.geometries,function(a){return a.toJson()}),d={};d.outSR=this.outSR.wkid||h.toJson(this.outSR.toJson());d.inSR=this.geometries[0].spatialReference.wkid||h.toJson(this.geometries[0].spatialReference.toJson());d.geometries=h.toJson({geometryType:a.getJsonType(this.geometries[0]),geometries:l});this.transformation&&(d.transformation=this.transformation.wkid||h.toJson(this.transformation));r.isDefined(this.transformForward)&&(d.transformForward=
this.transformForward);return d}})})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(n,f){var g=n.clone(f);g.declaredClass="jimu.portalUrlUtils";g.getPortalUrlFromLocation=function(){return g.getPortalServerFromLocation()+g.getDeployContextFromLocation()};g.getPortalSignInUrlFromLocation=function(){var f=g.getPortalUrlFromLocation()+"home/signin.html";return f=g.setHttpsProtocol(f)};g.getPortalServerFromLocation=function(){return window.location.protocol+
"//"+window.location.host};g.getDeployContextFromLocation=function(){var f=window.location.href.split("?")[0],e=f.indexOf("/home");0>e&&(e=f.indexOf("/apps"));f=f.substring(f.indexOf(window.location.host)+window.location.host.length+1,e);"/"!==f&&(f="/"+f+"/");return f};g.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+g.getDeployContextFromLocation()+"sharing/rest/"};return g})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var n={declaredClass:"jimu.shared.basePortalUrlUtils"};
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(f){return this.substr(0,f.length)===f});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(f){return this.substr(this.length-f.length,f.length)===f});n.getServerByUrl=function(f){f=(f||"").trim();f=f.replace(/^(http(s?):?)\/\//gi,"");0===f.indexOf("//")&&
(f=f.slice(2));return f.split("/")[0]};n.getServerWithProtocol=function(f){var g="";if(f=(f||"").trim()){var h=n.getServerByUrl(f);if(!h)return g;var e=n.getProtocol(f);e?g=e+"://"+h:0===f.indexOf("//")&&(g="//"+h)}return g};n.isSameServer=function(f,g){f=n.getServerByUrl(f)||"";g=n.getServerByUrl(g)||"";return f.toLowerCase()===g.toLowerCase()};n.getDomain=function(f){var g="";if(f=n.getServerByUrl(f))f=f.replace(/:\d+$/,""),f=f.match(/[^.]\w+\.\w+$/),null!==f&&(g=f[0],/^\d+\.\d+$/.test(g)&&(g=""));
return g};n.isSameDomain=function(f,g){var h=n.getDomain(f),e=n.getDomain(g);return""!==h&&h===e};n.isOnline=function(f){return 0<=n.getServerByUrl(f).toLowerCase().indexOf(".arcgis.com")};n.isArcGIScom=function(f){f=n.getServerByUrl(f).toLowerCase();return"www.arcgis.com"===f||"arcgis.com"===f};n.getStandardPortalUrl=function(f){var g=n.getServerByUrl(f);if(""===g)return"";n.isOnline(g)?(n.isArcGIScom(g)&&(g="www.arcgis.com"),f=n.addProtocol(f),f=n.getProtocol(f)+"://"+g):(f=(f||"").trim().replace(/sharing(.*)/gi,
"").replace(/\/*$/g,""),f=n.addProtocol(f),f.replace(RegExp("http(s?)://"+g,"g"),"")||(f+="/arcgis"));return f};n.isSamePortalUrl=function(f,g){var h=/^http(s?):\/\//gi,e=/^\/\//gi;f=n.getStandardPortalUrl(f).toLowerCase().replace(h,"").replace(e,"");g=n.getStandardPortalUrl(g).toLowerCase().replace(h,"").replace(e,"");return f===g};n.addProtocol=function(f){if(-1>=f.toLowerCase().indexOf("http://")&&-1>=f.toLowerCase().indexOf("https://")){var g="";"undefined"!==typeof window&&window.location?(g=
window.location.protocol,f=f.startWith("//")?g+f:f.startWith("/")?g+"//"+window.location.host+f:g+"//"+f):(g="http:",f=f.startWith("//")?g+f:g+"//"+f)}return f};n.getProtocol=function(f){var g="";f=f.toLowerCase();0===f.indexOf("https://")?g="https":0===f.indexOf("http://")&&(g="http");return g};n.updateUrlProtocolByOtherUrl=function(f,g){g=g.toLowerCase();0===g.indexOf("https://")?f=n.setHttpsProtocol(f):0===g.indexOf("http://")&&(f=n.setHttpProtocol(f));return f};n.removeProtocol=function(f){return f.replace(/^http(s?):\/\//i,
"//")};n.setHttpProtocol=function(f){f=n.addProtocol(f);return f.replace(/^https:\/\//,"http://")};n.setHttpsProtocol=function(f){f=n.addProtocol(f);return f.replace(/^http:\/\//,"https://")};n.setProtocol=function(f,g){return 0<=g.indexOf("https")?n.setHttpsProtocol(f):0<=g.indexOf("http")?n.setHttpProtocol(f):f};n.getSharingUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/sharing/rest");return g};n.getOAuth2Url=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/sharing/rest/oauth2");
return g};n.getAppIdUrl=function(f,g){var h="",e=n.getStandardPortalUrl(f);e&&(h=e+"/sharing/rest/oauth2/apps/"+g);return h};n.getSignInUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/home/signin.html");return g};n.getBaseSearchUrl=function(f){var g="";f=n.getStandardPortalUrl(f);(f=f.replace(/\/*$/g,""))&&(g=f+"/sharing/rest/search");return g};n.getBaseItemUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/sharing/rest/content/items");return g};n.getItemUrl=function(f,
g){var h="",e=n.getBaseItemUrl(f);e&&g&&(h=e+"/"+g);return h};n.getItemDataUrl=function(f,g){var h="",e=n.getItemUrl(f,g);e&&(h=e+"/data");return h};n.getItemGroupsUrl=function(f,g){var h="",e=n.getItemUrl(f,g);e&&(h=e+"/groups");return h};n.getGenerateTokenUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/sharing/rest/generateToken");return g};n.getItemDetailsPageUrl=function(f,g){var h="";f&&g&&(f=n.getStandardPortalUrl(f),h=f+"/home/item.html?id\x3d"+g);return h};n.getUserProfilePageUrl=
function(f,g){var h="";f&&g&&(f=n.getStandardPortalUrl(f),h=f+"/home/user.html?user\x3d"+g);return h};n.getBaseGroupUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/sharing/rest/community/groups");return g};n.getPortalSelfInfoUrl=function(f){var g="";(f=n.getStandardPortalUrl(f||""))&&(g=f+"/sharing/rest/portals/self");return g};n.getCommunitySelfUrl=function(f){var g="";(f=n.getStandardPortalUrl(f||""))&&(g=f+"/sharing/rest/community/self");return g};n.getBaseUserUrl=function(f){var g=
"";(f=n.getStandardPortalUrl(f))&&(g=f+"/sharing/rest/community/users");return g};n.getUserUrl=function(f,g){var h="",e=n.getBaseUserUrl(f);f&&g&&(h=e+"/"+g);return h};n.getUserTagsUrl=function(f,g){var h="",e=n.getUserUrl(f,g);f&&g&&(h=e+"/tags");return h};n.getUserThumbnailUrl=function(f,g,h){var e="";(f=n.getUserUrl(f,g))&&h&&(e=f+"/info/"+h);return e};n.getContentUrl=function(f){var g="";f&&(f=n.getStandardPortalUrl(f),g=f+"/sharing/rest/content");return g};n.getUserContentUrl=function(f,g,h){var e=
"",e="";f&&g&&(e=n.getContentUrl(f),e=h?e+"/users/"+g+"/"+h:e+"/users/"+g);return e};n.getAddItemUrl=function(f,g,h){var e="",e="";f&&g&&(e=n.getUserContentUrl(f,g,h),e+="/addItem");return e};n.getDeleteItemUrl=function(f,g,h){var e="";(f=n.getUserItemsUrl(f,g))&&(e=f+"/"+h+"/delete");return e};n.getUserItemsUrl=function(f,g,h){var e="",e="";f&&g&&(e=n.getUserContentUrl(f,g,h),e+="/items");return e};n.getUpdateItemUrl=function(f,g,h,e){var p="",p="";f&&g&&(p=n.getUserItemsUrl(f,g,e),p=p+"/"+h+"/update");
return p};n.shareItemUrl=function(f,g,h,e){var p="",p="";f&&g&&(p=n.getUserItemsUrl(f,g,e),p=p+"/"+h+"/share");return p};n.getHomeIndexUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/home/index.html");return g};n.getHomeMapViewerUrl=function(f,g){var h="",e=n.getStandardPortalUrl(f);e&&(h=e+"/home/webmap/viewer.html",h=g?h+("?webmap\x3d"+g):h+"?useExisting\x3d1");return h};n.getHomeSceneViewerUrl=function(f,g){var h="",e=n.getStandardPortalUrl(f);e&&(h=e+"/home/webscene/viewer.html",
g&&(h+="?webscene\x3d"+g));return h};n.getHomeGalleryUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/home/gallery.html");return g};n.getHomeGroupsUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/home/groups.html");return g};n.getHomeMyContentUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/home/content.html");return g};n.getHomeMyOrganizationUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/home/organization.html");return g};n.getHomeUserUrl=
function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/home/user.html");return g};n.getPortalHelpUrl=function(f,g){var h="",e=n.getStandardPortalUrl(f);e&&(h=e+"/portalhelp/"+(g||"en")+"/website/help/");return h};n.getPortalAdminHelpUrl=function(f,g){var h="",e=n.getStandardPortalUrl(f);e&&(h=e+"/portalhelp/"+(g||"en")+"/admin/help/");return h};n.getPortalProxyUrl=function(f){var g="";(f=n.getStandardPortalUrl(f))&&(g=f+"/sharing/proxy");return g};n.getOAuth2SignOutUrl=function(f){var g="";(f=
n.getStandardPortalUrl(f))&&(g=f+"/sharing/rest/oauth2/signout");return g};n.getNewPrintUrl=function(f){var g="";if(f=n.getStandardPortalUrl(f))f=n.setHttpProtocol(f),g=f+"/sharing/tools/newPrint";return g};return n})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(n){function f(e,f){function r(a,l){var d,f,q,k,c="widgetOnScreen"===a;if(e[a]){if(e[a].groups)for(d=0;d<e[a].groups.length;d++)if(q=e[a].groups[d],l(q,{index:d,isWidget:!1,groupId:q.id,isThemeWidget:!1,isOnScreen:c}),
e[a].groups[d].widgets)for(f=0;f<e[a].groups[d].widgets.length;f++)k=e[a].groups[d].widgets[f],l(k,{index:f,isWidget:!0,groupId:q.id,isThemeWidget:k.uri&&-1<k.uri.indexOf("themes/"+e.theme.name),isOnScreen:c});if(e[a].widgets)for(d=0;d<e[a].widgets.length;d++)k=e[a].widgets[d],l(e[a].widgets[d],{index:d,isWidget:!0,groupId:a,isThemeWidget:k.uri&&-1<k.uri.indexOf("themes/"+e.theme.name),isOnScreen:c})}}r("widgetOnScreen",f);r("widgetPool",f)}var g={},h="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");
g.visitElement=f;g.getConfigElementById=function(e,p){var r;if("map"===p)return e.map;f(e,function(a){if(a.id===p)return r=a,!0});return r};g.getConfigElementByLabel=function(e,p){var r;if("map"===p)return e.map;f(e,function(a){if(a.label||a.name===p)return r=a,!0});return r};g.getConfigElementsByName=function(e,p){var r=[];if("map"===p)return[e.map];f(e,function(a){a.name===p&&r.push(a)});return r};g.getWidgetNameFromUri=function(e){e=e.split("/");e.pop();return e.pop()};g.getAmdFolderFromUri=function(e){e=
e.split("/");e.pop();return e.join("/")+"/"};g.widgetProperties=h;g.processWidgetProperties=function(e){"undefined"===typeof e.properties.isController&&(e.properties.isController=!1);"undefined"===typeof e.properties.isThemeWidget&&(e.properties.isThemeWidget=!1);"undefined"===typeof e.properties.hasVersionManager&&(e.properties.hasVersionManager=!1);h.forEach(function(f){"undefined"===typeof e.properties[f]&&(e.properties[f]=!0)})};g.getControllerWidgets=function(e){var f=[];e.visitElement(function(e){e.isController&&
f.push(e)});return f};g.addI18NLabelToManifest=function(e,f,r){function a(a,d){d[l]&&(e.i18nLabels[a]=d[l]);"theme"===e.category&&(e.layouts&&e.layouts.forEach(function(k){e["i18nLabels_layout_"+k.name]||(e["i18nLabels_layout_"+k.name]={});e["i18nLabels_layout_"+k.name][a]=d["_layout_"+k.name]}),e.styles&&e.styles.forEach(function(k){e["i18nLabels_style_"+k.name]||(e["i18nLabels_style_"+k.name]={});e["i18nLabels_style_"+k.name][a]=d["_style_"+k.name]}));"widget"===e.category&&e.featureActions&&e.featureActions.forEach(function(k){e["i18nLabels_featureAction_"+
k.name]||(e["i18nLabels_featureAction_"+k.name]={});e["i18nLabels_featureAction_"+k.name][a]=d["_featureAction_"+k.name]})}e.i18nLabels={};var l="widget"===e.category?"_widgetLabel":"_themeLabel";f&&(f.root&&f.root[l])&&(e.i18nLabels.defaultLabel=f.root[l],"theme"===e.category&&(e.layouts&&e.layouts.forEach(function(a){e["i18nLabels_layout_"+a.name]={};e["i18nLabels_layout_"+a.name].defaultLabel=f.root["_layout_"+a.name]}),e.styles&&e.styles.forEach(function(a){e["i18nLabels_style_"+a.name]={};e["i18nLabels_style_"+
a.name].defaultLabel=f.root["_style_"+a.name]})),"widget"===e.category&&e.featureActions&&e.featureActions.forEach(function(a){e["i18nLabels_featureAction_"+a.name]={};e["i18nLabels_featureAction_"+a.name].defaultLabel=f.root["_featureAction_"+a.name]}));for(var d in r)a(d,r[d])};g.isHostedService=function(e){var f=n.getServerByUrl(e)+"/[^/]+/[^/]+/rest/services";return RegExp(f,"gi").test(e)};return g})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t){var b=null,v=n(r,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(p.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),p.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(p.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),p.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(p.subscribe("app/sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),p.subscribe("app/sceneViewChanged",
f.hitch(this,this._onSceneViewChanged))):(p.subscribe("sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),p.subscribe("sceneViewChanged",f.hitch(this,this._onSceneViewChanged)));window.isBuilder?(p.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),p.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(p.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),p.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));p.subscribe("userSignIn",
f.hitch(this,this._onUserSignIn));p.subscribe("userSignOut",f.hitch(this,this._onUserSignOut));p.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered));p.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart))},loadWidget:function(b){var a=new e,c;b=f.clone(b);(c=this.getWidgetById(b.id))?a.resolve(c):k([this.loadWidgetClass(b),this.loadWidgetManifest(b)]).then(f.hitch(this,function(b){var c=b[0],d=b[1];this.loadWidgetResources(d).then(f.hitch(this,function(b){try{var m=this.createWidget(d,
c,b);h.setAttr(m.domNode,"data-widget-name",d.name);console.log("widget ["+d.uri+"] created.")}catch(k){console.log("create ["+d.uri+"] error:"+k.stack),new t({message:window.jimuNls.widgetManager.createWidgetError+": "+d.uri}),a.reject(k)}setTimeout(f.hitch(this,function(){a.resolve(m);this.emit("widget-created",m);p.publish("widgetCreated",m)}),50)}),function(b){a.reject(b)})}),function(b){a.reject(b)});return a},loadWidgetClass:function(b){var a=new e,d;d=b.isRemote?b.uri+".js":b.uri;require(c.getRequireConfig(),
[d],f.hitch(this,function(b){a.resolve(b)}));c.checkError(b.uri,a);return a},loadWidgetResources:function(b){var a=new e,c,d,m,l=[];m=f.clone(b);b=this.tryLoadWidgetConfig(m);c=this._tryLoadResource(m,"i18n");d=this._tryLoadResource(m,"style");m=this._tryLoadResource(m,"template");l.push(b);l.push(c);l.push(m);l.push(d);k(l).then(f.hitch(this,function(b){var c={};c.config=b[0];c.i18n=b[1];c.template=b[2];c.style=b[3];a.resolve(c)}),function(b){a.reject(b)});return a},loadWidgetManifest:function(b){var a=
new e,d=c.getUriInfo(b.uri).folderUrl+"manifest.json";if(b.manifest)return a.resolve(b),a;q(d,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(d){d.category="widget";f.mixin(d,c.getUriInfo(b.uri));c.manifest.addI18NLabel(d).then(f.hitch(this,function(){this._processManifest(d);c.widgetJson.addManifest2WidgetJson(b,d);a.resolve(b)}))}),function(b){a.reject(b)});return a},getWidgetMarginBox:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return{};if(b._marginBox)return b._marginBox;
b.setPosition({left:-9999,top:-9999,relativeTo:b.position.relativeTo});this.openWidget(b);b._marginBox=b.getMarginBox();this.closeWidget(b);return b._marginBox},_processManifest:function(b){c.manifest.addManifestProperies(b);c.manifest.processManifestLabel(b,window.dojoConfig.locale)},createWidget:function(b,d,m){if(this.getWidgetById(b.id))return this.getWidgetById(b.id);m.config&&m.i18n&&(m.config=c.replacePlaceHolder(m.config,m.i18n));b.rawConfig=b.config;b.config=m.config||{};this.appConfig._appData&&
this._mergeAgolConfig(b);b.nls=m.i18n||{};m.template&&(b.templateString=m.template);b["class"]="jimu-widget";b.label||(b.label=b.name);this.map&&(b.map=this.map);b.appConfig=this.appConfig;m={};for(var k in b)b.hasOwnProperty(k)&&(m[k]=b[k]);m.widgetManager=this;b=new d(m);b.clazz=d;l.after(b,"startup",f.hitch(this,this._postWidgetStartup,b));l.before(b,"destroy",f.hitch(this,this._onDestroyWidget,b));a(b.domNode,"click",f.hitch(this,this._onClickWidget,b));this.loaded.push(b);return b},getAllWidgets:function(){return this.loaded},
destroyAllWidgets:function(){var b=g.map(this.loaded,function(b){return b.id});g.forEach(b,function(b){this.destroyWidget(b)},this);this.loaded=[]},loadWidgetSettingPage:function(b){var a=new e;b=f.clone(b);b.id+="_setting";k([this.loadWidgetSettingClass(b)]).then(f.hitch(this,function(c){var d=c[0];this.loadWidgetSettingPageResources(b).then(f.hitch(this,function(c){var m;c={nls:c.i18n,templateString:c.template,appConfig:this.appConfig,"class":"jimu-widget-setting"};"HTML3D"===window.appInfo.appType?
c.sceneView=this.sceneView:c.map=this.map;for(var k in b)b.hasOwnProperty(k)&&(c[k]=b[k]);try{m=new d(c),h.setAttr(m.domNode,"data-widget-name-setting",c.name),l.before(m,"destroy",f.hitch(this,this._onDestroyWidgetSetting,m)),a.resolve(m)}catch(q){new t({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+b.uri}),a.reject(q)}}),function(b){console.log(b)})}),function(b){a.reject(b)});return a},loadWidgetSettingClass:function(b){var a=new e,d;d=b.isRemote?b.folderUrl+"setting/Setting.js":
b.amdFolder+"setting/Setting";require(c.getRequireConfig(),[d],f.hitch(this,function(b){a.resolve(b)}));c.checkError(b.folderUrl+"setting/Setting.js",a);return a},loadWidgetSettingPageResources:function(b){var a=new e,c,d,m=[];b=f.clone(b);c=this._tryLoadResource(b,"settingI18n");d=this._tryLoadResource(b,"settingTemplate");b=this._tryLoadResource(b,"settingStyle");m.push(c);m.push(d);m.push(b);k(m).then(f.hitch(this,function(b){var c={};c.i18n=b[0]||{};c.template=b[1];c.style=b[2];a.resolve(c)}),
function(b){console.log(b)});return a},getWidgetById:function(b){var a;g.some(this.loaded,function(c){if(c.id===b)return a=c,!0},this);return a},getWidgetByLabel:function(b){var a;g.some(this.loaded,function(c){if(c.label===b)return a=c,!0},this);return a},getWidgetsByName:function(b){var a=[];g.some(this.loaded,function(c){c.name===b&&a.push(c)},this);return a},changeWindowStateTo:function(b,a){"normal"===a?this.normalizeWidget(b):"minimized"===a?this.minimizeWidget(b):"maximized"===a?this.maximizeWidget(b):
console.log("error state: "+a)},closeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;if("closed"!==b.state){this.activeWidget&&this.activeWidget.id===b.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);h.setStyle(b.domNode,"display","none");b.setState("closed");try{b.onClose()}catch(a){console.log(console.error("fail to close widget "+b.name+". "+a.stack))}}},openWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;if(!b.started)try{b.started=
!0,b.startup()}catch(a){console.error("fail to startup widget "+b.name+". "+a.stack)}if("closed"===b.state){h.setStyle(b.domNode,"display","");b.setState("opened");try{b.onOpen()}catch(c){console.error("fail to open widget "+b.name+". "+c.stack)}}},activateWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"opened"===b.state&&this._activeWidget(b)},maximizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&this.openWidget(b);
b.setWindowState("maximized");try{b.onMaximize()}catch(a){console.log(console.error("fail to maximize widget "+b.name+". "+a.stack))}},minimizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&this.openWidget(b);b.setWindowState("minimized");try{b.onMinimize()}catch(a){console.log(console.error("fail to minimize widget "+b.name+". "+a.stack))}},normalizeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;"closed"===b.state&&
this.openWidget(b);b.setWindowState("normal");try{b.onNormalize()}catch(a){console.log(console.error("fail to normalize widget "+b.name+". "+a.stack))}},destroyWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;this._removeWidget(b);try{b.destroy()}catch(a){console.log(console.error("fail to destroy widget "+b.name+". "+a.stack))}},tryLoadWidgetConfig:function(b){return this._tryLoadWidgetConfig(b).then(f.hitch(this,function(a){return this._upgradeWidgetConfig(b,a).then(function(a){return b.config=
a})}))},triggerWidgetOpen:function(b){function a(b){var d=l.after(b,"onOpen",function(){d.remove();c.resolve(b)})}var c=new e,d=this.getWidgetById(b);if(d){if("closed"!==d.state)return c.resolve(d),c;a(d)}else var m=p.subscribe("widgetCreated",f.hitch(this,function(a){a.id===b&&(m.remove(),c.resolve(a))}));p.publish("openWidget",b);return c},_tryLoadWidgetConfig:function(b){var a=new e;if(b.config&&f.isObject(b.config))return a.resolve(b.config),a;if(b.config){if(require.cache["url:"+b.config])return a.resolve(d.parse(require.cache["url:"+
b.config])),a;a=c.processUrlInAppConfig(b.config);a=a.split("/");a[a.length-1]=encodeURIComponent(a[a.length-1]);a=a.join("/");return q(a,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(b,"config").then(function(a){b.isDefaultConfig=!0;return a})},_upgradeWidgetConfig:function(b,a){var d=new e,m=b.manifest.version,k=b.version,l;if(m===k)return d.resolve(a),d;if(!1===b.hasVersionManager)return b.version=m,d.resolve(a),d;require(c.getRequireConfig(),[b.amdFolder+"VersionManager"],
f.hitch(this,function(c){c=new c;var q=c.getVersionIndex(k),t=c.getVersionIndex(m);if(q>t)d.reject("Bad widget version number, "+b.name+","+k);else try{l=c.upgrade(a,k,m),b.version=m,d.resolve(l)}catch(e){console.log("Read widget ["+b.name+"] old config error,"+e.stack),d.resolve(a)}}));return d},loadWidgetStyle:function(b){var a="widget/style/"+b.uri,d=new e,a=this._replaceId(a);return h.byId(a)?(d.resolve("load"),d):c.loadStyleLink(a,b.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},
loadWidgetSettingStyle:function(b){var a="widget/style/"+b.uri+"/setting",d=new e,a=this._replaceId(a);return h.byId(a)?(d.resolve("load"),d):c.loadStyleLink(a,b.settingStyleFile)},loadWidgetConfig:function(b){b=require(c.getRequireConfig()).toUrl(b.configFile);if(require.cache["url:"+b]){var a=new e;a.resolve(d.parse(require.cache["url:"+b]));return a}return q(b,{handleAs:"json",headers:{"X-Requested-With":null}})},loadWidgetI18n:function(b){var a=new e;require(c.getRequireConfig(),["dojo/i18n!"+
b.i18nFile],function(b){a.resolve(b)});return a},loadWidgetSettingI18n:function(b){var a=new e;require(c.getRequireConfig(),["dojo/i18n!"+b.settingI18nFile],function(b){a.resolve(b)});return a},loadWidgetTemplate:function(b){var a=new e;require(c.getRequireConfig(),["dojo/text!"+b.templateFile],function(b){a.resolve(b)});c.checkError(b.templateFile,a);return a},loadWidgetSettingTemplate:function(b){var a=new e;require(c.getRequireConfig(),["dojo/text!"+b.settingTemplateFile],function(b){a.resolve(b)});
c.checkError(b.settingTemplateFile,a);return a},removeWidgetStyle:function(b){h.destroy(this._replaceId("widget/style/"+b.uri))},removeWidgetSettingStyle:function(b){h.destroy(this._replaceId("widget/style/"+b.uri+"/setting"))},getControllerWidgets:function(){return g.filter(this.loaded,function(b){return b.isController})},getOffPanelWidgets:function(){return g.filter(this.loaded,function(b){return!b.inPanel})},getOnScreenOffPanelWidgets:function(){return g.filter(this.loaded,function(b){return b.isOnScreen&&
!b.inPanel})},closeOtherWidgetsInTheSameGroup:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===b.gid&&this.loaded[a].id!==b.id&&this.closeWidget(this.loaded[a])},closeAllWidgetsInGroup:function(b){for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===b&&this.closeWidget(this.loaded[a])},_mergeAgolConfig:function(b){var a=this.appConfig._appData.values,d="widgets["+b.id+"]",m;for(m in a){var k=m.replace(/\//g,"_").indexOf(d+
"_config");0<=k&&c.template.setConfigValue(b,m.replace(/\//g,"_").substr(k,m.length).replace(d,"widget"),a[m])}},_onUserSignIn:function(b){g.forEach(this.loaded,function(a){a.onSignIn(b)},this)},_onUserSignOut:function(){g.forEach(this.loaded,function(b){b.onSignOut()},this)},_activeWidget:function(b){if(this.activeWidget){if(this.activeWidget.id===b.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&
(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&h.setStyle(b.domNode,"zIndex","zIndex"in b.position?b.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=b;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),p.publish("widgetActived",b))},_onClickWidget:function(b,a){var c=s(".jimu-widget",
b.domNode);if(0<c.length)for(var d=0;d<c.length;d++)if(a.target===c[d]||h.isDescendant(a.target,c[d]))return;this._activeWidget(b)},_onMoveStart:function(b){g.forEach(this.loaded,function(a){a.domNode===b.node&&this._activeWidget(a)},this)},_onAppConfigLoaded:function(b){this.appConfig=b=f.clone(b);m.setPortalUrl(b.portalUrl)},_onMapLoaded:function(b){this.map=b},_onMapChanged:function(b){this.map=b},_onSceneViewLoaded:function(b){this.sceneView=b},_onSceneViewChanged:function(b){this.sceneView=b},
_onAppConfigChanged:function(b,a,c,d){var m=f.clone(b);this.appConfig=m;g.forEach(this.loaded,function(b){b&&(b.onAppConfigChanged(m,a,c,d),"widgetChange"===a&&this._onConfigChanged(c.id,c.config,d))},this)},_onConfigChanged:function(b,a){var c=this.getWidgetById(b);c&&(c.onConfigChanged(a),f.mixin(c.config,a))},_onActionTriggered:function(b){if(!("map"===b.elementId||"app"===b.elementId)){var a=this.getWidgetById(b.elementId);if(a)a.onAction(b.action,b.data);else this.missedActions.push({id:b.elementId,
action:{name:b.action,data:b.data}});g.forEach(this.getControllerWidgets(),function(a){if(a.widgetIsControlled(b.elementId))a.onAction(b.action,{widgetId:b.elementId,data:b.data})},this)}},_postWidgetStartup:function(b){b.started=!0;c.setVerticalCenter(b.domNode);l.after(b,"resize",f.hitch(this,c.setVerticalCenter,b.domNode));this.openWidget(b);var a=m.getPortalCredential(this.appConfig.portalUrl);if(a)b.onSignIn(a);else b.onSignOut();this._triggerMissedAction(b)},_triggerMissedAction:function(b){this.missedActions.forEach(function(a){if(a.id===
b.id)b.onAction(a.action.name,a.action.data)})},_remove:function(b){return g.some(this.loaded,function(a,c){if(a.id===b)return this.loaded.splice(c,1),!0},this)},_tryLoadResource:function(b,a){var c,d=new e;if("config"===a)c=b.amdFolder+"config.json",b.configFile=c,c="hasConfig";else if("style"===a)c=b.amdFolder+"css/style.css",b.styleFile=c,c="hasStyle";else if("i18n"===a)c=b.amdFolder+"nls/strings.js",b.i18nFile=b.isRemote?c:b.amdFolder+"nls/strings",c="hasLocale";else if("template"===a)c=b.amdFolder+
"Widget.html",b.templateFile=c,c="hasUIFile";else if("settingTemplate"===a)c=b.amdFolder+"setting/Setting.html",b.settingTemplateFile=c,c="hasSettingUIFile";else if("settingI18n"===a)c=b.amdFolder+"setting/nls/strings.js",b.settingI18nFile=b.isRemote?c:b.amdFolder+"setting/nls/strings",c="hasSettingLocale";else if("settingStyle"===a)c=b.amdFolder+"setting/css/style.css",b.settingStyleFile=c,c="hasSettingStyle";else return d;b[c]?function(){var c;if("config"===a)c=this.loadWidgetConfig(b);else if("style"===
a)c=this.loadWidgetStyle(b);else if("i18n"===a)c=this.loadWidgetI18n(b);else if("template"===a)c=this.loadWidgetTemplate(b);else if("settingTemplate"===a)c=this.loadWidgetSettingTemplate(b);else if("settingStyle"===a)c=this.loadWidgetSettingStyle(b);else if("settingI18n"===a)c=this.loadWidgetSettingI18n(b);else return d;c.then(function(b){d.resolve(b)},function(a){new t({message:window.jimuNls.widgetManager.loadWidgetResourceError+": "+b.uri});d.reject(a)})}.apply(this):d.resolve(null);return d},
_replaceId:function(b){return b.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(b){"closed"!==b.state&&this.closeWidget(b);this._removeWidget(b);this.emit("widget-destroyed",b.id);p.publish("widgetDestroyed",b.id);console.log("destroy widget ["+b.uri+"].")},_onDestroyWidgetSetting:function(b){this.removeWidgetSettingStyle(b)},_removeWidget:function(b){if("string"===typeof b&&(b=this.getWidgetById(b),!b))return;this.activeWidget&&this.activeWidget.id===b.id&&(this.activeWidget=null);
this._remove(b.id);0===this.getWidgetsByName(b.name).length&&this.removeWidgetStyle(b)}});v.getInstance=function(a){null===b&&(b=new v(a),window._widgetManager=b);return b};return v})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,
q,k,c,m,t){"function"!==typeof e.getAll&&(e.getAll=function(b){var a=[];(b=e(b))&&a.push(b);return a});k={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){var b=!1;try{b=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(a){console.log(a),b=!1}return!!b},isStringStartWith:function(b,a){return b.substr(0,a.length)===a},getCookiePath:function(){return this.cookiePath},
setPortalUrl:function(b){(b=m.getStandardPortalUrl(b))&&(b+="/");this.portalUrl=b},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(b){var c=new h,k=m.getStandardPortalUrl(b);b=k+"/sharing";var t=m.setHttpsProtocol(k+"/sharing/rest/generateToken?f\x3djson"),e=m.setHttpsProtocol(b);a.get(t,{jsonp:"callback"}).then(n.hitch(this,function(b){b.token?(this.webTierPortalUrls.push(k),this.removeWabAuthCookie(),l.id.getCredential(e).then(n.hitch(this,function(a){a.token||(a.token=b.token);
a=q.canUseXhr(a.server,!0);-1<a&&d.defaults.io.corsEnabledServers.splice(a,1);this._pushCorsEnabledServerInfo({host:m.getServerByUrl(k),withCredentials:!0});c.resolve(!0)}),n.hitch(this,function(){c.resolve(!0)}))):c.resolve(!1)}),n.hitch(this,function(b){console.error(b);c.reject(b)}));return c},addAuthorizedCrossOriginDomains:function(b){if(b&&0<b.length)for(var a=0;a<b.length;a++)this.addWithCredentialDomain(b[a])},addWithCredentialDomain:function(b){if(b&&"string"===typeof b){var a=d.defaults.io.corsEnabledServers,
c=m.getServerByUrl(b);(b=m.getServerWithProtocol(b))||(b="http://"+c);b=q.canUseXhr(b,!0);-1<b&&a.splice(b,1);this._pushCorsEnabledServerInfo({host:c,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(b){if(b){var a=d.defaults.io.corsEnabledServers,c="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");
if("object"===typeof b&&"string"===typeof b.host){for(var m in b.host)b[m]="function"===typeof b.host[m]?function(){return b.host[m].apply(b.host,arguments)}:b.host[m];b.length=b.host.length;f.forEach(c,function(a){"function"===typeof b.host[a]&&(b[a]=function(){return b.host[a].apply(b.host,arguments)})})}a.push(b)}},tryRegisterCredential:function(b){return!this.isValidCredential(b)?!1:!f.some(l.id.credentials,n.hitch(this,function(a){return b.token===a.token}))?(l.id.credentials.push(b),!0):!1},
registerToken:function(b){var a=m.getSharingUrl(this.portalUrl);l.id.findCredential(a)&&f.some(l.id.credentials,n.hitch(this,function(b,a){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,b))return l.id.credentials.splice(a,1),!0}));return this._getTokenInfo(b).then(function(b){l.id.registerToken(b)})},_getTokenInfo:function(b){var c=m.getPortalSelfInfoUrl(this.portalUrl);return a.get(c+("?f\x3djson\x26token\x3d"+b),{jsonp:"callback"}).then(n.hitch(this,function(a){if(a.user)return{server:m.getSharingUrl(this.portalUrl),
ssl:a.allSSL,token:b,userId:a.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(b){console.error(b);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(b){return b&&"string"===typeof b&&n.trim(b)},signInPortal:function(b){var a=new h;if(this._isInvalidPortalUrl(b)){b=m.getStandardPortalUrl(b);var c=m.getSharingUrl(b),d=this.getPortalCredential(b);d?setTimeout(n.hitch(this,function(){a.resolve(d)}),0):a=l.id.getCredential(c)}else setTimeout(n.hitch(this,
function(){a.reject("Invalid portalurl.")}),0);return a},_loadPortalSelfInfo:function(b){b=m.getPortalSelfInfoUrl(b);return s({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(b,a){if(!b||!("string"===typeof b&&a&&"string"===typeof a))return null;var d=l.id.findOAuthInfo(b);d||(d=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",d=new c({appId:a,expiration:20160,portalUrl:b,authNamespace:"/",popup:!0,
popupCallbackUrl:d}),l.id.registerOAuthInfos([d]));d.appId=a;return d},signOutAll:function(){var b=m.getStandardPortalUrl(this.portalUrl),a=!!l.id.findCredential(b+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();l.id.destroyCredentials();l.id._oAuthHash=null;a&&this._publishCurrentPortalUserSignOut(b)},userHaveSignInPortal:function(b){return!!this.getPortalCredential(n.trim(b||""))},isValidCredential:function(b){var a=!1;if(b){var a=b.token,
c=b.server,d=b.scope,a=a&&"string"===typeof a&&n.trim(a),c=c&&"string"===typeof c&&n.trim(c),d="portal"===d||"server"===d,m=!0;b.expires&&(b=parseInt(b.expires,10),m=(new Date).getTime(),m=b>m);a=a&&c&&d&&m}return a},isValidPortalCredentialOfPortalUrl:function(b,a){var c=!1;if(this.isValidCredential(a))var c="portal"===a.scope,d=m.isSameServer(b,a.server),c=c&&d;return c},getPortalCredential:function(b){var a=null;b=n.trim(b||"");if(!b)return null;b=m.getStandardPortalUrl(b);return a=this._filterPortalCredential(b,
l.id.credentials)},saveAndRegisterCookieToCredential:function(b){b=n.clone(b);b.referer=window.location.host;b.scope="portal";b.isAdmin=!!b.isAdmin;this.saveWabCookie(b);var a=b.server+"/sharing/rest";b.server=a;l.id.registerToken(b);return l.id.findCredential(a,b.userId)},registerAuth2Hash:function(b){b=n.clone(b);var a=1E3*parseInt(b.expires_in,10),a=(new Date).getTime()+a,c=m.getStandardPortalUrl(b.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:c,
token:b.access_token,expires:a,userId:b.username,scope:"portal",isAdmin:!!b.isAdmin})},saveWabCookie:function(b){this.removeCookie("wab_auth");e("wab_auth",p.stringify(b),{expires:new Date(b.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(b,
a){var c=null;if(a&&0<a.length){var d=f.filter(a,n.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<d.length&&(c=d[d.length-1])}return c},_removePortalCredential:function(b){var a=n.trim(b||"");if(a){a=m.getStandardPortalUrl(a);for(b=f.filter(l.id.credentials,n.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)}));0<b.length;)b[0].destroy(),b.splice(0,1);l.id.credentials=f.filter(l.id.credentials,n.hitch(this,function(b){return!this.isValidPortalCredentialOfPortalUrl(a,
b)}))}},getUserIdByToken:function(b,a){var c=new h;if(b&&"string"===typeof b&&a&&"string"===typeof a){var d=m.getStandardPortalUrl(a),k=f.filter(l.id.credentials,n.hitch(this,function(a){var c=a.token===b&&a.userId;a=m.isSameServer(d,a.server);return c&&a}));if(0<k.length){var q=k[0];setTimeout(n.hitch(this,function(){c.resolve(q.userId)}),0);return c}k=m.getCommunitySelfUrl(d);s({url:k,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,function(b){c.resolve(b&&b.username||
"")}),n.hitch(this,function(b){console.error(b);c.reject("fail to get userId by token")}))}else setTimeout(n.hitch(this,function(){c.reject("invalid parameters")}),0);return c},xtGetCredentialFromCookie:function(b){var a=e("wab_auth"),c=null;if(a)try{c=p.parse(a)}catch(d){console.error(d)}if(!(c&&"object"===typeof c)||!m.isSameServer(b,c.server)||window.location.host!==c.referer)return null;c.expires=parseInt(c.expires,10);a=(new Date).getTime();if(!(c.expires>a))return this.removeCookie("wab_auth"),
null;b+="/sharing/rest";c.server=b;(a=l.id.findCredential(b))||l.id.registerToken(c);return a=l.id.findCredential(b)},removeCookie:function(b){var a=this.getCookiePath();t.removeCookie(b,a)},_getDomainsByServerName:function(b){var a=b.split("."),c=a.length;return f.map(a,n.hitch(this,function(b,d){var m=a.slice(d,c),k="",l=m.length-1;f.forEach(m,n.hitch(this,function(b,a){k+=b;a!==l&&(k+=".")}));return k}))},_publishCurrentPortalUserSignIn:function(b){if(this.isValidCredential(b))try{r.publish("userSignIn",
b)}catch(a){console.error(a)}},_publishAnyUserSignIn:function(b){if(this.isValidCredential(b))try{r.publish("anyUserSignIn",b)}catch(a){console.error(a)}},_publishCurrentPortalUserSignOut:function(b){try{r.publish("userSignOut",b)}catch(a){console.error(a)}},_signInSuccess:function(b){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,b)&&this._publishCurrentPortalUserSignIn(b),this._publishAnyUserSignIn(b)}catch(a){console.error(a)}},_bindEvents:function(){g.after(l.id,"signIn",n.hitch(this,
function(b,a){console.log(a[1]);g.after(b,"callback",n.hitch(this,function(b,a){this._signInSuccess(a[0],!1)}));return b}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var b=window.parent;if(b){var a=b.esri&&b.esri.id;a&&(l.id=a,a=window.esriConfig.defaults.io,b=b.esriConfig.defaults.io,a.corsEnabledServers=b.corsEnabledServers,a.webTierAuthServers=b.webTierAuthServers,a._processedCorsServers=b._processedCorsServers,a.corsStatus=
b.corsStatus)}}this._bindEvents();this._started=!0}}};k.startup();return k})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(n,f,g,h,e,p){return n(p,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=
g.create("div",{"class":"title"},this.domNode),this.titleLabeNode=g.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=g.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(e(this.closeBtnNode,"click",f.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:h.ENTER,onClick:f.hitch(this,this.close)})},_increaseZIndex:function(){g.setStyle(this.domNode,
"zIndex",501);g.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q){var k=0;return n(s,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,
autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._positioning();h.place(this.domNode,this.container);setTimeout(f.hitch(this,function(){this._moveToMiddle()}),50);this.own(p(window,"resize",f.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),
this._moveToMiddle()):this._positioning()})));this.overlayNode=h.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();e.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=h.create("div",{"class":"title"},this.domNode);this.titleLabeNode=h.create("span",
{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=h.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var c=null,c="ontouchstart"in document?a.press:"click";this.own(p(this.closeBtnNode,c,f.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=h.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=
this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&h.place(this.content,this.contentContainerNode));this.buttonContainer=h.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&h.setStyle(this.buttonContainer,"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=
this.enabledButtons.length;if(0!==a){var d=h.getContentBox(this.buttonContainer),k=h.getMarginExtents(this.enabledButtons[0]),b=h.getPadBorderExtents(this.enabledButtons[0]),l=0,b=8===r("ie")?b.l+b.r:0,l=(d.w-(k.l+k.r+b)*a)/a;0<l&&(g.forEach(this.enabledButtons,f.hitch(this,function(b){h.setStyle(b,"maxWidth",l+"px")})),g.forEach(this.disabledButtons,f.hitch(this,function(b){h.setStyle(b,"maxWidth",l+"px")})))}},_moveableNode:function(a,m){this.moveable&&(this.moveable.destroy(),this.moveable=null);
var k=h.getMarginBox(this.container);k.l=k.l-a+m;k.w+=2*(a-m);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:k,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(p(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(p(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===l("#header").length?{t:0,l:0,w:0,h:0}:h.getMarginBox("header")},_getFooterBox:function(){return 0===l(".footer",this.container).length?{t:0,l:0,w:0,
h:0}:h.getMarginBox(l(".footer",this.container)[0])},_calculatePosition:function(){var a=h.getContentBox(this.container),d=this._getHeaderBox(),k=this._getFooterBox(),k=a.h-d.h-k.h-40,b=0;b=this._fixedHeight?this.height:this.autoHeight?k-200:this.height=k>this.maxHeight?this.maxHeight:k;k=(k-b)/2+d.h+20;k=k<d.h?d.h:k;this.width=this.width||this.maxWidth;h.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:k+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(h.setStyle(this.domNode,
"height","auto"),h.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&h.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(h.setStyle(this.domNode,"height",this.height+"px"),h.addClass(this.contentContainerNode,"content-absolute"),h.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&h.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=h.getMarginBox(this.domNode),
d=h.getContentBox(this.container),k=this._getHeaderBox(),b=this._getFooterBox(),b=d.h-k.h-b.h-40,l=0,l=a.h||b-200,a=(b-l)/2+k.h+20,a=a<k.h?k.h:a;h.setStyle(this.domNode,{left:(d.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){h.setStyle(this.domNode,"zIndex",k+200+1);h.setStyle(this.overlayNode,"zIndex",k+200);k++},setTitleLabel:function(a){this.titleNode.innerHTML=q.stripHTML(a)},onMoving:function(a){h.setStyle(a.node,
"opacity",0.9)},onMoveStop:function(a){h.setStyle(a.node,"opacity",1)},close:function(){if(!(this.onClose&&!1===this.onClose())){var a=this.domNode.parentNode,d=f.clone(this.domNode);h.setStyle(this.domNode,"display","none");h.destroy(this.overlayNode);this.destroy();this.moveable.destroy();h.place(d,a);e.animateProperty({node:d,properties:{opacity:0},duration:200,onEnd:function(){h.destroy(d)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var d=" ";a.classNames&&
0<a.classNames.length&&"function"===typeof a.classNames.join&&(d+=a.classNames.join(" "));var k=h.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+d,innerHTML:a.label,title:a.title||a.label},this.buttonContainer);this.enabledButtons.unshift(k);d=h.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+d,title:a.title||a.label,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(d);
this.own(p(k,"click",f.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})))},setButtonProps:function(a,d){"number"===typeof a&&isFinite(a)||(d=a,a=0);if(d&&0!==this.enabledButtons.length)for(var k in d)"title"===k?(h.setAttr(this.enabledButtons[a],"title",d[k]),h.setAttr(this.disabledButtons[a],"title",d[k])):"label"===k&&(h.setProp(this.enabledButtons[a],"innerHTML",d[k]),h.setProp(this.disabledButtons[a],"innerHTML",d[k]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&
a<this.enabledButtons.length?(h.setStyle(this.enabledButtons[a],"display","inline-block"),h.setStyle(this.disabledButtons[a],"display","none")):(g.forEach(this.enabledButtons[a],f.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),g.forEach(this.disabledButtons[a],f.hitch(this,function(a){h.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(h.setStyle(this.disabledButtons[a],"display","inline-block"),h.setStyle(this.enabledButtons[a],
"display","none")):(g.forEach(this.disabledButtons,f.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),g.forEach(this.enabledButtons,f.hitch(this,function(a){h.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(h.setStyle(this.disabledButtons[a],"display","none"),h.setStyle(this.enabledButtons[a],"display","none")):(g.forEach(this.disabledButtons,f.hitch(this,function(a){h.setStyle(a,
"display","none")})),g.forEach(this.enabledButtons,f.hitch(this,function(a){h.setStyle(a,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(n,f,g,h,e,p){h=n("dojo.dnd.move.constrainedMoveable",p,{constraints:function(){},within:!1,constructor:function(e,a){a||(a={});this.constraints=a.constraints;this.within=a.within},onFirstMove:function(e){var a=this.constraintBox=this.constraints.call(this,
e);a.r=a.l+a.w;a.b=a.t+a.h;this.within&&(e=f.getMarginSize(e.node),a.r-=e.w,a.b-=e.h)},onMove:function(e,a){var l=this.constraintBox,d=e.node.style;this.onMoving(e,a);a.l=a.l<l.l?l.l:l.r<a.l?l.r:a.l;a.t=a.t<l.t?l.t:l.b<a.t?l.b:a.t;d.left=a.l+"px";d.top=a.t+"px";this.onMoved(e,a)}});e=n("dojo.dnd.move.boxConstrainedMoveable",h,{box:{},constructor:function(e,a){var l=a&&a.box;this.constraints=function(){return l}}});n=n("dojo.dnd.move.parentConstrainedMoveable",h,{area:"content",constructor:function(e,
a){var l=a&&a.area;this.constraints=function(){var a=this.node.parentNode,e=g.getComputedStyle(a),q=f.getMarginBox(a,e);if("margin"==l)return q;var k=f.getMarginExtents(a,e);q.l+=k.l;q.t+=k.t;q.w-=k.w;q.h-=k.h;if("border"==l)return q;k=f.getBorderExtents(a,e);q.l+=k.l;q.t+=k.t;q.w-=k.w;q.h-=k.h;if("padding"==l)return q;k=f.getPadExtents(a,e);q.l+=k.l;q.t+=k.t;q.w-=k.w;q.h-=k.h;return q}}});return{constrainedMoveable:h,boxConstrainedMoveable:e,parentConstrainedMoveable:n}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager",
"./utils"],function(n,f){function g(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(f){return f},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(f){if(f.widgetOnScreen&&f.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===f.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===f.widgetOnScreen.panel.uri))f.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel";
return f},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(f){var e=0;if(f.widgetOnScreen&&f.widgetOnScreen.widgets){for(var p=!1,e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/Splash/Widget"===f.widgetOnScreen.widgets[e].uri&&(p=!0);p||f.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});p=!1;for(e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/TimeSlider/Widget"===f.widgetOnScreen.widgets[e].uri&&
(p=!0);p||f.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});p=!1;for(e=0;e<f.widgetOnScreen.widgets.length;e++)"widgets/Swipe/Widget"===f.widgetOnScreen.widgets[e].uri&&(p=!0);p||f.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return f},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(g){(function(e){f.visitElement(e,
function(e){e.positionRelativeTo&&(e.position?e.position.relativeTo=e.positionRelativeTo:e.position={relativeTo:e.positionRelativeTo},e.panel&&(e.panel.position?e.panel.position.relativeTo=e.panel.positionRelativeTo:e.panel.position={relativeTo:e.panel.positionRelativeTo}))});var p=e.widgetOnScreen;p&&(p.panel&&p.panel.positionRelativeTo)&&(p.panel.position?p.panel.position.relativeTo=p.panel.positionRelativeTo:p.panel.position={relativeTo:p.panel.positionRelativeTo});if((p=e.widgetPool)&&p.panel&&
p.panel.positionRelativeTo)p.panel.position?p.panel.position.relativeTo=p.panel.positionRelativeTo:p.panel.position={relativeTo:p.panel.positionRelativeTo}})(g);g.widgetOnScreen&&(g.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===g.widgetOnScreen.panel.uri)&&(g.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(e){if(e.widgetOnScreen&&e.widgetOnScreen.widgets&&e.theme&&"FoldableTheme"===e.theme.name){var f=null,g=null;if(f=e.widgetOnScreen.widgets[4])void 0!==f.position.top?(f={position:{left:205,
top:45}},g={position:{left:255,top:45}}):(f={position:{left:205,bottom:55}},g={position:{left:255,bottom:55}}),e.widgetOnScreen.widgets.splice(7,0,f,g)}})(g);(function(){for(var e=0,f=0,r=!1,e=0;e<g.widgetOnScreen.widgets.length;e++)if("widgets/Geocoder/Widget"===g.widgetOnScreen.widgets[e].uri){r=!0;break}for(var a=!1,f=0;f<g.widgetOnScreen.widgets.length;f++)if("widgets/Search/Widget"===g.widgetOnScreen.widgets[f].uri){a=!0;break}!a&&r&&(e=g.widgetOnScreen.widgets[e],e.uri="widgets/Search/Widget",
e.name="Search")})(g);(function(e){for(var f=0,f=e.widgetOnScreen.widgets.length-1;0<=f;f--){var g=e.widgetOnScreen.widgets[f];if("widgets/Swipe/Widget"===g.uri&&!g.closeable&&(e.widgetOnScreen.widgets.splice(f,1),!1!==g.visible)){g.closeable=!0;var a;a:{for(a=a=0;a<e.widgetOnScreen.widgets.length;a++)if(!e.widgetOnScreen.widgets[a].uri)break a;a=-1}0<=a&&(g.position=e.widgetOnScreen.widgets[a].position,e.widgetOnScreen.widgets[a]=g)}"widgets/TimeSlider/Widget"===g.uri&&(!1===g.visible?e.widgetOnScreen.widgets.splice(f,
1):g.closeable=!0)}})(g);g.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});g.loadingPage||(g.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return g},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(f){if(f.theme){var e=f.theme.name;if(("FoldableTheme"===e||"JewelryBoxTheme"===e)&&
f.widgetOnScreen){var g=f.widgetOnScreen.widgets;if(g&&0<g.length)for(var e="themes/"+e+"/widgets/HeaderController/Widget",r=null,a=0;a<g.length;a++)if((r=g[a])&&r.uri===e&&r.position&&310===r.position.paddingRight)r.position.paddingRight=275}}return f},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(f){f.keepAppState=!0;return f},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(f){return f},compatible:!0},
{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(f){return f},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(f){return f},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(f){return f},compatible:!0}];this.isCompatible=function(f,e){for(var g=this.getVersionIndex(f),r=this.getVersionIndex(e),g=g+1;g<=r;g++)if(!1===this.versions[g].compatible)return!1;return!0}}g.prototype=new n;
return g.prototype.constructor=g})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(n,f,g){f=this.getVersionIndex(f);g=this.getVersionIndex(g);if(f>g)throw Error("New version should higher than old version.");for(f+=1;f<=g;f++)this.versions[f].upgrader&&(n=this.versions[f].upgrader(n));return n};this.getVersionIndex=function(n){n=this.fixVersion(n);var f,g;for(g=0;g<this.versions.length;g++)this.versions[g].version===n&&(f=g);
null===n&&(f=-1);void 0===f&&(f=this.versions.length-1);return f};this.fixVersion=function(n){return!n?null:n}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),function(n,f,g,h,e,p,r,
a,l,d,s,q,k,c,m,t,b,v,x,y){var A=null,w;w=n(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(b,a){this._removeHash(b);this.urlParams=b||{};this.widgetManager=s.getInstance();f.mixin(this,a)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(f.hitch(this,function(b){var a=this.checkConfig(b);if(a)throw Error(a);this.rawAppConfig=f.clone(b);t.getInstance().setRawAppConfig(this.rawAppConfig);
b=this._upgradeAppConfig(b);this._processAfterTryLoad(b);this.appConfig=b;if(this.urlParams.id)return this.loadWidgetsManifest(b).then(f.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(b)})).then(f.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(b);return this.getAppConfig()}));k.setPortalUrl(b.portalUrl);y.arcgisUrl=m.getBaseItemUrl(b.portalUrl);return this._proesssWebTierAndSignin(b).then(f.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?
this._getAppConfigFromTemplateAppId(b.portalUrl,this.urlParams.appid).then(f.hitch(this,function(b){this._tryUpdateAppConfigByLocationUrl(b);return this._processInPortalAppProtocol(b)})):this._processNotInPortalAppProtocol(b).then(f.hitch(this,function(b){return this._getAppDataAddTemplateDataFromTemplateAppId(b.portalUrl,this.urlParams.appid).then(f.hitch(this,function(a){a.appData.appConfig&&(b=a.appData.appConfig);b._appData=a.appData;b.templateConfig=a.templateData;b.isTemplateApp=!0;return b}))})):
this._processNotInPortalAppProtocol(b)})).then(f.hitch(this,function(b){this._processAfterTryLoad(b);this.appConfig=b;return b.map.itemId?b:(b.map["3D"]?c.getDefaultWebScene(b.portalUrl):c.getDefaultWebMap(b.portalUrl)).then(function(a){b.map.itemId=a;return b})})).then(f.hitch(this,function(b){return this.loadWidgetsManifest(b)})).then(f.hitch(this,function(b){return b._appData?b._appData.values&&b._appData.values.webmap?c.getPortal(b.portalUrl).getItemById(b._appData.values.webmap).then(f.hitch(this,
function(a){return d.template.mergeTemplateAppConfigToAppConfig(b,b._appData,a)})):d.template.mergeTemplateAppConfigToAppConfig(b,b._appData):b})).then(f.hitch(this,function(b){return this.loadAndUpgradeAllWidgetsConfig(b)})).then(f.hitch(this,function(b){this._configLoaded=!0;this._setDocumentTitle(b);return this.getAppConfig()}))}),f.hitch(this,function(b){this.showError(b);var a=new r;a.reject(b);return a}))},_setDocumentTitle:function(b){!window.isBuilder&&(b&&b.title)&&(document.title=d.stripHTML(b.title))},
getAppConfig:function(){var b=f.clone(this.appConfig);b.getConfigElementById=function(b){return d.getConfigElementById(this,b)};b.getConfigElementsByName=function(b){return d.getConfigElementsByName(this,b)};b.visitElement=function(b){d.visitElement(this,b)};this._addAuthorizedCrossOriginDomains(this.portalSelf,b);return b},_addAuthorizedCrossOriginDomains:function(b,a){b&&b.authorizedCrossOriginDomains&&k.addAuthorizedCrossOriginDomains(b.authorizedCrossOriginDomains);a&&a.authorizedCrossOriginDomains&&
k.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains)},checkConfig:function(b){return(b=this._getRepeatedId(b))?"repeated id:"+b:null},processProxy:function(b){v.defaults.io.alwaysUseProxy=b.httpProxy&&b.httpProxy.useProxy&&b.httpProxy.alwaysUseProxy;v.defaults.io.proxyUrl="";v.defaults.io.proxyRules=[];b.httpProxy&&(b.httpProxy.useProxy&&b.httpProxy.url)&&(v.defaults.io.proxyUrl=b.httpProxy.url);b.httpProxy&&(b.httpProxy.useProxy&&b.httpProxy.rules)&&g.forEach(b.httpProxy.rules,function(b){x.addProxyRule(b)})},
addNeedValues:function(b){this._processNoUriWidgets(b);this._addElementId(b)},showError:function(b){b&&b.message&&h.create("div",{"class":"app-error",innerHTML:b.message},document.body)},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,l(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(b){k.setPortalUrl(b.portalUrl);
b.portalUrl&&(window.portalUrl=b.portalUrl);return this.urlParams.token?k.registerToken(this.urlParams.token).then(function(){return b}):b}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var b=m.getPortalUrlFromLocation(),a=new r;k.setPortalUrl(b);window.portalUrl=b;y.arcgisUrl=m.getBaseItemUrl(b);var d;this.urlParams.token?d=k.registerToken(this.urlParams.token):(d=new r,d.resolve());d.then(f.hitch(this,function(){c.getPortal(b).loadSelfInfo().then(f.hitch(this,function(c){this.portalSelf=
c;c.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),window.location.href=m.setHttpsProtocol(window.location.href),a.reject()):this._processSignIn(b).then(f.hitch(this,function(){this._getAppConfigFromAppId(b,this.urlParams.id).then(f.hitch(this,function(b){this._tryUpdateAppConfigByLocationUrl(b);return this._processInPortalAppProtocol(b)})).then(function(b){a.resolve(b)},function(b){a.reject(b)})}))}))}),f.hitch(this,function(b){this.showError(b)}));return a}this.configFile=
"config.json";return l(this.configFile,{handleAs:"json"}).then(f.hitch(this,function(b){k.setPortalUrl(b.portalUrl);b.portalUrl&&(window.portalUrl=b.portalUrl);return this.urlParams.token?k.registerToken(this.urlParams.token).then(function(){return b}):b}))},_upgradeAppConfig:function(b){var a=window.wabVersion,c=b.wabVersion;if(a===c)return b;var d=this.versionManager.getVersionIndex(c),m=this.versionManager.getVersionIndex(a);if(d>m)throw Error("Bad version number, "+c);b=this.versionManager.upgrade(b,
c,a);b.wabVersion=a;return b},loadAndUpgradeAllWidgetsConfig:function(b){var c=new r,d=[];q.visitElement(b,f.hitch(this,function(b){b.uri&&(b=this.widgetManager.tryLoadWidgetConfig(b),d.push(b))}));a(d).then(f.hitch(this,function(){c.resolve(b)}),function(b){c.reject(b)});return c},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);b.tokenValidity=10080;return a},_tryUpdateAppConfigByLocationUrl:function(b){if(!(this.urlParams.config&&
-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var a=m.getPortalUrlFromLocation(),a=m.getStandardPortalUrl(a);m.isOnline(a)&&(a=m.updateUrlProtocolByOtherUrl(a,b.portalUrl),b.map.portalUrl&&m.isSamePortalUrl(b.portalUrl,b.map.portalUrl)&&(b.map.portalUrl=a),b.portalUrl=a,b.httpProxy&&b.httpProxy.url&&(b.httpProxy.url=m.getPortalProxyUrl(a)))}},_processWidgetJsons:function(b){q.visitElement(b,function(b,a){a.isWidget&&b.uri&&d.widgetJson.processWidgetJson(b)})},_processNoUriWidgets:function(b){var a=
0;q.visitElement(b,function(b,c){c.isWidget&&!b.uri&&(a++,b.placeholderIndex=a)})},_addElementId:function(b){var a=0,c;q.visitElement(b,function(b){if(b.id){b.id=b.id.replace(/\//g,"_");var d=b.id.lastIndexOf("_");-1<d&&(c=b.id.substr(d+1),a=Math.max(a,c))}});q.visitElement(b,function(b){b.id||(a++,b.id=b.uri?b.uri.replace(/\//g,"_")+"_"+a:"_"+a)})},_setPortalUrl:function(b){if(b.portalUrl){var a=m.getPortalUrlFromLocation(),c=m.isOnline(a);!m.isSamePortalUrl(b.portalUrl,a)&&!c&&(window.appInfo.isRunInPortal=
!1)}else window.isXT&&p("wab_portalurl")?b.portalUrl=p("wab_portalurl"):(window.appInfo.isRunInPortal=!0,b.portalUrl=m.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(b,a){b.portalUrl=m.setProtocol(b.portalUrl,a);b.map.portalUrl&&(b.map.portalUrl=m.setProtocol(b.map.portalUrl,a));b.httpProxy&&(b.httpProxy.url=m.setProtocol(b.httpProxy.url,a),b.httpProxy&&b.httpProxy.rules&&g.forEach(b.httpProxy.rules,f.hitch(this,function(b){b.proxyUrl=m.setProtocol(b.proxyUrl,a)})))},_processInPortalAppProtocol:function(b){var a=
new r,d=c.getPortal(b.portalUrl),k=f.hitch(this,function(c){if("https:"===window.location.protocol)this._changePortalUrlProtocol(b,"https");else{if(c){console.log("redirect from http to https");window.location.href=m.setHttpsProtocol(window.location.href);a.reject();return}this._changePortalUrlProtocol(b,"http")}this._checkLocale();a.resolve(b)});d.loadSelfInfo().then(f.hitch(this,function(a){"private"===a.access?(a=0===b.portalUrl.toLowerCase().indexOf("https://"),k(a)):k(a.allSSL)}),f.hitch(this,
function(b){a.reject(b)}));return a},_processNotInPortalAppProtocol:function(b){var a=new r;b.portalUrl?c.getPortal(b.portalUrl).loadSelfInfo().then(f.hitch(this,function(c){var d="https:"===window.location.protocol;(c.allSSL||d)&&this._changePortalUrlProtocol(b,"https");0===b.portalUrl.toLowerCase().indexOf("https://")&&!d&&!k.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=m.setHttpsProtocol(window.location.href),a.reject()):a.resolve(b)}),f.hitch(this,
function(b){a.reject(b)})):a.resolve(b);return a},_proesssWebTierAndSignin:function(b){var a=new r,d=!1,m=b.portalUrl;this._processWebTier(b).then(f.hitch(this,function(b){d=b;return c.getPortal(m).loadSelfInfo()})).then(f.hitch(this,function(b){this.portalSelf=b;return this._processSignIn(m,d)})).then(f.hitch(this,function(){a.resolve()}),function(b){a.reject(b)});return a},_processWebTier:function(b){var a=new r,c=b.portalUrl;b.isWebTier?(k.addAuthorizedCrossOriginDomains([c]),k.isWebTierPortal(c).then(f.hitch(this,
function(){var d=k.getPortalCredential(c);d&&d.ssl&&"http:"===window.location.protocol&&!k.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=m.setHttpsProtocol(window.location.href)):a.resolve(b.isWebTier)}),f.hitch(this,function(b){a.reject(b)}))):a.resolve(!1);return a},_processSignIn:function(a,d){var l=new r,e=c.getPortal(a),q=m.getSharingUrl(a);window.appInfo.isRunInPortal?(q=b.checkSignInStatus(q),q.promise.always(f.hitch(this,function(){l.resolve()}))):
(!k.isInBuilderWindow()&&(!k.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!d)&&k.registerOAuthInfo(a,this.rawAppConfig.appId),q=b.checkSignInStatus(q),q.promise.always(f.hitch(this,function(){k.xtGetCredentialFromCookie(a);e.loadSelfInfo().then(f.hitch(this,function(b){this.portalSelf=b;this._checkLocale();l.resolve()}))})));return l},_checkLocale:function(){if(!k.isInConfigOrPreviewWindow()){var b=this.portalSelf.user&&this.portalSelf.user.culture||
e.locale,b=b.toLowerCase();!this.urlParams.locale&&d.isLocaleChanged(e.locale,b)&&(p("wab_app_locale",b),window.location.reload())}},_getAppConfigFromTemplateAppId:function(b,d){var m=c.getPortal(b);return this._getWabAppIdAndDataFromTemplateAppId(b,d).then(f.hitch(this,function(c){var d=c.appData;return a([this._getAppConfigFromAppId(b,c.appId),m.getItemData(d.source)]).then(f.hitch(this,function(b){var a;d.appConfig?(a=d.appConfig,delete d.appConfig):a=b[0];a=this._upgradeAppConfig(a);b=b[1];a._appData=
d;a.templateConfig=b;a.isTemplateApp=!0;return a}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(b,a){var d=c.getPortal(b);return d.getItemData(a).then(function(b){return d.getItemData(b.source).then(function(a){return{appData:b,templateData:a}})})},_getWabAppIdAndDataFromTemplateAppId:function(b,a){var d=new r,m=c.getPortal(b);m.getItemData(a).then(f.hitch(this,function(b){m.getItemById(b.source).then(f.hitch(this,function(a){a=x.urlToObject(a.url);d.resolve({appId:a.query.id,appData:b})}))}),
function(b){d.reject(b)});return d},_getAppConfigFromAppId:function(b,a){return c.getPortal(b).getItemData(a)},_removeHash:function(b){for(var a in b)b[a]&&(b[a]=b[a].replace("#",""))},loadWidgetsManifest:function(b){var c=[],m=new r;b._buildInfo&&b._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(f.hitch(this,function(k){q.visitElement(b,f.hitch(this,function(b){!b.widgets&&b.uri&&(k[b.uri]?(this._addNeedValuesForManifest(k[b.uri],b.uri),d.widgetJson.addManifest2WidgetJson(b,
k[b.uri])):c.push(this.widgetManager.loadWidgetManifest(b)))}));a(c).then(function(){m.resolve(b)})})):(q.visitElement(b,f.hitch(this,function(b){!b.widgets&&b.uri&&c.push(this.widgetManager.loadWidgetManifest(b))})),a(c).then(function(){m.resolve(b)}));setTimeout(function(){function a(b){function c(a){b[a]&&b[a].widgets&&(b[a].widgets=b[a].widgets.filter(function(b){b.uri&&!b.manifest&&console.error("Widget is removed because it is not loaded successfully.",b.uri);return b.manifest}));b[a]&&b[a].groups&&
b[a].groups.forEach(function(b){b.widgets&&(b.widgets=b.widgets.filter(function(b){b.uri&&!b.manifest&&console.error("Widget is removed because it is not loaded successfully.",b.uri);return b.manifest}))})}c("widgetOnScreen");c("widgetPool")}m.isResolved()||(a(b),m.resolve(b))},6E4);return m},_addNeedValuesForManifest:function(b,a){f.mixin(b,d.getUriInfo(a));d.manifest.addManifestProperies(b);d.manifest.processManifestLabel(b,e.locale)},_loadMergedWidgetManifests:function(){return l(window.appInfo.appPath+
"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(b){var a=[],c;q.visitElement(b,function(b){if(0<=a.indexOf(b.id))return c=b.id,!0;a.push(b.id)});return c},_processUrlParams:function(b){var a=this.urlParams.itemid||this.urlParams.webmap;a&&b.map.itemId!==a&&(b.map.mapOptions&&d.deleteMapOptions(b.map.mapOptions),b.map.itemId=a);this.urlParams.mode&&(b.mode=this.urlParams.mode);b.map.mapOptions||(b.map.mapOptions={});this.urlParams.scale&&(b.map.mapOptions.scale=this.urlParams.scale);
if(this.urlParams.level||this.urlParams.zoom)b.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});w.getInstance=function(b,a){null===A?A=new w(b,a):(A.urlParams=b,A.options=a);return A};return w})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(n,f,g,h,e,p,r,a,l,d,s){var q=n([],{declaredClass:"jimu.Portal",selfUrl:null,
user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(b){this.portalUrl=d.getStandardPortalUrl(b);this.selfUrl=d.getPortalSelfInfoUrl(b)},loadSelfInfo:function(){var b=new e,c={url:this.selfUrl,content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};this.isValidCredential()&&(c.content.token=this.credential.token);a(c).then(f.hitch(this,function(a){var c=a.user;delete a.user;f.mixin(this,a);a.user=c;b.resolve(a)}),f.hitch(this,function(a){console.error(a);
b.reject(a)}));return b},_checkCredential:function(){var b=s.isValidCredential(this.credential);b||this.clearCredentialAndUser();return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=s.getPortalCredential(this.portalUrl))},signIn:function(){var b=new e;this.updateCredential();this.isValidCredential()?setTimeout(f.hitch(this,function(){b.resolve(this.credential)}),0):b=s.signInPortal(this.portalUrl);
return b},haveSignIn:function(){return s.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var b=new e;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(f.hitch(this,function(){this.user.updateCredential();b.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(f.hitch(this,function(a){this.user=a;b.resolve(this.user)}),f.hitch(this,
function(a){console.error(a);b.reject(a)})):s.getUserIdByToken(this.credential.token,this.portalUrl).then(f.hitch(this,function(a){this.credential.userId=a;this._getUser(this.credential.userId).then(f.hitch(this,function(a){this.user=a;b.resolve(this.user)}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(f.hitch(this,function(){b.reject("credential is null.")}),0);return b},queryItems:function(b){this.updateCredential();
var c=new e,k=d.getBaseSearchUrl(this.portalUrl),l={f:"json"};b&&(l=f.mixin(l,b));this.isValidCredential()&&(l.token=this.credential.token);!l.sortField&&!l.sortOrder&&(l.sortField="title",l.sortOrder="asc");a({url:k,handleAs:"json",content:l,callbackParamName:"callback"}).then(f.hitch(this,function(b){b.results=g.map(b.results,f.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;return new m(b)}));c.resolve(b)}),f.hitch(this,function(b){console.error(b);
c.reject(b)}));return c},getItemData:function(b){this.updateCredential();b={url:d.getItemDataUrl(this.portalUrl,b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return a(b)},getItemById:function(b){var c=new e;this.updateCredential();b={url:d.getItemUrl(this.portalUrl,b),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);a(b).then(f.hitch(this,
function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;b=new m(b);c.resolve(b)}),f.hitch(this,function(b){console.error(b);c.reject(b)}));return c},getAppById:function(b){var c=new e;this.updateCredential();this.isValidCredential()?(b=d.getAppIdUrl(this.portalUrl,b),c=a({url:b,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(f.hitch(this,function(){c.reject("token is null.")}),0);return c},queryGroups:function(b){this.updateCredential();var m=
new e,k=d.getBaseGroupUrl(this.portalUrl),l={f:"json"};b&&(l=f.mixin(l,b));this.isValidCredential()&&(l.token=this.credential.token);a({url:k,handleAs:"json",content:l,callbackParamName:"callback"}).then(f.hitch(this,function(b){b.results=g.map(b.results,f.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;return new c(b)}));m.resolve(b)}),f.hitch(this,function(b){console.error(b);m.reject(b)}));return m},registerApp:function(b,c,m){var k=new e;this.updateCredential();
if(this.isValidCredential())var l=this.credential&&this.credential.token,q=d.getOAuth2Url(this.portalUrl),k=a({url:q+"/registerApp",content:{itemId:b,appType:c,redirect_uris:r.stringify(m),token:l,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(f.hitch(this,function(){k.reject("token is null.")}),0);return k},createAndRegisterApp:function(b){var a=new e;this.updateCredential();this.isValidCredential()?this.getUser().then(f.hitch(this,function(c){c.addItem({title:"Web AppBuilder for ArcGIS",
type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(f.hitch(this,function(c){c.success?this.registerApp(c.id,"browser",b).then(f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(b){console.error(b);a.reject(b)})):a.reject("create app failed")}),f.hitch(this,function(b){console.error(b);a.reject(b)}))}),f.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(f.hitch(this,function(){a.reject("token is null.")}),0);return a},_getUser:function(b){this.updateCredential();
var c=new e;b={url:d.getUserUrl(this.portalUrl,b),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential&&this.credential.token);a(b).then(f.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;this.user=new k(b);c.resolve(this.user)}),f.hitch(this,function(b){console.error(b);c.reject(b)}));return c}}),k=n([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(b){b&&
f.mixin(this,b)},_checkCredential:function(){var b=s.isValidCredential(this.credential);b||(this.credential=null);return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var b=[];this.groups&&(b=g.map(this.groups,f.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this.portal;
return new c(b)})));return b},getItemsByKeywords:function(b,a){return this.portal.queryItems({start:a||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+b+'"'})},getContent:function(){this.updateCredential();var b={url:d.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(b.content.token=this.credential.token);return a(b)},getTags:function(){this.updateCredential();var b={url:d.getUserTagsUrl(this.portalUrl,
this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return a(b)},addItem:function(b,c){this.updateCredential();var m=new e;if(this.isValidCredential()){var k={f:"json",token:this.credential.token};b&&(k=f.mixin(k,b));a({url:d.getAddItemUrl(this.portalUrl,this.username,c),handleAs:"json",callbackParamName:"callback",content:k},{usePost:!0}).then(f.hitch(this,function(b){m.resolve(b)}),f.hitch(this,function(b){console.error(b);
m.reject(b)}))}else setTimeout(f.hitch(this,function(){m.reject("token is null.")}),0);return m},deleteItem:function(b){this.updateCredential();var c=new e;this.isValidCredential()?(b=d.getDeleteItemUrl(this.portalUrl,this.username,b),c=a({url:b,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(f.hitch(this,function(){c.reject("token is null.")}),0);return c},getItemById:function(b,c){this.updateCredential();var k=new e,l={url:d.getUserItemsUrl(this.portalUrl,
this.username,c)+"/"+b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(l.content.token=this.credential.token);a(l).then(f.hitch(this,function(b){b.portalUrl=this.portalUrl;b.credential=this.credential;b.portal=this;b=new m(b);k.resolve(b)}),f.hitch(this,function(b){console.error(b);k.reject(b)}));return k},shareItem:function(b,c,m){this.updateCredential();var k=new e;this.isValidCredential()?(c={url:d.shareItemUrl(this.portalUrl,this.username,c,m),handleAs:"json",
callbackParamName:"callback",content:{f:"json",token:this.credential.token}},b&&(c.content=f.mixin(c.content,b)),a(c,{usePost:!0}).then(f.hitch(this,function(b){k.resolve(b)}),f.hitch(this,function(b){console.error(b);k.reject(b)}))):setTimeout(f.hitch(this,function(){k.reject("token is null.")}),0);return k},updateItem:function(b,c){this.updateCredential();var m=new e;this.isValidCredential()?this.portal.getItemById(b).then(f.hitch(this,function(k){var l={f:"json",token:this.credential.token};c&&
(l=f.mixin(l,c));a({url:d.getUpdateItemUrl(this.portalUrl,k.owner,b,k.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:l},{usePost:!0}).then(f.hitch(this,function(b){m.resolve(b)}),f.hitch(this,function(b){console.error(b);m.reject(b)}))}),f.hitch(this,function(b){console.error(b);m.reject(b)})):setTimeout(f.hitch(this,function(){m.reject("token is null.")}),0);return m},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===
this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),c=n([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(b){b&&f.mixin(this,b)},_checkCredential:function(){var b=s.isValidCredential(this.credential);b||(this.credential=null);return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),
this.credential=this.portal.credential)},queryItems:function(b){b.q="group:"+this.id+" AND "+b.q;return this.portal.queryItems(b)}}),m=n([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(b){b&&f.mixin(this,b);this.itemUrl=d.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&(this.thumbnail&&this.itemUrl)&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&
this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=d.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=d.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var b=s.isValidCredential(this.credential);b||(this.credential=null);return b},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||
(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();var b={url:d.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.content.token=this.credential.token);return a(b)}}),t={portals:[],webMapQueryStr:" "+l.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+l.getItemQueryStringByTypes(["Web Scene"])+
" ",_findPortal:function(b){for(var a=0;a<this.portals.length;a++){var c=this.portals[a];if(d.isSamePortalUrl(b,c.portalUrl))return c.updateCredential(),c}return null},getPortal:function(b){if(!b||!("string"===typeof b&&f.trim(b)))return null;b=d.getStandardPortalUrl(b);var a=this._findPortal(b);a||(a=new q(b),a.credential=s.getPortalCredential(a.portalUrl),a.updateCredential(),this.portals.push(a));return a},getPortalSelfInfo:function(b){return this.getPortal(b).loadSelfInfo()},getBasemapGalleryGroup:function(b){return this._getPortalSelfGroup(b,
"basemapGalleryGroupQuery")},getTemplatesGroup:function(b){return this._getPortalSelfGroup(b,"templatesGroupQuery")},getUnits:function(b){var a="english",c="",d=new e;this.getPortal(b).getUser().then(f.hitch(this,function(b){b&&b.units?a=b.units:(c=h.locale,a=c.startWith("en")?"english":"metric");d.resolve(a)}),f.hitch(this,function(m){console.warn(m);this.getPortalSelfInfo(b).then(f.hitch(this,function(b){var a=null;b&&b.units?a=b.units:(c=b&&b.culture||h.locale,a=c.startWith("en")?"english":"metric");
d.resolve(a)}),f.hitch(this,function(b){console.warn(b);c=h.locale;a=c.startWith("en")?"english":"metric";d.resolve(a)}))}));return d.promise},_getPortalSelfGroup:function(b,a){var d=new e,m=this.getPortal(b);m||setTimeout(f.hitch(this,function(){d.reject()}),0);this.getPortalSelfInfo(b).then(f.hitch(this,function(b){m.queryGroups({f:"json",q:b[a]}).then(f.hitch(this,function(b){0<b.results.length?(b=b.results[0],b.portalUrl=m.portalUrl,b.credential=m.credential,b.portal=m,b=new c(b),d.resolve(b)):
d.reject("Can't find portal self group.")}),f.hitch(this,function(b){console.error(b);d.reject(b)}))}),f.hitch(this,function(b){console.error(b);d.reject(b)}));return d},getWebMapsFromBasemapGalleryGroup:function(b){var a=new e;this.getBasemapGalleryGroup(b).then(f.hitch(this,function(b){b?b.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(b){console.error(b);a.reject(b)})):a.reject()}),f.hitch(this,function(b){console.error(b);
a.reject(b)}));return a},getDefaultWebScene:function(b){var a=d.getStandardPortalUrl(b);return this._searchWABDefaultWebScene(a).then(f.hitch(this,function(b){return b?b:this._createWABDefaultWebScene(a).then(f.hitch(this,function(b){return this.getPortal(a).getUser().then(f.hitch(this,function(a){var c=!1;a&&(a.privileges&&0<a.privileges.length)&&(c=g.some(a.privileges,function(b){return 0<=b.indexOf("shareToPublic")}));return c?a.shareItem({everyone:!0},b).then(f.hitch(this,function(){return b}),
f.hitch(this,function(){return b})):b}),f.hitch(this,function(a){console.error(a);return b}))}))}))},_searchWABDefaultWebScene:function(b){var a=new e;b=d.getStandardPortalUrl(b);this.getPortal(b).queryItems({q:'typekeywords:"WABDefaultWebScene" access:public '+this.webSceneQueryStr}).then(f.hitch(this,function(b){b&&b.results&&0<b.results.length?a.resolve(b.results[0].id):a.resolve(null)}),f.hitch(this,function(b){console.error("_searchWABDefaultWebScene error:",b);a.reject(b)}));return a},_createWABDefaultWebScene:function(b){var a=
new e;b=d.getStandardPortalUrl(b);this.getPortal(b).getUser().then(f.hitch(this,function(b){var c={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:r.stringify({operationalLayers:[],baseMap:{id:"151b431fe65-basemap-0",title:"Topographic",baseMapLayers:[{id:"defaultBasemap",url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer"}],elevationLayers:[{id:"globalElevation",url:"http://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",
layerType:"ArcGISTiledElevationServiceLayer"}]},version:"1.3",authoringApp:"WebSceneViewer",authoringAppVersion:"3.10.0.0",spatialReference:{wkid:102100,latestWkid:3857},viewingMode:"global",initialState:{viewpoint:{scale:4.5188197847224146E7,rotation:0,targetGeometry:{x:144770.99872895706,y:3232837.215000455,spatialReference:{wkid:102100,latestWkid:3857},z:-127.7412482528016},camera:{position:{x:144770.99767624016,y:3182557.105058348,spatialReference:{wkid:102100,latestWkid:3857},z:2.551254800000001E7},
heading:0,tilt:0.0999986601088944}},environment:{lighting:{datetime:1426420488E3,displayUTCOffset:0}}},presentation:{slides:[]}}),snippet:""};b.addItem(c,"").then(f.hitch(this,function(b){b.success?a.resolve(b.id):(console.error("Can't create default web scene:",b),a.reject())}))}),f.hitch(this,function(b){console.error("Can't create default web scene");a.reject(b)}));return a},getDefaultWebMap:function(b){var a=new e;this.getPortalSelfInfo(b).then(f.hitch(this,function(c){var d=c.defaultBasemap&&
c.defaultBasemap.id;d?a.resolve(d):this._getDefaultWebMapByBasemapGallery(b,c).then(f.hitch(this,function(c){c?a.resolve(c):this._getMostNumViewsWebMap(b).then(f.hitch(this,function(b){b?a.resolve(b):a.reject()}),f.hitch(this,function(b){console.error(b);a.reject(b)}))}),f.hitch(this,function(b){console.error(b);a.reject(b)}))}),f.hitch(this,function(b){console.error(b);a.reject(b)}));return a},_getDefaultWebMapByBasemapGallery:function(b,a){var c=new e,d=this.getPortal(b),m=a.defaultBasemap&&a.defaultBasemap.title;
d.queryGroups({f:"json",q:a.basemapGalleryGroupQuery}).then(f.hitch(this,function(b){b=b.results;0<b.length?d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+b[0].id+" AND title:"+m}).then(f.hitch(this,function(b){b=b.results;b=g.filter(b,f.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));0<b.length?c.resolve(b[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+
m}).then(f.hitch(this,function(b){b=b.results;b=g.filter(b,f.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));if(0<b.length){var a=b[0];d.getItemData(a.id).then(f.hitch(this,function(b){b&&(b.operationalLayers||b.baseMap||b.version)?c.resolve(a.id):c.resolve(null)}),f.hitch(this,function(){c.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),c.resolve(null)}),f.hitch(this,function(b){console.error(b);c.reject(b)})))}),f.hitch(this,function(b){console.error(b);
c.reject(b)})):(console.log("Can't find group by basemapGalleryGroupQuery."),c.resolve(null))}),f.hitch(this,function(b){console.error(b);c.reject(b)}));return c},_getMostNumViewsWebMap:function(b){var a=new e;this.getPortal(b).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(f.hitch(this,function(b){b=b.results;b=g.filter(b,f.hitch(this,function(b){return b.type&&"web map"===b.type.toLowerCase()}));0<b.length?
a.resolve(b[0].id):a.reject("Can't find most-num-views web map.")}),f.hitch(this,function(b){console.error(b);a.reject(b)}));return a},comparePortalVersion:function(b,a){var c=b.split("."),d=parseInt(c[0],10),c=1<c.length?parseInt(c[1],10):0,m=a.split("."),k=parseInt(m[0],10),m=1<m.length?parseInt(m[1],10):0;return d>k?1:d<k?-1:c>m?1:c<m?-1:0}};p.subscribe("userSignOut",function(b){(b=t._findPortal(b))&&b.clearCredentialAndUser()});return t})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),
function(n,f,g,h,e,p,r,a,l){var d=null,s=n(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var d=h.stringify(this.rawAppConfig.map);this.mapMd5=a(d)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new g,d={};if(l.isInConfigOrPreviewWindow()||
!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(d),a;var c=this._getAppStateKey(),m=r.get(c);m&&m.appStateMd5===this._getAppStateMd5()?(c=m.map&&m.map.extent,m=m.map&&m.map.layers,c&&(d.extent=new e(c.xmin,c.ymin,c.xmax,c.ymax,new p(c.spatialReference))),m&&(d.layers=m)):r.remove(c);a.resolve(d);return a},saveWabAppState:function(a,d){if(a&&!l.isInConfigOrPreviewWindow()){var c=this._getAppStateKey(),m={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,
spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};d&&d.traversal&&d.traversal(f.hitch(this,function(a){m.layers[a.id]={visible:a.isVisible()}}));r.set(c,{map:m,appStateMd5:this._getAppStateMd5()})}}});s.getInstance=function(a){null===d&&(d=new s);d.urlParams=a;return d};return s})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(n,f,g,h){return n(f,{baseClass:"jimu-loading-indicator",
declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&g.set(this.domNode,{display:"none"});g.set(this.domNode,{width:"100%",height:"100%"});var e='\x3cdiv class\x3d"loading-section"\x3e\x3cimg class\x3d"jimu-loading" src\x3d"'+require.toUrl("jimu")+'/images/loading2.gif"\x3e\x3c/div\x3e';h.place(e,this.domNode)},show:function(){this.domNode&&g.set(this.domNode,"display","block")},hide:function(){this.domNode&&g.set(this.domNode,
"display","none")}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/dom-construct dojo/dom-geometry dojo/Deferred dojo/promise/all dojo/when require ./WidgetManager ./PanelManager ./MapManager ./utils ./OnScreenWidgetIcon ./WidgetPlaceholder ./dijit/LoadingShelter".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A){var w=null,C;C=n([e],{constructor:function(b,a){this.widgetManager=
m.getInstance();this.panelManager=t.getInstance();this.own(p.subscribe("appConfigLoaded",f.hitch(this,this.onAppConfigLoaded)));this.own(p.subscribe("appConfigChanged",f.hitch(this,this.onAppConfigChanged)));this.own(p.subscribe("mapLoaded",f.hitch(this,this.onMapLoaded)));this.own(p.subscribe("mapChanged",f.hitch(this,this.onMapChanged)));this.own(p.subscribe("beforeMapDestory",f.hitch(this,this.onBeforeMapDestory)));this.own(p.subscribe("preloadModulesLoaded",f.hitch(this,this._onPreloadModulesLoaded)));
this.own(p.subscribe("builder/actionTriggered",f.hitch(this,this.onActionTriggered)));this.own(p.subscribe("openWidget",f.hitch(this,this._onOpenWidgetRequest)));this.widgetPlaceholders=[];this.preloadWidgetIcons=[];this.preloadGroupPanels=[];this.invisibleWidgetIds=[];v.isMobileUa()||this.own(r(window,"resize",f.hitch(this,this.resize)));this.id=a;this.preloadModulesLoadDef=new s},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",hlDiv:null,animTime:500,resize:function(){g.forEach(this.widgetManager.getAllWidgets(),
function(b){!1===b.inPanel&&b.resize()},this)},onAppConfigLoaded:function(b){this.appConfig=f.clone(b);this._loadMap();this.preloadModulesLoadDef.then(f.hitch(this,function(){this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},onAppConfigChanged:function(b,a,c){b=f.clone(b);switch(a){case "themeChange":this._onThemeChange(b);break;case "styleChange":this._onStyleChange(b);break;case "layoutChange":this._onLayoutChange(b);
break;case "widgetChange":this._onWidgetChange(b,c);break;case "groupChange":this._onGroupChange(b,c);break;case "widgetPoolChange":this._onWidgetPoolChange(b,c);break;case "resetConfig":this._onResetConfig(b);break;case "loadingPageChange":this._onLoadingPageChange(b,c)}this.appConfig=b},onMapLoaded:function(b){this.map=b;this.panelManager.setMap(b);this.preloadModulesLoadDef.then(f.hitch(this,function(){this._loadPreloadWidgets(this.appConfig)}))},onMapChanged:function(b){this.map=b;this.panelManager.setMap(b);
this._loadPreloadWidgets(this.appConfig)},onBeforeMapDestory:function(){this.panelManager.destroyAllPanels();this._destroyOffPanelWidgets();this._destroyWidgetPlaceholders();this._destroyPreloadWidgetIcons()},onActionTriggered:function(b){"highLight"===b.action&&(g.forEach(this.widgetPlaceholders,function(a){a.configId===b.elementId&&this._highLight(a)},this),g.forEach(this.preloadWidgetIcons,function(a){a.configId===b.elementId&&this._highLight(a)},this),g.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),
function(a){a.configId===b.elementId&&this._highLight(a)},this),g.forEach(this.preloadGroupPanels,function(a){a.configId===b.elementId&&this._highLight(a)},this));"removeHighLight"===b.action&&this._removeHighLight();"showLoading"===b.action&&(h.setStyle(jimuConfig.loadingId,"display","block"),h.setStyle(jimuConfig.mainPageId,"display","none"));"showApp"===b.action&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"))},_highLight:function(b){if(b.domNode){this.hlDiv&&
this._removeHighLight(b);var a=d.getMarginBox(b.domNode);this.hlDiv=l.create("div",{style:{position:"absolute",left:a.l+"px",top:a.t+"px",width:a.w+"px",height:a.h+"px"},"class":"icon-highlight"},b.domNode,"before")}},_removeHighLight:function(){this.hlDiv&&(l.destroy(this.hlDiv),this.hlDiv=null)},_onWidgetChange:function(b,a){a=b.getConfigElementById(a.id);a.isController?this._reloadControllerWidget(b,a.id):(g.forEach(this.widgetPlaceholders,function(c){c.configId===a.id&&(c.destroy(),this._loadPreloadWidget(a,
b))},this),this._removeDestroyed(this.widgetPlaceholders),g.forEach(this.preloadWidgetIcons,function(c){if(c.configId===a.id){var d=c.state;c.destroy();this._loadPreloadWidget(a,b).then(function(b){if(a.uri&&"opened"===d)b.onClick()})}},this),this._removeDestroyed(this.preloadWidgetIcons),g.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(c){c.configId===a.id&&(c.destroy(),!1===a.visible?0>this.invisibleWidgetIds.indexOf(a.id)&&this.invisibleWidgetIds.push(a.id):this._loadPreloadWidget(a,
b))},this),g.forEach(this.preloadGroupPanels,function(b){b.reloadWidget(a)},this),this._updatePlaceholder(b),g.forEach(this.invisibleWidgetIds,function(c){c===a.id&&!1!==a.visible&&(this._loadPreloadWidget(a,b),c=this.invisibleWidgetIds.indexOf(a.id),this.invisibleWidgetIds.splice(c,1))},this),a.isOnScreen||g.forEach(this.widgetManager.getControllerWidgets(),function(c){c.widgetIsControlled(a.id)&&this._reloadControllerWidget(b,c.id)},this))},_onGroupChange:function(b,a){a=b.getConfigElementById(a.id);
a.isOnScreen?(this.panelManager.destroyPanel(a.id+"_panel"),this._removeDestroyed(this.preloadGroupPanels),this._loadPreloadGroup(a,b)):(g.forEach(this.widgetManager.getControllerWidgets(),function(c){c.isControlled(a.id)&&this._reloadControllerWidget(b,c.id)},this),g.forEach(this.panelManager.panels,function(b){b.config.id===a.id&&b.updateConfig(a)},this))},_updatePlaceholder:function(b){g.forEach(this.widgetPlaceholders,function(a){a.setIndex(b.getConfigElementById(a.configId).placeholderIndex)},
this)},_onWidgetPoolChange:function(b,a){this._reloadControllerWidget(b,a.controllerId)},_reloadControllerWidget:function(b,a){var c=this.widgetManager.getWidgetById(a);if(c){var d=c.getOpenedIds(),m=c.windowState;g.forEach(c.getAllConfigs(),function(b){if(b.widgets)this.panelManager.destroyPanel(b.id+"_panel"),g.forEach(b.widgets,function(b){this.panelManager.destroyPanel(b.id+"_panel")},this);else{var a=this.widgetManager.getWidgetById(b.id);a&&(b.inPanel?this.panelManager.destroyPanel(a.getPanel()):
this.widgetManager.destroyWidget(a))}},this);this.widgetManager.destroyWidget(c);c=b.getConfigElementById(a);!1!==c.visible&&this._loadPreloadWidget(c,b).then(f.hitch(this,function(b){this.widgetManager.changeWindowStateTo(b,m);d&&b.setOpenedIds(d)}))}},_removeDestroyed:function(b){var a=[];g.forEach(b,function(b){b._destroyed&&a.push(b)});g.forEach(a,function(a){a=b.indexOf(a);b.splice(a,1)})},_destroyPreloadWidgetIcons:function(){g.forEach(this.preloadWidgetIcons,function(b){b.destroy()},this);
this.preloadWidgetIcons=[]},_destroyOffPanelWidgets:function(){g.forEach(this.widgetManager.getOffPanelWidgets(),function(b){this.widgetManager.destroyWidget(b)},this)},_destroyWidgetPlaceholders:function(){g.forEach(this.widgetPlaceholders,function(b){b.destroy()},this);this.widgetPlaceholders=[]},_destroyPreloadGroupPanels:function(){g.forEach(this.preloadGroupPanels,function(b){this.panelManager.destroyPanel(b)},this);this.preloadGroupPanels=[]},_changeMapPosition:function(b){this.map&&(v.isEqual(this.mapManager.getMapPosition(),
b.map.position)||this.mapManager.setMapPosition(b.map.position))},_onThemeChange:function(b){this._destroyPreloadWidgetIcons();this._destroyWidgetPlaceholders();this._destroyOffPanelWidgets();this._destroyPreloadGroupPanels();this.panelManager.destroyAllPanels();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();c(["themes/"+b.theme.name+"/main"],f.hitch(this,function(){this._loadThemeCommonStyle(b.theme);this._loadThemeCurrentStyle(b.theme);
this._addCustomStyle(b.theme);this._changeMapPosition(b);this._loadPreloadWidgets(b)}))},_onResetConfig:function(b){var a=this.appConfig;p.publish("appConfigChanged",b,"mapChange",b);this.appConfig=a;this._updateCommonStyle(b);this._onStyleChange(b);this._changeMapPosition(b)},_onLoadingPageChange:function(b,a){if("backgroundColor"in a)h.setStyle(jimuConfig.loadingId,"background-color",b.loadingPage.backgroundColor);else if("backgroundImage"in a){var c=b.loadingPage.backgroundImage;c.visible&&c.uri?
(h.setStyle(jimuConfig.loadingImageId,"background-image","url('"+c.uri+"')"),h.setStyle(jimuConfig.loadingImageId,"width",c.width+"px"),h.setStyle(jimuConfig.loadingImageId,"height",c.height+"px")):(h.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),h.setStyle(jimuConfig.loadingImageId,"width","0px"),h.setStyle(jimuConfig.loadingImageId,"height","0px"))}else"loadingGif"in a&&(c=b.loadingPage.loadingGif,c.visible&&c.uri?(h.setStyle(jimuConfig.loadingGifId,"background-image","url('"+
c.uri+"')"),h.setStyle(jimuConfig.loadingGifId,"width",c.width+"px"),h.setStyle(jimuConfig.loadingGifId,"height",c.height+"px")):(h.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),h.setStyle(jimuConfig.loadingGifId,"width","0px"),h.setStyle(jimuConfig.loadingGifId,"height","0px")))},_updateCommonStyle:function(b){this._removeThemeCommonStyle(this.appConfig.theme);this._loadThemeCommonStyle(b.theme)},_onStyleChange:function(b){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(b.theme);
this._removeCustomStyle();this._addCustomStyle(b.theme)},_onLayoutChange:function(b){this._changeMapPosition(b);g.forEach(this.widgetPlaceholders,function(a){a.moveTo(b.getConfigElementById(a.configId).position)},this);g.forEach(this.preloadWidgetIcons,function(a){a.moveTo(b.getConfigElementById(a.configId).position)},this);g.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){if(!a.closeable){var c=b.getConfigElementById(a.id).position;a.setPosition(c)}},this);g.forEach(this.preloadGroupPanels,
function(a){var c=b.getConfigElementById(a.config.id).panel.position;a.setPosition(c)},this)},_loadTheme:function(b){c(["themes/"+b.name+"/main"],f.hitch(this,function(){this._loadThemeCommonStyle(b);this._loadThemeCurrentStyle(b);this._addCustomStyle(b)}))},_loadThemeCommonStyle:function(b){v.loadStyleLink(this._getThemeCommonStyleId(b),"themes/"+b.name+"/common.css");h.addClass(this.domNode,b.name)},_removeThemeCommonStyle:function(b){h.removeClass(this.domNode,b.name);h.destroy(this._getThemeCommonStyleId(b))},
_loadThemeCurrentStyle:function(b){v.loadStyleLink(this._getThemeCurrentStyleId(b),"themes/"+b.name+"/styles/"+b.styles[0]+"/style.css");h.addClass(this.domNode,b.styles[0])},_removeThemeCurrentStyle:function(b){h.removeClass(this.domNode,b.styles[0]);h.destroy(this._getThemeCurrentStyleId(b))},_addCustomStyle:function(b){var a=f.getObject("customStyles",!1,b);if(a){var c=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(b=this._getFixedThemeStyles(b))&&(c+=b);c=f.replace(c,
a,/\$\{([^\}]+)\}/g);a=h.create("style",{type:"text/css"});try{a.appendChild(document.createTextNode(c))}catch(d){a.styleSheet.cssText=c}a.setAttribute("source","custom");document.head.appendChild(a)}},_getFixedThemeStyles:function(b){var a=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===b.name?(a+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}",
a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out{background-color: ${mainBackgroundColor} !important;}",a+=".jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}",a+=".jimu-panel{border-color: ${mainBackgroundColor} !important;}",a+=
".jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}",a+=".jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}"):"BillboardTheme"===b.name?(a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out{background-color: ${mainBackgroundColor} !important;}",a+=".jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}"):
"BoxTheme"===b.name?a+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===b.name&&(a+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}");return a},_removeCustomStyle:function(){a('style[source\x3d"custom"]',document.head).forEach(function(b){h.destroy(b)})},_getThemeCommonStyleId:function(b){return"theme_"+
b.name+"_style_common"},_getThemeCurrentStyleId:function(b){return"theme_"+b.name+"_style_"+b.styles[0]},_loadMap:function(){h.create("div",{id:this.mapId,style:f.mixin({position:"absolute",backgroundColor:"#EEEEEE",overflow:"hidden",minWidth:"1px",minHeight:"1px"})},this.id);this.mapManager=b.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},this.mapId);this.mapManager.setMapPosition(this.appConfig.map.position);this.mapManager.showMap()},_createPreloadWidgetPlaceHolder:function(b){var a;
a="map"===b.position.relativeTo?this.mapId:this.id;var c=f.clone(b);c.position.width=40;c.position.height=40;var d=v.getPositionStyle(c.position);b=new y({index:c.placeholderIndex,configId:b.id});h.setStyle(b.domNode,d);h.place(b.domNode,a);this.widgetPlaceholders.push(b);return b},_createPreloadWidgetIcon:function(b){var a=new x({panelManager:this.panelManager,widgetManager:this.widgetManager,widgetConfig:b,configId:b.id,map:this.map});"map"===b.position.relativeTo?h.place(a.domNode,this.mapId):
h.place(a.domNode,this.id);h.setStyle(a.domNode,v.getPositionStyle({top:b.position.top,left:b.position.left,right:b.position.right,bottom:b.position.bottom,width:40,height:40}));a.startup();!this.openAtStartWidget&&b.openAtStart&&(a.switchToOpen(),this.openAtStartWidget=b.name);this.preloadWidgetIcons.push(a);return a},_loadPreloadWidgets:function(b){console.time("Load widgetOnScreen");var a=new A,c=[];a.placeAt(this.id);a.startup();g.forEach(b.widgetOnScreen.widgets,function(a){!1===a.visible?this.invisibleWidgetIds.push(a.id):
c.push(this._loadPreloadWidget(a,b))},this);g.forEach(b.widgetOnScreen.groups,function(a){c.push(this._loadPreloadGroup(a,b))},this);q(c).then(f.hitch(this,function(){a&&(a.destroy(),a=null);console.timeEnd("Load widgetOnScreen");p.publish("preloadWidgetsLoaded");this._doPostLoad()}),f.hitch(this,function(){a&&(a.destroy(),a=null);console.timeEnd("Load widgetOnScreen");p.publish("preloadWidgetsLoaded");this._doPostLoad()}))},_doPostLoad:function(){c(["dynamic-modules/postload"])},_loadPreloadWidget:function(b,
a){var c=new s;if("config"===a.mode&&!b.uri){var d=this._createPreloadWidgetPlaceHolder(b);c.resolve(d);return c}if(!b.uri)return c.resolve(null),c;b.inPanel||b.closeable?(d=this._createPreloadWidgetIcon(b),c.resolve(d)):this.widgetManager.loadWidget(b).then(f.hitch(this,function(a){try{a.setPosition(a.position),this.widgetManager.openWidget(a)}catch(d){console.log(console.error("fail to startup widget "+a.name+". "+d.stack))}a.configId=b.id;c.resolve(a)}),function(b){c.reject(b)});return c},_loadPreloadGroup:function(b,
a){return!a.mode&&(!b.widgets||0===b.widgets.length)?k(null):this.panelManager.showPanel(b).then(f.hitch(this,function(a){a.configId=b.id;this.preloadGroupPanels.push(a);return a}))},_onOpenWidgetRequest:function(b){g.forEach(this.preloadWidgetIcons,function(a){a.configId===b&&a.switchToOpen()},this);g.forEach(this.widgetManager.getControllerWidgets(),function(a){a.widgetIsControlled(b)&&a.setOpenedIds([b])},this)}});C.getInstance=function(b,a){null===w&&(w=new C(b,a),window._layoutManager=w);return w};
return C})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k){var c,m=null;c=n(null,{constructor:function(){this.panels=[];this.widgetManager=k.getInstance();a(window,"resize",f.hitch(this,this.onWindowResize));this.activePanel=null;l.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart));
l.subscribe("widgetActived",f.hitch(this,this._onWidgetActived))},showPanel:function(c){var b=new p,d=this.getPanelById(c.id+"_panel");d?("closed"===d.state&&this.openPanel(d),b.resolve(d)):r({Panel:this._loadPanelClass(c.panel.uri),nls:this._loadThemeI18N(c.panel.uri)}).then(f.hitch(this,function(d){var m=c.id+"_panel",k=this.getPanelById(m),l={label:c.label,config:c,uri:c.panel.uri,position:c.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:m,gid:c.gid,nls:d.nls};
f.mixin(l,c.panel.options);try{k=new d.Panel(l),console.log("panel ["+m+"] created.")}catch(e){console.log("create panel error: "+e+", panelId: "+m);b.reject(e);return}k.setPosition(c.panel.position);q.setVerticalCenter(k.domNode);this.openPanel(k);this.panels.push(k);a(k.domNode,"click",f.hitch(this,this._onPanelClick,k));b.resolve(k)}));return b},setMap:function(c){this.map=c;a(this.map,"resize",f.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&
(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new p;if("string"===typeof a&&(a=this.getPanelById(a),!a))return b.reject(),b;if(!a.started)try{a.started=!0,a.startup()}catch(c){console.error("fail to startup panel "+a.id+". "+c.stack)}if("opened"===
a.state)return b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(f.hitch(this,function(){h.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new p;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();
a.domNode&&h.setStyle(a.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(b){console.log(console.error("fail to minimize panel "+a.id+". "+b.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(b){console.log(console.error("fail to maximize panel "+
a.id+". "+b.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(b){console.log(console.error("fail to noralize panel "+a.id+". "+b.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+
b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(b){console.log(console.error("fail to destroy panel "+a.id+". "+b.stack))}}},destroyAllPanels:function(){var a=g.map(this.panels,function(b){return b.id});g.forEach(a,function(b){this.destroyPanel(b)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return d();var b=new p;"string"===typeof a.openAnimation?
"fadeIn"===a.openAnimation?(h.setStyle(a.domNode,{opacity:0,display:""}),e.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return d();var b=new p;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?e.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():
b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=h.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",
bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:
b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,
borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&h.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=
this.widgetManager.activeWidget;b&&("active"===b.state&&b.getPanel()!==a)&&(b.setState("opened"),!1===b.inPanel&&h.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&h.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);
-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){g.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},this)},_onWidgetActived:function(a){this.activePanel&&("active"===this.activePanel.state&&a.getPanel()!==this.activePanel)&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),
this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new p;s([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new p;a.startWith("themes")?(a=a.split("/"),s(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});return b}});c.getInstance=function(){null===m&&(m=new c,window._panelManager=m);return m};return c})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point require ./utils ./dijit/LoadingShelter jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A,w,C,u,E,D,B){var G=null,I=n(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(b,a){this.appConfig=b.appConfig;this.urlParams=b.urlParams;this.id=this.mapDivId=a;this.appStateManager=E.getInstance(this.urlParams);this.popupManager=D.getInstance(this);this.filterManager=B.getInstance();this.nls=window.jimuNls;e.subscribe("appConfigChanged",f.hitch(this,
this.onAppConfigChanged));e.subscribe("changeMapPosition",f.hitch(this,this.onChangeMapPosition));e.subscribe("syncExtent",f.hitch(this,this.onSyncExtent));p(window,"resize",f.hitch(this,this.onWindowResize));p(window,"beforeunload",f.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(b){console.time("Load Map");this.loading=new y;this.loading.placeAt(this.mapDivId);this.loading.startup();b.map["3D"]?b.map.itemId?this._show3DWebScene(b):this._show3DLayersMap(b):
b.map.itemId?this._show2DWebMap(b):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(b){b&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&
this._mapMobileInfoWindow.destroy(),this._mapMobileInfoWindow=new q(null,h.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);x.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!x.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onChangeMapPosition:function(b){var a=f.clone(this.mapPosition);f.mixin(a,
b);this.setMapPosition(a)},setMapPosition:function(b){this.mapPosition=b;b=x.getPositionStyle(b);h.setStyle(this.mapDivId,b);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncExtent:function(b){this.map&&(b=new t(b.extent),this.map.setExtent(b))},_visitConfigMapLayers:function(b,a){g.forEach(b.map.basemaps,function(b,c){b.isOperationalLayer=!1;a(b,c)},this);g.forEach(b.map.operationallayers,function(b,c){b.isOperationalLayer=!0;a(b,c)},this)},_show3DLayersMap:function(b){v(["esri3d/Map"],
f.hitch(this,function(a){var c;c=new a(this.mapDivId,{camera:b.map.mapOptions.camera});this._visitConfigMapLayers(b,f.hitch(this,function(b){this.createLayer(c,"3D",b)}));c.usePlugin=a.usePlugin;this._publishMapEvent(c)}))},_show3DWebScene:function(b){this._getWebsceneData(b.map.itemId).then(f.hitch(this,function(a){v(["esri3d/Map"],f.hitch(this,function(c){var d=new c(this.mapDivId,b.map.mapOptions);g.forEach(a.itemData.operationalLayers,function(b){this.createLayer(d,"3D",b)},this);g.forEach(a.itemData.baseMap.baseMapLayers,
function(b){b.type="tile";this.createLayer(d,"3D",b)},this);g.forEach(a.itemData.baseMap.elevationLayers,function(b){b.type="elevation";this.createLayer(d,"3D",b)},this);d.toc=a.itemData.toc;d.bookmarks=a.itemData.bookmarks;d.tours=a.itemData.tours}))}))},_publishMapEvent:function(b){window._viewerMap=b;u.postProcessUrlParams(this.urlParams,b);console.timeEnd("Load Map");this.map?(this.map=b,this.resetInfoWindow(!0),console.log("map changed."),e.publish("mapChanged",this.map)):(this.map=b,this.resetInfoWindow(!0),
e.publish("mapLoaded",this.map))},_getWebsceneData:function(b){return c({url:"http://184.169.133.166/sharing/rest/content/items/"+b+"/data",handleAs:"json"})},_show2DWebMap:function(b){b.map.mapOptions||(b.map.mapOptions={});var c=this._processMapOptions(b.map.mapOptions)||{};c.isZoomSlider=!1;var d=b.map.portalUrl,m=b.map.itemId,c={mapOptions:c,bingMapsKey:b.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!b.mode&&b.map.appProxy&&b.map.appProxy.mapItemId===b.map.itemId){var k=[];g.forEach(b.map.appProxy.proxyItems,
function(b){b.useProxy&&b.proxyUrl&&k.push({url:b.sourceUrl,mixin:{url:b.proxyUrl}})});0<k.length&&(c.layerMixins=k)}this._createWebMapRaw(d,m,this.mapDivId,c).then(f.hitch(this,function(c){var d=c.map;d.hideZoomSlider();d.infoWindow.resize(270,316);d.itemId=b.map.itemId;d.itemInfo=c.itemInfo;d.webMapResponse=c;d.enableSnapping({snapKey:a.copyKey});h.setStyle(d.root,"zIndex",0);d._initialExtent=d.extent;A.getInstance(d,d.itemInfo).then(f.hitch(this,function(b){this.layerInfosObj=b;this._publishMapEvent(d);
setTimeout(f.hitch(this,this._checkAppState),500);this.loading.hide();this._addDataLoadingOnMapUpdate(d)}))}),f.hitch(this,function(b){console.error(b);this._destroyLoadingShelter();e.publish("mapCreatedFailed")}))},_createWebMapRaw:function(b,a,c,k){return x.createWebMap(b,a,c,k).then(f.hitch(this,function(b){return b}),f.hitch(this,function(e){console.error(e);if(e&&e instanceof Error&&e.message){var q=f.getObject("arcgis.utils.baseLayerError",!1,l.cache["esri/nls/jsapi/"+d.locale]);if(q&&0<=e.message.indexOf(q))return new w({message:window.jimuNls.map.basemapNotAvailable+
window.jimuNls.map.displayDefaultBasemap}),m.getItem(a).then(f.hitch(this,function(a){a.itemData.spatialReference={wkid:102100,latestWkid:3857};a.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return x.createWebMap(b,a,c,k)}))}throw e;}))},_addDataLoadingOnMapUpdate:function(b){var a=h.toDom('\x3cdiv class\x3d"load-container"\x3e\x3cdiv class\x3d"loader"\x3eLoading...\x3c/div\x3e\x3c/div\x3e');
h.place(a,b.root);b.updating&&h.addClass(a,"loading");p(b,"update-start",f.hitch(this,function(){h.addClass(a,"loading")}));p(b,"update-end",f.hitch(this,function(){h.removeClass(a,"loading")}));p(b,"unload",f.hitch(this,function(){h.destroy(a);a=null;this._destroyLoadingShelter()}))},_destroyLoadingShelter:function(){this.loading&&(this.loading.destroy(),this.loading=null)},_checkAppState:function(){var b="extent center marker find query scale level".split(" "),a=this.appConfig.keepAppState;a&&g.forEach(b,
function(b){b in this.urlParams&&(a=!1)},this);a&&this.appStateManager.getWabAppState().then(f.hitch(this,function(b){if(b.extent||b.layers){var a=new C({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});a.placeAt("main-page");p(a,"applyAppState",f.hitch(this,function(){this._applyAppState(b,this.map)}));a.startup();a.show()}}))},_applyAppState:function(b,a){this.layerInfosObj.restoreState({layerOptions:b.layers||null});b.extent&&a.setExtent(b.extent);this._publishMapEvent(a)},
_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=f.clone(a),a.extent&&(a.extent=new t(a.extent)),a.center&&!f.isArrayLike(a.center)&&(a.center=new b(a.center)),a.infoWindow&&(a.infoWindow=new s(a.infoWindow,h.create("div",{},this.mapDivId))),a},createLayer:function(b,a,c){v([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer",
"2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[a+"_"+c.type]],f.hitch(this,
function(a){var d,m={};d="label url type icon infoTemplate isOperationalLayer".split(" ");for(var l in c)0>d.indexOf(l)&&(m[l]=c[l]);c.infoTemplate?(d=new k(c.infoTemplate.title,c.infoTemplate.content),m.infoTemplate=d,a=new a(c.url,m),c.infoTemplate.width&&c.infoTemplate.height&&r.after(a,"onClick",f.hitch(this,function(){b.infoWindow.resize(c.infoTemplate.width,c.infoTemplate.height)}),!0)):a=new a(c.url,m);a.isOperationalLayer=c.isOperationalLayer;a.label=c.label;a.icon=c.icon;b.addLayer(a)}))},
onAppConfigChanged:function(b,a,c){this.appConfig=b;"mapChange"===a?this._recreateMap(b):"mapOptionsChange"===a&&c.lods&&this._recreateMap(b)},_recreateMap:function(b){this.map&&(e.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(b)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});I.getInstance=function(b,a){null===G&&(G=new I(b,a));return G};return I})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x){var y=n([v,q,k,c,b],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:x,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(b){this.inherited(arguments);d.place(this.domNode,b.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[y.ANCHOR_UPPERRIGHT,y.ANCHOR_LOWERRIGHT,y.ANCHOR_LOWERLEFT,y.ANCHOR_UPPERLEFT];
if(7>p("ie")){var b="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+s.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",a=d.create("div",null,h.body());s.set(a,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:b});var c=setTimeout(function(){d.destroy(a);clearTimeout(c);c=a=null},100);e.query(".sprite",this.domNode).forEach(function(a){a.style.backgroundImage="none";a.style.filter=
b})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(b,a){if(b&&a){var c=s.set;c(this._topleft,{height:a+"px",marginLeft:b+"px"});c(this._topright,{width:b+"px",height:a+"px"});c(this._user,"width",b-8+"px");c(this._hide,"marginLeft",b-22+"px");c(this._title,"width",b-25+
"px");c(this._content,"height",a-37+"px");c(this._bottomleft,{marginLeft:b+"px",marginTop:a+"px"});c(this._bottomright,{width:b-5+"px",marginTop:a+"px"});this.width=b;this.height=a;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(b,a)}},_adjustPosition:function(b,a){var c=s.set;c(this._infowindow,{left:Math.round(b.x)+"px",top:Math.round(b.y)+"px"});a===y.ANCHOR_UPPERLEFT?c(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):a===y.ANCHOR_UPPERRIGHT?
c(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):a===y.ANCHOR_LOWERRIGHT?c(this._window,{left:"6px",right:null,top:"43px",bottom:null}):a===y.ANCHOR_LOWERLEFT&&c(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(b){var a=this.map;return a&&b?(b.y<a.height/2?"lower":"upper")+(b.x<a.width/2?"right":"left"):"upperright"},show:function(b,a,c){if(b){b.spatialReference?(this.mapCoords=b,b=this.coords=this.map.toScreen(b,!0)):(this.mapCoords=
null,this.coords=b);var d=this.map._getFrameWidth();if(-1!==d&&(b.x%=d,0>b.x&&(b.x+=d),this.map.width>d))for(var m=(this.map.width-d)/2;b.x<m;)b.x+=d;if(!a||-1===g.indexOf(this._ANCHORS,a))a=this._getAnchor(b);l.remove(this._pointer,this.anchor);a=this.anchor=this.fixedAnchor||a;this._adjustPosition(b,a);l.add(this._pointer,a);t.show(this.domNode);this.isShowing=!0;if(!c)this.onShow()}},hide:function(b,a){t.hide(this.domNode);this.isShowing=!1;if(!a)this.onHide()},showTitleBar:function(){t.show(this._titlebar);
t.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){t.hide(this._titlebar);t.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){t.show(this._content);t.show(this._border);this.isContentShowing=!0},hideContent:function(){t.hide(this._content);t.hide(this._border);this.isContentShowing=!1},move:function(b,a){a?b=this.coords.offset(b.x,b.y):(this.coords=b,this.mapCoords&&(this.mapCoords=this.map.toMap(b)));s.set(this._infowindow,{left:Math.round(b.x)+"px",top:Math.round(b.y)+
"px"})},setFixedAnchor:function(b){b&&-1===g.indexOf(this._ANCHORS,b)||(this.fixedAnchor=b,this.isShowing&&this.show(this.mapCoords||this.coords,b),this.onAnchorChange(b))},setTitle:function(b){this.destroyDijits(this._title);this.__setValue("_title",b);return this},setContent:function(b){this.destroyDijits(this._content);this.__setValue("_content",b);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});f.mixin(y,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});return y})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A,w){return f([t,b],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:n.toUrl("./images/whitex.png"),dArrowIcon:n.toUrl("./images/whitedown.png"),lArrowIcon:n.toUrl("./images/whitel.png"),rArrowIcon:n.toUrl("./images/whiter.png"),constructor:function(b,a){this.initialize();g.mixin(this,b);this.domNode=d.byId(a);this._nls=g.mixin({},
w.widgets.popup);var c=this.domNode;q.add(c,"esriPopupMobile");s.set(c,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var m=r.query(".titlePane",c)[0];this._arrowButton=r.query(".arrow",m)[0];this._pointerTop=r.query(".top",c)[0];this._pointerBottom=r.query(".bottom",c)[0];this._title=r.query(".title",m)[0];this._footer=r.query(".footer",m)[0];this._prev=r.query(".prev",m)[0];this._next=r.query(".next",m)[0];this._spinner=r.query(".spinner",m)[0];this._eventConnections=[h.connect(r.query(".close",m)[0],"onclick",this,this.hide),h.connect(this._arrowButton,"onclick",this,this._toggleView),h.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),h.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();A.hide(c);this.isShowing=!1},setMap:function(b){this.inherited(arguments);k.place(this.domNode,b.root);this.highlight&&this.enableHighlight(b)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(b,a){this.destroyDijits(this._title);this.place(b,this._title);
this.destroyDijits(this._footer);this.place(a,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(b){this.destroyDijits(this._contentPane);this.place(b,this._contentPane);this.startupDijits(this._contentPane)},show:function(b){if(b){var a=this.map;b.spatialReference?(this.location=b,b=a.toScreen(b)):this.location=a.toMap(b);this._maximized?this.restore():this._setPosition(b);this.isShowing||(A.show(this.domNode),this.isShowing=!0,this.onShow())}else A.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(A.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);e.forEach(this._eventConnections,h.disconnect);k.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");q.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var b=this.selectedIndex;this._updateUI();0<=b&&(this.setContent(this.features[b].getContent()),this.updateHighlight(this.map,this.features[b]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var b=this.map;this._handles=[h.connect(b,"onPanStart",this,this._onPanStart),h.connect(b,"onPan",this,this._onPan),h.connect(b,"onZoomStart",this,this._onZoomStart),h.connect(b,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var b=this._handles;b&&(e.forEach(b,h.disconnect),this._handles=null)},_onPanStart:function(){var b=this.domNode.style;this._panOrigin={left:b.left,top:b.top,right:b.right,
bottom:b.bottom}},_onPan:function(b,a){var c=this._panOrigin,d=a.x,k=a.y,l=c.left,e=c.top,q=c.right,c=c.bottom;l&&(l=parseFloat(l)+d+"px");e&&(e=parseFloat(e)+k+"px");q&&(q=parseFloat(q)-d+"px");c&&(c=parseFloat(c)-k+"px");m.set(this.domNode,{left:l,top:e,right:q,bottom:c})},_onZoomStart:function(){A.hide(this.domNode)},_onExtentChange:function(b,a,c){c&&(A.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(b){var a=b.x;b=b.y;var d=
c.getContentBox(this.map.container),k=d.w,d=d.h,l=0,e=b+10,f=118,s=k-18;18<a&&a<s?(l=a-130,0>l?l=0:l>k-260&&(l=k-260)):18>=a?l=a-18:a>=s&&(l=k-260+(a-s));118<a&&a<k-130?f=118:118>=a?18<a?f=a-12:18>=a&&(f=6):a>=k-130&&(a<s?f=118+a-(k-130):a>=s&&(f=118+s-(k-130)));b<=d/2?(m.set(this.domNode,{left:l+"px",top:e+"px",bottom:null}),m.set(this._pointerTop,{left:f+"px"}),q.add(this._pointerBottom,"hidden"),q.remove(this._pointerTop,"hidden")):(m.set(this.domNode,{left:l+"px",top:e-64+"px",bottom:null}),m.set(this._pointerBottom,
{left:f+"px"}),q.add(this._pointerTop,"hidden"),q.remove(this._pointerBottom,"hidden"))},_showPointer:function(b){e.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(a){a===b?r.query(".pointer."+a,this.domNode).removeClass("hidden"):r.query(".pointer."+a,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();A.show(this.popupNavigationBar.container);A.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(b){this.popupInfoView.animateTo(0);switch(b.name){case "CloseButton":A.hide(this.popupNavigationBar.container);A.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":A.hide(this.popupNavigationBar.container);A.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var b={};b.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new x(b,k.create("div",{},p.body()));h.connect(this.popupNavigationBar,"onCreate",this,function(b){this._prevFeatureButton=b[3]._node;this._nextFeatureButton=b[4]._node});h.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);h.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();A.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},k.create("div",{},p.body()));q.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();h.connect(this.popupInfoView,"onCreate",this,function(b){this._contentPane=b[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});h.connect(this.popupInfoView,"onSwipeLeft",this,function(){});h.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var b="\x26nbsp;",a="\x26nbsp;",c=this.selectedIndex,d=this.features,m=this.deferreds,k=this._prevFeatureButton.parentNode,l=this._nextFeatureButton.parentNode,e=this._spinner,f=this._nls;d&&1<=d.length?(b=d[c].getTitle(),a=c+1+" of "+d.length,q.remove(this._arrowButton,"hidden"),0===c?(q.add(k,"hidden"),q.add(this._prev,"hidden")):(q.remove(k,"hidden"),q.remove(this._prev,"hidden")),c===d.length-1?(q.add(l,"hidden"),
q.add(this._next,"hidden")):(q.remove(l,"hidden"),q.remove(this._next,"hidden"))):(q.add(this._arrowButton,"hidden"),q.add(k,"hidden"),q.add(l,"hidden"),q.add(this._prev,"hidden"),q.add(this._next,"hidden"));this.setTitle(b,a);this.popupNavigationBar.getItems()[1]._node.innerHTML=a;m&&m.length?(q.remove(e,"hidden"),this.setTitle(f.NLS_searching+"...","\x26nbsp;")):(q.add(e,"hidden"),(!d||!d.length)&&this.setTitle("No Information","\x26nbsp;"))}})})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k){return n(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(c,m){var e;this.container=a.byId(m);this._touchBase=k(this.container,null);this._slideDiv=d.create("div",null,this.container,"first");this.events=[];this._items=c.items;c.sections&&(this._sections=c.sections);l.add(this.container,"esriMobileInfoView");if(0===this._sections.length)d.create("div",{},this._slideDiv);else for(e=0;e<this._sections.length;e++){var b=
d.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);d.create("div",{innerHTML:this._sections[e].title},b)}for(e=0;e<this._items.length;e++){var q,b=0;this._items[e].section&&(b=this._items[e].section);switch(this._items[e].type){case "div":q=d.create("div",{"class":"esriMobileInfoViewItem",style:this._items[e].style},this._slideDiv.childNodes[b]),q=d.create("div",{innerHTML:this._items[e].text},q)}this._items[e].className&&l.add(q,this._items[e].className);q._index=e;q._item=this._items[e];
this._items[e]._node=q}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){g.forEach(this.events,h.disconnect);this._touchBase=null;e.query("img",this.container).forEach(function(a){a._index=null;a._item=null;d.destroy(a)});this._items=null;d.destroy(this._slideDiv);d.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);
this.events.push(h.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(h.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(h.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){h.disconnect(this.events.pop());h.disconnect(this.events.pop());h.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);
this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},
_onTouchMoveHandler:function(a){this._moveDirection||(Math.abs(a.curY)>Math.abs(a.curX)?this._moveDirection="vertical":this._moveDirection="horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===
this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return 0.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,d;a=s.getContentBox(this.container);var k=0>this._velocity?0.0010:-0.0010;d=-(this._velocity*this._velocity)/(2*k);var b=-this._velocity/k,k=3*0.6-0,l=1-k,e=0,q=0;if(a.h>
this._slideDiv.scrollHeight)this.contentOffsetY=0,q=300;else if(0<this.contentOffsetY+d){a=0;for(d=Math.floor(b/20);a<d;a++)if(e=(l*20*a^3)+(k*20*a^2)+0*20*a+0,e=0>this._velocity?-e:e,0<this.contentOffsetY+e){q=20*a;break}0===q&&(q=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+d)+a.h>this._slideDiv.scrollHeight){this.contentOffsetY=a.h-this._slideDiv.scrollHeight;a=0;for(d=Math.floor(b/20);a<d;a++)if(e=(l*20*a^3)+(k*20*a^2)+0*20*a+0,e=0>this._velocity?-e:e,Math.abs(this.contentOffsetY+
e)>this._slideDiv.scrollHeight){q=20*a;break}}else q=b,this.contentOffsetY+=d;this._slideDiv.style.webkitTransition="-webkit-transform "+q+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=s.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration=
"0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,d){"ON"===d.toggleState?(d.toggleState=
"OFF",d.src&&(a.src=d.src.toString()),this.onUnSelect(d)):(d.toggleState="ON",d.srcAlt&&(a.src=d.srcAlt),this.onSelect(d))}})})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),function(n,f,g,h,e,p){return n(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(e,a){this.domNode=h.byId(e);this.events=[g.connect(this.domNode,"touchstart",this,this._touchStartHandler),
g.connect(this.domNode,"touchmove",this,this._touchMoveHandler),g.connect(this.domNode,"touchend",this,this._touchEndHandler),g.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(e){this._preventDefault=e},disableOnClick:function(){g.disconnect(this.events.pop())},_clickHandler:function(e){if(this._moved)e.preventDefault();else this.onclick(e)},_touchStartHandler:function(e){this._moved=!1;this.client_x=e.targetTouches[0].clientX;this.client_y=e.targetTouches[0].clientY;
this.down_x=e.targetTouches[0].pageX;this.down_y=e.targetTouches[0].pageY;e.downX=this.down_x;e.downY=this.down_y;this.onTouchStart(e)},_touchMoveHandler:function(e){this._preventDefault&&e.preventDefault();this._moved=!0;this.up_x=e.targetTouches[0].pageX;this.cur_x=e.targetTouches[0].pageX-this.down_x;this.cur_y=e.targetTouches[0].pageY-this.down_y;e.curX=this.cur_x;e.curY=this.cur_y;this.onTouchMove(e)},_touchEndHandler:function(e){this._moved?(e.curX=this.cur_x,e.curY=this.cur_y,this.down_x-this.up_x>
this._swipeThreshold?e.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(e.swipeDirection="right")):(e.clientX=this.client_x,e.clientY=this.client_y);this.onTouchEnd(e)},onTouchStart:function(e){},onTouchMove:function(e){},onTouchEnd:function(e){},onclick:function(e){}})})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q){return n(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(k,c){var m;this.container=a.byId(c);this._touchBase=s(this.container,null);this._slideDiv=d.create("div",{},this.container,"first");this.events=[g.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=k.items;l.add(this.container,"esriMobileNavigationBar");var e=d.create("div",{},this._slideDiv);for(m=0;m<this._items.length;m++){var b,q;switch(this._items[m].type){case "img":q=
d.create("div",{"class":"esriMobileNavigationItem"},e);b=d.create("img",{src:this._items[m].src.toString(),style:{width:"100%",height:"100%"}},q);break;case "span":q=d.create("div",{"class":"esriMobileNavigationItem"},e);b=d.create("span",{innerHTML:this._items[m].text},q);break;case "div":q=d.create("div",{"class":"esriMobileNavigationInfoPanel"},e),b=d.create("div",{innerHTML:this._items[m].text},q)}l.add(q,this._items[m].position);this._items[m].className&&l.add(b,this._items[m].className);b._index=
m;b._item=this._items[m];this._items[m]._node=b}},startup:function(){this.onCreate(this._items)},destroy:function(){h.forEach(this.events,g.disconnect);this._touchBase=null;e.query("img",this.container).forEach(function(a){a._index=null;a._item=null;d.destroy(a)});this._items=null;d.destroy(this._slideDiv);d.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},
onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var c=a.target,d=c._item;e.query("img",this.container).forEach(function(a){a!==c&&a._item.toggleGroup===d.toggleGroup&&this._markUnSelected(a,a._item)},this);this._toggleNode(c,d)}},_toggleNode:function(a,c){"ON"===c.toggleState?(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c)):(c.toggleState="ON",c.srcAlt&&(a.src=c.srcAlt),this.onSelect(c))},_markSelected:function(a,c){c.toggleState=
"ON";c.srcAlt&&(a.src=c.srcAlt);this.onSelect(c)},_markUnSelected:function(a,c){"ON"===c.toggleState&&(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c))}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(n,f,g,h,e){return n([f,g],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:h,loadingText:null,
hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&e.setStyle(this.domNode,"display","none");e.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading2.gif";this.showLoading||e.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(f){this.domNode&&this.hidden&&
("string"===typeof f&&(this.textNode.innerHTML=f),e.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(e.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(n,f,g,h,e,p,r,a,l){var d=n([r],{map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,
_tableInfos:null,_finalTableInfos:null,_basemapLayers:null,constructor:function(a,c){this._basemapLayers=c.baseMap.baseMapLayers;this._operLayers=c.operationalLayers;this._tables=c.tables;this.map=a;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._layerInfos);this._initFinalTableInfos();this._initFinalLayerInfos(this._layerInfos);this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var a=
[];f.forEach(this.getLayerInfoArray(),function(c){for(var b=0;b<this._operLayers.length;b++)if(c.id===this._operLayers[b].id){a.push(c);break}b===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(c.id)&&a.push(c)},this);return a},getLayerInfoArray:function(){return this._finalLayerInfos},getTableInfoArray:function(){return this._finalTableInfos},addFeatureCollection:function(a,c){var b=this._getUniqueTopLayerInfoId(c),d={layers:[]};f.forEach(a,function(a,c){a.id=b+
"_"+c;d.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var k;try{k=l.getInstance().create({featureCollection:d,title:c||b,id:b},this.map),k.init()}catch(e){console.warn(e.message),k=null}k&&(k._extraOfWebmapLayerInfo=!0,this._layerInfos.push(k),this.update(),this._onUpdated())},addTable:function(a){var c=[];a=this._addTable(a,this._finalTableInfos);this._tableInfos.push(a);c.push(a);this._onTableChange(c,"added");return a},removeTable:function(a){var c=-1,b=!1;f.forEach(this._tableInfos,
function(b,d){a.id===b.id&&(c=d)});0<=c&&(this._tableInfos.splice(c,1),b=!0);c=-1;f.forEach(this._finalTableInfos,function(b,d){a.id===b.id&&(c=d)});0<=c&&(this._finalTableInfos.splice(c,1),b=!0);b&&this._onTableChange([a],"removed")},_addTable:function(a,c){var b;try{a.layerObject={url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),a.selfType="table",b=l.getInstance().create(a),b.init()}catch(d){console.warn(d.message),b=null}b&&c&&c.push(b);return b},
_getUniqueTableId:function(a){var c=this._tableInfos.concat(this._finalTableInfos||[]);return this._getUniqueLayerOrTableId(a,c)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,c){var b=1,d;a||(a="table");for(d=a;;){for(var k=0;k<c.length&&c[k].id!==d;k++);if(k===c.length)return d;d=a+"_"+b.toString();b++}},_traversal:function(a,c){for(var b=0;b<c.length;b++)if(c[b].traversal(a))return!0;return!1},traversal:function(a){var c=
this.getLayerInfoArray();return this._traversal(a,c)},traversalLayerInfosOfWebmap:function(a){var c=this.getLayerInfoArrayOfWebmap();return this._traversal(a,c)},traversalAll:function(a){var c=this.getLayerInfoArray(),b=this.getTableInfoArray();return this._traversal(a,c.concat(b))},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getTableInfoById:function(a){var c=null;f.some(this.getTableInfoArray(),function(b){if(b.id===a)return c=b,!0});return c},getLayerOrTableInfoById:function(a){var c=
null;this.traversalAll(function(b){if(b.id===a)return c=b,!0});return c},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},moveUpLayer:function(a,c){var b=null;c=c?c:1;var d=this._getTopLayerInfoIndexById(a.id);0<=d-c&&(b=this._finalLayerInfos[d-c].obtainLayerIndexesInMap().length,this._finalLayerInfos[d].moveLayerByIndex(this._finalLayerInfos[d-c].obtainLayerIndexesInMap()[b-1].index),b=this._finalLayerInfos[d-c],p.publish("layerInfos/layerReorder",d,c,"moveup"));return b},
_reorderLayerInfosArray:function(a,c,b){"moveup"===b?(b=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-c,0,b)):(b=this._finalLayerInfos[a],this._finalLayerInfos.splice(a+c+1,0,b),this._finalLayerInfos.splice(a,1));this._markFirstOrLastNode()},moveDownLayer:function(a,c){var b=null;c=c?c:1;var d=this._getTopLayerInfoIndexById(a.id);d+c<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[d].moveLayerByIndex(this._finalLayerInfos[d+c].obtainLayerIndexesInMap()[0].index),
b=this._finalLayerInfos[d+c],p.publish("layerInfos/layerReorder",d,c,"movedown"));return b},getBasemapLayers:function(){var a=[];f.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);("basemap"===c._basemapGalleryLayerType||"reference"===c._basemapGalleryLayerType)&&a.push(c)},this);0===a.length&&(a=this._basemapLayers);return a},getMapNotesLayerInfoArray:function(){return f.filter(this.getLayerInfoArray(),function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){var c=
a&&a.layerOptions?a.layerOptions:null;f.forEach(this.getLayerInfoArray(),function(b){b.resetLayerObjectVisibility(c)},this)},_initLayerInfos:function(){var a;this._layerInfos=[];f.forEach(this._operLayers,function(c){try{a=l.getInstance().create(c),a.init()}catch(b){console.warn(b.message),a=null}a&&this._layerInfos.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=[];f.forEach(this._layerInfos,function(a,c){var b;if("esri.layers.GeoRSSLayer"===a.layerObject.declaredClass||
"esri.layers.KMLLayer"===a.layerObject.declaredClass){try{b=l.getInstance().create(a.originOperLayer),b.init()}catch(d){console.warn(d.message),b=null}b&&(a.destroyLayerInfo(),this._layerInfos[c]=b)}else if(a.originOperLayer.featureCollection){var k=[];f.forEach(a.getSubLayers(),function(b){k.push(b.id)});f.forEach(k,function(b){this.map.getLayer(b)||a.removeSubLayerById(b)},this);1===a.getSubLayers().length&&(b=a.getSubLayers()[0],this.map.getLayer(b.id).title=a.title,a.removeSubLayerById(b.id),
this._removedLayerInfoIdsFromFeatureCollection.push(b.id))}},this)},_initFinalLayerInfos:function(a){var c,b;this._finalLayerInfos=[];for(c=this.map.graphicsLayerIds.length-1;0<=c;c--)b=this.map.graphicsLayerIds[c],this._isBasemap(b)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(b,a),b,!0);for(c=this.map.layerIds.length-1;0<=c;c--)b=this.map.layerIds[c],this._isBasemap(b)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(b,a),b,!1)},_isBasemap:function(a){for(var c=
!1,b=this.getBasemapLayers(),d=0;d<b.length;d++)b[d].id===a&&(c=!0);return c},_addToFinalLayerInfos:function(a,c,b){var d;if(a)!a._addedFlag&&a.isGraphicLayer()===b&&(this._finalLayerInfos.push(a),a._addedFlag=!0);else{a=this.map.getLayer(c);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"labels"!==a.id){try{d=l.getInstance().create({layerObject:a,title:this._getLayerTitle(a),id:a.id||" "},this.map),d.init()}catch(k){console.warn(k.message),d=null}d&&this._finalLayerInfos.push(d)}("esri.layers.ArcGISDynamicMapServiceLayer"===
a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&d&&d._getLayerDefinition().then(g.hitch(this,function(b){var a=[];f.forEach(b.tables,function(b){b.url=d.getUrl()+"/"+b.id;b.id=d.id+"_"+b.id;b.title=this._getLayerTitle(b);(b=this._addTable(b,this._finalTableInfos))&&a.push(b)},this);this._onTableChange(a,"added")}))}},_getLayerTitle:function(a){if(a.title)return a.title;var c=a.label||a.name||"";if(a.url){var b;b=a.url.indexOf("/FeatureServer");-1===b&&(b=a.url.indexOf("/MapServer"));
-1===b&&(b=a.url.indexOf("/service"));-1<b&&(b=a.url.substring(0,b),b=b.substring(b.lastIndexOf("/")+1,b.length),c=c?b+" - "+c:b)}return c||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,c){var b,d=null;c||(c=this._finalLayerInfos);for(b=0;b<c.length;b++)if(d=c[b].findLayerInfoById(a)){d=c[b];break}return d},_findLayerInfoById:function(a,c){var b,d=null;c||(c=this._finalLayerInfos);for(b=0;b<c.length&&!(d=c[b].findLayerInfoById(a));b++);return d},_findTopLayerInfoById:function(a){var c,b=null,
d=this._finalLayerInfos.concat(this._finalTableInfos);for(c=0;c<d.length;c++)if(d[c].id===a){b=d[c];break}return b},_getTopLayerInfoIndexById:function(a){var c,b=-1;for(c=0;c<this._finalLayerInfos.length;c++)if(this._finalLayerInfos[c].id===a){b=c;break}return b},_clearAddedFlag:function(a){f.forEach(a,function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=
!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,c,b){"BasemapGallery"===a&&(this._basemapLayers.length=0,f.forEach(b,g.hitch(this,function(b){this._basemapLayers.push({layerObject:b,id:b.id})}),this),this.update(),this.emit("layerInfosChanged"))},
_onBasemapChange:function(a){var c;for(c=this._basemapLayers.length=0;c<a.layers.length;c++)this._basemapLayers.push({layerObject:a.layer[c],id:a.layers[c].id})},_destroyLayerInfos:function(){f.forEach(this.getLayerInfoArray(),g.hitch(this,function(a){a.destroyLayerInfo()}))},_bindEvents:function(){var a,c,b,d,k,l,q,f;a=e(this.map,"layer-add-result",g.hitch(this,this._onLayersChange,"added"));c=e(this.map,"layer-remove",g.hitch(this,this._onLayersChange,"removed"));q=p.subscribe("layerInfos/layerReorder",
g.hitch(this,this._onLayerReorder));d=p.subscribe("layerInfos/layerInfo/isShowInMapChanged",g.hitch(this,this._onShowInMapChanged));k=p.subscribe("layerInfos/layerInfo/visibleChanged",g.hitch(this,this._onVisibleChanged));l=p.subscribe("layerInfos/layerInfo/filterChanged",g.hitch(this,this._onFilterChanged));f=p.subscribe("layerInfos/layerInfo/rendererChanged",g.hitch(this,this._onRendererChanged));b=e(this.map,"before-unload",g.hitch(this,function(){a.remove();c.remove();q.remove();d.remove();k.remove();
l.remove();f.remove();b.remove();this._destroyLayerInfos()}))},_onLayersChange:function(a,c){var b=null,d;!c.error&&("esri.layers.GraphicsLayer"!==c.layer.declaredClass&&!c.layer._basemapGalleryLayerType)&&("added"===a?(this.update(),b=this._findTopLayerInfoById(c.layer.id),d=this._findLayerInfoById(c.layer.id)):(b=this._findTopLayerInfoById(c.layer.id),d=this._findLayerInfoById(c.layer.id),this.update()),this.emit("layerInfosChanged",b,a,d))},_onShowInMapChanged:function(a){this.emit("layerInfosIsShowInMapChanged",
a)},_onVisibleChanged:function(a){this.emit("layerInfosIsVisibleChanged",a)},_onFilterChanged:function(a){this.emit("layerInfosFilterChanged",a)},_onLayerReorder:function(a,c,b){this._reorderLayerInfosArray(a,c,b);this.emit("layerInfosReorder")},_onRendererChanged:function(a){this.emit("layerInfosRendererChanged",a)},_initTablesInfos:function(){this._tableInfos=[];f.forEach(this._tables&&this._tables.reverse(),function(a){this._addTable(a,this._tableInfos)},this)},_initFinalTableInfos:function(){this._finalTableInfos=
[];f.forEach(this._tableInfos,function(a){this._finalTableInfos.push(a)},this)},_onTableChange:function(a,c){this.emit("tableInfosChanged",a,c)},_onUpdated:function(){this.emit("updated")}});d.getLayerInfoArrayByType=function(c,k){var b=new h,e=[],l=[];d.getInstance(c,c.iteminfo).then(function(c){c.traversal(function(b){var a=b.getLayerType();a.layerInfo=b;e.push(a)});a(e).then(function(a){f.forEach(a,function(b,a){k===b&&l.push(e[a].layerInfo)});b.resolve(l)})});return b};var s=!0,q=null,k=null,
c=new h;d.getInstance=function(a,e){q&&q!==a&&(s=!0,k=q=null,c=new h);k?c.resolve(k):s&&(s=!1,l.getInstance(a).init().then(g.hitch(this,function(){var b=new d(a,e.itemData);q=a;k=b;c.resolve(b)})));return c};d.getInstanceSync=function(){return k};return d})},"jimu/LayerInfos/LayerInfoFactory":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(n,f,g){var h=null,e=n(null,{constructor:function(){},init:function(){var e=new g;require("jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForGroup jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream".split(" "),
f.hitch(this,function(f,a,l,d,s,q,k,c,m,g,b,h,x){this.LayerInfoForCollection=f;this.LayerInfoForMapService=a;this.LayerInfoForKML=l;this.LayerInfoForGeoRSS=d;this.LayerInfoForDefault=s;this.LayerInfoForWMS=q;this.LayerInfoForGroup=k;this.LayerInfoForDefaultDynamic=c;this.LayerInfoForDefaultTile=m;this.LayerInfoForDefaultWMS=g;this.LayerInfoForDefaultTable=b;this.LayerInfoForDefaultImage=h;this.LayerInfoForDefaultStream=x;e.resolve()}));return e},create:function(e){if(e.featureCollection)return new this.LayerInfoForCollection(e,
this.map);if("esri.layers.KMLLayer"===e.layerObject.declaredClass)return new this.LayerInfoForKML(e,this.map);if("esri.layers.GeoRSSLayer"===e.layerObject.declaredClass)return new this.LayerInfoForGeoRSS(e,this.map);if("esri.layers.WMSLayer"===e.layerObject.declaredClass&&!e.selfType)return new this.LayerInfoForWMS(e,this.map);if("esri.layers.ArcGISDynamicMapServiceLayer"===e.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===e.layerObject.declaredClass)return new this.LayerInfoForMapService(e,
this.map);if("esri.layers.ArcGISImageServiceLayer"===e.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===e.layerObject.declaredClass)return new this.LayerInfoForDefaultImage(e,this.map);if("esri.layers.StreamLayer"===e.layerObject.declaredClass)return new this.LayerInfoForDefaultStream(e,this.map);"Table"===e.layerObject.type&&(e.selfType="table");switch(e.selfType){case "mapservice_dynamic_group":return new this.LayerInfoForGroup(e,this.map);case "mapservice_tiled_group":return new this.LayerInfoForGroup(e,
this.map,!0);case "mapservice_dynamic":return new this.LayerInfoForDefaultDynamic(e,this.map);case "mapservice_tiled":return new this.LayerInfoForDefaultTile(e,this.map);case "wms":return new this.LayerInfoForDefaultWMS(e,this.map);case "table":return new this.LayerInfoForDefaultTable(e,this.map);default:return new this.LayerInfoForDefault(e,this.map)}}});e.getInstance=function(f){null===h&&(h=new e);f&&(h.map=f);return h};return e})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/Evented".split(" "),
function(n,f,g,h,e,p,r,a){var l=1E3,d=1E4;return n([f,a],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(a){this.inherited(arguments);"animationDuration"in a&&(l=a.animationDuration);"autoCloseInterval"in a&&(d=a.autoCloseInterval)},postCreate:function(){window.appInfo.isRunInMobile&&h.addClass(this.domNode,"mobile");var a=h.create("div",{"class":"appstate-header"});h.create("div",{"class":"appstate-title",innerHTML:this.nls.title},
a);var l=h.create("div",{"class":"appstate-close"},a);h.place(a,this.domNode);a=h.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});h.place(a,this.domNode);this.own(e(a,"click",g.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(e(l,"click",g.hitch(this,function(){this.hide()})));this.own(e(this.domNode,p.enter,g.hitch(this,function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)})));this.own(e(this.domNode,p.leave,
g.hitch(this,function(){1===this.currentState&&!this.timeoutHandler&&(this.timeoutHandler=setTimeout(g.hitch(this,this.hide),d))})))},show:function(){r.animateProperty({node:this.domNode,duration:l,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:g.hitch(this,function(){this.currentState=1})}).play();this.timeoutHandler=setTimeout(g.hitch(this,this.hide),d)},hide:function(){0!==this.currentState&&r.animateProperty({node:this.domNode,duration:l,properties:window.appInfo.isRunInMobile?
{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:g.hitch(this,function(){this.currentState=0;h.setStyle(this.domNode,"display","none")})}).play()}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v){function x(b,c){var d=b.center.split(";");1===d.length&&(d=b.center.split(","));if(2===d.length||3===d.length){var k=parseFloat(d[0]),m=parseFloat(d[1]);if(isNaN(k)||isNaN(m))k=parseFloat(d[0]),m=parseFloat(d[1]);if(!isNaN(k)&&!isNaN(m)){var l=4326;3===d.length&&!isNaN(d[2])&&(l=parseInt(d[2],10));d=new e(k,m,new a(l));K(d.spatialReference,c.spatialReference)?c.centerAt(d):I(d,c.spatialReference,function(b){c.centerAt(b[0])},function(){console.error("Project center point error.")})}}}
function y(b,c){var d=b.extent.split(";");1===d.length&&(d=b.extent.split(","));if(4===d.length||5===d.length){var k=parseFloat(d[0]),m=parseFloat(d[1]),e=parseFloat(d[2]),l=parseFloat(d[3]);if(isNaN(k)||isNaN(k)||isNaN(k)||isNaN(k))k=parseFloat(d[0]),m=parseFloat(d[1]),e=parseFloat(d[2]),l=parseFloat(d[3]);if(!isNaN(k)&&!isNaN(m)&&!isNaN(e)&&!isNaN(l)){var q=4326;5===d.length&&!isNaN(d[4])&&(q=parseInt(d[4],10));d=new p(k,m,e,l,new a({wkid:q}));K(c.spatialReference,d.spatialReference)?c.setExtent(d):
I(d,c.spatialReference,function(b){c.setExtent(b[0])},function(){console.error("Project extent error.")})}else console.error("Wrong extent parameters.")}else console.error("Wrong extent parameters.")}function A(b,c){var d=b.marker.split(";");1===d.length&&(d=b.marker.split(","));if(2<=d.length&&6>=d.length&&d[0].length&&!isNaN(d[0])&&d[1].length&&!isNaN(d[1])){var k=parseFloat(d[0]),m=parseFloat(d[1]),l=4326;3<=d.length&&(d[2].length&&!isNaN(d[2]))&&(l=parseInt(d[2],10));var f="";4<=d.length&&(f=
d[3]);var s=null;5<=d.length&&0===d[4].indexOf("http")&&(s=d[4]);var g=null;6===d.length&&(g=d[5]);var p=q.fromJson({type:"esriPMS",url:s,contentType:"image/png"}),t=null;g&&(t=q.fromJson({color:[0,0,0,255],type:"esriTS",verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:g}));C(p).then(function(){var b=new e(k,m,new a({wkid:l}));K(b.spatialReference,c.spatialReference)?w(b,p,t,f,
c):I(b,c.spatialReference,function(b){w(b[0],p,t,f,c)},function(){console.error("Project center point error.")})})}}function w(b,a,d,l,q){var f;f=new m("",l);l=new c;q.addLayer(l);f=new k(b,a,null,f);l.add(f);d&&(d.xoffset=a.width/2,d.yoffset=a.height/2+a.yoffset,a=new k(new e(b.toJson()),d),l.add(a));q.centerAt(b)}function C(a){var c=new f;a.url?b.getImagesSize(a.url).then(function(b){a.width=b[0];a.height=b[1];c.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";
a.width=26;a.height=26;a.setOffset(0,a.height/2);c.resolve(a)}):(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",a.width=26,a.height=26,a.setOffset(0,a.height/2),c.resolve(a));return c}function u(b,a){var c=b.query.split(";");1===c.length&&(c=b.query.split(","));if(2!==c.length&&3!==c.length)console.error("query URL parameter is not correct.");else{var d=c[0];G("name",d,a).then(function(b){null===b?G("id",d,a).then(function(b){null===b?console.error("Invalid layer name or id."):E(a,
b,c)}):E(a,b,c)})}}function E(a,c,d){var k=new t,m="";if(2===d.length)k.where=d[1];else if(3===d.length&&(c.layerObject.url&&(b.isHostedService(c.layerObject.url)&&b.containsNonLatinCharacter(d[2]))&&(m="N"),n.forEach(c.layerObject.fields,function(b){b.alias.toLowerCase()!==d[1].toLowerCase()&&b.name.toLowerCase()!==d[1].toLowerCase()||(-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(b.type)?k.where=b.name+"\x3d"+d[2]:-1<["esriFieldTypeString",
'"esriFieldTypeOID"'].indexOf(b.type)&&(k.where=d[1]+"\x3d"+m+"'"+d[2].replace(/\'/g,"''")+"'"))},this),!k.where)){console.error("Invalid field name or type in query URL parameter.");return}c.layerObject.selectFeatures(k).then(function(d){if(0===d.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===c.layerObject.geometryType&&1===d.length)a.setExtent(r.getExtentForScale(a,1E3)),a.centerAt(d[0].geometry);else{var k=b.graphicsExtent(d);a.setExtent(k)}D(a,c,d)}},function(b){console.error(b)})}
function D(b,a,d){function k(m){var e=new c;e.setRenderer(a.layerObject.renderer);b.addLayer(e);n.forEach(d,function(b){b.setInfoTemplate(m);e.add(b)})}function m(){b.infoWindow.setFeatures(d);b.infoWindow.show(B(d[0]))}if(b.getLayer(a.layerInfo.id))m();else{var e=a.layerInfo.getInfoTemplate();e?(k(e),m()):a.layerInfo.loadInfoTemplate().then(function(b){k(b);m()})}}function B(b){b=b.geometry;if("point"!==b.type)if("multipoint"===b.type)b=b.getPoint(0);else if("polyline"===b.type)b=b.getExtent().getCenter();
else if("polygon"===b.type)b=b.getExtent().getCenter();else if("extent"===b.type)b=b.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return b}function G(b,a,c){var d=new f,k=[];v.getInstance(c,c.itemInfo).then(function(c){c.traversal(function(c){if(d.isResolved())return!0;("id"===b&&c.id.toLowerCase()===a.toLowerCase()||"name"===b&&c.title.toLowerCase()===a.toLowerCase())&&k.push(h({layerType:c.getLayerType(),layerObject:c.getLayerObject()}).then(function(b){"FeatureLayer"===
b.layerType&&d.resolve({layerInfo:c,layerObject:b.layerObject})},function(b){console.error("Find layer error from query URL parameter",b);d.resolve(null)}))});h(k).then(function(){d.isResolved()||d.resolve(null)})});return d}function I(b,a,c,k){var m=[102113,102100,3857],e;if(4326===b.spatialReference.wkid&&R(m,a.wkid)){b.ymin=Math.max(b.ymin,-89.99);b.ymax=Math.min(b.ymax,89.99);b=s.geographicToWebMercator(b);if((k=b.spatialReference._getInfo())&&b.xmin>b.xmax)m=k.valid[1]-b.xmin,e=b.xmax-k.valid[0],
m>e?b.xmax=k.valid[1]+e:b.xmin=k.valid[0]-m;b.spatialReference.wkid=a.wkid;c([b],null)}else if(R(m,b.spatialReference.wkid)&&4326===a.wkid){b=s.webMercatorToGeographic(b);if((k=b.spatialReference._getInfo())&&b.xmin>b.xmax)m=k.valid[1]-b.xmin,e=b.xmax-k.valid[0],m>e?b.xmax=k.valid[1]+e:b.xmin=k.valid[0]-m;c([b],null)}else m=new l,m.geometries=[b],m.outSR=a,d.defaults.geometryService.project(m,function(b){b&&0<b.length&&b[0]&&"extent"===b[0].type&&!isNaN(b[0].xmin)&&!isNaN(b[0].ymin)&&!isNaN(b[0].xmax)&&
!isNaN(b[0].ymax)?c(b,null):b&&(0<b.length&&b[0]&&"point"===b[0].type&&!isNaN(b[0].x)&&!isNaN(b[0].y))&&c(b,null)},k)}function K(b,a){var c=[102113,102100,3857];return b&&a&&b.wkt===a.wkt&&(b.wkid===a.wkid||b.latestWkid&&b.latestWkid===a.wkid||a.latestWkid&&b.wkid===a.latestWkid||b.latestWkid&&b.latestWkid===a.latestWkid)||b&&a&&b.wkid&&a.wkid&&R(c,b.wkid)&&R(c,a.wkid)?!0:!1}function R(b,a){for(var c=b.length;c--;)if(b[c]===a)return!0;return!1}return{postProcessUrlParams:function(b,a){if("extent"in
b)return y(b,a);if("center"in b)return x(b,a);if("marker"in b)return A(b,a);if("find"in b)g.publish("publishData","framework","framework",{searchString:b.find},!0);else if("query"in b)return u(b,a)}}})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/PopupMenu".split(" "),function(n,f,g,h,e,p,r,a,l){var d=null,s=n(null,{mapManager:null,popupUnion:null,constructor:function(a){f.mixin(this,
a);this.popupMenu=l.getInstance();this.isInited=!1;this.featureActionManager=r.getInstance();h.subscribe("mapLoaded",f.hitch(this,this.onMapLoadedOrChanged));h.subscribe("mapChanged",f.hitch(this,this.onMapLoadedOrChanged));h.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged));h.subscribe("widgetsActionsRegistered",f.hitch(this,this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&(this.popupUnion.mobile&&
this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode)&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop=g.create("span",{"class":"popup-menu-button"},p(".actionList",this.popupUnion.bigScreen.domNode)[0]);var a=p(".esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],a=g.create("div",{"class":"esriMobileInfoViewItem"},a);this.popupMenuButtonMobile=g.create("span",{"class":"popup-menu-button"},
a);e(this.popupMenuButtonMobile,"click",f.hitch(this,this._onPopupMenuButtonClick));e(this.popupMenuButtonDesktop,"click",f.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(a){a=g.position(a.target);this.popupMenu.show(a)},_bindSelectionChangeEvent:function(){e(this.popupUnion.bigScreen,"selection-change",f.hitch(this,this._onSelectionChange));e(this.popupUnion.mobile,"selection-change",f.hitch(this,this._onSelectionChange))},_onSelectionChange:function(a){(this.selectedFeature=
a.target.getSelectedFeature())?this._initPopupMenu():(g.addClass(this.popupMenuButtonDesktop,"disabled"),g.addClass(this.popupMenuButtonMobile,"disabled"))},_initPopupMenu:function(){this.featureActionManager.getSupportedActions(this.selectedFeature).then(f.hitch(this,function(d){d=d.filter(f.hitch(this,function(a){return 0>["ZoomTo","ShowPopup","Flash"].indexOf(a.name)}));0===d.length?(g.addClass(this.popupMenuButtonDesktop,"disabled"),g.addClass(this.popupMenuButtonMobile,"disabled")):(g.removeClass(this.popupMenuButtonDesktop,
"disabled"),g.removeClass(this.popupMenuButtonMobile,"disabled"));d=d.map(f.hitch(this,function(d){d.data=a.toFeatureSet(this.selectedFeature);return d}));this.popupMenu.setActions(d)}))},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),this.popupMenu.hide()))},
_onWidgetsActionsRegistered:function(){this.init()}});s.getInstance=function(a){null===d&&(d=new s({mapManager:a}));return d};return s})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),function(n,f,g,h,e,p,r,a){var l=null,d=n(null,{constructor:function(){this._actions=[];window.isBuilder?(h.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),h.subscribe("app/mapChanged",
f.hitch(this,this._onMapChanged))):(h.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),h.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(h.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),h.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(h.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),h.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},
getSupportedActions:function(a){a=this._getFeatureSet(a);var d=[];g.forEach(this._actions,function(k){var c=this.testActionSupportFeature(k,a);c.action=k;d.push(c)},this);return p(d).then(f.hitch(this,function(a){return a.map(f.hitch(this,function(a,d){return{result:a,action:this._actions[d]}})).filter(function(a){return a.result}).map(function(a){return a.action})}))},testActionSupportFeature:function(a,d){d=this._getFeatureSet(d);var k;d.features&&0<d.features.length&&(k=d.features[0].getLayer());
k=a.isFeatureSupported(d,k);var c=new e;k&&"function"===typeof k.then?k.then(function(a){c.resolve(a)},function(a){console.error(a);c.resolve(!1)}):c.resolve(k);return c},registerAction:function(a){var d=new e;require([a.uri],f.hitch(this,function(k){var c=new k({map:this.map,appConfig:this.appConfig,label:a.label,name:a.name,widgetId:a.widgetId});g.some(this._actions,function(a){return c.name===a.name&&c.widgetId===a.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",c.name),
d.reject("Feature/FeatureSet action has been registered.",c.name)):(this._actions.push(c),d.resolve(c))}));return d},removeActionsByWidgetId:function(a){this._actions=g.filter(this._actions,function(d){return d.widgetId!==a},this)},getActionsByWidgetId:function(a){return g.filter(this._actions,function(d){return d.widgetId===a},this)},getActionsByActionName:function(a){return g.filter(this._actions,function(d){return d.name===a},this)},registerWidgetFeatureActions:function(a){var d=new e;if(!a.featureActions||
!a.uri)return d.resolve(),d;var k=[];g.forEach(a.featureActions,function(c){k.push(this.registerAction({uri:a.isRemote?a.amdFolder+c.uri+".js":a.amdFolder+c.uri,widgetId:a.id,name:c.name,label:a.manifest["i18nLabels_featureAction_"+c.name][window.dojoConfig.locale]||a.manifest["i18nLabels_featureAction_"+c.name].defaultLabel}))},this);return p(k)},registerAllWidgetFeatureActions:function(a){var d=[];a.visitElement(f.hitch(this,function(a){a.uri&&a.visible&&d.push(this.registerWidgetFeatureActions(a))}));
return p(d).then(function(){h.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(a){var d=[];g.forEach(this.getAllActions(),function(d){var c=a.getConfigElementById(d.widgetId);"framework"!==d.widgetId&&(!c||!c.uri||!1===c.visible)&&this.removeActionsByWidgetId(d.widgetId)},this);a.visitElement(f.hitch(this,function(a){a.uri&&(a.visible&&0===this.getActionsByWidgetId(a.id).length)&&d.push(this.registerWidgetFeatureActions(a))}));0<d.length&&p(d).then(function(){h.publish("widgetsActionsRegistered")})},
_registerFrameworkActions:function(){g.forEach(r,function(a){this.registerAction({uri:a.uri,widgetId:"framework",label:window.jimuNls.featureActions[a.name],name:a.name})},this)},_getFeatureSet:function(d){return"[object Object]"===Object.prototype.toString.call(d)?d.features?d:a.toFeatureSet([d]):a.toFeatureSet(d)},_onAppConfigLoaded:function(a){this.appConfig=a=f.clone(a);this._setActionsAppConfig(a);this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(a){this.appConfig=
a=f.clone(a);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(a)},_onMapLoaded:function(a){this.map=a;this._setActionsMap(a)},_onMapChanged:function(a){this.map=a;this._setActionsMap(a)},_setActionsMap:function(a){g.forEach(this._actions,function(d){d.setMap(a)},this)},_setActionsAppConfig:function(a){g.forEach(this._actions,function(d){d.setAppConfig(a)},this)}});d.getInstance=function(){null===l&&(l=new d,window._featureActionManager=l);return l};return d})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer".split(" "),
function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",
uri:"jimu/featureActions/CreateLayer"}]})},"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(n,f,g){return n(f,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){g.featureAction.zoomTo(this.map,f.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(n,f){return n(null,{name:void 0,label:void 0,
iconFormat:"svg",iconClass:"",map:null,appConfig:{},widgetId:null,constructor:function(g){f.mixin(this,g)},isFeatureSupported:function(f,h){return!0},onExecute:function(f,h){},setMap:function(f){this.map=f},setAppConfig:function(f){this.appConfig=f},getIcon:function(f){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+this.name+"_"+f+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+f+"."+this.iconFormat}})})},
"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(n,f,g){return n(f,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(f){return 0<f.features.length&&f.geometryType},onExecute:function(f){g.featureAction.panTo(this.map,f.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare","dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(n,f,g,h){return n([g],{name:"Flash",iconClass:"icon-flash",
isFeatureSupported:function(e,g){if(1>e.features.length||!g)return!1;var r=e.features[0],a=f.getObject("renderer.symbol",!1,g);return r&&r.geometry&&(r.symbol||a)&&this.map.getLayer(g.id)},onExecute:function(e,f){h.featureAction.flash(e&&e.features,f)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(n,f,g){return n([f],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(f,e){return f&&f.features&&1===
f.features.length&&e&&e.infoTemplate},onExecute:function(f){g.featureAction.showPopup(this.map,f.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(n,f,g){return n(f,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(f){return 1<f.features.length},onExecute:function(f){f=g.createDataSource({type:g.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(g.FORMAT_CSV);f.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask ./utils ./jsonConverters".split(" "),
function(n,f,g,h,e,p,r,a,l){function d(c,d){var b="",k=d.length,e=c.length,l="",f="",q;try{g.forEach(c,function(a){b="string"===typeof a?b+l+a:b+l+(a.alias||a.name);l=","});for(var b=b+"\r\n",s=0;s<k;s++){l="";q=d[s];for(var p=0;p<e;p++){var r=c[p],f=q["string"===typeof r?r:r.name];!f&&"number"!==typeof f&&(f="");f&&"esriFieldTypeDate"===r.type&&(f=a.localizeDateByFieldInfo(f,null));f&&/[",\r\n]/g.test(f)&&(f='"'+f.replace(/(")/g,'""')+'"');b=b+l+f;l=","}b+="\r\n"}return b}catch(h){return""}}var s=
{createDataSource:function(a){return a.type===s.TYPE_TABLE?new c(a):a.type===s.TYPE_FEATURESET?new k(a):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},q=n(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,constructor:function(){this.nls=window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(a){this.format=a},download:function(){this.getExportString().then(f.hitch(this,
function(a){var c=this.filename+this.suffix,b;try{b=!!new Blob}catch(d){b=!1}b?(a=new Blob([a],{type:"text/plain;charset\x3dutf-8"}),saveAs(a,c)):saveTextAs(a,c,"utf-8")}))},exportToPortal:function(a,c){}}),k=n(q,{featureSet:null,constructor:function(a){this.inherited(arguments);this.featureSet=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===s.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===s.FORMAT_FEATURESET)return this.suffix=
".json",this._getAsFeatureSetString();if(this.format===s.FORMAT_GEOJSON)return this.suffix=".geojson",this._getAsGeoJsonString();var a=new e;a.resolve("");return a},getSupportExportFormats:function(){return[{value:s.FORMAT_CSV,label:this.nls.toCSV},{value:s.FORMAT_FEATURESET,label:this.nls.toFeatureCollection},{value:s.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},_getFeatureSet:function(){var a=new e;if(this.featureSet)a.resolve(this.featureSet);else if(this.url){var c=new p;c.returnGeometry=!0;c.outFields=
["*"];this.queryTask=new r(this.url);this.queryTask.execute(c,f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getAsFeatureSetString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var c="";a&&(a=a.toJson())&&(c=h.stringify(a));return c}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var c="";a&&(a=(new l.esriConverter).toGeoJson(a))&&(c=h.stringify(a));return c}))},
_getAsCSVString:function(){return this._getFeatureSet().then(f.hitch(this,function(a){var c="";a&&(c=this._createCSVFromFeatureSet(a));return c}))},_createCSVFromFeatureSet:function(a){var c=a.features,b=[],k;if(a.fieldAliases)for(k in a.fieldAliases)a.fieldAliases.hasOwnProperty(k)&&b.push({name:k,alias:a.fieldAliases[k]});else for(k in c=c[0].attributes,c)c.hasOwnProperty(k)&&b.push({name:k});k=g.map(a.features,function(b){return b.attributes});a.fields&&0<a.fields.length&&g.forEach(b,function(b){var c=
b.name;g.some(a.fields,function(a){return a.name===c?(b.type=a.type,!0):!1})});return d(b,k)}}),c=n(q,{table:null,constructor:function(a){this.inherited(arguments);this.table=a.data;this.url=a.url;this.filename=a.filename},getExportString:function(){if(this.format===s.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();var a=new e;a.resolve("");return a},getSupportExportFormats:function(){return[{value:s.FORMAT_CSV,label:this.nls.toCSV}]},_getTableData:function(){var a=new e;if(this.table)a.resolve(this.table);
else if(this.url){var c=new p;c.outFields=["*"];this.queryTask=new r(this.url);this.queryTask.execute(c,f.hitch(this,function(b){var c={};c.fields=b.fields;c.datas=g.map(b.features,function(b){return b.attributes});a.resolve(c)}),f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},_getAsCSVString:function(){return this._getTableData().then(f.hitch(this,function(a){var c="";a&&(c="\ufeff"+d(a.fields,a.datas));return c}))}});return s})},"jimu/jsonConverters":function(){(function(){function n(e){var f=
0,a=0,l=e.length,d=e[a],s;for(a;a<l-1;a++)s=e[a+1],f+=(s[0]-d[0])*(s[1]+d[1]),d=s;return 0<=f}function f(){function e(a){var l,d,f;if(a){if((a.x&&"NaN"!==a.x||0===a.x)&&(a.y&&"NaN"!==a.y||0===a.y))f="Point",d=[a.x,a.y];else if(a.points&&a.points.length)f="MultiPoint",d=a.points;else if(a.paths&&a.paths.length)a=a.paths,1===a.length?(f="LineString",d=a[0]):(f="MultiLineString",d=a);else if(a.rings&&a.rings.length){f=[];a=a.rings;for(l=0;l<a.length;l++)d=a[l],n(d)?f.push([d]):0<f.length&&f[f.length-
1].push(d);1<f.length?(d=f,f="MultiPolygon"):(d=f.pop(),f="Polygon")}l=d&&f?{type:f,coordinates:d}:null}return l}function f(a){var l=null,d,s;if(a&&(l={type:"Feature"},a.geometry&&(l.geometry=e(a.geometry)),a.attributes)){s={};for(d in a.attributes)s[d]=a.attributes[d];l.properties=s}return l}return{toGeoJson:function(a){var l,d,s;if(a)if(a.features){l={type:"FeatureCollection",features:[]};d=a.features;for(a=0;a<d.length;a++)(s=f(d[a]))&&l.features.push(s)}else l=a.geometry?f(a):e(a);return l}}}
function g(){function e(a){var l,f;if("Point"===a)l="esriGeometryPoint";else if("MultiPoint"===a)l="esriGeometryMultipoint",f="points";else if("LineString"===a||"MultiLineString"===a)l="esriGeometryPolyline",f="paths";else if("Polygon"===a||"MultiPolygon"===a)l="esriGeometryPolygon",f="rings";return{type:l,geomHolder:f}}function f(a){var e,l,k=[],c;e=0;for(l=a.length;e<l;e++)c=a[e],0===e!==n(c)&&(c=c.reverse()),k.push(c);return k}function a(a){var l,q,k,c,m;if("GeometryCollection"===a.type){q=[a.geometries.shift()];
l=e(q[0].type);for(k=0;k<a.geometries.length;k++){c=l.type;m=a.geometries[k].type;var g=!1;if(("esriGeometryPoint"===c||"esriGeometryMultipoint"===c)&&("Point"===m||"MultiPoint"===m))g=!0;else if("esriGeometryPolyline"===c&&("LineString"===m||"MultiLineString"===m))g=!0;else if("esriGeometryPolygon"===c&&("Polygon"===m||"MultiPolygon"===m))g=!0;g&&q.push(a.geometries[k])}}else l=e(a.type),q=[a];"esriGeometryPoint"===l.type&&1<q.length&&(l=e("MultiPoint"));a={spatialReference:{wkid:4326}};if("esriGeometryPoint"===
l.type)0===q[0].coordinates.length?(a.x=null,a.y=null):(a.x=q[0].coordinates[0],a.y=q[0].coordinates[1]);else{a[l.geomHolder]=[];for(k=0;k<q.length;k++){c=q[k];var b=g=m=void 0;if("MultiPoint"===c.type||"MultiLineString"===c.type)b=c.coordinates;else if("Point"===c.type||"LineString"===c.type)b=[c.coordinates];else if("Polygon"===c.type)b=f(c.coordinates);else if("MultiPolygon"===c.type){b=[];m=0;for(g=c.coordinates.length;m<g;m++)b.push(f(c.coordinates[m])[0])}m=b;for(c=0;c<m.length;c++)a[l.geomHolder].push(m[c])}}return a}
function l(d){var e,l,k;if(d&&(e={},d.geometry&&(e.geometry=a(d.geometry)),d.properties)){k={};for(l in d.properties)k[l]=d.properties[l];e.attributes=k}return e}return{toEsri:function(d){var e,f,k;if(d)if("FeatureCollection"===d.type){e={features:[]};f=d.features;for(d=0;d<f.length;d++)(k=l(f[d]))&&e.features.push(k)}else e="Feature"===d.type?l(d):a(d);return e}}}var h;h="undefined"!==typeof exports&&null!==exports?exports:this;if("function"===typeof define){var e={esriConverter:f,geoJsonConverter:g};
define([],function(){return e})}else h.esriConverter=f,h.geoJsonConverter=g}).call(this)},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(n,f,g){return n(f,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(f){return 1<f.features.length&&f.features[0].geometry},onExecute:function(f){f=g.createDataSource({type:g.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(g.FORMAT_FEATURESET);
f.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(n,f,g){return n(f,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(f){return 1<f.features.length&&f.features[0].geometry},onExecute:function(f){f=g.createDataSource({type:g.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(g.FORMAT_GEOJSON);f.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare",
"../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(n,f,g){return n(f,{iconClass:"icon-statistics",isFeatureSupported:function(f,e){return 1<f.features.length&&e&&0<this.getNumbericFields(e).length},onExecute:function(f,e){var p=new g,r={featureSet:f,layer:e,fieldNames:this.getNumbericFields(e).map(function(a){return a.name})};p.showContentAsPopup(r)},getNumbericFields:function(f){return f.fields.filter(function(e){return 0<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"].indexOf(e.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when dijit/form/Select esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m){return n([f],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;g.mixin(this.nls,
window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=h.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=
new q({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(a)},_showOneFieldStatContent:function(a,b){var c;m.isStatFromServer(this.statInfo)&&(c=new k,c.placeAt(b),c.show());m.getStatisticsResult(this.statInfo).then(g.hitch(this,function(a){c&&c.destroy();r(".esriAGOTableStatistics",b).remove();a=this._createStatContent(a);h.place(a,b)}))},_getFieldAliaseFromStatInfo:function(a){if(this.statInfo.layer){var b=e.filter(this.statInfo.layer.fields,
function(b){return b.name===a});return b[0]?b[0].alias:""}return this.statInfo.featureSet.fieldAliases?this.statInfo.featureSet.fieldAliases[a]:a},_createFieldDom:function(a){var b;if(1<this.statInfo.fieldNames.length){b=h.create("div",{className:"header"},a);h.create("span",{innerHTML:this.nls.field+": "},b);var c=new d({options:this.statInfo.fieldNames.map(g.hitch(this,function(b){return{value:b,label:this._getFieldAliaseFromStatInfo(b)}})),style:{width:"150px"}});this.own(p(c,"change",g.hitch(this,
function(b){this.statInfo.fieldName=b;this._showOneFieldStatContent(this.statInfo,a)})));c.placeAt(b);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else b=h.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},a);return b},_createStatContent:function(a){var b={},c="count sum min max ave stddev".split(" "),d,k,l,m,f,q,g,s;d=h.create("div",{className:"esriAGOTableStatistics",
innerHTML:""});h.create("div",{className:"hzLine",innerHTML:""},d);k=h.create("table",{className:"attrTable",innerHTML:"",style:{cellpadding:0,cellspacing:0}},d);for(f in a)a.hasOwnProperty(f)&&(b[f.toLowerCase()]=a[f]);f=b.countfield;s=b.sumfield||"";g=b.minfield||"";q=b.maxfield||"";a=b.avgfield||"";b=b.stddevfield||"";l=h.create("tbody",{},k);var p=this;e.forEach([f,s,g,q,a,b],function(b,a){""!==b&&(m=h.create("tr",{valign:"top"},l),h.create("td",{"class":"attrName",innerHTML:p.nls[c[a]]},m),h.create("td",
{"class":"attrValue",innerHTML:b},m))});h.create("div",{className:"break",innerHTML:""},d);return d}})})},"dojo/NodeList-manipulate":function(){define("./query ./_base/lang ./_base/array ./dom-construct ./dom-attr ./NodeList-dom".split(" "),function(n,f,g,h,e){function p(a){for(;a.childNodes[0]&&1==a.childNodes[0].nodeType;)a=a.childNodes[0];return a}function r(a,d){"string"==typeof a?(a=h.toDom(a,d&&d.ownerDocument),11==a.nodeType&&(a=a.childNodes[0])):1==a.nodeType&&a.parentNode&&(a=a.cloneNode(!1));
return a}var a=n.NodeList;f.extend(a,{_placeMultiple:function(a,d){for(var e="string"==typeof a||a.nodeType?n(a):a,f=[],k=0;k<e.length;k++)for(var c=e[k],m=this.length,g=m-1,b;b=this[g];g--)0<k&&(b=this._cloneNode(b),f.unshift(b)),g==m-1?h.place(b,c,d):c.parentNode.insertBefore(b,c),c=b;f.length&&(f.unshift(0),f.unshift(this.length-1),Array.prototype.splice.apply(this,f));return this},innerHTML:function(a){return arguments.length?this.addContent(a,"only"):this[0].innerHTML},text:function(a){if(arguments.length){for(var d=
0,f;f=this[d];d++)1==f.nodeType&&e.set(f,"textContent",a);return this}for(var q="",d=0;f=this[d];d++)q+=e.get(f,"textContent");return q},val:function(a){if(arguments.length){for(var d=f.isArray(a),e=0,q;q=this[e];e++){var k=q.nodeName.toUpperCase(),c=q.type,m=d?a[e]:a;if("SELECT"==k){k=q.options;for(c=0;c<k.length;c++){var p=k[c];p.selected=q.multiple?-1!=g.indexOf(a,p.value):p.value==m}}else"checkbox"==c||"radio"==c?q.checked=q.value==m:q.value=m}return this}if((q=this[0])&&1==q.nodeType){a=q.value||
"";if("SELECT"==q.nodeName.toUpperCase()&&q.multiple){a=[];k=q.options;for(c=0;c<k.length;c++)p=k[c],p.selected&&a.push(p.value);a.length||(a=null)}return a}},append:function(a){return this.addContent(a,"last")},appendTo:function(a){return this._placeMultiple(a,"last")},prepend:function(a){return this.addContent(a,"first")},prependTo:function(a){return this._placeMultiple(a,"first")},after:function(a){return this.addContent(a,"after")},insertAfter:function(a){return this._placeMultiple(a,"after")},
before:function(a){return this.addContent(a,"before")},insertBefore:function(a){return this._placeMultiple(a,"before")},remove:a.prototype.orphan,wrap:function(a){if(this[0]){a=r(a,this[0]);for(var d=0,e;e=this[d];d++){var f=this._cloneNode(a);e.parentNode&&e.parentNode.replaceChild(f,e);p(f).appendChild(e)}}return this},wrapAll:function(a){if(this[0]){a=r(a,this[0]);this[0].parentNode.replaceChild(a,this[0]);a=p(a);for(var d=0,e;e=this[d];d++)a.appendChild(e)}return this},wrapInner:function(a){if(this[0]){a=
r(a,this[0]);for(var d=0;d<this.length;d++){var e=this._cloneNode(a);this._wrap(f._toArray(this[d].childNodes),null,this._NodeListCtor).wrapAll(e)}}return this},replaceWith:function(a){a=this._normalize(a,this[0]);for(var d=0,e;e=this[d];d++)this._place(a,e,"before",0<d),e.parentNode.removeChild(e);return this},replaceAll:function(a){a=n(a);for(var d=this._normalize(this,this[0]),e=0,f;f=a[e];e++)this._place(d,f,"before",0<e),f.parentNode.removeChild(f);return this},clone:function(){for(var a=[],
d=0;d<this.length;d++)a.push(this._cloneNode(this[d]));return this._wrap(a,this,this._NodeListCtor)}});a.prototype.html||(a.prototype.html=a.prototype.innerHTML);return a})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x){function y(b){return function(c){this._isLoaded?this.inherited(b,arguments):this.loadDropDown(a.hitch(this,b,c))}}var A=f("dijit.form._SelectMenu",k,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,"selectstart",function(b){b.preventDefault();b.stopPropagation()}))},focus:function(){var b=!1,c=this.parentWidget.value;
a.isArray(c)&&(c=c[c.length-1]);c&&n.forEach(this.parentWidget._getChildren(),function(a){a.option&&c===a.option.value&&(b=!0,this.focusChild(a,!1))},this);b||this.inherited(arguments)}});e=f("dijit.form.Select"+(d("dojo-bidi")?"_NoBidi":""),[s,q,b],{baseClass:"dijitSelect dijitValidationTextBox",templateString:x,_buttonInputDisabled:d("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var b=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=b?b:0].value)}this.dropDown=new A({id:this.id+"_menu",parentWidget:this});h.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(b){if(!b.value&&!b.label)return new m({ownerDocument:this.ownerDocument});var d=a.hitch(this,"_setValueAttr",b);b=new c({option:b,label:("text"===this.labelType?(b.label||"").toString().replace(/&/g,
"\x26amp;").replace(/</g,"\x26lt;"):b.label)||this.emptyLabel,onClick:d,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:b.disabled||!1});b.focusNode.setAttribute("role","option");return b},_addOptionItem:function(b){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(b))},_getChildren:function(){return!this.dropDown?[]:this.dropDown.getChildren()},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(b){}},focusChild:function(b){b&&
this.set("value",b.option)},_getFirst:function(){var b=this._getChildren();return b.length?b[0]:null},_getLast:function(){var b=this._getChildren();return b.length?b[b.length-1]:null},childSelector:function(b){return(b=v.byNode(b))&&b.getParent()==this.dropDown},onKeyboardSearch:function(b,a,c,d){b&&this.focusChild(b)},_loadChildren:function(b){if(!0===b)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{n.forEach(this._getChildren(),
function(b){b.destroyRecursive()});var a=new c({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(a)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(b){this.inherited(arguments);g.set(this.valueNode,"value",this.get("value"));this._refreshState()},
_setNameAttr:"valueNode",_setDisabledAttr:function(b){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(b){this._set("required",b);this.focusNode.setAttribute("aria-required",b);this._refreshState()},_setOptionsAttr:function(b){this._isLoaded=!1;this._set("options",b)},_setDisplay:function(b){b=("text"===this.labelType?(b||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):b)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+b+"\x3c/span\x3e"},validate:function(b){b=this.disabled||this.isValid(b);this._set("state",b?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",b?"false":"true");var a=b?"":this._missingMsg;a&&this.focused&&this._hasBeenBlurred?t.show(a,this.domNode,this.tooltipPosition,!this.isLeftToRight()):t.hide(this.domNode);this._set("message",a);return b},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);t.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=p.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(l(this.domNode,"selectstart",function(b){b.preventDefault();b.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var b=this._keyNavCodes;delete b[r.LEFT_ARROW];delete b[r.RIGHT_ARROW]},_setStyleAttr:function(b){this.inherited(arguments);
h.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(b){this._loadChildren(!0);this._isLoaded=!0;b()},destroy:function(b){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(b),delete this.dropDown);t.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){t.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
d("dojo-bidi")&&(e=f("dijit.form.Select",e,{_setDisplay:function(b){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));e._Menu=A;e.prototype._onContainerKeydown=y("_onContainerKeydown");e.prototype._onContainerKeypress=y("_onContainerKeypress");return e})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k){return e("dijit.form._FormSelectWidget",k,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var d=this.options||[];if(null==a)return d;if(l.isArrayLike(a))return n.map(a,"return this.getOptions(item);",this);l.isString(a)&&(a={value:a});l.isObject(a)&&(n.some(d,function(d,b){for(var k in a)if(!(k in d)||d[k]!=a[k])return!1;a=b;return!0})||(a=-1));return 0<=a&&a<d.length?d[a]:null},addOption:function(a){n.forEach(l.isArrayLike(a)?a:[a],function(a){a&&l.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(l.isArrayLike(a)?
a:[a]);n.forEach(a,function(a){a&&(this.options=n.filter(this.options,function(c){return c.value!==a.value||c.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){n.forEach(l.isArrayLike(a)?a:[a],function(a){var c=this.getOptions({value:a.value}),b;if(c)for(b in a)c[b]=a[b]},this);this._loadChildren()},setStore:function(c,d,k){a.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(c,d,k)},_deprecatedSetStore:function(a,d,k){var b=this.store;k=k||{};if(b!==a){for(var e;e=this._notifyConnections.pop();)e.remove();a.get||(l.mixin(a,{_oldAPI:!0,get:function(b){var a=new f;this.fetchItemByIdentity({identity:b,onItem:function(b){a.resolve(b)},onError:function(b){a.reject(b)}});return a.promise},query:function(b,a){var c=new f(function(){d.abort&&d.abort()});c.total=new f;var d=this.fetch(l.mixin({query:b,onBegin:function(b){c.total.resolve(b)},
onComplete:function(b){c.resolve(b)},onError:function(b){c.reject(b)}},a));return new q(c)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[g.after(a,"onNew",l.hitch(this,"_onNewItem"),!0),g.after(a,"onDelete",l.hitch(this,"_onDeleteItem"),!0),g.after(a,"onSet",l.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);k.query&&this._set("query",k.query);k.queryOptions&&this._set("queryOptions",k.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new f,this._queryRes=a.query(this.query,this.queryOptions),s(this._queryRes,l.hitch(this,function(b){if(this.sortByLabel&&!k.sort&&b.length)if(a.getValue)b.sort(h.createSortFunction([{attribute:a.getLabelAttributes(b[0])[0]}],a));else{var e=this.labelAttr;b.sort(function(b,a){return b[e]>a[e]?1:a[e]>
b[e]?-1:0})}k.onFetch&&(b=k.onFetch.call(this,b,k));n.forEach(b,function(b){this._addOptionForItem(b)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(l.hitch(this,function(b,a,c){a==c?this._onSetItem(b):(-1!=a&&this._onDeleteItem(b),-1!=c&&this._onNewItem(b))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:d);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(b):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),l.hitch(this,function(b){console.error("dijit.form.Select: "+b.toString());this.onLoadDeferred.reject(b)})));return b},_setValueAttr:function(a,d){this._onChangeActive||(d=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=l.isArrayLike(a)?n.map(a,function(b){return l.isObject(b)?b:{value:b}}):l.isObject(a)?[a]:[{value:a}];a=n.filter(this.getOptions(a),function(b){return b&&b.value});var k=this.getOptions()||[];if(!this.multiple&&(!a[0]||!a[0].value)&&k.length)a[0]=
k[0];n.forEach(k,function(b){b.selected=n.some(a,function(a){return a.value===b.value})});k=n.map(a,function(b){return b.value});if(!("undefined"==typeof k||"undefined"==typeof k[0])){var b=n.map(a,function(b){return b.label});this._setDisplay(this.multiple?b:b[0]);this.inherited(arguments,[this.multiple?k:k[0],d]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=n.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(n.forEach(this._getChildren(),function(a){a.destroyRecursive()}),n.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var d=this;n.forEach(this._getChildren(),function(k){var b=n.some(a,function(b){return k.option&&
b===k.option.value});b&&!d.multiple&&(d.focusedChild=k);r.toggle(k.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),b);k.domNode.setAttribute("aria-selected",b?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var d=n.filter(a,function(a){return a.selected})[0];if(d&&d.value)return d.value;a[0].selected=!0;return a[0].value}return this.multiple?n.map(n.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,d){(!d||!d.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var d=this.store,k=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:d.getLabel(a);return{value:k?d.getIdentity(a):null,label:k,item:a}},_addOptionForItem:function(a){var d=this.store;d.isItemLoaded&&!d.isItemLoaded(a)?d.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);p.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?d("\x3e *",this.srcNodeRef).map(function(c){return"separator"===c.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:c.getAttribute("data-"+a._scopeName+"-value")||c.getAttribute("value"),
label:String(c.innerHTML),selected:c.getAttribute("selected")||!1,disabled:c.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);g.after(this,"onChange",l.hitch(this,"_updateSelection"));var a=this.store;if(a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"]))this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions});this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(n){var f={};n.setObject("dojo.data.util.sorter",f);f.basicComparator=function(f,h){var e=-1;null===f&&(f=void 0);null===h&&(h=void 0);if(f==h)e=0;else if(f>h||null==f)e=1;return e};f.createSortFunction=function(g,h){function e(a,c,d,e){return function(b,f){var l=e.getValue(b,a),q=e.getValue(f,
a);return c*d(l,q)}}for(var p=[],r,a=h.comparatorMap,l=f.basicComparator,d=0;d<g.length;d++){r=g[d];var s=r.attribute;if(s){r=r.descending?-1:1;var q=l;a&&("string"!==typeof s&&"toString"in s&&(s=s.toString()),q=a[s]||l);p.push(e(s,r,q,h))}}return function(a,c){for(var d=0;d<p.length;){var e=p[d++](a,c);if(0!==e)return e}return 0}};return f})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(n,f,g){var h=function(e){function p(a){e[a]=
function(){var f=arguments,d=g(e,function(d){Array.prototype.unshift.call(f,d);return h(n[a].apply(n,f))});if("forEach"!==a||r)return d}}if(!e)return e;var r=!!e.then;r&&(e=f.delegate(e));p("forEach");p("filter");p("map");null==e.total&&(e.total=g(e,function(a){return a.length}));return e};f.setObject("dojo.store.util.QueryResults",h);return h})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(n,f,g,h){return n("dijit.DropDownMenu",
h,{templateString:g,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(e){this._moveToPopup(e);e.stopPropagation();e.preventDefault()},_onLeftArrow:function(e){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else e.stopPropagation(),e.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m){return f("dijit._MenuBase",[q,m,c,k],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){e.toggle(this.domNode,"dijitMenuActive",a);e.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var b=s.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var c=this,b="string"==typeof this.childSelector?this.childSelector:p.hitch(this,"childSelector");this.own(a(this.containerNode,a.selector(b,r.enter),function(){c.onItemHover(s.byNode(this))}),a(this.containerNode,a.selector(b,r.leave),function(){c.onItemUnhover(s.byNode(this))}),a(this.containerNode,a.selector(b,d),function(b){c.onItemClick(s.byNode(this),b);b.stopPropagation()}),
a(this.containerNode,a.selector(b,"focusin"),function(){c._onItemFocus(s.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||
b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(c,b){if(c!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var d=c.popup;d.parentMenu=this;this.own(this._mouseoverHandle=a.once(d.domNode,"mouseover",p.hitch(this,"_onPopupHover")));var k=this;c._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&
k.focusChild(c);k._cleanUp()},onExecute:p.hitch(this,"_cleanUp",!0),onClose:function(){k._mouseoverHandle&&(k._mouseoverHandle.remove(),delete k._mouseoverHandle)}},b);this.currentPopupItem=c}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(h.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(n,f,g,h,e,p,r,a,l,d){return f("dijit._KeyNavContainer",[l,d,a],{connectKeyNavHandlers:function(a,d){var k=this._keyNavCodes={},c=p.hitch(this,"focusPrev"),f=p.hitch(this,"focusNext");n.forEach(a,function(a){k[a]=c});n.forEach(d,function(a){k[a]=f});k[e.HOME]=p.hitch(this,"focusFirstChild");k[e.END]=p.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){h.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);n.forEach(this.getChildren(),
p.hitch(this,"_startupChild"))},addChild:function(a,d){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
r.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(n,f,g,h,e,p,r,a){return f("dijit._KeyNavMixin",a,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);g.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var a=this._keyNavCodes={};a[h.HOME]=e.hitch(this,"focusFirstChild");a[h.END]=e.hitch(this,
"focusLastChild");a[this.isLeftToRight()?h.LEFT_ARROW:h.RIGHT_ARROW]=e.hitch(this,"_onLeftArrow");a[this.isLeftToRight()?h.RIGHT_ARROW:h.LEFT_ARROW]=e.hitch(this,"_onRightArrow");a[h.UP_ARROW]=e.hitch(this,"_onUpArrow");a[h.DOWN_ARROW]=e.hitch(this,"_onDownArrow")}var d=this,a="string"==typeof this.childSelector?this.childSelector:e.hitch(this,"childSelector");this.own(p(this.domNode,"keypress",e.hitch(this,"_onContainerKeypress")),p(this.domNode,"keydown",e.hitch(this,"_onContainerKeydown")),p(this.domNode,
"focus",e.hitch(this,"_onContainerFocus")),p(this.containerNode,p.selector(a,"focusin"),function(a){d._onChildFocus(r.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(a,d){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(d?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){g.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){g.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,d,e,f){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,d){var e=a.domNode,e=(a.label||(e.focusNode?
e.focusNode.label:"")||e.innerText||e.textContent||"").replace(/^\s+/,"").substr(0,d.length).toLowerCase();return d.length&&e==d?-1:0},_isFormElement:function(a){return"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"BUTTON"===a.tagName},_onContainerKeydown:function(a){if(!this._isFormElement(document.activeElement)){var d=this._keyNavCodes[a.keyCode];d?(d(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""):a.keyCode==h.SPACE&&(this._searchTimer&&
!a.ctrlKey&&!a.altKey&&!a.metaKey)&&(a.stopImmediatePropagation(),a.preventDefault(),this._keyboardSearch(a," "))}},_onContainerKeypress:function(a){if(!this._isFormElement(document.activeElement)&&!(a.charCode<=h.SPACE||a.ctrlKey||a.altKey||a.metaKey))a.preventDefault(),a.stopPropagation(),this._keyboardSearch(a,String.fromCharCode(a.charCode).toLowerCase())},_keyboardSearch:function(a,d){var f=null,q,k=0;e.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=d;
var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;q=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var e=this.focusedChild||null;if(1==a||!e)if(e=this._getNextFocusableChild(e,1),!e)return;a=e;do{var l=this._keyboardSearchCompare(e,q);l&&0==k++&&(f=e);if(-1==l){k=-1;break}e=this._getNextFocusableChild(e,1)}while(e&&e!=a)})();this.onKeyboardSearch(f,a,q,k)},_onChildBlur:function(){},
_getNextFocusableChild:function(a,d){var e=a;do{if(a)a=this._getNext(a,d);else if(a=this[0<d?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=e&&a.isFocusable())return a}while(a!=e);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,d){if(a)for(a=a.domNode;a;)if((a=a[0>d?"previousSibling":"nextSibling"])&&"getAttribute"in a){var e=r.byNode(a);if(e)return e}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q){r=n("dijit.MenuItem"+(p("dojo-bidi")?"_NoBidi":""),[a,l,d,s],{templateString:q,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var c="",d;d=a.search(/{\S}/);if(0<=d){var c=a.charAt(d+1),e=a.substr(0,d);a=a.substr(d+3);d=e+c+a;a=e+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+c+"\x3c/span\x3e"+a}else d=a;this.domNode.setAttribute("aria-label",d+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",c)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);g.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&g.set(this.accelKeyNode,"id",this.id+"_accel");f.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==p("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_setSelected:function(a){h.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){e.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){e.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,g.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});p("dojo-bidi")&&(r=n("dijit.MenuItem",r,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return r})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(n,f){return n("dijit._Contained",null,{_getSibling:function(f){var h=this.getParent();return h&&h._getSiblingOfChild&&h._getSiblingOfChild(this,
"previous"==f?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var f=this.getParent();return!f||!f.getIndexOfChild?-1:f.getIndexOfChild(this)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(n,f,g,h,e,p){return n("dijit.MenuSeparator",[g,h,e],{templateString:p,
buildRendering:function(){this.inherited(arguments);f.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),function(n,f,g,h,e,p,r,a,l){function d(a){var c;c=new e;c.outFields=[a.fieldName];c.outStatistics=[];c.geometry=a.geometry;var d=q(a);n.forEach(d,function(d){var k=new g;k.statisticType=
d;k.displayFeildName=a.fieldName;k.onStatisticField=a.fieldName;k.outStatisticFieldName=b[d];c.outStatistics.push(k)});c.where=a.filterExpression?a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(c.geometry=a.geometry);return(new h(a.layer.url)).execute(c).then(function(b){return b&&b.features&&0<b.features.length?(b=b.features[0].attributes,m(a,b),b):[]})}function s(b){var a={countField:0,sumField:0},c=q(b),d=0,e=0;b.featureSet.features.forEach(function(k){var f=
k.attributes[b.fieldName];null===f||"undefined"===typeof f||c.forEach(function(b){switch(b){case "count":a.countField++;break;case "sum":a.sumField+=f;break;case "min":a.minField="undefined"===typeof a.minField?f:Math.min(a.minField,f);break;case "max":a.maxField="undefined"===typeof a.maxField?f:Math.max(a.maxField,f);break;case "avg":d++,e+=f}})});if(0===d)return f({countField:0});a.avgField=0===d?"":e/d;var l=b.featureSet.features.filter(function(a){a=a.attributes[b.fieldName];return null===a||
"undefined"===typeof a?!1:!0}).map(function(a){return a.attributes[b.fieldName]});a.stddevField=k(l);m(b,a);return f(a)}function q(b){return b.statisticTypes&&0<b.statisticTypes.length?t.filter(function(a){return-1<b.statisticTypes.indexOf(a)}):t}function k(b){var a=b.length;if(1>=a)return 0;var c=0;b.forEach(function(b){c+=b});var d=c/a,k=0;b.forEach(function(b){k+=Math.pow(b-d,2)});return Math.sqrt(1/(a-1)*k)}function c(b){var c=a.getInstanceSync();return b.layer?c.getLayerInfoById(b.layer.id).loadInfoTemplate().then(function(b){var a=
{};b.info&&b.info.fieldInfos&&b.info.fieldInfos.forEach(function(b){a[b.fieldName]=b});return a}):f({})}function m(b,a){if(b.fieldInfos[b.fieldName])for(var c in a)"countField"!==c&&p.isDefined(a[c])&&(a[c]=null===a[c]||"undefined"===typeof a[c]?"":r.localizeNumberByFieldInfo(a[c],b.fieldInfos[b.fieldName]))}var t="count sum min max avg stddev".split(" "),b={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};l.getStatisticsResult=function(b){return c(b).then(function(a){b.fieldInfos=
a;if(b.featureSet)return s(b);if(b.layer){if(b.layer.url)return d(b);b.featureSet=r.toFeatureSet(b.layer.graphics);return s(b)}})};l.isStatFromServer=function(b){return b.layer&&b.layer.url};l.getStddevVal=k})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k){return n(l,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(a){return 1<a.features.length},onExecute:function(c,d){var k,b;k={layerDefinition:{geometryType:d.geometryType,fields:f.clone(d.fields),objectIdField:d.objectIdField},featureSet:c.toJson()};k=new p(k);(b=d._json?h.parse(d._json):null)&&b.drawingInfo&&b.drawingInfo.renderer?(b=b.drawingInfo.renderer,b=r.fromJson(b)):b=r.fromJson(d.renderer.toJson());k.setRenderer(b);(b=d.getSelectionSymbol())&&
k.setSelectionSymbol(a.fromJson(b.toJson()));this._popupAddLayer(k)},_popupAddLayer:function(a){var m,l=g.create("div",{style:"padding: 0 10px 0 10px;"}),b=(new s({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(l);g.setStyle(b.searchBtn,"display","none");var q=new d({content:l,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,function(){a.name=k.stripHTML(b.getValue());this._addLayerToMap(a);q.close();
m&&m.remove&&m.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){q.close();m&&m.remove&&m.remove()})}]});b.inputSearch.focus();q.disableButton(0);m=e(b.inputSearch,"keyup",function(){b.getValue()?q.enableButton(0):q.disableButton(0)})},_addLayerToMap:function(a){var d=q.getInstanceSync(),k=e(d,"layerInfosChanged",f.hitch(this,function(b){a.id===b.id&&(b.enablePopup(),k.remove())}));this.map.addLayer(a)}})})},"jimu/dijit/Search":function(){define(["dojo/_base/declare",
"dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(n,f,g,h,e){return n([h,e],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&f.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return g.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(e){13===(void 0!==e.keyCode?e.keyCode:e.which)&&this.doSearch();e.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()}})})},
"jimu/dijit/PopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin ./PopupMenuItem".split(" "),function(n,f,g,h,e,p,r,a,l){var d=null,s=n([r,a],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);this.hide();this.menuItems=[];this.own(e(this.domNode,"click",g.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||f.isDescendant(a,this.menuNode)||this.hide()})));this.own(e(this.closeBtn,"click",g.hitch(this,this.hide)))},setActions:function(a){this.clearActions();h.forEach(a,g.hitch(this,this._addMenuItem))},clearActions:function(){this.menuItems=[];f.empty(this.menuContent)},_addMenuItem:function(a){a=new l({action:a});f.place(a.domNode,
this.menuContent);a.startup();this.menuItems.push(a);this.own(e(a,"click",g.hitch(this,this.hide)))},hide:function(){f.setStyle(this.domNode,"display","none")},show:function(a,d){if(0===this.menuItems.length)f.setStyle(this.domNode,"display","none");else{"string"===typeof d&&""!==d?(this.labelNode.innerHTML=d,f.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",f.setStyle(this.titleNode,"display","none"));var c,e=a.y+a.h,l;c=window.isRTL?a.x:a.x+a.w;f.setStyle(this.domNode,"display",
"");f.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});l=p.getMarginSize(this.menuNode);f.setStyle(this.menuNode,{left:(window.isRTL?c+l.w>window.innerWidth?window.innerWidth-l.w:0>c?0:c:0>c-l.w?0:c>window.innerWidth?window.innerWidth-l.w:c-l.w)+"px",top:(l.h>window.innerHeight?0:e+l.h>window.innerHeight?window.innerHeight-l.h:e+l.h+5<window.innerHeight?e+5:e)+"px"})}}});s.getInstance=function(){null===d&&(d=new s,f.place(d.domNode,document.body),d.startup());d.setActions([]);return d};
return s})},"jimu/dijit/PopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(n,f,g,h,e,p,r,a,l){return n([a,l,r],{baseClass:"popup-menu-item",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"icon jimu-float-leading"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',
action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=this.action.label,this.action.iconClass?f.addClass(this.iconNode,this.action.iconClass):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(e(this.domNode,p.enter,g.hitch(this,this._useHoverIcon))),this.own(e(this.domNode,p.leave,g.hitch(this,this._useNormalIcon))));this.own(e(this.domNode,"click",g.hitch(this,this._clickHandler)))},_useNormalIcon:function(){this.action.iconClass?
f.removeClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?f.addClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("hover")+")")},_clickHandler:function(a){h.stop(a);if(this.action){var e;this.action.data.features&&0<this.action.data.features.length&&(e=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,
e)}this.emit("click")}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(n,f,g,h,e){var p=null,r=n(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(g.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),g.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(g.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),g.subscribe("mapChanged",f.hitch(this,
this._onMapChanged)));g.subscribe("widgetDestroyed",f.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(a,e){return f.getObject(a+".filterExprs."+e,!1,this._filters)},applyWidgetFilter:function(a,e,d,f,q){this._setFilterExp(a,e,d,f,q);e=this.layerInfos.getLayerInfoById(a);a=this._getFilterExp(a);null!==a&&e.setFilter(a)},_onMapLoaded:function(){this.layerInfos=e.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=e.getInstanceSync();this._traversalFilter()},
_onWidgetDestroyed:function(a){for(var e in this._filters)if(this._filters[e]){var d=this._filters[e];if(d){var f=d.filterExprs,d=d.mapFilterControls;f&&delete f[a];d&&delete d[a]}}},_traversalFilter:function(){this.layerInfos.traversal(f.hitch(this,function(a){this._filters[a.id]||(this._filters[a.id]={definitionExpression:a.getFilter(),filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(a){a=f.getObject(a+".mapFilterControls",!1,this._filters);var e=0,d;for(d in a){var g=
a[d];g.priority>e&&(e=g.priority)}return e},_getMapFilterControl:function(a){a=f.getObject(a+".mapFilterControls",!1,this._filters);var e=null,d;for(d in a){var g=a[d];0<g.priority&&(e=g)}return e},_setFilterExp:function(a,e,d,g,q){var k=a+".filterExprs."+e,c=a+".mapFilterControls."+e;d?(f.setObject(k,d,this._filters),h.isDefined(g)&&(a=this._getPriorityOfMapFilter(a),f.setObject(c,{enable:g,useAND:q,priority:a+1},this._filters))):(f.getObject(k,!1,this._filters)&&delete this._filters[a].filterExprs[e],
f.getObject(c,!1,this._filters)&&delete this._filters[a].mapFilterControls[e])},_getFilterExp:function(a){if(!this._filters[a])return null;var e=[],d=this._filters[a].definitionExpression,f=this._filters[a].filterExprs;a=this._getMapFilterControl(a);for(var q in f){var k=f[q];k&&e.push("("+k+")")}e=e.join(" AND ");return d&&a&&a.enable||d&&null===a?e?a&&!1===a.useAND?"("+d+") OR "+e:"("+d+") AND "+e:d:e}});r.getInstance=function(){if(null===p)p=new r,window._filterManager=p;else return p};return r})},
"jimu/OnScreenWidgetIcon":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetBase ./utils".split(" "),function(n,f,g,h,e,p,r){return n(p,{"class":"jimu-widget-onscreen-icon",postCreate:function(){this.inherited(arguments);this.iconNode=h.create("img",{src:this.widgetConfig.icon},this.domNode);h.setAttr(this.domNode,"title",this.widgetConfig.label);h.setAttr(this.domNode,"data-widget-name",this.widgetConfig.name);this.own(e(this.domNode,"click",
f.hitch(this,function(){this.onClick()})));this.position=f.clone(this.widgetConfig.position);"map"===this.widgetConfig.position.relativeTo&&this.own(e(this.map,"resize",f.hitch(this,function(){var a=f.clone(this.position);delete a.width;delete a.height;this.panel&&this.panel.setPosition(a)})));this.state="closed"},startup:function(){this.inherited(arguments)},onClick:function(){"closed"===this.state?this.switchToOpen():this.switchToClose()},moveTo:function(a){var e={left:"auto",right:"auto",bottom:"auto",
top:"auto",width:"auto",height:"auto"},e=f.mixin(e,r.getPositionStyle(a));delete e.width;delete e.height;h.setStyle(this.domNode,e);this.position=f.clone(a);this.widgetConfig&&this.widgetConfig.panel&&(this.widgetConfig.panel.position=f.clone(a),this.widgetConfig.position=f.clone(a));this.panel&&this.panel.setPosition(f.clone(a));this.widget&&this.widget.setPosition(this.getOffPanelWidgetPosition(this.widget))},destroy:function(){this.panel?this.panelManager.destroyPanel(this.panel):this.widget&&
this.widgetManager.destroyWidget(this.widget);this.inherited(arguments)},switchToOpen:function(){this.state="opened";this.panelManager.closeAllPanelsInGroup(this.widgetConfig.gid);g.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.closeable&&this.widgetManager.closeWidget(a)},this);h.addClass(this.domNode,"jimu-state-selected");this._showLoading();!1===this.widgetConfig.inPanel?this.widgetManager.loadWidget(this.widgetConfig).then(f.hitch(this,function(a){this.widget=a;a.setPosition(this.getOffPanelWidgetPosition(a));
this.widgetManager.openWidget(a);this.own(e(a,"close",f.hitch(this,function(){this.switchToClose()})));this._hideLoading()})):this.panelManager.showPanel(f.clone(this.widgetConfig)).then(f.hitch(this,function(a){this.panel=a;this.own(e(a,"close",f.hitch(this,function(){this.switchToClose()})));this._hideLoading()}))},switchToClose:function(){this.state="closed";h.removeClass(this.domNode,"jimu-state-selected");!1===this.widgetConfig.inPanel?this.widgetManager.closeWidget(this.widget):this.panelManager.closePanel(this.panel)},
getOffPanelWidgetPosition:function(a){var e={relativeTo:a.position.relativeTo},d=h.getMarginBox(this.domNode);a=this.widgetManager.getWidgetMarginBox(a);var f=h.getMarginBox("map"===e.relativeTo?this.map.id:jimuConfig.layoutId),q=d.t+d.h+1;q+a.h>f.h?e.bottom=f.h-d.t+1:e.top=q;window.isRTL?e.right=0>d.l+d.w-a.w?0:d.l+d.w-a.w:d.l+a.w>f.w?e.right=0:e.left=d.l;return e},_showLoading:function(){h.setAttr(this.iconNode,"src",require.toUrl("jimu")+"/images/loading_circle.gif")},_hideLoading:function(){h.setAttr(this.iconNode,
"src",this.widgetConfig.icon)}})})},"jimu/WidgetPlaceholder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase","./utils"],function(n,f,g,h,e){return n(h,{"class":"jimu-widget-placeholder",postCreate:function(){this.inherited(arguments);this.indexNode=g.create("div",{"class":"inner",innerHTML:this.index},this.domNode);g.setAttr(this.domNode,"title",window.jimuNls.widgetPlaceholderTooltip)},moveTo:function(p){var r={left:"auto",right:"auto",bottom:"auto",
top:"auto",width:"auto",height:"auto"},r=f.mixin(r,e.getPositionStyle(p));delete r.width;delete r.height;g.setStyle(this.domNode,r)},setIndex:function(e){this.index=e;this.indexNode.innerHTML=e}})})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(n,f,g){var h=null,e;e=n(null,{constructor:function(e){g.subscribe("publishData",f.hitch(this,this.onDataPublished));g.subscribe("fetchData",f.hitch(this,this.onFetchData));g.subscribe("clearAllData",f.hitch(this,
this.onClearAllData));g.subscribe("removeData",f.hitch(this,this.onRemoveData));g.subscribe("clearDataHistory",f.hitch(this,this.onClearDataHistory));this.widgetManager=e},_dataStore:{},onDataPublished:function(e,f,a,l){"undefined"===typeof l&&(l=!1);this._dataStore[f]?(this._dataStore[f].current=a,l&&(this._dataStore[f].history?this._dataStore[f].history.push(a):this._dataStore[f].history=[a])):(this._dataStore[f]={current:a},l&&(this._dataStore[f].history=[a]))},onFetchData:function(e){var f;if(e)"framework"===
e?this._dataStore[e]?g.publish("dataFetched","framework","framework",this._dataStore[e].current,this._dataStore[e].history):g.publish("noData","framework","framework"):(f=this.widgetManager.getWidgetById(e))?this._dataStore[e]?g.publish("dataFetched",f.name,e,this._dataStore[e].current,this._dataStore[e].history):g.publish("noData",f.name,e):g.publish("noData",void 0,e);else{for(var a in this._dataStore)(f=this.widgetManager.getWidgetById(a))&&g.publish("dataFetched",f.name,a,this._dataStore[a].current,
this._dataStore[a].history);f||g.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};g.publish("allDataCleared")},onRemoveData:function(e){delete this._dataStore[e];g.publish("dataRemoved",e)},onClearDataHistory:function(e){this._dataStore[e]&&(this._dataStore[e].history=[]);g.publish("dataHistoryCleared",e)}});e.getInstance=function(f){null===h&&(h=new e(f));return h};return e})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k){var c=null,m=n(null,{constructor:function(){window.isBuilder?(e.subscribe("app/mapLoaded",g.hitch(this,this._onMapLoaded)),e.subscribe("app/mapChanged",g.hitch(this,this._onMapChanged))):(e.subscribe("mapLoaded",g.hitch(this,this._onMapLoaded)),e.subscribe("mapChanged",g.hitch(this,this._onMapChanged)))},_displayLayers:{},setSelectionSymbol:function(a){var b=a.geometryType,c=new d("#00FFFF"),e=new s(s.STYLE_CIRCLE,16,null,c),f=new q(q.STYLE_SOLID,c,2),c=new k(k.STYLE_NULL,
f,c);"esriGeometryPoint"===b?a.setSelectionSymbol(e):"esriGeometryPolyline"===b?a.setSelectionSymbol(f):"esriGeometryPolygon"===b&&a.setSelectionSymbol(c)},updateSelectionByFeatures:function(a,b,c){a.getSelectionSymbol()||this.setSelectionSymbol(a);var d=new f;a._selectHandler({features:b},c,null,null,d);this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a));return d},getDisplayLayer:function(a){return this._displayLayers[a]},
setSelection:function(a,b){return this.updateSelectionByFeatures(a,b,p.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,p.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,b,p.SELECTION_SUBTRACT)},clearSelection:function(a){this.clearDisplayLayer(a);return this.updateSelectionByFeatures(a,[],p.SELECTION_NEW)},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(c,
b,d){return h.filter(c.graphics,g.hitch(this,function(c){return d?a.contains(b,c.geometry):a.intersects(b,c.geometry)}))},getUnionGeometryBySelectedFeatures:function(c){var b=null;c=c.getSelectedFeatures();0<c.length&&(b=h.map(c,g.hitch(this,function(b){return b.geometry})),b=a.union(b));return b},_createDisplayLayer:function(a){var b=new r;b.id="displayLayer_of_"+a.id;this.map.addLayer(b);return b},_updateDisplayLayer:function(a){var b=a.getSelectedFeatures(),c=this._displayLayers[a.id];this.clearDisplayLayer(a);
var d=a.getSelectionSymbol();h.forEach(b,g.hitch(this,function(b){b.setSymbol(null);b=new l(b.toJson());b.setSymbol(d);c.add(b)}))},_isLayerNeedDisplayLayer:function(a){return!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});m.getInstance=function(){c||(c=new m,window._selectionManager=c);return c};return m})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),
function(n,f,g,h,e,p,r,a,l){return n([p,r],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(e.subscribe("publishData",f.hitch(this,this._onReceiveData)));this.own(e.subscribe("dataFetched",f.hitch(this,
this._onReceiveData)));this.own(e.subscribe("noData",f.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(d,e){this.position=d;var f=a.getPositionStyle(this.position);f.position="absolute";
e||(e="map"===d.relativeTo?this.map.id:window.jimuConfig.layoutId);h.place(this.domNode,e);h.setStyle(this.domNode,f);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return h.getMarginBox(this.domNode)},setMap:function(a){this.map=a},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,e,f){},onAction:function(a,e){},getPanel:function(){if(!1===
this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return l.getInstance().getPanelById(this.id+"_panel");var a=l.getInstance().getPanelById(this.gid+"_panel");return a?a:l.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,f){"undefined"===typeof f&&(f=!1);e.publish("publishData",this.name,this.id,a,f)},fetchData:function(a){a?e.publish("fetchData",a):0!==this.listenWidgetIds.length?g.forEach(this.listenWidgetIds,function(a){e.publish("fetchData",a)},
this):e.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);g.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){return this.widgetManager.triggerWidgetOpen(a)},_onReceiveData:function(a,e,f,k){if(e!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(e)))this.onReceiveData(a,e,f,k)},onReceiveData:function(a,e,f,k){},_onNoData:function(a,e){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(e)))this.onNoData(a,
e)},onNoData:function(a,e){}})})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(n,f,g,h){return n([h],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&("closed"!==
this.widget.state&&f.isFunction(this.widget.resize))&&this.widget.resize()},setLoading:function(e){this.loading=e;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(e){this.widget=e;this.loading&&this.loading.destroy();g.place(e.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(e){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+e.stack)}this.loading&&
this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(n,f,g,h,e,p,r,a,l){return n([e,p],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);
this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];g.forEach(a,function(a){var d,e;!1!==a.visible&&(e=new r,d=this.createFrame(a),this.addChild(d),d.setLoading(e),this.widgetManager.loadWidget(a).then(f.hitch(this,function(a){d.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:
[this.config]},getWidgetById:function(a){for(var e=this.getChildren(),f=0;f<e.length;f++)if(e[f].getWidget()&&e[f].getWidget().id===a)return e[f].getWidget()},createFrame:function(d){return new a},setPosition:function(a,e){this.position=a;var f=l.getPositionStyle(this.position);f.position="absolute";e||(e="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(f.display="none");h.place(this.domNode,e);h.setStyle(this.domNode,f)},getPosition:function(){return this.position},
setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){g.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){g.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){g.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){g.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){g.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),
this.getChildren().forEach(function(e){e.getWidget()&&e.getWidget().id===a.id&&(e.getWidget().destroy(),e.setLoading(new r),this.widgetManager.loadWidget(a).then(f.hitch(this,function(a){e.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},this))},isWidgetInPanel:function(a){return g.some(this.getAllWidgetConfigs(),function(e){if(a.id===e.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var e=-1,f=0;f<this.config.widgets.length;f++)this.config.widgets[f].id===
a.id&&(e=f);0<e&&(this.config.widgets[e]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(e){console.error("destroy widget frame error."+e.stack)}});this.inherited(arguments)}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(n,f,g,h,e){return n([h,e],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(g(window,
"resize",f.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),function(n,f,g,h,e,p){return{cloneSymbol:function(f){if(!f)return null;var a=null;try{var l=f.toJson(),a=e.fromJson(l)}catch(d){console.error(d)}return a},getDefaultMarkerSymbol:function(){return e.fromJson({style:"esriSMSCircle",
color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return e.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return e.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return e.fromJson({color:[255,
255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return e.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return e.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var e=
n.toUrl("jimu/css/images/grey_pin.png"),e=new p(e,16,16);e.setOffset(0,8);return e},createSymbolNode:function(p,a){var l=32,d=32,s=g.create("div",{},document.body);g.setStyle(s,"display","inline-block");if(a)l=a.width,d=a.height;else if(l=80,d=30,this.isSimpleMarkerSymbol(p))d=l=Math.min(p.size+12,125);else if(this.isPictureMarkerSymbol(p)){if(!p.url||"http://"===p.url||-1===p.url.indexOf("http://")&&-1===p.url.indexOf("https://")&&-1===p.url.indexOf("data:"))return;d=l=Math.min(Math.max(p.width,
p.height),125)}else if(this.isSimpleLineSymbol(p)||this.isCartographicLineSymbol(p))l=190,d=20;var q=h.createSurface(s,l,d);if("vml"===h.renderer){var k=q.getEventSource();g.setStyle(k,"position","relative");g.setStyle(k.parentNode,"position","relative")}var k=null,k=a?e.getShapeDescriptors(p):this.isSimpleLineSymbol(p)||this.isCartographicLineSymbol(p)?this._getLineShapeDesc(p):e.getShapeDescriptors(p),c;try{c=q.createShape(k.defaultShape),k.fill&&c.setFill(k.fill),k.stroke&&c.setStroke(k.stroke)}catch(m){q.clear();
q.destroy();return}var q=q.getDimensions(),q={dx:q.width/2,dy:q.height/2},t=c.getBoundingBox(),k=t.width,t=t.height;if(k>l||t>d)l=((l<d?l:d)-5)/(k>t?k:t),f.mixin(q,{xx:l,yy:l});c.applyTransform(q);return s},_getLineShapeDesc:function(e){var a=null;if(this.isSimpleLineSymbol(e)||this.isCartographicLineSymbol(e))a={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:e.getStroke()};return a},isSimpleMarkerSymbol:function(e){return e&&"esri.symbol.SimpleMarkerSymbol"===e.declaredClass},
isPictureMarkerSymbol:function(e){return e&&"esri.symbol.PictureMarkerSymbol"===e.declaredClass},isSimpleLineSymbol:function(e){return e&&"esri.symbol.SimpleLineSymbol"===e.declaredClass},isCartographicLineSymbol:function(e){return e&&"esri.symbol.CartographicLineSymbol"===e.declaredClass},isSimpleFillSymbol:function(e){return e&&"esri.symbol.SimpleFillSymbol"===e.declaredClass},isPictureFillSymbol:function(e){return e&&"esri.symbol.PictureFillSymbol"===e.declaredClass},isTextSymbol:function(e){return e&&
"esri.symbol.TextSymbol"===e.declaredClass}}})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale esri/lang dojo/data/ItemFileWriteStore jimu/utils".split(" "),function(n,f,g,h,e,p,r){return n([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,fieldsStore:null,
isHosted:!1,constructor:function(){String.prototype.startsWith=function(a){return 0===this.indexOf(a)};String.prototype.endsWith=function(a){return this.substring(this.length-a.length)===a};String.prototype.count=function(a){return this.split(a).length-1};String.prototype.trim||(String.prototype.trim=f.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},
OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",
numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",
dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast"},prepare:function(a,e){this.isHosted=r.isHostedService(a);this.setFieldsStoreByFieldInfos(e)},isPartsObjHasError:function(a){var e=
!1;a&&(e=a.parts&&0<=a.parts.length?g.every(a.parts,f.hitch(this,function(a){return a.parts?0<a.parts.length?g.every(a.parts,f.hitch(this,function(a){return!a.error})):!1:!a.error})):!1);return!e},isAskForValues:function(a){var e=!1;return e=g.some(a.parts,f.hitch(this,function(a){return a.parts?g.some(a.parts,f.hitch(this,function(a){return!!a.interactiveObj})):!!a.interactiveObj}))},setFieldsStoreByFieldInfos:function(a){a=g.filter(a,f.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)}));
a=g.map(a,function(a,d){var e;switch(a.type){case "esriFieldTypeString":e="string";break;case "esriFieldTypeDate":e="date";break;default:e="number"}return{id:d,label:a.name,shortType:e,alias:a.alias,editable:a.editable,name:a.name,nullable:a.nullable,type:a.type}},this);this.fieldsStore=new p({data:{identifier:"id",label:"label",items:a}});return a.length},_validatePartsObj:function(a){return a&&"object"===typeof a},_isObject:function(a){return a&&"object"===typeof a},_isString:function(a){return a&&
"string"===typeof a},containsNonLatinCharacter:function(a){for(var e=0;e<a.length;e++)if(255<a.charCodeAt(e))return!0;return!1},getExprByFilterObj:function(a){if(!g.every(a.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(a))return a.expr="",a.expr;var f="";if(0===a.parts.length)f="1\x3d1";else if(1===a.parts.length)f=this.builtFilterString(a.parts[0]);else for(var d="",p=0;p<a.parts.length;p++){var q=this.builtFilterString(a.parts[p]);if(!e.isDefined(q))return null;f+=d+
"("+q+")";d=d||" "+a.logicalOperator+" "}return a.expr=f},isPartsObjReadyToBuild:function(a){return g.every(a.parts,f.hitch(this,function(a){return a.parts?g.every(a.parts,f.hitch(this,function(a){return this._isPartReadyToBuild(a)})):this._isPartReadyToBuild(a)}))},_isPartReadyToBuild:function(a){var e=a.fieldObj.shortType,d=a.operator,f=a.valueObj;a=f.type||"value";var q=f.value,k=f.value1,f=f.value2;if("value"===a){if("string"===e)return d===this.OPERATORS.stringOperatorIsBlank||d===this.OPERATORS.stringOperatorIsNotBlank?
!0:r.isNotEmptyString(q);if("number"===e)return d===this.OPERATORS.numberOperatorIsBlank||d===this.OPERATORS.numberOperatorIsNotBlank?!0:d===this.OPERATORS.numberOperatorIsBetween||d===this.OPERATORS.numberOperatorIsNotBetween?r.isValidNumber(k)&&r.isValidNumber(f):r.isValidNumber(q);if("date"===e)return d===this.OPERATORS.dateOperatorIsBlank||d===this.OPERATORS.dateOperatorIsNotBlank?!0:d===this.OPERATORS.dateOperatorIsBetween||d===this.OPERATORS.dateOperatorIsNotBetween?r.isNotEmptyString(k)&&r.isNotEmptyString(f):
r.isNotEmptyString(q)}else{if("field"===a)return r.isNotEmptyString(q);if("unique"===a){if("string"===e)return r.isNotEmptyString(q);if("number"===e)return r.isValidNumber(q)}}return!1},builtFilterString:function(a){var f="";if(a.parts)for(var d="",g=0;g<a.parts.length;g++){var q=a.parts[g],k=this.builtSingleFilterString(q);q.expr=k.whereClause;if(!e.isDefined(k.whereClause))return null;f+=d+k.whereClause;d=" "+a.logicalOperator+" "}else f=this.builtSingleFilterString(a).whereClause;return a.expr=
f},_preBuiltSingleFilterString:function(a){if("string"===a.fieldObj.shortType&&"\x3cNull\x3e"===a.valueObj.value){if(a.operator===this.OPERATORS.stringOperatorIs)return{whereClause:a.fieldObj.name+" IS NULL"};if(a.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:a.fieldObj.name+" IS NOT NULL"}}if("number"===a.fieldObj.shortType&&"\x3cNull\x3e"===a.valueObj.value){if(a.operator===this.OPERATORS.numberOperatorIs)return{whereClause:a.fieldObj.name+" IS NULL"};if(a.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:a.fieldObj.name+
" IS NOT NULL"}}return null},builtSingleFilterString:function(a,f){this.isHosted&&(a.caseSensitive=!1);if(e.isDefined(a.valueObj.isValid)&&!a.valueObj.isValid)return{whereClause:null};var d=this._preBuiltSingleFilterString(a);if(d)return d;var d=a.valueObj.value,g=a.valueObj.value1,q=a.valueObj.value2,k=!1;a.interactiveObj&&e.isDefined(f)&&(k=!0,e.isDefined(a.valueObj.value)&&(d="{"+f+"}"),e.isDefined(a.valueObj.value1)&&(g="{"+f+"}"),e.isDefined(a.valueObj.value2)&&(q="{"+(f+1)+"}"));var c="";if("string"===
a.fieldObj.shortType)switch(g="",k&&this.isHosted?g="N":d&&"field"!==a.valueObj.type&&this.isHosted&&this.containsNonLatinCharacter(d)&&(g="N"),a.operator){case this.OPERATORS.stringOperatorIs:c="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+d:a.fieldObj.name+" \x3d "+g+"'"+d.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorIsNot:c="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+d:a.fieldObj.name+" \x3c\x3e "+g+"'"+d.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorStartsWith:c=
a.caseSensitive?a.fieldObj.name+" LIKE "+g+"'"+d.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+g+"'"+d.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorEndsWith:c=a.caseSensitive?a.fieldObj.name+" LIKE "+g+"'%"+d.replace(/\'/g,"''")+"'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+g+"'%"+d.replace(/\'/g,"''")+"')";break;case this.OPERATORS.stringOperatorContains:c=a.caseSensitive?a.fieldObj.name+" LIKE "+g+"'%"+d.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+
g+"'%"+d.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorDoesNotContain:c=a.caseSensitive?a.fieldObj.name+" NOT LIKE "+g+"'%"+d.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") NOT LIKE UPPER("+g+"'%"+d.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorIsBlank:c=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:c=a.fieldObj.name+" IS NOT NULL"}else if("number"===a.fieldObj.shortType)switch(a.operator){case this.OPERATORS.numberOperatorIs:c=
a.fieldObj.name+" \x3d "+d;break;case this.OPERATORS.numberOperatorIsNot:c=a.fieldObj.name+" \x3c\x3e "+d;break;case this.OPERATORS.numberOperatorIsAtLeast:c=a.fieldObj.name+" \x3e\x3d "+d;break;case this.OPERATORS.numberOperatorIsLessThan:c=a.fieldObj.name+" \x3c "+d;break;case this.OPERATORS.numberOperatorIsAtMost:c=a.fieldObj.name+" \x3c\x3d "+d;break;case this.OPERATORS.numberOperatorIsGreaterThan:c=a.fieldObj.name+" \x3e "+d;break;case this.OPERATORS.numberOperatorIsBetween:c=a.fieldObj.name+
" BETWEEN "+g+" AND "+q;break;case this.OPERATORS.numberOperatorIsNotBetween:c=a.fieldObj.name+" NOT BETWEEN "+g+" AND "+q;break;case this.OPERATORS.numberOperatorIsBlank:c=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:c=a.fieldObj.name+" IS NOT NULL"}else switch(e.isDefined(d)&&("field"!==a.valueObj.type&&"string"===typeof d)&&(d=new Date(d)),"field"!==a.valueObj.type&&(d&&(d=new Date(d)),g&&(g=new Date(g)),q&&(q=new Date(q))),a.operator){case this.OPERATORS.dateOperatorIsOn:c=
"field"===a.valueObj.type?a.fieldObj.name+" \x3d "+d:k?a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+f+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(f+1)+"}'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(d)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(d))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:c="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+d:k?a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":
"timestamp ")+"'{"+f+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(f+1)+"}'":a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(d)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(d))+"'";break;case this.OPERATORS.dateOperatorIsBefore:c="field"===a.valueObj.type?a.fieldObj.name+" \x3c "+d:a.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(d)+"'";break;case this.OPERATORS.dateOperatorIsAfter:c="field"===a.valueObj.type?
a.fieldObj.name+" \x3e "+d:a.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(d))+"'";break;case this.OPERATORS.dateOperatorIsBetween:c=k?a.fieldObj.name+" BETWEEN '"+g+"' AND '"+q+"'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(g)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(q))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:c=k?a.fieldObj.name+" NOT BETWEEN '"+g+"' AND '"+q+"'":a.fieldObj.name+
" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(g)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(q))+"'";break;case this.OPERATORS.dateOperatorIsBlank:c=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:c=a.fieldObj.name+" IS NOT NULL"}return{whereClause:c}},formatDate:function(a){var e=h.format(a,{datePattern:"yyyy-MM-dd",selector:"date"});a=h.format(a,{selector:"time",timePattern:"HH:mm:ss"});return e+" "+a},addDay:function(a){return new Date(a.getTime()+
this.dayInMS)},getFilterObjByExpr:function(a){if(a&&this.fieldsStore){var e=this.replaceStrings(a);a=e.defExpr;var d=this.findParts(a,"AND");1===d.parts.length&&(d=this.findParts(a,"OR"),1===d.parts.length&&(d.logicalOperator="AND"));g.forEach(d.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var d=a.expr.substring(1,a.expr.length-1),e=d.indexOf("("),c=d.indexOf(")");if(-1===e&&-1===c||e<c)a.expr=d}d=this.findParts(a.expr,"AND");1===d.parts.length&&(d=this.findParts(a.expr,
"OR"));1<d.parts.length&&(a.parts=d.parts,a.logicalOperator=d.logicalOperator)},this);this.parseExpr(d);this.reReplaceStrings(e,d,f.hitch(this,function(){d&&d.parts&&g.forEach(d.parts,f.hitch(this,function(a){a&&(a.parts?g.forEach(a.parts,f.hitch(this,function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(a),this._addDefalutValueTypeForSinglePart(a)))}))}));this.isPartsObjHasError(d)&&(d=null);return d}},_handleParsedValuesForSinglePart:function(a){a&&
(a.fieldObj&&"number"===a.fieldObj.shortType&&a.valueObj)&&(a.valueObj.hasOwnProperty("value")&&(a.valueObj.value=parseFloat(a.valueObj.value)),a.valueObj.hasOwnProperty("value1")&&(a.valueObj.value1=parseFloat(a.valueObj.value1)),a.valueObj.hasOwnProperty("value2")&&(a.valueObj.value2=parseFloat(a.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(a){a&&a.valueObj&&!a.valueObj.type&&(a.valueObj.type="value")},replaceStrings:function(a){for(var e=a,d=function(a,b,c){var e=-1,e=a.indexOf("'",
c+1);return e===c+1?(e=a.indexOf("'",e+1),d(a,b,e)):c},f=[],q=a.indexOf("'");-1<q;){var k=q,q=a.indexOf("'",q+1),c=0,q=d(a,k,q);"%"===a[k+1]&&k++;"%"===a[q-1]&&(q-=1,c++);var m=a.substring(k+1,q);"N"===a[k-1]&&(a=a.substring(0,k-1)+a.substring(k),k-=1,q-=1);!this.isDateString(m)&&-1===m.indexOf("{")?(f.push(m),a=a.substring(0,k+1)+"#"+(f.length-1)+"#"+a.substring(q),q=a.indexOf("'",a.lastIndexOf("#")+2+c)):q=a.indexOf("'",q+1+c)}return{origDefExpr:e,defExpr:a,savedStrings:f}},reReplaceStrings:function(a,
l,d){var p=a.savedStrings;if(p.length){if(p.length){var q=function(a,d){if(void 0===a.valueObj||null===a.valueObj||(void 0===a.valueObj.value||null===a.valueObj.value)||"string"!==a.fieldObj.shortType)return!1;var k=a.valueObj.value.indexOf("#"),b=a.valueObj.value.lastIndexOf("#");return e.isDefined(a.valueObj.value)&&-1<k?(a.valueObj.value=d[parseInt(a.valueObj.value.substring(k+1,b),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},q=f.hitch(this,q),k=!1;g.forEach(l.parts,function(a){if(a.parts){var d=
!1;g.forEach(a.parts,function(a){d=q(a,p)||d});d&&(k=d,a.expr=this.builtFilterString(a))}else(k=q(a,p)||k)&&this.builtFilterString(a)},this);d&&"function"===typeof d&&d();k&&(l.expr=null,this.getExprByFilterObj(l))}}else d&&"function"===typeof d&&d()},isDateString:function(a){return 19===a.length&&"-"===a.charAt(4)&&"-"===a.charAt(7)&&" "===a.charAt(10)&&":"===a.charAt(13)&&":"===a.charAt(16)?!0:!1},findParts:function(a,e){for(var d=a.toLowerCase(),f=" "+e.toLowerCase()+" ",q=[],k=0,c=d.indexOf(f);0<
c;){var m=a.substring(k,c),g=m.toLowerCase(),b=m.count("("),p=m.count(")"),h=m.count("'");b!==p||1===h%2?c=d.indexOf(f,c+1):-1<g.indexOf(" between ")&&-1===g.indexOf(" and ")?c=d.indexOf(f,c+1):(q.push({expr:m}),k=c+f.length,c=d.indexOf(f,k))}q.push({expr:a.substring(k)});for(d=q.length-1;0<=d;d--)!this.hasOperator(q[d].expr)&&0<d&&(q[d-1].expr+=" "+e+" "+q[d].expr,q.splice(d,1));return{expr:a,parts:q,logicalOperator:e}},hasOperator:function(a){a=a.toLowerCase();return-1<a.indexOf("{")&&-1<a.indexOf("}")||
-1<a.indexOf(" \x3d ")||-1<a.indexOf(" \x3c ")||-1<a.indexOf(" \x3e ")||-1<a.indexOf(" \x3c\x3e ")||-1<a.indexOf(" \x3c\x3d ")||-1<a.indexOf(" \x3e\x3d ")||-1<a.indexOf(" like ")||-1<a.indexOf(" between ")||-1<a.indexOf(" date")||-1<a.indexOf(" is null")||-1<a.indexOf(" is not null")?!0:!1},parseExpr:function(a){g.forEach(a.parts,function(a){a.parts?this.parseExpr(a):this.parseSingleExpr(a)},this)},_preParseSingleExpr:function(a){var e=null;try{if(e=f.clone(a),e.expr=e.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(e.expr)){var d=
a="",g=e.expr.match(/^UPPER\((.*)\)\s+/i);if(g&&2<=g.length)a=g[1];else return null;var q=e.expr.match(/UPPER\(N?'(.*)'\)$/i);if(q&&2<=q.length)d="'"+q[1]+"'";else return null;e.expr=e.expr.replace(/^UPPER\((.*)\)\s+/i,a+" ");e.expr=e.expr.replace(/UPPER\(N?'(.*)'\)$/i,d);e.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(e.expr)&&(e.caseSensitive=!0)}catch(k){return console.log(k),null}e&&this.isHosted&&(e.caseSensitive=!1);return e},parseSingleExpr:function(a){var l=this._preParseSingleExpr(a);
l&&(a=f.mixin(a,l));var l=a.expr.trim(),d=l.indexOf(" "),g=l.substring(0,d);a.fieldObj={name:g};a.valueObj={};this.getFieldItemByName({name:g},function(d){a.fieldObj.shortType=d.shortType[0];a.fieldObj.label=d.label[0]},function(){a.error={msg:"unknown field name ("+g+")",code:1}});l=l.substring(d+1).trim();d=l.toLowerCase();d.startsWith("\x3d ")?(l="date"===a.fieldObj.shortType&&!this.isHosted?l.substring(12).trim():l.substring(2).trim(),this.storeValue(l,a),a.operator="date"===a.fieldObj.shortType?
this.OPERATORS.dateOperatorIsOn:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):d.startsWith("\x3c ")?(l="date"===a.fieldObj.shortType&&!this.isHosted?l.substring(12).trim():l.substring(2).trim(),this.storeValue(l,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsBefore:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsLessThan:a.error={msg:"operator ("+d+") not supported for string",code:3}):d.startsWith("\x3e ")?
(l="date"===a.fieldObj.shortType&&!this.isHosted?l.substring(12).trim():l.substring(2).trim(),this.storeValue(l,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsAfter:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsGreaterThan:a.error={msg:"operator ("+d+") not supported for string",code:3}):d.startsWith("\x3c\x3e ")?(l="date"===a.fieldObj.shortType&&!this.isHosted?l.substring(13).trim():l.substring(3).trim(),this.storeValue(l,a),a.operator="date"===
a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):d.startsWith("\x3c\x3d ")?(this.storeValue(l.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtMost):d.startsWith("\x3e\x3d ")?(this.storeValue(l.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtLeast):d.startsWith("like ")?(l=l.substring(5).trim(),l.startsWith("N'")&&(l=l.substring(1,l.length)),l.startsWith("'%")&&
l.endsWith("%'")?(this.storeValue(l.substring(2,l.length-2),a),a.operator=this.OPERATORS.stringOperatorContains):l.startsWith("'%")&&l.endsWith("'")?(this.storeValue(l.substring(2,l.length-1),a),a.operator=this.OPERATORS.stringOperatorEndsWith):l.startsWith("'")&&l.endsWith("%'")?(this.storeValue(l.substring(1,l.length-2),a),a.operator=this.OPERATORS.stringOperatorStartsWith):a.error={msg:"value ("+d+") not supported for LIKE",code:3}):d.startsWith("not like ")?(l=l.substring(9).trim(),l.startsWith("N'")&&
(l=l.substring(1,l.length)),l.startsWith("'%")&&l.endsWith("%'")?(this.storeValue(l.substring(2,l.length-2),a),a.operator=this.OPERATORS.stringOperatorDoesNotContain):a.error={msg:"value ("+d+") not supported for NOT LIKE",code:3}):d.startsWith("between ")?(l="date"===a.fieldObj.shortType&&!this.isHosted?l.substring(18).trim():l.substring(8).trim(),d=l.toLowerCase().indexOf(" and "),-1<d?(this.storeValue1(l.substring(0,d).trim(),a),"date"===a.fieldObj.shortType&&!this.isHosted?this.storeValue2(l.substring(d+
15).trim(),a):this.storeValue2(l.substring(d+5).trim(),a)):a.error={msg:"missing AND operator for BETWEEN",code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsOn):a.operator=this.OPERATORS.dateOperatorIsBetween:"number"===
a.fieldObj.shortType||"oid"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsBetween:a.error={msg:"string field not supported for BETWEEN",code:3}):d.startsWith("not between ")?(l="date"===a.fieldObj.shortType&&!this.isHosted?l.substring(22).trim():l.substring(12).trim(),d=l.toLowerCase().indexOf(" and "),-1<d?(this.storeValue1(l.substring(0,d).trim(),a),"date"===a.fieldObj.shortType&&!this.isHosted?this.storeValue2(l.substring(d+15).trim(),a):this.storeValue2(l.substring(d+5).trim(),
a)):a.error={msg:"missing AND operator for NOT BETWEEN",code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsNotBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsNotOn):a.operator=this.OPERATORS.dateOperatorIsNotBetween:"number"===a.fieldObj.shortType||"oid"===a.fieldObj.shortType?
a.operator=this.OPERATORS.numberOperatorIsNotBetween:a.error={msg:"string field not supported for NOT BETWEEN",code:3}):"is null"===d?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===d?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:
this.OPERATORS.numberOperatorIsNotBlank):a.error={msg:"unknown operator ("+d+")",code:2};if(e.isDefined(a.valueObj.value)&&"string"===typeof a.valueObj.value&&a.valueObj.value.startsWith("{")&&a.valueObj.value.endsWith("}")||e.isDefined(a.valueObj.value1)&&"string"===typeof a.valueObj.value1&&a.valueObj.value1.startsWith("{")&&a.valueObj.value1.endsWith("}"))a.isInteractive=!0},getFieldItemByName:function(a,e,d){this.fieldsStore.fetch({query:a,onComplete:f.hitch(this,function(a){a&&a.length?e(a[0]):
d()})})},subtractDay:function(a){return new Date(a.getTime()-this.dayInMS)},storeValue:function(a,e){if(a.startsWith("{")&&a.endsWith("}"))e.valueObj.value=a;else if(a.startsWith("'{")&&a.endsWith("}'"))e.valueObj.value=a.substring(1,a.length-1);else if("date"===e.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var d=a.substring(1,a.length-1);e.valueObj.value=this.parseDate(d)}else e.valueObj.value=a,e.valueObj.type="field";else"string"===e.fieldObj.shortType?(a.startsWith("#")||a.startsWith("%#"))&&
(a.endsWith("#")||a.endsWith("#%"))?e.valueObj.value=a:a.startsWith("'")&&a.endsWith("'")?e.valueObj.value=a.substring(1,a.length-1).replace(/\'\'/g,"'"):(e.valueObj.value=a,e.valueObj.type="field",this.getFieldItemByName({name:a},function(a){e.valueObj.label=a.label[0]},function(){e.error={msg:"unknown field name ("+a+")",code:1}})):(e.valueObj.value=a,isNaN(a)&&(e.valueObj.type="field",this.getFieldItemByName({name:a},function(a){e.valueObj.label=a.label[0]},function(){e.error={msg:"unknown field name ("+
a+")",code:1}})))},storeValue1:function(a,e){if(a.startsWith("{")&&a.endsWith("}"))e.valueObj.value1=a;else if(a.startsWith("'{")&&a.endsWith("}'"))e.valueObj.value1=a.substring(1,a.length-1);else if("date"===e.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var d=a.substring(1,a.length-1);e.valueObj.value1=this.parseDate(d)}else e.valueObj.value1=a,e.valueObj.type="field";else e.valueObj.value1=a,isNaN(a)&&(e.valueObj.type="field")},storeValue2:function(a,e){if(a.startsWith("{")&&a.endsWith("}"))e.valueObj.value2=
a;else if(a.startsWith("'{")&&a.endsWith("}'"))e.valueObj.value2=a.substring(1,a.length-1);else if("date"===e.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var d=a.substring(1,a.length-1);e.valueObj.value2=this.parseDate(d)}else e.valueObj.value2=a,e.valueObj.type="field";else e.valueObj.value2=a,isNaN(a)&&(e.valueObj.type="field")},parseDate:function(a){var e=h.parse(a,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});e||(e=h.parse(a.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||
(e=h.parse(a.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return e}})})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(n,f,g,h,e,p,r){return f("dojo.data.ItemFileWriteStore",p,{constructor:function(a){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};
this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(a){return r.toISOString(a,{zulu:!0})});a&&!1===a.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(a){if(!a)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(a,e){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=
typeof a&&"undefined"!=typeof a)throw Error("newItem() was passed something other than an object");var d=null,f=this._getIdentifierAttribute();if(f===Number)d=this._arrayOfAllItems.length;else{d=a[f];if("undefined"===typeof d)throw Error("newItem() was not passed an identity for the new item");if(n.isArray(d))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[d]);this._assert("undefined"===typeof this._pending._newItems[d]);
this._assert("undefined"===typeof this._pending._deletedItems[d]);var q={};q[this._storeRefPropName]=this;q[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[d]=q,q[f]=[d]);this._arrayOfAllItems.push(q);f=null;if(e&&e.parent&&e.attribute){var f={item:e.parent,attribute:e.attribute,oldValue:void 0},k=this.getValues(e.parent,e.attribute);if(k&&0<k.length){var c=k.slice(0,k.length);f.oldValue=1===k.length?k[0]:k.slice(0,k.length);c.push(q);this._setValueOrValues(e.parent,
e.attribute,c,!1);f.newValue=this.getValues(e.parent,e.attribute)}else this._setValueOrValues(e.parent,e.attribute,q,!1),f.newValue=q}else q[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(q);this._pending._newItems[d]=q;for(var m in a){if(m===this._storeRefPropName||m===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");d=a[m];n.isArray(d)||(d=[d]);q[m]=d;if(this.referenceIntegrity)for(k=0;k<d.length;k++)c=d[k],this.isItem(c)&&this._addReferenceToMap(c,
q,m)}this.onNew(q,f);return q},_removeArrayElement:function(a,e){var d=g.indexOf(a,e);return-1!=d?(a.splice(d,1),!0):!1},deleteItem:function(a){this._assert(!this._saveInProgress);this._assertIsItem(a);var e=a[this._itemNumPropName],d=this.getIdentity(a);if(this.referenceIntegrity){var f=this.getAttributes(a);a[this._reverseRefMap]&&(a["backup_"+this._reverseRefMap]=n.clone(a[this._reverseRefMap]));g.forEach(f,function(b){g.forEach(this.getValues(a,b),function(c){this.isItem(c)&&(a["backupRefs_"+
this._reverseRefMap]||(a["backupRefs_"+this._reverseRefMap]=[]),a["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(c),attr:b}),this._removeReferenceFromMap(c,a,b))},this)},this);if(f=a[this._reverseRefMap])for(var q in f){var k=null;if(k=this._itemsByIdentity?this._itemsByIdentity[q]:this._arrayOfAllItems[q])for(var c in f[q]){var m=this.getValues(k,c)||[],p=g.filter(m,function(a){return!(this.isItem(a)&&this.getIdentity(a)==d)},this);this._removeReferenceFromMap(a,k,c);p.length<m.length&&
this._setValueOrValues(k,c,p,!0)}}}this._arrayOfAllItems[e]=null;a[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[d];this._pending._deletedItems[d]=a;a[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,a);this.onDelete(a);return!0},setValue:function(a,e,d){return this._setValueOrValues(a,e,d,!0)},setValues:function(a,e,d){return this._setValueOrValues(a,e,d,!0)},unsetAttribute:function(a,e){return this._setValueOrValues(a,e,[],!0)},_setValueOrValues:function(a,
e,d,f){this._assert(!this._saveInProgress);this._assertIsItem(a);this._assert(n.isString(e));this._assert("undefined"!==typeof d);var q=this._getIdentifierAttribute();if(e==q)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var q=this._getValueOrValues(a,e),k=this.getIdentity(a);if(!this._pending._modifiedItems[k]){var c={},m;for(m in a)c[m]=m===this._storeRefPropName||m===this._itemNumPropName||m===this._rootItemPropName?a[m]:m===this._reverseRefMap?
n.clone(a[m]):a[m].slice(0,a[m].length);this._pending._modifiedItems[k]=c}k=!1;if(n.isArray(d)&&0===d.length){if(k=delete a[e],d=void 0,this.referenceIntegrity&&q){m=q;n.isArray(m)||(m=[m]);for(var p=0;p<m.length;p++)c=m[p],this.isItem(c)&&this._removeReferenceFromMap(c,a,e)}}else{k=n.isArray(d)?d.slice(0,d.length):[d];if(this.referenceIntegrity)if(q){m=q;n.isArray(m)||(m=[m]);var b={};g.forEach(m,function(a){this.isItem(a)&&(a=this.getIdentity(a),b[a.toString()]=!0)},this);g.forEach(k,function(c){if(this.isItem(c)){var d=
this.getIdentity(c);b[d.toString()]?delete b[d.toString()]:this._addReferenceToMap(c,a,e)}},this);for(p in b)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[p]:this._arrayOfAllItems[p],a,e)}else for(p=0;p<k.length;p++)c=k[p],this.isItem(c)&&this._addReferenceToMap(c,a,e);a[e]=k;k=!0}if(f)this.onSet(a,e,q,d);return k},_addReferenceToMap:function(a,e,d){e=this.getIdentity(e);var f=a[this._reverseRefMap];f||(f=a[this._reverseRefMap]={});(a=f[e])||(a=f[e]={});a[d]=!0},_removeReferenceFromMap:function(a,
e,d){e=this.getIdentity(e);var f=a[this._reverseRefMap],q;if(f){for(q in f)q==e&&(delete f[q][d],this._isEmpty(f[q])&&delete f[q]);this._isEmpty(f)&&delete a[this._reverseRefMap]}},_dumpReferenceMap:function(){var a;for(a=0;a<this._arrayOfAllItems.length;a++){var e=this._arrayOfAllItems[a];e&&e[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(e)+"] is referenced by: "+h.toJson(e[this._reverseRefMap]))}},_getValueOrValues:function(a,e){var d=void 0;this.hasAttribute(a,e)&&(d=this.getValues(a,
e),d=1==d.length?d[0]:d);return d},_flatten:function(a){if(this.isItem(a))return{_reference:this.getIdentity(a)};if("object"===typeof a)for(var e in this._datatypeMap){var d=this._datatypeMap[e];if(n.isObject(d)&&!n.isFunction(d)){if(a instanceof d.type){if(!d.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+e+"]");return{_type:e,_value:d.serialize(a)}}}else if(a instanceof d)return{_type:e,_value:a.toString()}}return a},_getNewFileContentString:function(){var a=
{},e=this._getIdentifierAttribute();e!==Number&&(a.identifier=e);this._labelAttr&&(a.label=this._labelAttr);a.items=[];for(e=0;e<this._arrayOfAllItems.length;++e){var d=this._arrayOfAllItems[e];if(null!==d){var f={},q;for(q in d)if(q!==this._storeRefPropName&&q!==this._itemNumPropName&&q!==this._reverseRefMap&&q!==this._rootItemPropName){var k=this.getValues(d,q);if(1==k.length)f[q]=this._flatten(k[0]);else for(var c=[],m=0;m<k.length;++m)c.push(this._flatten(k[m])),f[q]=c}a.items.push(f)}}return h.toJson(a,
!0)},_isEmpty:function(a){var e=!0;if(n.isObject(a))for(var d in a){e=!1;break}else n.isArray(a)&&0<a.length&&(e=!1);return e},save:function(a){this._assert(!this._saveInProgress);this._saveInProgress=!0;var f=this,d=function(){f._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};f._saveInProgress=!1;a&&a.onComplete&&a.onComplete.call(a.scope||e.global)},g=function(d){f._saveInProgress=!1;a&&a.onError&&a.onError.call(a.scope||e.global,d)};if(this._saveEverything){var q=this._getNewFileContentString();
this._saveEverything(d,g,q)}this._saveCustom&&this._saveCustom(d,g);!this._saveEverything&&!this._saveCustom&&d()},revert:function(){this._assert(!this._saveInProgress);for(var a in this._pending._modifiedItems){var e=this._pending._modifiedItems[a],d=null,d=this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a];e[this._storeRefPropName]=this;for(var f in d)delete d[f];n.mixin(d,e)}var q;for(a in this._pending._deletedItems)q=this._pending._deletedItems[a],q[this._storeRefPropName]=
this,e=q[this._itemNumPropName],q["backup_"+this._reverseRefMap]&&(q[this._reverseRefMap]=q["backup_"+this._reverseRefMap],delete q["backup_"+this._reverseRefMap]),this._arrayOfAllItems[e]=q,this._itemsByIdentity&&(this._itemsByIdentity[a]=q),q[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(q);for(a in this._pending._deletedItems)q=this._pending._deletedItems[a],q["backupRefs_"+this._reverseRefMap]&&(g.forEach(q["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?
this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],q,a.attr)},this),delete q["backupRefs_"+this._reverseRefMap]);for(a in this._pending._newItems)e=this._pending._newItems[a],e[this._storeRefPropName]=null,this._arrayOfAllItems[e[this._itemNumPropName]]=null,e[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,e),this._itemsByIdentity&&delete this._itemsByIdentity[a];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(a){return a?
(a=this.getIdentity(a),(new Boolean(this._pending._newItems[a]||this._pending._modifiedItems[a]||this._pending._deletedItems[a])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(a,e,d,f){},onNew:function(a,e){},onDelete:function(a){},close:function(a){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(n,f,g,h,e,p,r,a,l){g=g("dojo.data.ItemFileReadStore",[p],{constructor:function(a){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=a.url;this._jsonData=a.data;this.data=null;this._datatypeMap=a.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return l.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==a.urlPreventCache&&(this.urlPreventCache=a.urlPreventCache?!0:!1);void 0!==a.hierarchical&&(this.hierarchical=a.hierarchical?
!0:!1);a.clearOnClose&&(this.clearOnClose=!0);"failOk"in a&&(this.failOk=a.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(a,e,f){a=this.getValues(a,e);return 0<a.length?a[0]:f},getValues:function(a,
e){this._assertIsItem(a);this._assertIsAttribute(e);return(a[e]||[]).slice(0)},getAttributes:function(a){this._assertIsItem(a);var e=[],f;for(f in a)f!==this._storeRefPropName&&(f!==this._itemNumPropName&&f!==this._rootItemPropName&&f!==this._reverseRefMap)&&e.push(f);return e},hasAttribute:function(a,e){this._assertIsItem(a);this._assertIsAttribute(e);return e in a},containsValue:function(a,e,f){var k=void 0;"string"===typeof f&&(k=r.patternToRegExp(f,!1));return this._containsValue(a,e,f,k)},_containsValue:function(a,
e,q,k){return h.some(this.getValues(a,e),function(a){if(null!==a&&!f.isObject(a)&&k){if(a.toString().match(k))return!0}else if(q===a)return!0})},isItem:function(a){return a&&a[this._storeRefPropName]===this&&this._arrayOfAllItems[a[this._itemNumPropName]]===a?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this._assertIsItem(a.item)},getFeatures:function(){return this._features},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},
getLabelAttributes:function(a){return this._labelAttr?[this._labelAttr]:null},filter:function(a,e,f){var k=[],c,m;if(a.query){var l;c=a.queryOptions?a.queryOptions.ignoreCase:!1;var b={};for(m in a.query)l=a.query[m],"string"===typeof l?b[m]=r.patternToRegExp(l,c):l instanceof RegExp&&(b[m]=l);for(c=0;c<e.length;++c){var g=!0,p=e[c];if(null===p)g=!1;else for(m in a.query)l=a.query[m],this._containsValue(p,m,l,b[m])||(g=!1);g&&k.push(p)}}else for(c=0;c<e.length;++c)m=e[c],null!==m&&k.push(m);f(k,a)},
_fetchItems:function(a,l,q){var k=this;if(this._loadFinished)this.filter(a,this._getItemsArray(a.queryOptions),l);else if(this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:a,
filter:f.hitch(k,"filter"),findCallback:f.hitch(k,l)});else{this._loadInProgress=!0;var c=e.get({url:k._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});c.addCallback(function(b){try{k._getItemsFromLoadedData(b),k._loadFinished=!0,k._loadInProgress=!1,k.filter(a,k._getItemsArray(a.queryOptions),l),k._handleQueuedFetches()}catch(c){k._loadFinished=!0,k._loadInProgress=!1,q(c,a)}});c.addErrback(function(b){k._loadInProgress=!1;q(b,a)});var m=null;a.abort&&
(m=a.abort);a.abort=function(){c&&-1===c.fired&&c.cancel();m&&m.call(a)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,k.filter(a,this._getItemsArray(a.queryOptions),l)}catch(g){q(g,a)}else q(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),a)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var e=this._queuedFetches[a],
f=e.args,k=e.filter,e=e.findCallback;k?k(f,this._getItemsArray(f.queryOptions),e):this.fetchItemByIdentity(f)}this._queuedFetches=[]}},_getItemsArray:function(a){return a&&a.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(a){this.clearOnClose&&(this._loadFinished&&!this._loadInProgress)&&((""==this._jsonFileUrl||null==this._jsonFileUrl)&&(""==this.url||null==this.url)&&null==this.data&&console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(a){function e(a){return null!==a&&"object"===typeof a&&(!f.isArray(a)||k)&&!f.isFunction(a)&&(a.constructor==Object||f.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&c.hierarchical}function q(a){c._arrayOfAllItems.push(a);for(var b in a){var d=a[b];if(d)if(f.isArray(d))for(var k=
0;k<d.length;++k){var m=d[k];e(m)&&q(m)}else e(d)&&q(d)}}var k=!1,c=this;this._labelAttr=a.label;var m,l;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=a.items;for(m=0;m<this._arrayOfTopLevelItems.length;++m)l=this._arrayOfTopLevelItems[m],f.isArray(l)&&(k=!0),q(l),l[this._rootItemPropName]=!0;var b={},g;for(m=0;m<this._arrayOfAllItems.length;++m)for(g in l=this._arrayOfAllItems[m],l){if(g!==this._rootItemPropName){var p=l[g];null!==p?f.isArray(p)||(l[g]=[p]):l[g]=[null]}b[g]=g}for(;b[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;b[this._itemNumPropName];)this._itemNumPropName+="_";for(;b[this._reverseRefMap];)this._reverseRefMap+="_";if(b=a.identifier){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=b;for(m=0;m<this._arrayOfAllItems.length;++m)if(l=this._arrayOfAllItems[m],a=l[b],a=a[0],Object.hasOwnProperty.call(this._itemsByIdentity,a)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
b+"].  Value collided: ["+a+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+b+"].  Value collided: ["+a+"]");}else this._itemsByIdentity[a]=l}else this._features["dojo.data.api.Identity"]=Number;for(m=0;m<this._arrayOfAllItems.length;++m)l=this._arrayOfAllItems[m],l[this._storeRefPropName]=this,l[this._itemNumPropName]=m;for(m=0;m<this._arrayOfAllItems.length;++m)for(g in l=this._arrayOfAllItems[m],
l){a=l[g];for(b=0;b<a.length;++b)if(p=a[b],null!==p&&"object"==typeof p){if("_type"in p&&"_value"in p){var h=p._type,r=this._datatypeMap[h];if(r)if(f.isFunction(r))a[b]=new r(p._value);else if(f.isFunction(r.deserialize))a[b]=r.deserialize(p._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
h+"'");}if(p._reference){p=p._reference;if(f.isObject(p))for(h=0;h<this._arrayOfAllItems.length;++h){var r=this._arrayOfAllItems[h],w=!0,n;for(n in p)r[n]!=p[n]&&(w=!1);w&&(a[b]=r)}else a[b]=this._getItemByIdentity(p);this.referenceIntegrity&&(p=a[b],this.isItem(p)&&this._addReferenceToMap(p,l,g))}else this.isItem(p)&&this.referenceIntegrity&&this._addReferenceToMap(p,l,g)}}},_addReferenceToMap:function(a,e,f){},getIdentity:function(a){var e=this._features["dojo.data.api.Identity"];return e===Number?
a[this._itemNumPropName]:(a=a[e])?a[0]:null},fetchItemByIdentity:function(a){var f,q;if(this._loadFinished)f=this._getItemByIdentity(a.identity),a.onItem&&(q=a.scope?a.scope:n.global,a.onItem.call(q,f));else{var k=this;this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:a}):(this._loadInProgress=!0,q=e.get({url:k._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),q.addCallback(function(c){var e=a.scope?a.scope:n.global;try{k._getItemsFromLoadedData(c),k._loadFinished=!0,k._loadInProgress=!1,f=k._getItemByIdentity(a.identity),a.onItem&&a.onItem.call(e,f),k._handleQueuedFetches()}catch(q){k._loadInProgress=
!1,a.onError&&a.onError.call(e,q)}}),q.addErrback(function(c){k._loadInProgress=!1;a.onError&&a.onError.call(a.scope?a.scope:n.global,c)})):this._jsonData&&(k._getItemsFromLoadedData(k._jsonData),k._jsonData=null,k._loadFinished=!0,f=k._getItemByIdentity(a.identity),a.onItem&&(q=a.scope?a.scope:n.global,a.onItem.call(q,f)))}},_getItemByIdentity:function(a){var e=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,a)&&(e=this._itemsByIdentity[a]):Object.hasOwnProperty.call(this._arrayOfAllItems,
a)&&(e=this._arrayOfAllItems[a]);void 0===e&&(e=null);return e},getIdentityAttributes:function(a){a=this._features["dojo.data.api.Identity"];return a===Number?null:[a]},_forceLoad:function(){var a=this;this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var f=e.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});f.addCallback(function(e){try{if(!0!==a._loadInProgress&&!a._loadFinished)a._getItemsFromLoadedData(e),a._loadFinished=!0;else if(a._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(f){throw console.log(f),f;}});f.addErrback(function(a){throw a;
})}else this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),a._jsonData=null,a._loadFinished=!0)}});f.extend(g,a);return g})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(n){var f={};n.setObject("dojo.data.util.filter",f);f.patternToRegExp=function(f,h){for(var e="^",p=null,r=0;r<f.length;r++)switch(p=f.charAt(r),p){case "\\":e+=p;r++;e+=f.charAt(r);break;case "*":e+=".*";break;case "?":e+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":e+=
"\\";default:e+=p}e+="$";return h?RegExp(e,"mi"):RegExp(e,"m")};return f})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(n,f,g){var h={};n.setObject("dojo.data.util.simpleFetch",h);h.errorHandler=function(e,g){g.onError&&g.onError.call(g.scope||f.global,e,g)};h.fetchHandler=function(e,p){var h=p.abort||null,a=!1,l=p.start?p.start:0,d=p.count&&Infinity!==p.count?l+p.count:e.length;p.abort=function(){a=!0;h&&h.call(p)};var s=p.scope||f.global;
p.store||(p.store=this);p.onBegin&&p.onBegin.call(s,e.length,p);p.sort&&e.sort(g.createSortFunction(p.sort,this));if(p.onItem)for(var q=l;q<e.length&&q<d;++q){var k=e[q];a||p.onItem.call(s,k,p)}p.onComplete&&!a&&(q=null,p.onItem||(q=e.slice(l,d)),p.onComplete.call(s,q,p))};h.fetch=function(e){e=e||{};e.store||(e.store=this);this._fetchItems(e,n.hitch(this,"fetchHandler"),n.hitch(this,"errorHandler"));return e};return h})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array",
"jimu/PanelManager"],function(n,f,g){return n(null,{constructor:function(){this.panelManager=g.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(f){},getConfigById:function(f){for(var e=this.getAllConfigs(),g=0;g<e.length;g++)if(e[g].id===f)return e[g]},getAllConfigs:function(){var g=[],g=g.concat(this.getWidgetConfigs(),this.getGroupConfigs()),g=f.filter(g,
function(e){return e.visible});return g.sort(function(e,f){return e.index-f.index})},getAllConfigsIncludeInvisible:function(){var f=[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs());return f.sort(function(e,f){return e.index-f.index})},isControlled:function(g){return f.some(this.getAllConfigsIncludeInvisible(),function(e){return e.id===g})},widgetIsControlled:function(g){return f.some(this.getAllConfigsIncludeInvisible(),function(e){return e.id===g?!0:f.some(e.widgets,function(e){return e.id===
g})})},getGroupConfigs:function(){var g=[];if(!this.appConfig.widgetPool)return g;this.appConfig.widgetPool.groups&&f.forEach(this.appConfig.widgetPool.groups,function(e){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(e.id)&&g.push(e):"all"===this.controlledGroups&&g.push(e))},this);return g},getWidgetConfigs:function(){var g=[];if(!this.appConfig.widgetPool)return g;this.appConfig.widgetPool.widgets&&f.forEach(this.appConfig.widgetPool.widgets,function(e){this.controlledWidgets&&
(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(e.id)&&g.push(e):"all"===this.controlledWidgets&&g.push(e))},this);return g}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),function(n,f,g,h,e,p,r,a){var l=null,d=null,s=!1;n=n(null,function(){});var q=require.toUrl("jimu"),k=p(q+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),
c=p(q+"/SpatialReference/transform.json",{handleAs:"json"});n.loadResource=function(){var a=new h;if(l&&d)return a.resolve(),a;e([k,c]).then(function(c){l=c[0];d=c[1];s=!0;a.resolve()},function(c){console.error(c);s=!1;a.reject(c)});return a};n.getAllCSUnits=function(){if(s){var a=[];g.forEach(l.wkids,f.hitch(this,function(c){c=this.getCSUnit(c);-1===g.indexOf(a,c)&&a.push(c)}));return a}};n.convertUnit=function(c,d,b){if(s)return a.convertUnit(c,d,b)};n.getUnitRate=function(c,d){if(s)return a.getUnitRate(c,
d)};n.isProjectUnit=function(c){if(s)return a.isProjectUnit(c)};n.isGeographicUnit=function(c){if(s)return a.isGeographicUnit(c)};n.getGeographicUnits=function(){if(s)return a.getGeographicUnits()};n.getProjectUnits=function(){if(s)return a.getProjectUnits()};n.getCSUnit=function(a){if(s){a=this.getCSStr(a);var c=0,b=0,c=a.lastIndexOf("UNIT"),b=a.indexOf(",",c);return a.slice(c+6,b-1)}};n.isSameSR=function(a,c){if(s){var b=this.indexOfWkid(a),d=this.indexOfWkid(c);return l.labels[b]===l.labels[d]}};
n.isValidWkid=function(a){if(s)return-1<this.indexOfWkid(a)};n.getSRLabel=function(a){if(s&&this.isValidWkid(a))return a=this.indexOfWkid(a),l.labels[a]};n.indexOfWkid=function(a){if(s)return g.indexOf(l.wkids,a)};n.isWebMercator=function(a){return r.prototype._isWebMercator?r.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new r(parseInt(a,10))).isWebMercator()};n.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};n.isValidTfWkid=function(a){if(s)return-1<this.indexOfTfWkid(a)};
n.getTransformationLabel=function(a){if(s)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),d.labels[a]):""};n.indexOfTfWkid=function(a){if(s)return g.indexOf(d.tfWkids,a)};n.isGeographicCS=function(a){if(s)return this.isValidWkid(a)?l.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};n.isProjectedCS=function(a){if(s)return this.isValidWkid(a)?l.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};n.getGeoCSByProj=function(a){if(s&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=g.indexOf(l.details,
a),l.wkids[a]};n.getSpheroidStr=function(a){if(s){if(this.isGeographicCS(a))return l.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=l.details[this.indexOfWkid(a)];var c=a.indexOf("GEOGCS"),b=a.indexOf("PROJECTION")-1;return a.slice(c,b)}return null}};n.getCSStr=function(a){if(s)return l.details[this.indexOfWkid(a)]};n.isSameSpheroid=function(a,c){if(s){var b=this.getSpheroidStr(a),d=this.getSpheroidStr(c);return b&&d&&b===d?!0:!1}};return n})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare",
"dojo/_base/array"],function(n,f){var g="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),h="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),e={INCHES:0.0254,FOOT:0.3048,FOOT_US:0.3048006096012192,YARDS:0.9144,MILES:1609.344,NAUTICAL_MILES:1852,
MILLIMETERS:0.0010,CENTIMETERS:0.01,METER:1,KILOMETERS:1E3,DECIMETERS:0.1,LINK_CLARKE:0.2011661949,FOOT_GOLD_COAST:0.3047997101815088,FOOT_CLARKE:0.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:0.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:0.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:0.3047994715386762,YARD_INDIAN_1937:0.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:0.0174532925199433,DECIMAL_DEGREES:0.0174532925199433,MGRS:0.0174532925199433,
USNG:0.0174532925199433,DEGREE_MINUTE_SECONDS:0.0174532925199433,GRAD:0.01570796326794897},p=n(null,function(){});p.convertUnit=function(f,a,l){return e[f.toUpperCase()]/e[a.toUpperCase()]*l};p.getUnitRate=function(f,a){return e[f.toUpperCase()]/e[a.toUpperCase()]};p.isProjectUnit=function(e){return-1<f.indexOf(g,e.toUpperCase())};p.isGeographicUnit=function(e){return-1<f.indexOf(h,e.toUpperCase())};p.getGeographicUnits=function(){return h};p.getProjectUnits=function(){return g};return p})},"jimu/dijit-all":function(){define([],
1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(n,f,g,h,e,p,r,a){return n(f,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){r.create("div",{"class":"jimu-radio-inner"},this.domNode);this.checked&&p.add(this.domNode,"jimu-radio-checked");this.own(e(this.domNode,"click",g.hitch(this,
function(){this.checked||this.check()})))},check:function(a){void 0===a&&(a=!0);this.checked=!0;p.add(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(a){void 0===a&&(a=!0);this.checked=!1;p.remove(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(e){null!==this.group&&h.forEach(a.toArray(),function(a){a.id!==this.id&&(a["class"]===this["class"]&&a.group===this.group)&&(e?a.check(!1):
a.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/Evented".split(" "),function(n,f,g,h,e,p,r){return n([f,r],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,status:!0,label:"",postCreate:function(){this.checkNode=h.create("div",{"class":"checkbox jimu-float-leading"},this.domNode);this.labelNode=h.create("div",{"class":"label jimu-float-leading",
innerHTML:this.label||""},this.domNode);this.checked&&h.addClass(this.checkNode,"checked");this.status||h.addClass(this.domNode,"jimu-state-disabled");this.own(p(this.checkNode,"click",g.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})));this.own(p(this.labelNode,"click",g.hitch(this,function(){this.checked&&this.status?this.uncheck():this.status&&this.check()})));this._udpateLabelClass()},setLabel:function(a){this.label=a;this.labelNode.innerHTML=this.label;this._udpateLabelClass()},
_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?h.removeClass(this.labelNode,"not-visible"):h.addClass(this.labelNode,"not-visible"))},setValue:function(a){this.status&&(!0===a?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(a){a=!!a;var f=this.status!==a;(this.status=a)?e.remove(this.domNode,"jimu-state-disabled"):e.add(this.domNode,"jimu-state-disabled");f&&this.emit("status-change",a)},getStatus:function(){return this.status},check:function(){this.status&&
(this.checked=!0,h.addClass(this.checkNode,"checked"),this.onStateChange())},uncheck:function(a){if(this.status&&(this.checked=!1,h.removeClass(this.checkNode,"checked"),!a))this.onStateChange()},onStateChange:function(){if(this.onChange&&g.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",this.checked)}})})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr jimu/utils jimu/symbolUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font dijit/form/Select dijit/form/NumberSpinner jimu/dijit/ColorPicker jimu/dijit/_Transparency".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A){return n([f,g,h,p],{templateString:e,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,symbol:null,type:null,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser},postCreate:function(){this.inherited(arguments);this.own(d(document.body,"click",r.hitch(this,this._onBodyClicked)));(this._isIE8=
8===s("ie"))&&a.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=a&&a.declaredClass;b&&("string"===typeof b&&0<=b.indexOf("esri.symbol"))&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?
(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){var a=
null;"marker"===this.type?a=this._getPointSymbolBySetting():"line"===this.type?a=this._getLineSymbolBySetting():"fill"===this.type?a=this._getFillSymbolBySetting():"text"===this.type&&(a=this._getTextSymbolBySetting());var b=null;a&&(b=this._cloneSymbol(a));return b},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),b=0,c=a.length;b<c;b++){var d=a[b];this[d]&&this[d].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||
a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(b,c){var d=c.domNode,e=c.dropDown.domNode,d=b===d||a.isDescendant(b,d),e=b===e||a.isDescendant(b,e);if(!d&&!e)c.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){q(".symbol-section",this.domNode).style("display","none")},_showSection:function(a){this._hideAllSections();
q("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,d){return c.getAncestorDom(a,b,d)},_getAbsoluteUrl:function(a){return window.location.protocol+"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=t.fromJson(c)}catch(d){console.error(d)}return b},_createSymbolIconTable:function(b,c,d){var e=this.type+"-icon-table";b=a.toDom('\x3ctable class\x3d"'+("icon-table "+e+" "+(e+"-"+b))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');
for(var e=q("tbody",b)[0],f=Math.ceil(c.length/8),k=0;k<f;k++)a.create("tr",{},e);var m=q("tr",b);l.forEach(c,r.hitch(this,function(b,c){var e=r.clone(b),f=t.fromJson(b),k=a.create("td",{},m[Math.floor(c/8)]);a.addClass(k,"symbol-td-item");f=this._createSymbolNode(f);a.addClass(f,"symbol-div-item");var q=f.firstChild;a.addClass(q,"svg-node");if(this._isIE8&&"point"===d)if(window.isRTL){if("Cross"===b.name||"X"===b.name)a.setStyle(q,"right","-20px"),a.setStyle(f,"marginTop","20px")}else("Cross"===
b.name||"X"===b.name)&&a.setStyle(f,"marginTop","20px");f.symbol=e;a.place(f,k)}));return b},_updatePreview:function(b){var c=this._cloneSymbol(this.symbol);a.empty(b);(c=m.createSymbolNode(c))||(c=a.create("div"));a.place(c,b)},_createSymbolNode:function(b){(b=m.createSymbolNode(b,{width:36,height:36}))||(b=a.create("div"));a.setStyle(b,{width:"36px",height:"36px"});return b},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",
path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new b({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());
this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(d(this.pointIconTables,".symbol-div-item:click",r.hitch(this,this._onPointSymIconItemClick)));this.own(d(this.pointSymClassSelect,"Change",r.hitch(this,this._onPointSymClassSelectChange)));this.own(d(this.pointSize,"change",r.hitch(this,this._onPointSymbolChange)));this.own(d(this.pointColor,"change",r.hitch(this,this._onPointSymbolChange)));this.own(d(this.pointAlpha,"change",r.hitch(this,this._onPointSymbolChange)));
this.own(d(this.pointOutlineColor,"change",r.hitch(this,this._onPointSymbolChange)));this.own(d(this.pointOutlineWidth,"change",r.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),
a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_onPointSymClassSelectChange:function(){this._showSelectedPointSymIconTable();var a=
this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]||this._requestPointSymJson(a);a=this.pointSymClassSelect.getOptions(a);this.pointSymClassSelect.domNode.title=a?a.label:""},_showSelectedPointSymIconTable:function(){var a=this.pointSymClassSelect.get("value");q(".marker-icon-table",this.pointIconTables).style("display","none");a=q(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_requestPointSymJson:function(b){var c="def"+b,d=this.pointSymClassSelect[c];
d||(d=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json"),d=k(d,{handleAs:"json"}),this.pointSymClassSelect[c]=d,d.then(r.hitch(this,function(c){this.domNode&&(c=this._createSymbolIconTable(b,c,"point"),a.place(c,this.pointIconTables),this._showSelectedPointSymIconTable())}),r.hitch(this,function(a){console.error("get point symbol failed",a)})))},_onPointSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(q(".selected-symbol-div-item",
b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol){this.symbol=t.fromJson(b);b=a.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showPictureMarkerSymSettings();this._onPointSymbolChange();var c=a.getStyle(this.pointColorTr,"display");b!==c&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){a.setStyle(this.pointColorTr,"display","");a.setStyle(this.pointOpacityTr,
"display","");a.setStyle(this.pointOutlineColorTr,"display","");a.setStyle(this.pointOulineWidthTr,"display","")},_showPictureMarkerSymSettings:function(){a.setStyle(this.pointColorTr,"display","none");a.setStyle(this.pointOpacityTr,"display","none");a.setStyle(this.pointOutlineColorTr,"display","none");a.setStyle(this.pointOulineWidthTr,"display","none")},_getPointSymbolBySetting:function(){if(!this.symbol)return null;var a=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){this.symbol.setSize(a);
var a=this.pointColor.getColor(),b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);var a=this.pointOutlineColor.getColor(),b=parseFloat(this.pointOutlineWidth.get("value")),c=new v;c.setStyle(v.STYLE_SOLID);c.setColor(a);c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(a),this.symbol.setHeight(a));this._updatePreview(this.pointSymPreview);return this.symbol},_initLineSection:function(){this._showSection("line");this._lineEventBinded||
(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(d(this.lineIconTables,".symbol-div-item:click",r.hitch(this,this._onLineSymIconItemClick)));this.own(d(this.lineColor,"change",r.hitch(this,this._onLineSymbolChange)));this.own(d(this.lineStylesSelect,"change",r.hitch(this,this._onLineSymbolChange)));this.own(d(this.lineAlpha,"change",r.hitch(this,this._onLineSymbolChange)));
this.own(d(this.lineWidth,"change",r.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&
"esri.symbol.SimpleLineSymbol"===a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");k(c,{handleAs:"json"}).then(r.hitch(this,function(c){this.domNode&&(c=this._createSymbolIconTable(b,c,"line"),a.place(c,this.lineIconTables))}),r.hitch(this,function(a){console.error("get line symbol failed",a)}))},_onLineSymIconItemClick:function(b){if(b=
this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(q(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=t.fromJson(b),this._initLineSettings(b),this._onLineSymbolChange()},_getLineSymbolBySetting:function(){this.symbol=new v;var a=this.lineColor.getColor(),b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));
this.symbol.setStyle(b);this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(d(this.fillIconTables,".symbol-div-item:click",r.hitch(this,this._onFillSymIconItemClick)));this.own(d(this.fillColor,
"change",r.hitch(this,this._onFillSymbolChange)));this.own(d(this.fillAlpha,"change",r.hitch(this,this._onFillSymbolChange)));this.own(d(this.fillOutlineColor,"change",r.hitch(this,this._onFillSymbolChange)));this.own(d(this.fillOutlineWidth,"change",r.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),
this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");k(c,{handleAs:"json"}).then(r.hitch(this,function(c){this.domNode&&(c=this._createSymbolIconTable(b,
c,"fill"),a.place(c,this.fillIconTables))}),r.hitch(this,function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(q(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=t.fromJson(b),this._initFillSettings(b),this._onFillSymbolChange()},_getFillSymbolBySetting:function(){this.symbol=
new x;var a=this.fillColor.getColor();a.a=this.fillAlpha.getAlpha();var b=this.fillOutlineColor.getColor(),c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(a);this.symbol.setStyle(x.STYLE_SOLID);a=new v;a.setStyle(v.STYLE_SOLID);a.setColor(b);a.setWidth(c);this.symbol.setOutline(a);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();
this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(d(this.inputText,"change",r.hitch(this,this._onTextSymbolChange)));this.own(d(this.textColor,"change",r.hitch(this,this._onTextSymbolChange)));this.own(d(this.textFontSize,"change",r.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=
a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(){var b=this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";a.setStyle(this.textPreview,{color:b,fontSize:c});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(){this.symbol=new y;var a=this.inputText.value,
b=this.textColor.getColor(),c=parseInt(this.textFontSize.get("value"),10),d=new A;d.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(d);this._updateTextPreview();return this.symbol}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(n,f,g,h){return n("dijit.form.NumberSpinner",[g,h.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(e,f){var g=this.constraints,a=isNaN(e),
l=!isNaN(g.max),d=!isNaN(g.min);a&&0!=f&&(e=0<f?d?g.min:l?g.max:0:l?this.constraints.max:d?g.min:0);var h=e+f;if(a||isNaN(h))return e;l&&h>g.max&&(h=g.max);d&&h<g.min&&(h=g.min);return h},_onKeyDown:function(e){if(!this.disabled&&!this.readOnly&&(e.keyCode==f.HOME||e.keyCode==f.END)&&!e.ctrlKey&&(!e.altKey&&!e.metaKey)&&"undefined"!=typeof this.get("value")){var g=this.constraints[e.keyCode==f.HOME?"min":"max"];"number"==typeof g&&this._setValueAttr(g,!1);e.stopPropagation();e.preventDefault()}}})})},
"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(n,f,g,h,e,p,r,a,l,d){return n("dijit.form._Spinner",a,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:0.9,smallDelta:1,largeDelta:10,templateString:l,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},
adjust:function(a){return a},_arrowPressed:function(a,e,f){!this.disabled&&!this.readOnly&&(this._setValueAttr(this.adjust(this.get("value"),e*f),!1),d.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,d,e){var c=this.smallDelta;d==this.textbox&&(d=e.keyCode,c=d==f.PAGE_UP||d==f.PAGE_DOWN?this.largeDelta:this.smallDelta,d=d==f.UP_ARROW||d==f.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(d):
this._arrowPressed(d,d==this.upArrowNode?1:-1,c)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var d=a.wheelDelta/120;Math.floor(d)!=d&&(d=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:d;if(0!==a){var e=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(e,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(e)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);
this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,d){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(p(this.domNode,e.wheel,g.hitch(this,
"_mouseWheeled")),r.addListener(this.upArrowNode,this.textbox,{keyCode:f.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),r.addListener(this.downArrowNode,this.textbox,{keyCode:f.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),r.addListener(this.upArrowNode,this.textbox,{keyCode:f.PAGE_UP,ctrlKey:!1,altKey:!1,
shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),r.addListener(this.downArrowNode,this.textbox,{keyCode:f.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(n,f,g){return n("dijit.form.RangeBoundTextBox",
g,{rangeMessage:"",rangeCheck:function(f,e){return("min"in e?0<=this.compare(f,e.min):!0)&&("max"in e?0>=this.compare(f,e.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var f=this.get("value");if(null==f)return!1;var e=!1;"min"in this.constraints&&(e=this.constraints.min,e=0>this.compare(f,"number"==typeof e&&0<=e&&0!=f?0:e));!e&&"max"in this.constraints&&(e=this.constraints.max,e=0<this.compare(f,"number"!=typeof e||0<
e?e:0));return e},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(f){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(f))},getErrorMessage:function(f){var e=this.get("value");return null!=e&&""!==e&&("number"!=typeof e||!isNaN(e))&&!this.isInRange(f)?this.rangeMessage:this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=
f.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(n,f,g,h){return n("dijit.form.MappedTextBox",h,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(e){return e.toString?e.toString():""},toString:function(){var e=this.filter(this.get("value"));
return null!=e?"string"==typeof e?e:this.serialize(e,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=g.place("\x3cinput type\x3d'hidden'"+(this.name&&!f("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),
function(n,f,g,h,e,p){var r=function(a){a=a||{};var d=g.getLocalization("dojo.cldr","number",g.normalizeLocale(a.locale)),e=a.pattern?a.pattern:d[(a.type||"decimal")+"Format"];a="number"==typeof a.places?a.places:"string"===typeof a.places&&0<a.places.length?a.places.replace(/.*,/,""):-1!=e.indexOf(".")?e.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:d.decimal,places:a}},a=n("dijit.form.NumberTextBoxMixin",null,{pattern:function(a){return"("+(this.focused&&this.editOptions?this._regExpGenerator(f.delegate(a,
this.editOptions))+"|":"")+this._regExpGenerator(a)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:e.format,_regExpGenerator:e.regexp,_decimalInfo:r(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(a){var d="number"==typeof a.places?a.places:0;d&&d++;"number"!=typeof a.max&&(a.max=9*Math.pow(10,15-d));"number"!=typeof a.min&&(a.min=-9*Math.pow(10,15-d));this.inherited(arguments,[a]);this.focusNode&&(this.focusNode.value&&
!isNaN(this.value))&&this.set("value",this.value);this._decimalInfo=r(a)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var a=this.get("value");"number"==typeof a&&!isNaN(a)&&(a=this.format(a,this.constraints),void 0!==a&&(this.textbox.value=a));this.inherited(arguments)}},format:function(a,d){var e=String(a);if("number"!=typeof a)return e;if(isNaN(a))return"";if(!("rangeCheck"in this&&this.rangeCheck(a,d))&&!1!==d.exponent&&/\de[-+]?\d/i.test(e))return e;this.editOptions&&this.focused&&
(d=f.mixin({},d,this.editOptions));return this._formatter(a,d)},_parser:e.parse,parse:function(a,d){var e=f.mixin({},d,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=e.places){var q=e.places,q="number"===typeof q?q:Number(q.split(",").pop());e.places="0,"+q}e=this._parser(a,e);this.editOptions&&(this.focused&&isNaN(e))&&(e=this._parser(a,d));return e},_getDisplayedValueAttr:function(){var a=this.inherited(arguments);return isNaN(a)?this.textbox.value:a},filter:function(a){if(null==
a||"string"==typeof a&&""==a)return NaN;"number"==typeof a&&(!isNaN(a)&&0!=a)&&(a=e.round(a,this._decimalInfo.places));return this.inherited(arguments,[a])},serialize:function(a,d){return"number"!=typeof a||isNaN(a)?"":this.inherited(arguments)},_setBlurValue:function(){var a=f.hitch(f.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(a,!0)},_setValueAttr:function(a,d,e){if(void 0!==a&&void 0===e)if(e=String(a),"number"==typeof a)if(isNaN(a))e="";else{if("rangeCheck"in this&&this.rangeCheck(a,
this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(e))e=void 0}else a?a=void 0:(e="",a=NaN);this.inherited(arguments,[a,d,e])},_getValueAttr:function(){var a=this.inherited(arguments);if(isNaN(a)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&RegExp("^"+e._realNumberRegexp(f.delegate(this.constraints))+"$").test(this.textbox.value))return a=Number(this.textbox.value),isNaN(a)?void 0:a}else return a},isValid:function(a){if(!this.focused||
this._isEmpty(this.textbox.value))return this.inherited(arguments);var d=this.get("value");return!isNaN(d)&&this.rangeCheck(d,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var a="number"==typeof this.constraints.min,d="number"==typeof this.constraints.max,e=this.get("value");if(isNaN(e)||!a&&!d)return this.inherited(arguments);var f=e|0,k=0>e,c=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
m=(this.maxLength||20)-this.textbox.value.length,g=c?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",f=c?f+"."+g:f+"",m=h.rep("9",m),c=e;k?c=Number(f+m):e=Number(f+m);return!(a&&e<this.constraints.min||d&&c>this.constraints.max)}});n=n("dijit.form.NumberTextBox",[p,a],{baseClass:"dijitTextBox dijitNumberTextBox"});n.Mixin=a;return n})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup dojox/widget/ColorPicker jimu/utils".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s){return n([f,g],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof r||(this.color=new r(this.color)):this.color=new r("#ccc");e.setStyle(this.domNode,"backgroundColor",this.color.toHex());
this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){l.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var d=this.tooltipDialog.domNode;return a===d||e.isDescendant(a,d)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){l.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=
!0},_hideTooltipDialog:function(){l.close(this.tooltipDialog);this._isTooltipDialogOpened=!1},_createTooltipDialog:function(){var f=e.create("div");this.tooltipDialog=new a({content:f});e.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");var k=new d({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:h.hitch(this,function(a){this.ensureMode||(a=new r(a),this.setColor(a))})});k.placeAt(f);k.startup();if(this.ensureMode){var c=e.create("div",
{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},f);this.own(p(c,"click",h.hitch(this,function(){this._hideTooltipDialog()})));c=e.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.ok,innerHTML:this.nls.ok},f);this.own(p(c,"click",h.hitch(this,function(){var a=this.picker.get("value");this.setColor(new r(a));this._hideTooltipDialog()})));f=e.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},
f);this.own(p(f,"click",h.hitch(this,function(){var a=this.picker.get("value");this.setColor(new r(a))})))}this.own(p(this.domNode,"click",h.hitch(this,function(a){a.stopPropagation();a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(p(document.body,"click",h.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=k},setColor:function(a){if(a instanceof r){var d=this.color,c="";d&&(c=
d.toHex());d=a.toHex();this.color=a;e.setStyle(this.domNode,"backgroundColor",d);c!==d&&(this.picker.set("value",d),this.onChange(new r(d)))}},getColor:function(){return this.color},_changeLabel:function(a){e.empty(this.domNode);e.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:s.invertColor(a.toHex())}},this.domNode)},onChange:function(a){this.showLabel&&this._changeLabel(a)}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A,w,C){n.experimental("dojox.widget.ColorPicker");return f("dojox.widget.ColorPicker",b,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:C,postMixInProperties:function(){s.contains(a.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=m.getUniqueId(this.id);g.mixin(this,y.getLocalization("dojox.widget","ColorPicker"));g.mixin(this,y.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>r("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new c.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new c.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(p.subscribe("/dnd/move/stop",g.hitch(this,"_clearTimer"))),this._subs.push(p.subscribe("/dnd/move/start",
g.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:q.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:q.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:q.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:q.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:q.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:q.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,g.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=x.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(a){a.node!=this.cursorNode&&a.node!=this.hueCursorNode||(t.focus(a.node),d.setSelectable(this.domNode,!1),this._timer=setInterval(g.hitch(this,"_updateColor"),45))},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),d.setSelectable(this.domNode,!0))},_setHue:function(a){e.style(this.colorUnderlay,"backgroundColor",x.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,b,c){if(-1!==a){a=e.style(this.hueCursorNode,"top");b=this.PICKER_HUE_SELECTOR_H/2;a+=b;var d=!1;c.charOrCode==q.UP_ARROW?0<a&&(a-=1,d=!0):c.charOrCode==q.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,d=!0);d&&e.style(this.hueCursorNode,"top",a-b+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,
b,c){b=this.PICKER_SAT_SELECTOR_H/2;var d=this.PICKER_SAT_SELECTOR_W/2;if(-1!==a){a=e.style(this.cursorNode,"top");var f=e.style(this.cursorNode,"left");a+=b;var f=f+d,k=!1;c.charOrCode==q.UP_ARROW?0<a&&(a-=1,k=!0):c.charOrCode==q.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,k=!0):c.charOrCode==q.LEFT_ARROW?0<f&&(f-=1,k=!0):c.charOrCode==q.RIGHT_ARROW&&f<this.PICKER_SAT_VAL_W&&(f+=1,k=!0);k&&(f-=d,e.style(this.cursorNode,"top",a-b+"px"),e.style(this.cursorNode,"left",f+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2,b=e.style(this.hueCursorNode,"top")+b,c=e.style(this.cursorNode,"top")+c,d=e.style(this.cursorNode,"left")+d,b=Math.round(360-360*(b/this.PICKER_HUE_H)),d=x.fromHsv(b,100*(d/this.PICKER_SAT_VAL_W),100-100*(c/this.PICKER_SAT_VAL_H));this._updateColorInputs(d);this._updateValue(d,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=
x.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=x.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=x.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){var c=a.toHex();this.value=this.valueNode.value=c;if(b&&(!this._timer||this.liveUpdate))this.onChange(c)},_updatePickerLocations:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2,c=this.PICKER_SAT_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();b=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-b;d=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-d;c=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-c;this.animatePoint?(k.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0}).play(),k.slideTo({node:this.cursorNode,duration:this.slideDuration,top:c,left:d}).play()):(e.style(this.hueCursorNode,"top",b+"px"),
e.style(this.cursorNode,{left:d+"px",top:c+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(a){a=a.layerY-
this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?k.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0,onEnd:g.hitch(this,function(){this._updateColor(!1);t.focus(this.hueCursorNode)})}).play():(e.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!1))},_setPoint:function(a){var b=a.layerY-this.PICKER_SAT_SELECTOR_H/2,c=a.layerX-this.PICKER_SAT_SELECTOR_W/2;a&&t.focus(a.target);this.animatePoint?k.slideTo({node:this.cursorNode,duration:this.slideDuration,top:b,left:c,onEnd:g.hitch(this,
function(){this._updateColor(!0);t.focus(this.cursorNode)})}).play():(e.style(this.cursorNode,{left:c+"px",top:b+"px"}),this._updateColor(!1))},_handleKey:function(a){},focus:function(){this.focused||t.focus(this.focusNode)},_stopDrag:function(a){l.stop(a)},destroy:function(){this.inherited(arguments);h.forEach(this._subs,function(a){p.unsubscribe(a)});delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(n){return n})},"dojox/color/_base":function(){define(["../main",
"dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(n,f,g,h){n=f.getObject("color",!0,n);n.Color=g;n.blend=g.blendColors;n.fromRgb=g.fromRgb;n.fromHex=g.fromHex;n.fromArray=g.fromArray;n.fromString=g.fromString;n.greyscale=h.makeGrey;f.mixin(n,{fromCmy:function(e,p,h){f.isArray(e)?(p=e[1],h=e[2],e=e[0]):f.isObject(e)&&(p=e.m,h=e.y,e=e.c);p=1-p/100;h=1-h/100;return new g({r:Math.round(255*(1-e/100)),g:Math.round(255*p),b:Math.round(255*h)})},fromCmyk:function(e,p,h,a){f.isArray(e)?(p=e[1],
h=e[2],a=e[3],e=e[0]):f.isObject(e)&&(p=e.m,h=e.y,a=e.b,e=e.c);p/=100;h/=100;a/=100;e=1-Math.min(1,e/100*(1-a)+a);p=1-Math.min(1,p*(1-a)+a);h=1-Math.min(1,h*(1-a)+a);return new g({r:Math.round(255*e),g:Math.round(255*p),b:Math.round(255*h)})},fromHsl:function(e,p,h){f.isArray(e)?(p=e[1],h=e[2],e=e[0]):f.isObject(e)&&(p=e.s,h=e.l,e=e.h);p/=100;for(h/=100;0>e;)e+=360;for(;360<=e;)e-=360;var a,l;120>e?(a=(120-e)/60,l=e/60,e=0):240>e?(a=0,l=(240-e)/60,e=(e-120)/60):(a=(e-240)/60,l=0,e=(360-e)/60);a=2*
p*Math.min(a,1)+(1-p);l=2*p*Math.min(l,1)+(1-p);e=2*p*Math.min(e,1)+(1-p);0.5>h?(a*=h,l*=h,e*=h):(a=(1-h)*a+2*h-1,l=(1-h)*l+2*h-1,e=(1-h)*e+2*h-1);return new g({r:Math.round(255*a),g:Math.round(255*l),b:Math.round(255*e)})}});n.fromHsv=function(e,p,h){f.isArray(e)?(p=e[1],h=e[2],e=e[0]):f.isObject(e)&&(p=e.s,h=e.v,e=e.h);360==e&&(e=0);p/=100;h/=100;var a,l,d;if(0==p)l=d=a=h;else{var s=e/60;e=Math.floor(s);var q=s-e,s=h*(1-p),k=h*(1-p*q);p=h*(1-p*(1-q));switch(e){case 0:a=h;l=p;d=s;break;case 1:a=
k;l=h;d=s;break;case 2:a=s;l=h;d=p;break;case 3:a=s;l=k;d=h;break;case 4:a=p;l=s;d=h;break;case 5:a=h,l=s,d=k}}return new g({r:Math.round(255*a),g:Math.round(255*l),b:Math.round(255*d)})};f.extend(g,{toCmy:function(){var e=1-this.g/255,f=1-this.b/255;return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*e),y:Math.round(100*f)}},toCmyk:function(){var e,f,g,a=this.r/255;e=this.g/255;f=this.b/255;g=Math.min(1-a,1-e,1-f);e=(1-e-g)/(1-g);f=(1-f-g)/(1-g);return{c:Math.round(100*((1-a-g)/(1-g))),m:Math.round(100*
e),y:Math.round(100*f),b:Math.round(100*g)}},toHsl:function(){var e=this.r/255,f=this.g/255,g=this.b/255,a=Math.min(e,g,f),l=Math.max(e,f,g),d=l-a,h=0,q=0,a=(a+l)/2;0<a&&1>a&&(q=d/(0.5>a?2*a:2-2*a));0<d&&(l==e&&l!=f&&(h+=(f-g)/d),l==f&&l!=g&&(h+=2+(g-e)/d),l==g&&l!=e&&(h+=4+(e-f)/d),h*=60);return{h:h,s:Math.round(100*q),l:Math.round(100*a)}},toHsv:function(){var e=this.r/255,f=this.g/255,g=this.b/255,a=Math.min(e,g,f),l=Math.max(e,f,g),a=l-a,d=null,h=0==l?0:a/l;0==h?d=0:(d=e==l?60*(f-g)/a:f==l?120+
60*(g-e)/a:240+60*(e-f)/a,0>d&&(d+=360));return{h:d,s:Math.round(100*h),v:Math.round(100*l)}}});return n})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(n,f,g,h){var e={};f.setObject("dojo.colors",e);var p=function(a,e,d){0>d&&++d;1<d&&--d;var f=6*d;return 1>f?a+(e-a)*f:1>2*d?e:2>3*d?a+6*(e-a)*(2/3-d):a};n.colorFromRgb=g.fromRgb=function(a,e){var d=a.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(d){var f=d[2].split(/\s*,\s*/),
q=f.length,d=d[1];if("rgb"==d&&3==q||"rgba"==d&&4==q)return d=f[0],"%"==d.charAt(d.length-1)?(d=h.map(f,function(a){return 2.56*parseFloat(a)}),4==q&&(d[3]=f[3]),g.fromArray(d,e)):g.fromArray(f,e);if("hsl"==d&&3==q||"hsla"==d&&4==q){var d=(parseFloat(f[0])%360+360)%360/360,k=parseFloat(f[1])/100,c=parseFloat(f[2])/100,k=0.5>=c?c*(k+1):c+k-c*k,c=2*c-k,d=[256*p(c,k,d+1/3),256*p(c,k,d),256*p(c,k,d-1/3),1];4==q&&(d[3]=f[3]);return g.fromArray(d,e)}}return null};var r=function(a,e,d){a=Number(a);return isNaN(a)?
d:a<e?e:a>d?d:a};g.prototype.sanitize=function(){this.r=Math.round(r(this.r,0,255));this.g=Math.round(r(this.g,0,255));this.b=Math.round(r(this.b,0,255));this.a=r(this.a,0,1);return this};e.makeGrey=g.makeGrey=function(a,e){return g.fromArray([a,a,a,e])};f.mixin(g.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],
cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],
darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,
92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,
153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,
245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,
82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return g})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q){return n([f,g,h,e],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:p,nls:null,alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency},postCreate:function(){this.inherited(arguments);"number"===typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){a=Math.round(100-100*a);this.opacitySlider.set("value",a)},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=
this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A){var w=f("dijit.form._SliderMover",
s,{onMouseMove:function(b){var c=this.widget,d=c._abspos;d||(d=c._abspos=e.position(c.sliderBarContainer,!0),c._setPixelValue_=a.hitch(c,"_setPixelValue"),c._isReversed_=c._isReversed());b=b[c._mousePixelCoord]-d[c._startingPixelCoord];c._setPixelValue_(c._isReversed_?d[c._pixelCount]-b:b,d[c._pixelCount],!1)},destroy:function(a){s.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,!0)}});g=f("dijit.form.HorizontalSlider",[x,y],{templateString:A,value:0,
showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:m.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(a){!this.disabled&&(!this.readOnly&&!a.altKey&&
!a.ctrlKey&&!a.metaKey)&&this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!this.disabled&&!this.readOnly&&!a.altKey&&!a.ctrlKey&&!a.metaKey){switch(a.keyCode){case r.HOME:this._setValueAttr(this.minimum,!1);break;case r.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?r.RIGHT_ARROW:r.LEFT_ARROW:case !1===this._descending?r.DOWN_ARROW:r.UP_ARROW:case !1===this._descending?r.PAGE_DOWN:r.PAGE_UP:this.increment(a);break;case this._descending||this.isLeftToRight()?
r.LEFT_ARROW:r.RIGHT_ARROW:case !1===this._descending?r.UP_ARROW:r.DOWN_ARROW:case !1===this._descending?r.PAGE_UP:r.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){!this.disabled&&!this.readOnly&&(l("ie")||t.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&this.clickSelect){t.focus(this.sliderHandle);a.stopPropagation();
a.preventDefault();var b=e.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;a=Math.round(a/(b/d));this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*a/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,
b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&d.style[this._progressPixelSize]){var f=this,k={},m=parseFloat(d.style[this._progressPixelSize]),
q=this.slideDuration*(c-m/100);0!=q&&(0>q&&(q=0-q),k[this._progressPixelSize]={start:m,end:100*c,units:"%"},this._inProgressAnim=h.animateProperty({node:d,duration:q,onAnimate:function(a){e.style[f._progressPixelSize]=100-parseFloat(a[f._progressPixelSize])+"%"},onEnd:function(){delete f._inProgressAnim},properties:k}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",e.style[this._progressPixelSize]=100*(1-c)+"%"},_bumpValue:function(a,b){if(!this.disabled&&!(this.readOnly||
this.maximum<=this.minimum)){var c=p.getComputedStyle(this.sliderBarContainer),d=e.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=d[this._pixelCount];c--;d=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>d&&(d=0);d>c&&(d=c);d=d*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(d,b)}},_onClkBumper:function(a){!this.disabled&&(!this.readOnly&&this.clickSelect)&&this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===
this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==r.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==r.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},startup:function(){this._started||(n.forEach(this.getChildren(),function(a){this[a.container]!=
this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var a=q('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+
"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(b.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),b.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(c(this.domNode,k.wheel,a.hitch(this,"_mouseWheeled")));var e=f(w,{widget:this});this._movable=
new d(this.sliderHandle,{mover:e});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});g._Mover=w;return g})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(n,f,g,h,e,p){n=n("dijit.form.HorizontalRuleLabels",p,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',
labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(e){return e},_genHTML:function(e,a){var f=this.labels[a];return this._positionPrefix+this._calcPosition(e)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(f)+this._labelPrefix+
f+this._suffix},_genDirectionHTML:function(e){return""},getLabels:function(){var e=this.labels;!e.length&&this.srcNodeRef&&(e=h("\x3e li",this.srcNodeRef).map(function(a){return String(a.innerHTML)}));if(!e.length&&1<this.count)for(var e=[],a=this.minimum,f=(this.maximum-a)/(this.count-1),d=0;d<this.count;d++)e.push(d<this.numericMargin||d>=this.count-this.numericMargin?"":g.format(a,this.constraints)),a+=f;return e},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();
this.count=this.labels.length}});f("dojo-bidi")&&n.extend({_setTextDirAttr:function(f){this.textDir!=f&&(this._set("textDir",f),h(".dijitRuleLabelContainer",this.domNode).forEach(e.hitch(this,function(a){a.style.direction=this.getTextDir(a.innerText||a.textContent||"")})))},_genDirectionHTML:function(e){return this.textDir?"direction:"+this.getTextDir(e)+";":""}});return n})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(n,f,g){return n("dijit.form.HorizontalRule",
[f,g],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(f){return this._positionPrefix+f+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var f;if(1==this.count)f=this._genHTML(50,0);else{var e,
g=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){f=this._genHTML(0,0);for(e=1;e<this.count-1;e++)f+=this._genHTML(g*e,e);f+=this._genHTML(100,this.count-1)}else{f=this._genHTML(100,0);for(e=1;e<this.count-1;e++)f+=this._genHTML(100-g*e,e);f+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=f}})})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(n,f,g,h,e,p,r,a){return n([a],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=f.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=f.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=f.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);f.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(h(this,"Change",g.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(a,d){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof a&&(this._fetchHandle=p.after(this,"onFetch",a),this.own(this._fetchHandle));"function"===typeof d&&(this._fetchErrHandle=p.after(this,"onFetchError",d),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(a){return a},onFetchError:function(a){},getStatus:function(){return this._status},_onServiceUrlChange:function(a){var d=new e;d.then(g.hitch(this,function(){this._valid()}),g.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();a?r({url:g.trim(a||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(g.hitch(this,function(a){this.onFetch({url:this.getValue(),data:a})?d.resolve("success"):d.reject("error")}),g.hitch(this,function(a){d.reject(a)})):d.reject("error")},_validating:function(){this._status="validating";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q){return n([f,g,h],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(s.bindClickAndDblclickEvents(this.tableInBodySection,e.hitch(this,function(a){if(a=s.getAncestorDom(a.target||a.srcElement,function(a){return p.hasClass(a,"simple-table-row")&&p.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),e.hitch(this,function(a){if(a=s.getAncestorDom(a.target||a.srcElement,function(a){return p.hasClass(a,"simple-table-row")&&p.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var d=Math.random().toString();this._name="jimu_table_"+d.slice(2,d.length);if(this.fields&&0<this.fields.length){var c=p.create("tr",{},this.thead);r.forEach(this.fields,e.hitch(this,function(d){var f="auto";"actions"===d.type&&(d.name="actions");d.hidden?f=1:void 0!==d.width&&null!==d.width?f=d.width:"actions"===d.type&&!d.name&&(d.width=this._calculateActionsWidth(d)+20,f=d.width);p.create("col",{width:f},this.headColgroup);
p.create("col",{width:f},this.bodyColgroup);f=p.create("th",{innerHTML:d.title,title:d.title},c);if("checkbox"===d.type){f.innerHTML="";var b=new q({label:d.title}),k=l(".checkbox",b.domNode)[0];k&&(k.style.marginTop="10px");this.own(a(b.domNode,"click",e.hitch(this,function(){b.getValue()?this._checkAllTdCheckBoxes(d.name):this._uncheckAllTdCheckBoxes(d.name)})));b.placeAt(f)}p.addClass(f,"simple-table-field");d.hidden&&p.addClass(f,"hidden-column");d["class"]&&p.addClass(f,d["class"]);p.addClass(f,
d.name)}))}else this.fields=null},_getThCheckBox:function(a){var c=null;a=l(".simple-table-field."+a+" .jimu-checkbox",this.thead)[0];return c=d.byNode(a)},_getAllEnabledTdCheckBoxes:function(a){a=l(".simple-table-cell."+a+" .jimu-checkbox",this.tbody);a=r.map(a,function(a){return d.byNode(a)});return a=r.filter(a,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);r.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=
this._getAllEnabledTdCheckBoxes(a);r.forEach(a,function(a){a.getValue()&&a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(e.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var c=this._getAllEnabledTdCheckBoxes(a),c=r.filter(c,e.hitch(this,function(a){return a.getStatus()}));0!==c.length&&(a=this._getThCheckBox(a),r.every(c,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):
a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows(),c=r.map(a,e.hitch(this,function(a){return this.getRowData(a)}));p.empty(this.tbody);r.forEach(a,e.hitch(this,function(a,d){this._onDeleteRow(a,c[d])}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var c=[];this.fields&&(a&&0<a.length)&&r.forEach(a,e.hitch(this,function(a){c.push(this.addRow(a,-1,!0))}));this.updateUI();return c},addRow:function(a,c,d){this._rowIndex++;var f={success:!1,tr:null,
errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof a)return f;var b=r.filter(this.fields,e.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),b=r.filter(b,e.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<b.length)return f.errorCode=this.REPEATING_ERROR,f.errorMessage="repeating data",f.repeatFields=b,f;var q=p.create("tr",{"class":"simple-table-row not-empty"},this.tbody);p.setAttr(q,"rowId","row"+this._rowIndex);
r.forEach(this.fields,e.hitch(this,function(b){var c=a[b.name],d=b.type,e=null;"actions"===d?this._createActionsTd(q,b):("text"===d?e=this._createTextTd(q,b,c):"radio"===d?e=this._createRadioTd(q,b,c):"checkbox"===d?e=this._createCheckboxTd(q,b,c):"empty"===d?e=this._createEmptyTd(q,b):"extension"===d&&(e=this._createExtensionTd(q,b,c)),b.hidden&&p.addClass(e,"hidden-column"))}));d||(this.updateUI(),d=this.getRows(),"number"===typeof c&&(0<=c&&c<d.length)&&p.place(q,d[c],"before"));f.success=!0;f.tr=
q;f.errorMessage=null;this._onAddRow(q);return f},deleteRow:function(a){if(a){var c=this.getRowData(a);p.destroy(a);this.updateUI();this._onDeleteRow(a,c)}},selectRow:function(a){this.selectable&&(l(".simple-table-row",this.tbody).removeClass("jimu-state-active"),p.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();p.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
p.addClass(this.domNode,this._classVerticalScroll);r.forEach(this.fields,e.hitch(this,function(a){"checkbox"===a.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(a.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var a=p.getContentBox(this.tableInBodySection).w,c="100%";"number"===typeof a&&0<a&&(c=a+"px");p.setStyle(this.tableInHeadSection,"width",c)}},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();p.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=l("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=l("."+this._classRowUpDiv,a)[0])&&p.removeClass(a,this._classJimuStateDisabled);if(a=l("."+this._classLastSimpleTableRow,this.tbody)[0])(a=l("."+this._classRowDownDiv,a)[0])&&p.removeClass(a,this._classJimuStateDisabled);a=l("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);
r.forEach(a,e.hitch(this,function(a,c){0===c%2?p.addClass(a,"odd"):p.addClass(a,"even")}));if(0<a.length){var c=a[0];p.addClass(c,this._classFirstSimpleTableRow);(c=l("."+this._classRowUpDiv,c)[0])&&p.addClass(c,this._classJimuStateDisabled);a=a[a.length-1];p.addClass(a,this._classLastSimpleTableRow);(a=l("."+this._classRowDownDiv,a)[0])&&p.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,c,d){var e=null;return e=c.editable?this._createEditableTextTd(a,c,d):this._createNormalTextTd(a,
c,d)},_createNormalTextTd:function(a,c,d){var e=p.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');p.addClass(e,c.name);var b=l("div",e)[0];b.innerHTML=d||"";b.title=d||"";c["class"]&&p.addClass(e,c["class"]);p.place(e,a);return e},_createEditableTextTd:function(d,c,f){var q=p.toDom('\x3ctd class\x3d"editable-text-td '+c.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');
p.addClass(q,"simple-table-cell");p.place(q,d);c["class"]&&p.addClass(q,c["class"]);var b=l("div",q)[0],g=l("input",q)[0];b.innerHTML=f||"";""!==b.innerHTML&&(b.title=b.innerText||b.innerHTML);g.value=b.innerHTML;this.own(a(b,"dblclick",e.hitch(this,function(a){a.stopPropagation();g.value=b.innerText||b.innerHTML;p.setStyle(b,"display","none");p.setStyle(g,"display","inline");g.focus()})));this.own(a(g,"blur",e.hitch(this,function(){g.value=e.trim(g.value);var a=b.innerText||b.innerHTML,f=g.value;
""!==f?c.unique?0<this.getRowDataArrayByFieldValue(c.name,f,d).length?g.value=a:b.innerHTML=f:b.innerHTML=f:g.value=a;p.setStyle(g,"display","none");p.setStyle(b,"display","block")})));return q},_createRadioTd:function(a,c,d){var e=p.toDom('\x3ctd class\x3d"radio-td '+c.name+'"\x3e\x3cinput type\x3d"radio" /\x3e\x3c/td\x3e');p.addClass(e,"simple-table-cell");p.place(e,a);c["class"]&&p.addClass(e,c["class"]);a=l("input",e)[0];a.name=c.radio&&"row"===c.radio?this._name+this._rowIndex:this._name+c.name;
a.checked=!0===d;return e},_createCheckboxTd:function(d,c,f){var g=p.toDom('\x3ctd class\x3d"checkbox-td '+c.name+'"\x3e\x3c/td\x3e');p.addClass(g,"simple-table-cell");p.place(g,d);c["class"]&&p.addClass(g,c["class"]);var b=new q({onChange:e.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(c.name);"function"===typeof c.onChange&&setTimeout(e.hitch(this,function(){c.onChange(d,b)}),200)})});this.own(a(b,"status-change",e.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(c.name)})));
this._setValueForCheckBox(b,f);b.placeAt(g);return g},_createActionsTd:function(d,c){var f=p.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');p.addClass(f,"simple-table-cell");var q=l(".action-item-parent",f)[0];p.place(f,d);c["class"]&&p.addClass(f,c["class"]);r.forEach(c.actions,e.hitch(this,function(b){"up"===b?(b=p.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},q),b.title=this.nls.moveUp,
this.own(a(b,"click",e.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowUp(d)){a=l(".simple-table-row",this.tbody);var b=r.indexOf(a,d);if(0<b&&(a=a[b-1]))p.place(d,a,"before"),this.updateUI(),this.emit("row-up",d)}})))):"down"===b?(b=p.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},q),b.title=this.nls.moveDown,this.own(a(b,"click",e.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowDown(d)){a=l(".simple-table-row",this.tbody);
var b=r.indexOf(a,d);if(b<a.length-1&&(a=a[b+1]))p.place(d,a,"after"),this.updateUI(),this.emit("row-down",d)}})))):"edit"===b?(b=p.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},q),b.title=this.nls.edit,this.own(a(b,"click",e.hitch(this,function(a){a.stopPropagation();this.onBeforeRowEdit(d)&&this._onActionsEdit(d)})))):"delete"===b&&(b=p.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},q),b.title=this.nls.deleteRow,
this.own(a(b,"click",e.hitch(this,function(a){a.stopPropagation();this.onBeforeRowDelete(d)&&this.deleteRow(d)}))))}));var b=this._calculateActionsWidth(c)+"px";p.setStyle(q,"width",b);return f},_calculateActionsWidth:function(a){return 20*r.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,c){var d=p.create("td",{"class":c.name},a);p.addClass(d,"simple-table-cell");p.addClass(d,"empty-text-td");c["class"]&&p.addClass(d,c["class"]);
return d},_createExtensionTd:function(a,c,d){a=p.create("td",{"class":c.name},a);p.addClass(a,"simple-table-cell");p.addClass(a,"extension-td");c["class"]&&p.addClass(a,c["class"]);c.create&&"function"===typeof c.create&&c.create(a);c.setValue&&"function"===typeof c.setValue&&c.setValue(a,d);return a},editRow:function(a,c){var d={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof c||!p.isDescendant(a,this.tbody))return d;var f=e.mixin([],this.fields),
f=r.filter(f,e.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),f=r.filter(f,e.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,c[b.name],a).length}));if(0<f.length)return d.errorCode=this.REPEATING_ERROR,d.errorMessage="repeating data",d.repeatFields=f,d;var b=l(".simple-table-cell",a);r.forEach(this.fields,e.hitch(this,function(a,d){if(c.hasOwnProperty(a.name)){var e=b[d],f=c[a.name],k=a.type;"text"===k?a.editable?this._editEditableText(e,a,f):this._editNormalText(e,
a,f):"radio"===k?this._editRadio(e,a,f):"checkbox"===k?this._editCheckbox(e,a,f):"extension"===k&&this._editExtension(e,a,f)}}));d.success=!0;d.tr=a;d.errorMessage=null;this._onEditRow(a);return d},_editNormalText:function(a,c,d){a=l("div",a)[0];a.innerHTML=d||"";a.title=a.innerHTML},_editEditableText:function(a,c,d){c=l("div",a)[0];c.innerHTML=d||"";l("input",a)[0].value=c.innerHTML},_editRadio:function(a,c,d){l("input",a)[0].checked=!0===d},_editCheckbox:function(a,c,e){a=l(".jimu-checkbox",a)[0];
a=d.byNode(a);this._setValueForCheckBox(a,e)},_setValueForCheckBox:function(a,c){null===c?a.setStatus(!1):(a.setStatus(!0),c!==a.getValue()&&a.setValue(c))},_editExtension:function(a,c,d){c.setValue&&"function"===typeof c.setValue&&c.setValue(a,d)},_getAllRows:function(){return l(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();return r.filter(a,e.hitch(this,function(a){return!p.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return r.filter(a,
e.hitch(this,function(a){return p.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,c=l(".simple-table-row",this.tbody),c=r.filter(c,e.hitch(this,function(a){return!p.hasClass(a,"empty")&&p.hasClass(a,"jimu-state-active")}));0<c.length&&(a=c[0]);return a},getSelectedRowData:function(){var a=null,c=this.getSelectedRow();c&&(a=this._getRowDataByTr(c));return a},getData:function(a){var c=this._getNotEmptyRows();a&&(c=r.filter(c,e.hitch(this,
function(c){return c!==a})));return r.map(c,e.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(a){var c=null;if(a)c={};else return null;r.forEach(this.fields,e.hitch(this,function(e){var f=e.type;if("actions"!==f){var b=e.name;c[b]=null;var q=l(".simple-table-cell."+b,a)[0];q&&("text"===f?(e=l("div",q)[0],c[b]=e.innerText||e.innerHTML):"radio"===f?(e=l("input",q)[0],c[b]=e.checked):"checkbox"===f?(e=l(".jimu-checkbox",
q)[0],e=d.byNode(e),e.getStatus()?c[b]=e.getValue():c[b]=null):"extension"===f&&e.getValue&&"function"===typeof e.getValue&&(c[b]=e.getValue(q,e)))}}));return c},getRowDataArrayByFieldValue:function(a,c,d){var f=[];if(!this.fields||!r.some(this.fields,e.hitch(this,function(b){return b.name===a})))return[];d=this.getData(d);return f=r.filter(d,e.hitch(this,function(b){return b[a]==c}))},moveToTop:function(a){a&&a.parentNode===this.tbody&&p.place(a,this.tbody,"first")},_onClickRow:function(a){this.emit("row-click",
a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a,c){this.emit("row-delete",a,c)},_onEnterRow:function(a){this.emit("row-enter",a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},
onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(n,f,g,h,e,p,r,a,l,d){return n([r,a,p],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new l(null,this.containerNode);var a=100*(1/this.tabs.length);this.isNested&&h.addClass(this.domNode,"nested");g.forEach(this.tabs,function(d){this._createTab(d,a)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);d.setVerticalCenter(this.domNode)},_createTab:function(a,d){var k;k=h.create("div",{innerHTML:a.title,
"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":d+"%"},label:a.title},this.controlNode);this.viewStack.viewType=a.content.domNode?"dijit":"dom";a.content.label=a.title;this.viewStack.addView(a.content);this.own(e(k,"click",f.hitch(this,this.onSelect,a.title)));k.label=a.title;this.controlNodes.push(k)},onSelect:function(a){this.selectTab(a)},selectTab:function(a){this._selectControl(a);this.viewStack.switchView(a);this.emit("tabChanged",a)},_selectControl:function(a){g.forEach(this.controlNodes,
function(d){h.removeClass(d,"jimu-state-selected");d.label===a&&h.addClass(d,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dijit/_WidgetBase"],function(n,f,g,h,e){return n(e,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);h.forEach(this.views,f.hitch(this,function(e){1===e.nodeType?(g.place(e,
this.domNode),g.addClass(e,"view"),g.setStyle(e,"display","none")):e.domNode&&(g.place(e.domNode,this.domNode),g.addClass(e.domNode,"view"),g.setStyle(e.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var e="",f=this.getSelectedView();f&&(e=f.label);return e},getViewByLabel:function(e){for(var f=0;f<this.views.length;f++)if(e===this.views[f].label)return this.views[f];
return null},addView:function(e){this.views.push(e);1===e.nodeType?(g.place(e,this.domNode),g.addClass(e,"view")):e.domNode&&(g.place(e.domNode,this.domNode),g.addClass(e.domNode,"view"))},removeView:function(e){var f=this.views.length;this.views=h.filter(this.views,function(a){return e!==a});f!==this.views.length&&(1===e.nodeType?g.destroy(e):e.domNode&&e.destroyRecursive())},switchView:function(e){var h,a;h="number"===typeof e?this.views[e]:"string"===typeof e?this.getViewByLabel(e):e;this.views.forEach(f.hitch(this,
function(e){e&&(1===e.nodeType?a=e:e.domNode&&(a=e.domNode),e===h?(g.setStyle(a,"display","block"),e.domNode&&!e._started&&(e.startup(),e._started=!0)):g.setStyle(a,"display","none"))}));this._currentView=h;this.onViewSwitch(h)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s){return n([a,l,p],{templateString:d,selected:"",tabs:null,average:!1,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var d=r("td",this.tabTr);g.forEach(d,f.hitch(this,function(c,d){h.removeClass(c,"jimu-state-active");c.label===a&&(h.addClass(c,"jimu-state-active"),
this._currentIndex=d)}));this.controlNode.removeChild(this.controlTable);h.place(this.controlTable,this.controlNode);this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var d=r("td:last-child",this.tabTr);0<d.length&&h.destroy(d[0])}0<g.filter(this.tabs,function(c){return c.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(d=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),
h.place(d,this.tabTr)))},removeTab:function(a){var d=-1;if(g.some(this.tabs,function(b,c){if(b.title===a)return d=c,!0})){var c=this.tabs.splice(d,1)[0],e=r("td",this.tabTr),f;g.some(e,function(b){if(b.label===a)return f=b,!0})&&h.destroy(f);this.viewStack.removeView(c.content)}},showShelter:function(){h.setStyle(this.shelter,"display","block")},hideShelter:function(){h.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},
_initSelf:function(){this.viewStack=new s(null,this.containerNode);g.forEach(this.tabs,function(a){this._createTab(a)},this);if(this.average)this.controlTable.style.tableLayout="fixed";else{var a=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');h.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var d=h.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
d.label=a.title||"";h.place(d,this.tabTr);var c=r(".tab-item-div",d)[0];c.innerHTML=d.label;c.label=d.label;a.content.label=d.label;this.viewStack.addView(a.content);this.own(e(d,"click",f.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(n,f,g,h){return n([h],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",
constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(f.hitch(this,function(e){this._placeItem(e)}));this.resize()},_placeItem:function(e){e.domNode?g.place(e.domNode,this.domNode):g.place(e,this.domNode)},addItem:function(e){this.items.push(e);this._placeItem(e);this.resize()},addItems:function(e){this.items=this.items.concat(e);this.items.forEach(f.hitch(this,function(e){this._placeItem(e)}));this.resize()},removeItem:function(e){var f;
for(f=0;f<this.items.length;f++)if(this.items[f].label===e){this.items[f].domNode?this.items[f].destroy():g.destroy(this.items[f]);this.items.splice(f,1);this.resize();break}},empty:function(){var e;for(e=0;e<this.items.length;e++)this.items[e].domNode?this.items[e].destroy():g.destroy(this.items[e]);this.items=[]},resize:function(){var e,p,h;e=g.getMarginBox(this.domNode);p=this.getItemSize(e);h=Math.floor((e.w+this.hmargin)/(p.width+this.hmargin));this.items.forEach(f.hitch(this,function(a,e){this.setItemPosition(a,
e,p,h)}))},getItemSize:function(e){var f={},g;if("fixWidth"===this.strategy)f.width=this.itemSize.width,f.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(g=0;g<this.itemSize.length;g++){if(e.w<=this.itemSize[g].screenWidth){f.width=this.itemSize[g].width;f.height=this.itemSize[g].height;break}}else"fixCols"===this.strategy&&(f.width=(e.w-this.hmargin*(this.maxCols-1))/this.maxCols,f.height="number"===typeof this.itemSize.height?this.itemSize.height:f.width*parseFloat(this.itemSize.height.substring(0,
this.itemSize.height.length-1))/100);return f},setItemPosition:function(e,f,h,a){f++;var l=f%a;f=Math.ceil(f/a);0===l&&(l=a);a={position:"absolute",top:(this.vmargin+h.height)*(f-1)+"px"};a[window.isRTL?"right":"left"]=(this.hmargin+h.width)*(l-1)+"px";0<=h.width&&(a.width=h.width+"px");0<=h.height&&(a.height=h.height+"px");g.setStyle(e.domNode?e.domNode:e,a)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t){return n([f,g,h,s],{templateString:e,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);
var a={};this.drawLayerId&&(a.id=this.drawLayerId);this.drawLayer=new k(a);this._initDefaultSymbols();this._initTypes();a=d(".draw-item",this.domNode);this.own(a.on("click",p.hitch(this,this._onItemClick)));this.own(l(this.btnClear,"click",p.hitch(this,this._onClickClear)));this.own(l(document.body,"keydown",p.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.own(l(document.body,"keyup",p.hitch(this,function(a){this._shiftKey=!!a.shiftKey;
this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.map&&this.setMap(this.map);r.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable()},enable:function(){this._isDisabled=!1;r.addClass(this.domNode,"enabled");r.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;r.addClass(this.domNode,"disabled");r.removeClass(this.domNode,"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&
this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var a=d(".draw-item.jimu-state-active",this.domNode);return a&&0<a.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;this.inherited(arguments)},setMap:function(a){a&&
(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new c(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(l(this.drawToolBar,"draw-end",p.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=
a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();d(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),this.emit("draw-deactivate"))},activate:function(a){var c=null,e=d(".draw-item",this.domNode);"TEXT"===a?(a="POINT",c=this.textIcon):(e=e.filter(function(c){return c.getAttribute("data-geotype")===
a}),0<e.length&&(c=e[0]));c&&this._activate(c)},onIconSelected:function(a,c,d){this.emit("icon-selected",a,c,d)},onDrawEnd:function(a,c,d,e,f,k){this.emit("draw-end",a,c,d,e,f,k)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},getFirstGraphic:function(){var a=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(a=this.drawLayer.graphics[0]);return a},show:function(){r.removeClass(this.domNode,
"hidden")},hide:function(){r.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return d(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var a={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},c={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},d={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",
outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=m.fromJson(a));this.polylineSymbol||(this.polylineSymbol=m.fromJson(c));this.polygonSymbol||(this.polygonSymbol=m.fromJson(d))},_initTypes:function(){this.geoTypes&&0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&
(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var b=d(".draw-item",this.domNode);b.style("display","none");a.forEach(b,p.hitch(this,function(b){var c=b.getAttribute("data-geotype"),c=0<=a.indexOf(this.geoTypes,c);r.setStyle(b,"display",c?"block":"none")}))},
_onItemClick:function(a){this._isDisabled||(a=a.target||a.srcElement,r.hasClass(a,"draw-item")&&(r.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)))},_activate:function(a){d(".draw-item",this.domNode).removeClass("jimu-state-active");r.addClass(a,"jimu-state-active");var e=a.getAttribute("data-geotype"),f=a.getAttribute("data-commontype"),k=c[e];"TEXT"===e&&(k=c.POINT);this.disableWebMapPopup();this.drawToolBar.activate(k);this.emit("draw-activate",k);this.onIconSelected(a,e,f)},
_onDrawEnd:function(a){var c=d(".draw-item.jimu-state-active",this.domNode)[0],e=c.getAttribute("data-geotype"),c=c.getAttribute("data-commontype"),f=null,f="extent"===a.geometry.type?t.fromExtent(a.geometry):a.geometry;f.geoType=e;f.commonType=c;a=f.type;var k=null,k="point"===a||"multipoint"===a?r.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===a||"polyline"===a?this.polylineSymbol:this.polygonSymbol,f=new q(f,k,null,null);this.keepOneGraphic&&this.drawLayer.clear();
this.drawLayer.add(f);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(f,e,c,this._shiftKey,this._ctrlKey,this._metaKey)}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A,w,C,u,E,D){var B=n(m,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(c,d){this.markerSymbol=new t(t.STYLE_SOLID,10,new b(b.STYLE_SOLID,new e([255,0,0]),2),new e([0,0,0,0.25]));this.lineSymbol=new b(b.STYLE_SOLID,new e([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new b(b.STYLE_SOLID,new e([255,0,0]),2),new e([0,0,0,0.25]));this._points=[];this._mouse=!r("esri-touch")&&!r("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=f.mixin(f.mixin({},this._defaultOptions),d||{});if(a("ios")||a("android"))this._options.showTooltips=!1;this._onKeyDownHandler=f.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=f.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=f.hitch(this,this._onMouseUpHandler);this._onClickHandler=f.hitch(this,this._onClickHandler);this._onMouseMoveHandler=f.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=f.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=f.hitch(this,this._onDblClickHandler);this._updateTooltip=f.hitch(this,this._updateTooltip);this._hideTooltip=f.hitch(this,this._hideTooltip);this._redrawGraphic=f.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,d=h.connect,e=B;this._options=f.mixin(f.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.TRIANGLE:case e.CIRCLE:case e.ELLIPSE:case e.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));r("esri-touch")&&!r("esri-pointer")&&
(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case e.POINT:this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);break;case e.LINE:case e.EXTENT:case e.FREEHAND_POLYLINE:case e.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=d(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=d(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=d(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=d(c,"onMouseDragEnd",this._onMouseUpHandler));r("esri-touch")&&!r("esri-pointer")&&(this._onMouseDownHandler2_connect=d(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=d(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=d(c,"onSwipeEnd",this._onMouseUpHandler));break;case e.POLYLINE:case e.POLYGON:case e.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=d(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=d(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=d(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=d(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&("freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType)&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=h.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case B.CIRCLE:case B.ELLIPSE:case B.TRIANGLE:case B.ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.UP_ARROW:case B.DOWN_ARROW:case B.RECTANGLE:case B.LINE:case B.EXTENT:case B.FREEHAND_POLYLINE:case B.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case B.POLYLINE:case B.POLYGON:case B.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,d=B,b=b.slice(0,b.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>b.length)return;a=new w(c);a.addPath([].concat(b));break;case d.POLYGON:if(!this._graphic||3>b.length)return;a=new C(c);b=[].concat(b,[b[0].offset(0,0)]);!C.prototype.isClockwise(b)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());
a.addRing(b);break;case d.MULTI_POINT:a=new u(c),g.forEach(b,function(b){a.addPoint(b)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=A.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=y.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var d=a.x;a=a.y;var e=b.x;b=b.y;var f=Math.abs(d-
e),k=Math.abs(a-b);return{x:Math.min(d,e),y:Math.max(a,b),width:f,height:k,spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,d=B;b=this.map;var e=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case d.LINE:this._graphic=b.graphics.add(new x(new w({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:e}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);
break;case d.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new w(e);c.addPath(this._points);this._graphic=b.graphics.add(new x(c,this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:case d.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new C(e),c.addRing(this._points),this._graphic=b.graphics.add(new x(c,this.fillSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}r("esri-touch")&&a.preventDefault()},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];a=b||a.mapPoint;b=this._tGraphic;var d=b.geometry;switch(this._geometryType){case B.POLYLINE:case B.POLYGON:d.setPoint(0,0,{x:c.x,y:c.y}),d.setPoint(0,1,{x:a.x,y:a.y}),b.setGeometry(d)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(r("esri-touch")&&
!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0],d=b||a.mapPoint,e=this.map,k=e.spatialReference;b=this._graphic;var g=B,q=e.toScreen(c),m=e.toScreen(d),l=[],l=m.x-q.x,m=m.y-q.y,h=Math.sqrt(l*l+m*m);switch(this._geometryType){case g.CIRCLE:this._hideTooltip();b.geometry=C.createCircle({center:q,r:h,numberOfPoints:60,map:e});b.setGeometry(b.geometry);break;case g.ELLIPSE:this._hideTooltip();
b.geometry=C.createEllipse({center:q,longAxis:l,shortAxis:m,numberOfPoints:60,map:e});b.setGeometry(b.geometry);break;case g.TRIANGLE:this._hideTooltip();l=[[0,-h],[0.8660254037844386*h,0.5*h],[-0.8660254037844386*h,0.5*h],[0,-h]];b.geometry=this._toPolygon(l,q.x,q.y);b.setGeometry(b.geometry);break;case g.ARROW:this._hideTooltip();c=m/h;e=l/h;d=0.25*e*h;k=0.25*h/(m/l);h*=0.25*c;l=[[l,m],[l-d*(1+24/k),m+24*e-h],[l-d*(1+12/k),m+12*e-h],[-12*c,12*e],[12*c,-12*e],[l-d*(1-12/k),m-12*e-h],[l-d*(1-24/k),
m-24*e-h],[l,m]];b.geometry=this._toPolygon(l,q.x,q.y);b.setGeometry(b.geometry);break;case g.LEFT_ARROW:this._hideTooltip();l=0>=l?[[l,0],[0.75*l,m],[0.75*l,0.5*m],[0,0.5*m],[0,-0.5*m],[0.75*l,-0.5*m],[0.75*l,-m],[l,0]]:[[0,0],[0.25*l,m],[0.25*l,0.5*m],[l,0.5*m],[l,-0.5*m],[0.25*l,-0.5*m],[0.25*l,-m],[0,0]];b.geometry=this._toPolygon(l,q.x,q.y);b.setGeometry(b.geometry);break;case g.RIGHT_ARROW:this._hideTooltip();l=0<=l?[[l,0],[0.75*l,m],[0.75*l,0.5*m],[0,0.5*m],[0,-0.5*m],[0.75*l,-0.5*m],[0.75*
l,-m],[l,0]]:[[0,0],[0.25*l,m],[0.25*l,0.5*m],[l,0.5*m],[l,-0.5*m],[0.25*l,-0.5*m],[0.25*l,-m],[0,0]];b.geometry=this._toPolygon(l,q.x,q.y);b.setGeometry(b.geometry);break;case g.UP_ARROW:this._hideTooltip();l=0>=m?[[0,m],[-l,0.75*m],[-0.5*l,0.75*m],[-0.5*l,0],[0.5*l,0],[0.5*l,0.75*m],[l,0.75*m],[0,m]]:[[0,0],[-l,0.25*m],[-0.5*l,0.25*m],[-0.5*l,m],[0.5*l,m],[0.5*l,0.25*m],[l,0.25*m],[0,0]];b.geometry=this._toPolygon(l,q.x,q.y);b.setGeometry(b.geometry);break;case g.DOWN_ARROW:this._hideTooltip();
l=0<=m?[[0,m],[-l,0.75*m],[-0.5*l,0.75*m],[-0.5*l,0],[0.5*l,0],[0.5*l,0.75*m],[l,0.75*m],[0,m]]:[[0,0],[-l,0.25*m],[-0.5*l,0.25*m],[-0.5*l,m],[0.5*l,m],[0.5*l,0.25*m],[l,0.25*m],[0,0]];b.geometry=this._toPolygon(l,q.x,q.y);b.setGeometry(b.geometry);break;case g.RECTANGLE:this._hideTooltip();l=[[0,0],[l,0],[l,m],[0,m],[0,0]];b.geometry=this._toPolygon(l,q.x,q.y);b.setGeometry(b.geometry);break;case g.LINE:b.setGeometry(f.mixin(b.geometry,{paths:[[[c.x,c.y],[d.x,d.y]]]}));break;case g.EXTENT:b&&e.graphics.remove(b,
!0);b=new E(this._normalizeRect(c,d,k));b._originOnly=!0;this._graphic=e.graphics.add(new x(b,this.fillSymbol),!0);e.snappingManager&&e.snappingManager._setGraphic(this._graphic);break;case g.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){r("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry);break;case g.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){r("esri-touch")&&
a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([d.offset(0,0)],0);b.setGeometry(b.geometry)}r("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,d=this._options.tolerance;if((0>b?-1*b:b)<d&&(0>c?-1*c:c)<d)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},
_onMouseUpHandler:function(a){if(!this._dragged||!this._graphic)this._clear();else{0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;var d=this.map.spatialReference,e=B,f;switch(this._geometryType){case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:f=this._graphic.geometry;break;
case e.LINE:f=new w({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:d});break;case e.EXTENT:f=(new E(this._normalizeRect(c,b,d))).getExtent();break;case e.FREEHAND_POLYLINE:f=new w(d);f.addPath([].concat(this._points,[b.offset(0,0)]));break;case e.FREEHAND_POLYGON:f=new C(d),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),!C.prototype.isClockwise(c)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),
c.reverse()),f.addRing(c)}r("esri-touch")&&a.preventDefault();this._clear();this._drawEnd(f)}},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c=b.toScreen(a),d=B;this._points.push(a.offset(0,0));switch(this._geometryType){case d.POINT:this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case d.POLYLINE:1===this._points.length?(c=new w(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new x(c,
this.lineSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new x(new w({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,
1,a.offset(0,0)),b.setGeometry(c));break;case d.POLYGON:1===this._points.length?(c=new C(b.spatialReference),c.addRing(this._points),this._graphic=b.graphics.add(new x(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new x(new w({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case d.MULTI_POINT:a=this._points;1===a.length?(c=new u(b.spatialReference),c.addPoint(a[a.length-1]),this._graphic=b.graphics.add(new x(c,this.markerSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));
break;case d.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case d.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case d.DOWN_ARROW:this._addShape([[0,
0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],c.x,c.y);break;case d.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case d.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case d.CIRCLE:this._clear();this._drawEnd(C.createCircle({center:c,r:48,numberOfPoints:60,map:b}));break;case d.ELLIPSE:this._clear(),this._drawEnd(C.createEllipse({center:c,longAxis:48,shortAxis:24,numberOfPoints:60,
map:b}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var d=this.map,e=new C(d.spatialReference);e.addRing(g.map(a,function(a){return d.toMap({x:a[0]+b,y:a[1]+c})}));return e},_onDblClickHandler:function(a){var b,c=this._points,d=this.map.spatialReference,e=B;r("esri-touch")&&c.push(a.mapPoint);var f=c[c.length-1],k=c[c.length-2],c=f&&k&&f.x===k.x&&f.y===k.y?c.slice(0,
c.length-1):c.slice(0,c.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new w(d);b.addPath([].concat(c));break;case e.POLYGON:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new C(d);a=[].concat(c,[c[0].offset(0,0)]);!C.prototype.isClockwise(a)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+
" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());b.addRing(a);break;case e.MULTI_POINT:b=new u(d),g.forEach(c,function(a){b.addPoint(a)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===l.ESCAPE&&(h.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(a){this._options.showTooltips&&(a?this._tooltip||
(this._tooltip=d.create("div",{"class":"tooltip"},this.map.container),q.isBodyLtr()||s.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=h.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=h.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=h.connect(this.map,"onMouseMove",this._updateTooltip)):
this._tooltip&&(h.disconnect(this._onTooltipMouseEnterHandler_connect),h.disconnect(this._onTooltipMouseLeaveHandler_connect),h.disconnect(this._onTooltipMouseMoveHandler_connect),d.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case B.POINT:c=D.toolbars.draw.addPoint;break;case B.ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.UP_ARROW:case B.DOWN_ARROW:case B.TRIANGLE:case B.RECTANGLE:case B.CIRCLE:case B.ELLIPSE:c=
D.toolbars.draw.addShape;break;case B.LINE:case B.EXTENT:case B.FREEHAND_POLYLINE:case B.FREEHAND_POLYGON:c=D.toolbars.draw.freehand;break;case B.POLYLINE:case B.POLYGON:c=D.toolbars.draw.start;1===a?c=D.toolbars.draw.resume:2<=a&&(c=D.toolbars.draw.complete);break;case B.MULTI_POINT:c=D.toolbars.draw.addMultipoint,1<=a&&(c=D.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+p.body().scrollLeft-
p.body().clientLeft,a=a.clientY+p.body().scrollTop-p.body().clientTop);b.style.display="none";s.set(b,{left:c+this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,d){if(c||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});f.mixin(B,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",
POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});return B})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(n,f,g,h,e){return n([e],{declaredClass:"esri.toolbars._Toolbar",constructor:function(e){this.map=
e},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(e,f,a,g){var d=this.map;e&&(this._mapNavState={isDoubleClickZoom:d.isDoubleClickZoom,isClickRecenter:d.isClickRecenter,isPan:d.isPan,isRubberBandZoom:d.isRubberBandZoom,isKeyboardNavigation:d.isKeyboardNavigation,isScrollWheelZoom:d.isScrollWheelZoom},d.disableDoubleClickZoom(),
d.disableClickRecenter(),d.disablePan(),d.disableRubberBandZoom(),d.disableKeyboardNavigation());f&&d.hideZoomSlider();a&&d.hidePanArrows();g&&d.graphics.disableMouseEvents()},_activateMapTools:function(e,f,a,g){var d=this.map,h=this._mapNavState;e&&h&&(h.isDoubleClickZoom&&d.enableDoubleClickZoom(),h.isClickRecenter&&d.enableClickRecenter(),h.isPan&&d.enablePan(),h.isRubberBandZoom&&d.enableRubberBandZoom(),h.isKeyboardNavigation&&d.enableKeyboardNavigation(),h.isScrollWheelZoom&&d.enableScrollWheelZoom());
f&&d.showZoomSlider();a&&d.showPanArrows();g&&d.graphics.enableMouseEvents()}})})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(n,f,g,h){return n([g],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,declaredClass:"jimu.dijit.URLInput",postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:
"Invalid Url"},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-url-input")},validator:function(e){if(isFinite(e))return!1;var f="^"+h.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),f=RegExp(f,"g").test(e);return this.rest?(e=/\/rest\/services/gi.test(e),f&&e):f}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(n,f,g){var h=n.getObject("validate.regexp",!0,g);return h=g.validate.regexp={ipAddress:function(e){e=
"object"==typeof e?e:{};"boolean"!=typeof e.allowDottedDecimal&&(e.allowDottedDecimal=!0);"boolean"!=typeof e.allowDottedHex&&(e.allowDottedHex=!0);"boolean"!=typeof e.allowDottedOctal&&(e.allowDottedOctal=!0);"boolean"!=typeof e.allowDecimal&&(e.allowDecimal=!0);"boolean"!=typeof e.allowHex&&(e.allowHex=!0);"boolean"!=typeof e.allowIPv6&&(e.allowIPv6=!0);"boolean"!=typeof e.allowHybrid&&(e.allowHybrid=!0);var f=[];e.allowDottedDecimal&&f.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
e.allowDottedHex&&f.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");e.allowDottedOctal&&f.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");e.allowDecimal&&f.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");e.allowHex&&f.push("0[xX]0*[\\da-fA-F]{1,8}");e.allowIPv6&&f.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");e.allowHybrid&&f.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
e="";0<f.length&&(e="("+f.join("|")+")");return e},host:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowIP&&(e.allowIP=!0);"boolean"!=typeof e.allowLocal&&(e.allowLocal=!1);"boolean"!=typeof e.allowPort&&(e.allowPort=!0);"boolean"!=typeof e.allowNamed&&(e.allowNamed=!1);var f=e.allowPort?"(\\:\\d+)?":"",g="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";e.allowIP&&(g+="|"+h.ipAddress(e));e.allowLocal&&(g+="|localhost");
e.allowNamed&&(g+="|^[^-][a-zA-Z0-9_-]*");return"("+g+")"+f},url:function(e){e="object"==typeof e?e:{};"scheme"in e||(e.scheme=[!0,!1]);return f.buildGroupRE(e.scheme,function(e){return e?"(https?|ftps?)\\://":""})+h.host(e)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowCruft&&(e.allowCruft=!1);e.allowPort=!1;var f="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+h.host(e);
e.allowCruft&&(f="\x3c?(mailto\\:)?"+f+"\x3e?");return f},emailAddressList:function(e){e="object"==typeof e?e:{};"string"!=typeof e.listSeparator&&(e.listSeparator="\\s;,");var f=h.emailAddress(e);return"("+f+"\\s*["+e.listSeparator+"]\\s*)*"+f+"\\s*["+e.listSeparator+"]?\\s*"},numberFormat:function(e){e="object"==typeof e?e:{};"undefined"==typeof e.format&&(e.format="###-###-####");return f.buildGroupRE(e.format,function(e){return f.escapeString(e,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},
ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(e){e="object"==typeof e?e:{};"boolean"!=typeof e.allowTerritories&&(e.allowTerritories=!0);"boolean"!=typeof e.allowMilitary&&(e.allowMilitary=!0);var f="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";e.allowTerritories&&(f+="|AS|FM|GU|MH|MP|PW|PR|VI");
e.allowMilitary&&(f+="|AA|AE|AP");return"("+f+")"}}}})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(n,f,g,h,e,p,r,a,l){return n([r,p],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(g.removeClass(this.foldableNode,"fold-up"),g.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(g.removeClass(this.foldableNode,"fold-down"),g.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation();"touchstart"===a.type&&a.preventDefault()},_normalizePositionObj:function(a){var e=
this._getLayoutBox();a.left=isFinite(a.left)?a.left:e.w-a.right;a.top=isFinite(a.top)?a.top:e.h-a.bottom;delete a.right;delete a.bottom;this.position=f.mixin(f.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new l({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(a,l){this.disableMoveable();var q=g.getMarginBox(jimuConfig.layoutId);q.l=q.l-a+l;q.w+=2*(a-l);this.moveable=new e.boxConstrainedMoveable(this.domNode,{box:q,handle:this.titleNode,within:!0});this.own(h(this.moveable,
"Moving",f.hitch(this,this.onMoving)));this.own(h(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){g.removeClass(this.titleNode,"title-normal");g.addClass(this.titleNode,"title-full");g.setStyle(this.foldableNode,"display",
"block");g.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(g.removeClass(this.foldableNode,"fold-up"),g.addClass(this.foldableNode,"fold-down")):(g.removeClass(this.foldableNode,"fold-down"),g.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){g.removeClass(this.titleNode,"title-full");g.addClass(this.titleNode,"title-normal");g.setStyle(this.foldableNode,"display","none");g.setStyle(this.maxNode,"display","none")},resize:function(a){var e=this._getPositionInfo(),
g={left:e.position.left,top:e.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,g.left=isFinite(a.l)?a.l:g.left,g.top=isFinite(a.t)?a.t:g.top,g.width=isFinite(a.w)?a.w:g.width,g.height=isFinite(a.h)?a.h:g.height,this._normalizePositionObj(f.clone(g)),this.makePositionInfoBox(),g.width=this._positionInfoBox.w,g.height=this._positionInfoBox.h);e.position=g;this._onResponsible(e);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return g.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},e=this._getLayoutBox(),f=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;a.position.left=window.isRTL?e.w-f:f;var f=this._positionInfoBox.t,k=e.h-f;f>=k?f>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):k>=this._positionInfoBox.h&&(a.position.top=
this._positionInfoBox.t+40+3);!a.isRunInMobile&&a.position.left+this._positionInfoBox.w>e.w&&(a.position.left-=this._positionInfoBox.w);return a},_setMobilePosition:function(){window.appInfo.isRunInMobile&&(this.domNode&&this.domNode.parentNode!==g.byId(jimuConfig.layoutId))&&g.place(this.domNode,jimuConfig.layoutId);var d=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(d.zIndex=this.position.zIndex);var e=a.getPositionStyle(d);f.mixin(e,d.borderRadiusStyle);g.setStyle(this.domNode,
e)},_setDesktopPosition:function(a){!window.appInfo.isRunInMobile&&(this.domNode&&this.domNode.parentNode!==g.byId(jimuConfig.mapId))&&g.place(this.domNode,jimuConfig.mapId);g.setStyle(this.domNode,{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){g.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){g.setStyle(a.node,"opacity",1);a=g.getMarginBox(a.node);
this._normalizePositionObj(f.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b){n.experimental("dojox.layout.ResizeHandle");
var v=k("dojox.layout._ResizeHelper",t,{show:function(){q.set(this.domNode,"display","")},hide:function(){q.set(this.domNode,"display","none")},resize:function(a){s.setMarginBox(this.domNode,a)}});return k("dojox.layout.ResizeHandle",[t,b],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,
startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,c.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=m.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(r.body()),d.add(this._resizeHelper.domNode,this.activeResizeClass)));
this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=f.partial(d.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&(g.publish(this.startTopic,[this]),this.targetDomNode=
(this.targetWidget=m.byId(this.targetId))?this.targetWidget.domNode:l.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var b=s.position(this.targetDomNode,!0);this._resizeHelper.resize({l:b.x,t:b.y,w:b.w,h:b.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:b.x,t:b.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};var b=q.getComputedStyle(this.targetDomNode),d="border-model"===
s.boxModel?{w:0,h:0}:s.getPadBorderExtents(this.targetDomNode,b),f=s.getMarginExtents(this.targetDomNode,b);this.startSize={w:q.get(this.targetDomNode,"width",b),h:q.get(this.targetDomNode,"height",b),pbw:d.w,pbh:d.h,mw:f.w,mh:f.h};!this.isLeftToRight()&&"absolute"==q.get(this.targetDomNode,"position")&&(b=s.position(this.targetDomNode,!0),this.startPosition={l:b.x,t:b.y});this._pconnects=[g.connect(r.doc,c.move,this,"_updateSizing"),g.connect(r.doc,c.release,this,"_endSizing")];e.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);
else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(d){return!1}this._activeResizeLastEvent=a;var e=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),f=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?e:0);f=this._checkConstraints(a,this.startSize.h-(this._resizeY?f:0));if((c=c||this.startPosition)&&this._resizeX)f.l=
c.l+e,f.w!=a&&(f.l+=a-f.w),f.t=c.t;switch(b){case "margin":f.w+=this.startSize.mw,f.h+=this.startSize.mh;case "border":f.w+=this.startSize.pbw,f.h+=this.startSize.pbh}return f},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(b){var c=
this.targetWidget&&f.isFunction(this.targetWidget.resize),d=this._getNewCoords(b,c&&"margin");if(!1!==d&&(c?this.targetWidget.resize(d):this.animateSizing?a[this.animateMethod]([p.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:d.w}},duration:this.animateDuration}),p.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:d.h}},duration:this.animateDuration})]).play():q.set(this.targetDomNode,{width:d.w+"px",height:d.h+"px"}),
this.intermediateChanges))this.onResize(b)},_endSizing:function(a){h.forEach(this._pconnects,g.disconnect);var b=f.partial(g.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define(["dojo/_base/declare","dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(n,f,g,
h,e){return n(h,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},getExtent:function(){var e=[],h;f.forEach(this.originOperLayer.featureCollection.layers,function(a){e=e.concat(a.layerObject.graphics)});0===e.length?h=null:(h=1===e.length?e[0].getLayer().fullExtent:g.graphicsExtent(e),h=this._convertGeometryToMapSpatialRef(h));return h},_resetLayerObjectVisiblity:function(e){var g=e?e[this.id]:null;g&&(f.forEach(this.newSubLayers,
function(a){var f=e?e[a.id]:null;f&&a.layerObject.setVisibility(f.visible)},this),this._setTopLayerVisible(g.visible))},initVisible:function(){var e=!1,f;for(f=0;f<this.newSubLayers.length;f++)e=e||this.newSubLayers[f].layerObject.visible;e&&(this._visible=!0)},_setTopLayerVisible:function(e){this._visible=e?!0:!1;f.forEach(this.newSubLayers,function(e){e.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var g=[];f.forEach(this.originOperLayer.featureCollection.layers,
function(f){this._getLayerIndexesInMapByLayerId(f.layerObject.id)&&(f=e.getInstance().create({layerObject:f.layerObject,title:f.layerObject.label||f.layerObject.title||f.layerObject.name||f.layerObject.id||" ",id:f.id||" ",collection:{layerInfo:this},selfType:"collection",showLegend:f.showLegend,parentLayerInfo:this}),g.push(f),f.init())},this);g.reverse();return g},_obtainLayerIndexesInMap:function(){var e=[],f,a;for(a=0;a<this.newSubLayers.length;a++)(f=this._getLayerIndexesInMapByLayerId(this.newSubLayers[a].layerObject.id))&&
e.push(f);return e},moveLeftOfIndex:function(e){var f;for(f=this.newSubLayers.length-1;0<=f;f--)this.map.reorderLayer(this.newSubLayers[f].layerObject,e)},moveRightOfIndex:function(e){var f;for(f=0;f<this.newSubLayers.length;f++)this.map.reorderLayer(this.newSubLayers[f].layerObject,e)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getScaleRange:function(){var e=this.getSubLayers();return e[0]?
e[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect esri/config esri/tasks/ProjectParameters esri/SpatialReference esri/geometry/webMercatorUtils".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q){return n(null,{originOperLayer:null,layerObject:null,map:null,title:null,id:null,newSubLayers:null,parentLayerInfo:null,_oldIsShowInMap:null,
_oldFilter:null,_eventHandles:null,constructor:function(a,c){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=c;this.title=this.originOperLayer.title;this.id=this.originOperLayer.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.nls=window.jimuNls.layerInfosMenu;this._eventHandles=[]},init:function(){this.newSubLayers=this.obtainNewSubLayers();this.initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();
this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getExtent:function(){},getOpacity:function(){var a,c=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)c=this.newSubLayers[a].layerObject.opacity>c?this.newSubLayers[a].layerObject.opacity:c;else return 1;return c},setOpacity:function(a){f.forEach(this.newSubLayers,
function(c){c.layerObject.setOpacity&&c.layerObject.setOpacity(a)})},moveLayerByIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var c=this.getSubLayers(),d=0;d<c.length;d++)if(c[d].traversal(a))return!0},findLayerInfoById:function(a){var c=null,d=0;if(this.id&&this.id===a)return this;for(d=0;d<this.newSubLayers.length&&!(c=this.newSubLayers[d].findLayerInfoById(a));d++);return c},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},
_setTopLayerVisible:function(a){},setSubLayerVisible:function(a,c){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var c=a?a[this.id]:null;this.isRootLayer&&c&&this._resetLayerObjectVisiblity(a)},initVisible:function(){},isVisible:function(){return this._visible?!0:!1},_obtainLayerIndexesInMap:function(){var a=[],c;(c=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(c);return a},_getLayerIndexesInMapByLayerId:function(a){var c;
for(c=0;c<this.map.graphicsLayerIds.length;c++)if(this.map.graphicsLayerIds[c]===a)return{isGraphicLayer:!0,index:c};for(c=0;c<this.map.layerIds.length;c++)if(this.map.layerIds[c]===a)return{isGraphicLayer:!1,index:c};return null},_convertGeometryToMapSpatialRef:function(a){var c=new h;if(this.map.spatialReference.equals(a.spatialReference))return c.resolve([a]),c;if(this.map.spatialReference.isWebMercator()&&a.spatialReference.equals(new s(4326)))return c.resolve([q.geographicToWebMercator(a)]),
c;if(this.map.spatialReference.equals(new s(4326))&&a.spatialReference.isWebMercator())return c.resolve([q.webMercatorToGeographic(a)]),c;c=new d;c.geometries=[a];c.outSR=this.map.spatialReference;return l.defaults.geometryService.project(c)},_isShowInMapChanged:function(){var a=!1,c=this.isShowInMap();!1===c&&this.map.infoWindow.hide();this._oldIsShowInMap!==c&&(this._oldIsShowInMap=c,a=!0);return a},_isShowInMapChanged2:function(){var a=[];this.traversal(function(c){c._isShowInMapChanged()&&a.push(c)});
r.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){r.publish("layerInfos/layerInfo/visibleChanged",[this])},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return p.create("div",{"class":"legends-div"})},drawLegends:function(a,c){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_isItemLayer:function(){return this.originOperLayer.itemId||this.layerObject._itemId},
_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},getLayerObject:function(){var a=new h;this.layerObject?a.resolve(this.layerObject):a.resolve(null);return a},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},isShowInMap:function(){for(var a=
!0,c=this;c;)a=a&&c.isVisible(),c=c.parentLayerInfo;return a},getLayerType:function(){var a=[null],c=new h;this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));c.resolve(a[a.length-1]);return c},getPopupInfo:function(){return this.originOperLayer.popupInfo},loadInfoTemplate:function(){var a=new h;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:
null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=this,c=!0;a;)c=c&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return c},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new h,c={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},d=this.getLayerType(),f=this.getLayerObject();e({type:d,layerObject:f}).then(g.hitch(this,function(b){var d=b.type;b=b.layerObject;
c.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(c.isSupportedLayer=!0);if(b)if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())c.isSupportQuery=!1;else{if(!b.url||b.capabilities&&0<=b.capabilities.indexOf("Query"))c.isSupportQuery=!0}else c.isSupportQuery=!1;a.resolve(c)}),function(){a.resolve(c)});return a},getRelatedTableInfoArray:function(a){a=new h;a.resolve([]);return a},removeSubLayerById:function(a){var c=[];f.forEach(this.newSubLayers,function(d){d.id!==
a&&c.push(d)});this.newSubLayers=c},destroy:function(){f.forEach(this._eventHandles,function(a){a.remove()});this.inherited(arguments)},destroyLayerInfo:function(){f.forEach(this.newSubLayers,function(a){a.destroyLayerInfo()});this.destroy()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&
0<=this.layerObject.maxScale?{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},isCurrentScaleInTheScaleRange:function(){var a=this.getScaleRange(),c=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>c)&&(0===a.maxScale||c>a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,c=this;c&&!(a=c.isCurrentScaleInTheScaleRange(),c=c.parentLayerInfo,!a););return a},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},
getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},_bindEvent:function(){var d;this.layerObject&&!this.layerObject.empty&&(d=this.layerObject.on("visibility-change",g.hitch(this,this._onVisibilityChanged)),this._eventHandles.push(d),d=a.after(this.layerObject,"setDefinitionExpression",g.hitch(this,this._onFilterChanged)),this._eventHandles.push(d),d=a.after(this.layerObject,"setRenderer",g.hitch(this,this._onRendererChanged)),this._eventHandles.push(d))},_onVisibilityChanged:function(){this.initVisible();
this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=this._oldFilter?this._oldFilter:null,c=this.layerObject.getDefinitionExpression(),c=c?c:null;a!==c&&(r.publish("layerInfos/layerInfo/filterChanged",[this]),this._oldFilter=c)},_onRendererChanged:function(){r.publish("layerInfos/layerInfo/rendererChanged",[this])}})})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang ./LayerInfoFactory".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s){return n(a,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,constructor:function(a,d){this._initJsapiLayerInfos();this.initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup()},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:[]},_initJsapiLayerInfos:function(){var a=f.filter(this.originOperLayer.layers,function(a){return d.isDefined(a.id)&&
d.isDefined(a.name)&&d.isDefined(a.minScale)&&d.isDefined(a.maxScale)&&d.isDefined(a.parentLayerId)&&d.isDefined(a.defaultVisibility)});this._jsapiLayerInfos=0<a.length?a:this.layerObject.layerInfos},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:g.clone(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=g.clone(this.layerObject.infoTemplates);p.after(this.layerObject,"setInfoTemplates",g.hitch(this,function(){this.layerObject._infoTemplates=g.clone(this.layerObject.infoTemplates);
this.controlPopupInfo.infoTemplates=g.clone(this.layerObject.infoTemplates);this.traversal(function(a){a._afterSetInfoTemplates&&a._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new h}},initSubLayerVisible:function(a){this.subLayerVisible={};for(var d=0;d<this._jsapiLayerInfos.length;d++)this.subLayerVisible[this._jsapiLayerInfos[d].id]=0;a?f.forEach(a,function(a){this.subLayerVisible[a]++},this):this.originOperLayer.visibleLayers?
f.forEach(this.originOperLayer.visibleLayers,function(a){this.subLayerVisible[a]++},this):f.forEach(this._jsapiLayerInfos,function(a){a.defaultVisibility&&this.subLayerVisible[a.id]++},this)},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent)},_resetLayerObjectVisiblity:function(a){var e=a?a[this.id]:null;if(a&&(e&&this.layerObject.setVisibility(e.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===
this.layerObject.declaredClass)){var c=!1,g=[];f.forEach(this._jsapiLayerInfos,function(b){var e=this.id+"_"+b.id;d.isDefined(a[e])&&(c=!0,a[e].visible&&g.push(b.id))},this);if(c){this.initSubLayerVisible(g);this.traversal(function(a){a.initVisible()});var l={};this.traversal(function(a){0===a.getSubLayers().length&&(l[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});this.setSubLayerVisible(l)}}},initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){this.originOperLayer.layerObject.setVisibility(a);
this._visible=a},setSubLayerVisible:function(a){var d=[-1,-1,-1],c,e=[],g=f.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});f.forEach(g,function(a){this._isGroupLayerBySubId(a)||e.push(a)},this);var g=e,b;for(b in a)if(a.hasOwnProperty(b)&&"function"!==typeof a[b]){var l=Number(b);a[b]?(c=f.indexOf(g,l),0>c&&g.push(l)):(c=f.indexOf(g,l),0<=c&&g.splice(c,1))}d=d.concat(g);this.originOperLayer.layerObject.setVisibleLayers(d)},obtainNewSubLayers:function(){var a=[],d=
this.originOperLayer.layerObject,c=null,c="esri.layers.ArcGISDynamicMapServiceLayer"===d.declaredClass?"dynamic":"tiled";f.forEach(this._jsapiLayerInfos,function(e){var b=null,b=d.url+"/"+e.id,f=d.id+"_"+e.id;e.subLayerIds&&0<e.subLayerIds.length?(b={url:b,empty:!0},this._addNewSubLayer(a,b,f,e,c+"_group")):(b={url:b,empty:!0},this._addNewSubLayer(a,b,f,e,c))},this);var e=[];f.forEach(this._jsapiLayerInfos,function(c,b){var d=c.parentLayerId;if(-1!==d){for(var e=null,f=0;f<a.length;f++)if(a[f].mapService.subId===
d){e=a[f];break}(d=e)&&d.subLayers.push(a[b])}},this);f.forEach(this._jsapiLayerInfos,function(c,b){var d;-1===c.parentLayerId&&(d=s.getInstance().create(a[b]),e.push(d),d.init())},this);return e},_addNewSubLayer:function(a,d,c,e,f){a.push({layerObject:d,title:e.name||e.id||" ",id:c||" ",subLayers:[],mapService:{layerInfo:this,subId:e.id},selfType:"mapservice_"+f,parentLayerInfo:this})},_handleErrorSubLayer:function(a,d,c,e,f,b){a[d]={layerObject:null,title:b.name||b.id||" ",id:c||" ",subLayers:[],
mapService:{layerInfo:this,subId:e}}},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},getLegendInfo:function(a){var d=new h;this._legendInfo?d.resolve(this._legendInfo):this._legendRequest(a).then(g.hitch(this,function(a){this._legendInfo=a.layers;d.resolve(this._legendInfo)}),function(){d.reject()});return d},_legendRequest:function(a){return 10.01<=this.layerObject.version?this._legendRequestServer():
this._legendRequestTools(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",d={f:"json"};this.layerObject._params.dynamicLayers&&(d.dynamicLayers=e.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===d.dynamicLayers&&(d.dynamicLayers="[]"));return l({url:a,content:d,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(a){return l({url:a+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},
_createDynamicLayers:function(a){var d=[],c;f.forEach(a.dynamicLayerInfos||a.layerInfos,function(e){c={id:e.id};c.source=e.source&&e.source.toJson();var f;a.layerDefinitions&&a.layerDefinitions[e.id]&&(f=a.layerDefinitions[e.id]);f&&(c.definitionExpression=f);var b;a.layerDrawingOptions&&a.layerDrawingOptions[e.id]&&(b=a.layerDrawingOptions[e.id]);b&&(c.drawingInfo=b.toJson());c.minScale=e.minScale||0;c.maxScale=e.maxScale||0;d.push(c)});return d},_getLayerDefinition:function(){var a=new h;this._request(this.layerObject.url).then(g.hitch(this,
function(d){a.resolve(d)}),function(d){console.error(d.message||d);a.resolve(null)});return a},_getSublayerDefinition:function(a){var d;this._sublayerIdent.definitions[a]?(d=new h,d.resolve(this._sublayerIdent.definitions[a])):d=this._layerAndTableRequest(a);return d},_layerAndTableRequest:function(a){return 10.11<=this.layerObject.version?this._allLayerAndTableServer(a):this._allLayerAndTable(a)},_allLayerAndTableServer:function(a){var d=new h,c=this.layerObject.url+"/layers";this._sublayerIdent.empty?
(this._sublayerIdent.empty=!1,this._request(c).then(g.hitch(this,function(c){f.forEach(c.layers,function(a){this._sublayerIdent.definitions[a.id]=a},this);this._sublayerIdent.defLoad.resolve();d.resolve(this._sublayerIdent.definitions[a])}),g.hitch(this,function(a){console.error(a.message||a);this._sublayerIdent.defLoad.reject();this._sublayerIdent.defLoad=new h;this._sublayerIdent.empty=!0;d.resolve(null)}))):this._sublayerIdent.defLoad.then(g.hitch(this,function(){d.resolve(this._sublayerIdent.definitions[a])}),
function(a){console.error(a.message||a);d.resolve(null)});return d},_allLayerAndTable:function(a){var d=new h;this._request(this.layerObject.url+"/"+a).then(g.hitch(this,function(c){this._sublayerIdent.definitions[a]=c;d.resolve(c)}),function(a){console.error(a.message||a);d.resolve(null)});return d},_request:function(a){return l({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_getSublayerSettingOfWebmap:function(a){var d=f.filter(this.originOperLayer.layers,function(c){return c.id===
a});return 1===d.length?d[0]:null},_getSublayerShowLegendOfWebmap:function(a){return(a=this._getSublayerSettingOfWebmap(a))?void 0!==a.showLegend?a.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(a){return null===this._getJsapiLayerInfoById(a)?!1:!0},_getJsapiLayerInfoById:function(a){for(var d=null,c=0;c<this._jsapiLayerInfos.length;c++)this._jsapiLayerInfos[c].id===a&&(d=this._jsapiLayerInfos[c]);return d},_isGroupLayerBySubId:function(a){return(a=this._getJsapiLayerInfoById(a))&&a.subLayerIds&&
0<a.subLayerIds.length?!0:!1},_subLayerVisibleChanged:function(){var a=[];this.traversal(function(d){a.push(d)});r.publish("layerInfos/layerInfo/visibleChanged",a)},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visible-layers-change",g.hitch(this,this._onVisibleLayersChanged)),this._eventHandles.push(a),a=p.after(this.layerObject,"setLayerDefinitions",g.hitch(this,this._onFilterChanged)),this._eventHandles.push(a))},_onVisibleLayersChanged:function(a){var d=
a.visibleLayers;if(-1===d[0]&&-1===d[1]&&-1===d[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{a=[];var c=[-1,-1,-1],d=this._converVisibleLayers(d);a=d.visibleLayersForUpdateSubLayerVisible;c=c.concat(d.visibleLayersForSetVisibleLayers);this.initSubLayerVisible(a);this.traversal(function(a){a.initVisible()});this.layerObject.setVisibleLayers(c)}},_converVisibleLayers:function(a){var d={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};f.forEach(a,function(c){var d=
this.findLayerInfoById(this.id+"_"+c);if(this._isGroupLayerBySubId(c))d.traversal(function(c){a.push(c.originOperLayer.mapService.subId)});else for(;d&&d.originOperLayer.mapService;)a.push(d.originOperLayer.mapService.subId),d=d.parentLayerInfo},this);f.forEach(a,function(a){0>d.visibleLayersForUpdateSubLayerVisible.indexOf(a)&&d.visibleLayersForUpdateSubLayerVisible.push(a)},this);f.forEach(d.visibleLayersForUpdateSubLayerVisible,function(a){this._isGroupLayerBySubId(a)||d.visibleLayersForSetVisibleLayers.push(a)},
this);return d},_onFilterChanged:function(){for(var a,d=[],c=this.layerObject.layerDefinitions,e=c.length>this._oldFilter.length?c.length:this._oldFilter.length,f=0;f<e;f++)if((c[f]?c[f]:null)!==(this._oldFilter[f]?this._oldFilter[f]:null))(a=this.findLayerInfoById(this.id+"_"+f))&&a.isLeaf()&&d.push(a);0<d.length&&(r.publish("layerInfos/layerInfo/filterChanged",d),this._oldFilter=c)}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefault ./LayerInfoFactory dojo/Deferred".split(" "),
function(n,f,g,h,e,p,r,a,l){return n(p,{constructor:function(){},getExtent:function(){var a=this.originOperLayer.layerObject.getLayers(),e=null,g;f.forEach(a,function(a){g=this._convertGeometryToMapSpatialRef(a.initialExtent);e=e?e.union(g):g},this);return e},_resetLayerObjectVisiblity:function(a){var e=a?a[this.id]:null;e&&(f.forEach(this.newSubLayers,function(e){var f=a?a[e.id]:null;f&&e.layerObject.setVisibility(f.visible)},this),this._setTopLayerVisible(e.visible))},initVisible:function(){var a=
!1,e;for(e=0;e<this.newSubLayers.length;e++)a=a||this.newSubLayers[e].layerObject.visible;a&&(this._visible=!0)},_setTopLayerVisible:function(a){this._visible=a?!0:!1;f.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var d=[],e=this.originOperLayer.layerObject.getLayers();f.forEach(e,function(e){this._getLayerIndexesInMapByLayerId(e.id)&&(e=a.getInstance().create({layerObject:e,title:e.label||e.title||e.name||
e.id||" ",id:e.id||" ",collection:{layerInfo:this},selfType:"kml",parentLayerInfo:this}),d.push(e),e.init())},this);return d}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo ./LayerInfos dojox/gfx dojo/dom-construct dojo/dom-attr dojo/aspect jimu/portalUrlUtils jimu/utils esri/symbols/jsonUtils esri/dijit/PopupTemplate esri/dijit/Legend".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m){var t=n(e,{_legendsNode:null,
controlPopupInfo:null,constructor:function(){this._initControlPopup()},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},_getLayerOptionsForCreateLayerObject:function(){var a={};a.id=this.id;var c=[],d=this.getInfoTemplate();d&&d.info&&d.info.fieldInfos?f.forEach(d.info.fieldInfos,function(a){a.visible&&c.push(a.fieldName)},this):c=["*"];a.outFields=c;return a},getExtent:function(){var a=
this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent;if(a)return this._convertGeometryToMapSpatialRef(a);a=new h;a.resolve(null);return a},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=this.layerObject.visible)},initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,
c=this.layerObject.visible;if(a._oldIsShowInMap!==a.isShowInMap())return;this._visible=c?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;d.after(this.layerObject,"setInfoTemplate",g.hitch(this,function(){this.layerObject._infoTemplate=
this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}))},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),
this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},createLegendsNode:function(){var b=a.create("div",{"class":"legends-div jimu-leading-margin1",legendsDivId:this.id},document.body);a.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},b);return b},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(b){if(this.layerObject&&
!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){a.empty(b);var c=new m({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:m.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},a.create("div",{},b));c.startup();b._legendDijit=c}},_initLegendsNode:function(b){var c=[],d=this.layerObject;if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length))a.empty(b),
d.renderer&&(d.renderer.infos?c=g.clone(d.renderer.infos):c.push({label:d.renderer.label,symbol:d.renderer.symbol}),d.renderer&&(d.renderer.defaultSymbol&&0<c.length)&&c.push({label:d.renderer.defaultLabel||"others",symbol:d.renderer.defaultSymbol}),f.forEach(c,function(c){c.legendDiv=a.create("div",{"class":"legend-div"},b);c.symbolDiv=a.create("div",{"class":"legend-symbol jimu-float-leading"},c.legendDiv);c.labelDiv=a.create("div",{"class":"legend-label jimu-float-leading",innerHTML:c.label||" "},
c.legendDiv);if("textsymbol"===c.symbol.type)l.set(c.symbolDiv,"innerHTML",c.symbol.text);else{var d=r.createSurface(c.symbolDiv,50,50);c=k.getShapeDescriptors(c.symbol);d.createShape(c.defaultShape).setFill(c.fill).setStroke(c.stroke).setTransform(r.matrix.translate(25,25))}},this))},obtainNewSubLayers:function(){var a=[];this.originOperLayer.subLayers&&0!==this.originOperLayer.subLayers.length&&f.forEach(this.originOperLayer.subLayers,function(c){c=new t(c,this.map);a.push(c);c.init()},this);return a},
getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},_getDefaultPopupTemplate:function(a){var d=null;if(a&&a.fields){var e={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]};f.forEach(a.fields,function(c){if(c.name!==a.objectIdField&&"globalid"!==c.name.toLowerCase()&&"shape"!==c.name.toLowerCase()){var d=q.getDefaultPortalFieldInfo(c);d.visible=!0;d.isEditable=
c.editable;e.fieldInfos.push(d)}});d=new c(e)}return d},enablePopup:function(){return this.loadInfoTemplate().then(g.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?!0:!1},loadInfoTemplate:function(){var a=
new h;this.controlPopupInfo.infoTemplate||(this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject));a.resolve(this.controlPopupInfo.infoTemplate);return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedUrls:function(a,c){var d=[];if(!a||!a.url||!a.relationships)return d;var e=a.url.lastIndexOf("/"),g=a.url.slice(0,e);f.forEach(a.relationships,function(a){(!c||!a.role||c===a.role)&&d.push(g+"/"+a.relatedTableId.toString())},this);return d},
getRelatedTableInfoArray:function(a){var c=[],d=new h;this.getLayerObject().then(g.hitch(this,function(e){var k=this._getRelatedUrls(e,a);0!==k.length&&p.getInstanceSync().traversalAll(g.hitch(this,function(a){var b=-1;if(0===k.length)return!0;f.forEach(k,function(d,e){g.getObject("layerObject.url",!1,a)&&s.removeProtocol(d.toString().replace(/\/+/g,"/").toLowerCase())===s.removeProtocol(a.layerObject.url.toString().replace(/\/+/g,"/").toLowerCase())&&(c.push(a),b=e)},this);0<=b&&k.splice(b,1);return!1}));
d.resolve(c)}),g.hitch(this,function(){d.resolve(c)}));return d},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(a){this.layerObject&&(!this.layerObject.empty&&this.layerObject.setDefinitionExpression)&&this.layerObject.setDefinitionExpression(a)}});return t})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A,w,C,u,E,D,B,G,I,K,R,N,P,J,H,O,L,M,F){var Q=f([M,b],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new r([64,64,64]),defaultText:"Aa",sizeRampLightColor:new r([255,255,255]),sizeRampDarkColor:new r([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,
_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(b,c){g.mixin(this,F.widgets.legend);this._i18n=F.widgets.legend;b=b||{};b.map?c?(this.map=b.map,this.layerInfos=b.layerInfos,this._respectCurrentMapScale=!1===b.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===b.respectVisibility?!1:!0,this.arrangement=b.arrangement===Q.ALIGN_RIGHT?Q.ALIGN_RIGHT:Q.ALIGN_LEFT,this.arrangement===Q.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===b.autoUpdate?!1:!0,this._surfaceItems=
[],this.hideLayersInLegend={},this.refresh=a(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],n.locale&&-1!==n.locale.indexOf(c)&&(-1!==n.locale.indexOf("-")?-1!==n.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=
this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>l("ie")&&(this._repaintItems=g.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?
(this.layerInfos=a,this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=
this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)c.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,
this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];h.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==
c.declaredClass&&(d=c.getLayers(),h.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(d=c.getFeatureLayers(),h.forEach(d,function(a){b.push(a.id)},this))},this);h.forEach(this.map.graphicsLayerIds,function(c){var d=this.map.getLayer(c);-1==h.indexOf(a,c)&&-1==h.indexOf(b,c)&&(this._isSupportedLayerType(d)&&d._params&&d._params.drawMode)&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},
_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=e.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=e.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=e.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=e.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),h.forEach(this.layers,function(a){var b={};b.ovcConnect=e.connect(a,"onVisibilityChange",
this,"_refreshLayers");b.oocConnect=e.connect(a,"onOpacityChange",this,"_refreshLayers");b.oscConnect=e.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(b.odcConnect=e.connect(a,"_onDynamicLayersChange",g.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(b.oirConnect=e.connect(a,"onRenderingChange",g.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass&&(b.oivrConnect=e.connect(a,"onRendererChange",g.hitch(this,"_refreshLayers")));this.layerConnects[a.id]=b},this))},_deactivate:function(){this._ozeConnect&&e.disconnect(this._ozeConnect);this._olaConnect&&e.disconnect(this._olaConnect);this._olroConnect&&e.disconnect(this._olroConnect);this._olrConnect&&e.disconnect(this._olrConnect);h.forEach(this.layers,function(a){a=this.layerConnects[a.id]||{};a.ovcConnect&&e.disconnect(a.ovcConnect);a.oocConnect&&e.disconnect(a.oocConnect);a.oscConnect&&
e.disconnect(a.oscConnect);a.odcConnect&&e.disconnect(a.odcConnect);a.oirConnect&&e.disconnect(a.oirConnect);a.oivrConnect&&e.disconnect(a.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];h.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&
this.layers.push(a)},this);h.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1,b=!1;m.set(this.domNode,"position","relative");c.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var d=[];h.forEach(this.layers,function(f){if("esri.layers.KMLLayer"==f.declaredClass||"esri.layers.GeoRSSLayer"==
f.declaredClass){var k;f.loaded?("esri.layers.KMLLayer"==f.declaredClass?k=f.getLayers():"esri.layers.GeoRSSLayer"==f.declaredClass&&(k=f.getFeatureLayers(),this.hideLayersInLegend[f.id]&&(k=h.filter(k,function(a){return-1==h.indexOf(this.hideLayersInLegend[f.id],a.id)},this))),h.forEach(k,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&f._titleForLegend&&(a._titleForLegend=f._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==
a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),d.push(a))},this)):e.connect(f,"onLoad",g.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===f.declaredClass)if(f.loaded){if((!this._respectVisibility||this._respectVisibility&&f.visible)&&0<f.layerInfos.length&&h.some(f.layerInfos,function(a){return a.legendURL})){var m=!1;h.forEach(f.layerInfos,function(b){if(b.legendURL&&-1<h.indexOf(f.visibleLayers,
b.name)){m||(c.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(f._titleForLegend||f.name||f.id)+"\x3c/span\x3e"},this.domNode),m=!0);var d;b=b.legendURL;if(f.customParameters||f.customLayerParameters){var e=g.clone(f.customParameters||{});g.mixin(e,f.customLayerParameters||{});for(d in e)b+=(-1===b.indexOf("?")?"?":"\x26")+d+"\x3d"+e[d]}c.create("div",{innerHTML:"\x3cimg src\x3d'"+b+"'/\x3e"},this.domNode);a=!0}},this)}}else e.connect(f,"onLoad",g.hitch(this,function(){this.refresh(this.layerInfos)}));
else"esri.layers.WFSLayer"===f.declaredClass&&!f.renderer?(k=c.create("div",{id:this.id+"_"+f.id,"class":"esriLegendService"}),c.create("span",{innerHTML:this._getServiceTitle(f),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},k))))),c.place(k,this.id,"first"),tableNode=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),tableBody=c.create("tbody",{},tableNode),"esriGeometryComplex"===
f.geometryType?(this._buildRow_Renderer(f,f._pointSymbol,null,this.NLS_points,null,tableBody),this._buildRow_Renderer(f,f._lineSymbol,null,this.NLS_lines,null,tableBody),this._buildRow_Renderer(f,f._polygonSymbol,null,this.NLS_areas,null,tableBody)):"esriGeometryPoint"===f.geometryType?this._buildRow_Renderer(f,f._pointSymbol,null,"",null,tableBody):"esriGeometryPolyline"===f.geometryType?this._buildRow_Renderer(f,f._lineSymbol,null,"",null,tableBody):"esriGeometryPolygon"===f.geometryType&&this._buildRow_Renderer(f,
f._polygonSymbol,null,"",null,tableBody),b=!0):d.push(f)},this);var f=[];h.forEach(d,function(a){if(a.loaded){if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=c.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});c.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",
{},c.create("table",{width:"95%"},b)))));c.place(b,this.id,"first");a.legendResponse||a.renderer?this._createLegendForLayer(a):f.push(this._legendRequest(a))}}else var d=e.connect(a,"onLoad",this,function(a){e.disconnect(d);d=null;this.refresh()})},this);0===f.length&&!a&&!b?(k.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new s(f)).addCallback(g.hitch(this,function(c){!a&&!b?k.byId(this.id+"_msg").innerHTML=this.NLS_noLegend:k.byId(this.id+"_msg").innerHTML="";this._activate()}))},
_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var b=!1;if(a.legendResponse){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?h.forEach(c,function(c,d){if(!this.hideLayersInLegend[a.id]||-1===h.indexOf(this.hideLayersInLegend[a.id],c.id)){var e=this._buildLegendItems(a,c,d);b=b||e}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+
1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(m.set(k.byId(this.id+"_"+a.id),"display","block"),m.set(k.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);e.connect(a,"onLoad",g.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";
(c=a._getToken())&&(b+="?token\x3d"+c);var d=g.hitch(this,"_processLegendResponse"),e={f:"json"};a._params.dynamicLayers&&(e.dynamicLayers=q.stringify(this._createDynamicLayers(a)),"[{}]"===e.dynamicLayers&&(e.dynamicLayers="[]"));a._params.bandIds&&(e.bandIds=a._params.bandIds);a._params.renderingRule?e.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&h.forEach(a.rasterFunctionInfos,function(a){a&&(a.name&&"none"===a.name.toLowerCase())&&(e.renderingRule=
q.stringify({rasterFunction:a.name}))});return C({url:b,content:e,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:w.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!l("ie")||8<l("ie"))b+="\x26returnbytes\x3dtrue";var c=g.hitch(this,"_processLegendResponse");return C({url:b,content:{f:"json"},callbackParamName:"callback",
load:function(b,d){c(a,b,d)},error:w.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,k.byId(this.id+"_"+a.id)&&c.empty(k.byId(this.id+"_"+a.id)),c.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},k.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+
p.toJson(b))},_buildLegendItems:function(a,b,d){var e=!1,f=k.byId(this.id+"_"+a.id),g=b.parentLayerId;if(b.subLayerIds)a=c.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==g?0<d?"esriLegendGroupLayer":"":this._legendAlign},-1==g?f:k.byId(this.id+"_"+a.id+"_"+g+"_group")),c.create("td",{innerHTML:y.encode(b.name),align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&
a.visibleLayers)if(d=a.dynamicLayerInfos||a.layerInfos)if(a._params&&a._params.layers){if(-1===h.indexOf(a.visibleLayers,b.id))return e}else{if(d=this._getReallyVisibleLayers(d,a.visibleLayers),-1===h.indexOf(d,b.id))return e}else if(-1===h.indexOf(a.visibleLayers,b.id))return e;f=c.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<g?this._legendAlign:""},-1==g?f:k.byId(this.id+"_"+a.id+"_"+g+"_group"));c.create("td",{innerHTML:y.encode(b.name)||"",align:this._align},c.create("tr",
{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},f))));a.legendResponse?e=e||this._buildLegendItems_Tools(a,b,f):a.renderer&&(e=e||this._buildLegendItems_Renderer(a,b,f))}return e},_getReallyVisibleLayers:function(a,b){if(!a||!b||!b.length)return[];var c=[],d=[],e;for(e=0;e<a.length;e++)if(a[e].subLayerIds){if(-1===h.indexOf(b,a[e].id)||-1<h.indexOf(d,a[e].id))d=d.concat(a[e].subLayerIds)}else-1<h.indexOf(b,a[e].id)&&-1===h.indexOf(d,a[e].id)&&c.push(a[e].id);return c},
_buildLegendItems_Tools:function(a,b,d){var e=b.parentLayerId,f=this.map.getScale(),g=!1,l=function(a,b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,b,f)){var q=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||
"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var p=this._getEffectiveScale(a,b);if(p.minScale&&p.minScale<f||p.maxScale&&p.maxScale>f)q=!1}if(q){var f=l(a.legendResponse.layers,b),r=f.legendType,n=f.layerType,s=f.legend;if(s){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,f,b);d=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);var v=c.create("tbody",{},d);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(d,
a,b);h.forEach(s,function(c){if(!(10.1<=a.version&&!c.values&&1<s.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===c.label||!c.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version||"Raster Layer"===n))))if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)g=!0,this._buildRow_Tools(c,v,a,b.id,r)},this)}}}g&&(m.set(k.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<e&&(m.set(k.byId(this.id+"_"+a.id+"_"+e+"_group"),"display","block"),this._findParentGroup(a.id,
a,e)));return g},_sanitizeLegendResponse:function(a,b,c){var d=b.legend;if(10.1<=a.version&&1<d.length&&!b._sanitized){a=g.getObject("layerDefinition.drawingInfo.renderer",!1,c);var e,f;a||(a=g.getObject("drawingInfo.renderer",!1,c));h.some(d,function(a){if(a.values)return!0})&&h.some(d,function(a,b){a.values||(f=b,e=a);return!!e});a?"uniqueValue"===a.type?e&&(d.splice(f,1),d.push(e)):"classBreaks"===a.type&&(e&&d.splice(f,1),d.reverse(),e&&d.push(e)):e&&(d.splice(f,1),d.push(e));b._sanitized=!0}},
_buildRow_Tools:function(a,b,d,e,f){var g=c.create("tr",{},b),k;this.alignRight?(b=c.create("td",{align:this._isRightToLeft?"left":"right"},g),k=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},g)):(k=c.create("td",{width:35,align:"center"},g),b=c.create("td",{},g));g=a.url;(!l("ie")||9<=l("ie")||9>l("ie")&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass)&&a.imageData&&0<a.imageData.length?g="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(g=d.url+"/"+e+"/images/"+
a.url,(e=d._getToken())&&(g+="?token\x3d"+e));e=c.create("img",{src:g,border:0,style:"opacity:"+d.opacity},k);a=c.create("td",{innerHTML:y.encode(a.label),align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%",dir:"ltr"},b))));f&&("Stretched"===f&&10.3<=d.version&&"esri.layers.ArcGISImageServiceLayer"===d.declaredClass)&&(a.style.verticalAlign="top",a.style.lineHeight="1",e.style.marginBottom="-1px",e.style.display="block",b.style.verticalAlign="top");9>l("ie")&&(e.style.filter=
"alpha(opacity\x3d"+100*d.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getVariables:function(a,b,c){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?h.filter(a,function(a){return!(!a||!(a.field===b&&a.normalizationField==c))}):a},_getFieldAlias:function(a,b){var c=b.infoTemplate,c=c&&c.getFieldInfo&&c.getFieldInfo(a),d=g.isFunction(a)?null:b.getField(a),e=c||d,
f="";e&&(f=c&&c.label||d&&d.alias||e.name||e.fieldName);return f},_getRampTitle:function(a,b){var c,d=a.field,e=a.normalizationField,f=!1,k=!1,m=!1,l,d=g.isFunction(d)?null:d,e=g.isFunction(e)?null:e;if(a.legendOptions&&a.legendOptions.title)c=a.legendOptions.title;else{if(b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var q=b.renderer.authoringInfo.visualVariables;for(l=0;l<q.length;l++){var h=q[l];if("colorInfo"===h.type&&"ratio"===h.style){f=!0;break}else if("colorInfo"===
h.type&&"percent"===h.style){k=!0;break}else if("colorInfo"===h.type&&"percentTotal"===h.style){m=!0;break}}}(f=m&&"showRatioPercentTotal"||k&&"showRatioPercent"||f&&"showRatio"||e&&"showNormField"||d&&"showField"||null)&&(c=u.substitute({field:d&&this._getFieldAlias(d,b),normField:e&&this._getFieldAlias(e,b)},this._i18n[f]))}return c},_getRendererTitle:function(a,b){var c;if(a){var d,e,f;a instanceof I&&(d=a.attributeField,e=a.normalizationField,f="percent-of-total"===a.normalizationType);d=g.isFunction(d)?
null:d;e=g.isFunction(e)?null:e;a.legendOptions&&a.legendOptions.title?c=a.legendOptions.title:(f=e&&"showNormField"||(f?"showNormPct":null)||d&&"showField"||null)&&(c=u.substitute({field:d&&this._getFieldAlias(d,b),normField:e&&this._getFieldAlias(e,b)},this._i18n[f]))}return c},_buildLegendItems_Renderer:function(a,b,d){var e=b.parentLayerId,f=this.map,l=f.getScale(),q,p=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,l)){var r,n,s="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?
a.renderer.renderer:a.renderer,v,w,t,x,A;if(s instanceof K&&(s=(s="zoom"===s.rangeType?s.getRendererInfoByZoom(f.getZoom()):s.getRendererInfoByScale(l))&&s.renderer,!s))return!1;var u=this._getVariables(s),C=h.filter(u,function(a){return!!a}).length,l=u[0],f=u[1],u=u[2],D,E;l&&(v=this._getMedianColor(s,l),l.field&&(t=g.isFunction(l.field)?null:a.getField(l.field)));f&&f.field&&(A=g.isFunction(f.field)?null:a.getField(f.field));u&&u.field&&(x=g.isFunction(u.field)?null:a.getField(u.field));if(s instanceof
J)q=p=!0,this._showHeatRamp(a,b,s,d);else if(s instanceof R)q=p=!0,this._showDotDensityLegend(a,b,s,d);else if(s instanceof N)q=p=!0,n=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),r=c.create("tbody",{},n),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(n,a,b),s.latestObservationRenderer&&s.latestObservationRenderer instanceof B&&this._buildRow_Renderer(a,s.latestObservationRenderer.symbol,v,y.encode(s.latestObservationRenderer.label)||this.NLS_currentObservations,
null,r),s.observationRenderer&&s.observationRenderer instanceof B&&this._buildRow_Renderer(a,s.observationRenderer.symbol,v,y.encode(s.observationRenderer.label)||this.NLS_previousObservations,null,r);else if(s instanceof G){if(s.infos&&0<s.infos.length){q=p=!0;n=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);r=c.create("tbody",{},n);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(n,a,b);s.attributeField&&u&&this._addSubHeader(r,this._getFieldAlias(s.attributeField,
a));var H=[];h.forEach(s.infos,function(b){var c=null;a._editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var d=b.label;null==d&&(d=b.value);-1===h.indexOf(H,d)&&(H.push(d),this._buildRow_Renderer(a,b.symbol,v,y.encode(d),c,r))},this)}E=this._displayDefaultSymbol(a,s,d)}else if(s instanceof I){if(s.infos&&0<s.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){q=p=!0;D=this._isUnclassedRenderer(s);!l&&1===s.infos.length&&(w=(w=s.infos[0])&&w.symbol);D||(n=
c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),r=c.create("tbody",{},n),C=this._getRendererTitle(s,a),this._buildRow_Renderer(a,null,v,y.encode(C),null,r));n=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);r=c.create("tbody",{},n);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(n,a,b);if(!D||!u)C=s.infos.slice(0).reverse(),h.forEach(C,function(b){var c=b.label;null==c&&!D&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,
b.symbol,v,y.encode(c),null,r)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===P.STYLE_SCALAR||a.renderer.style===P.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,s.defaultSymbol,null,"",null,r),a._hideDefaultSymbol=!0}D||(E=this._displayDefaultSymbol(a,s,d))}else s instanceof B&&(q=p=!0,n=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),r=c.create("tbody",{},n),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(n,
a,b),w=null,a._editable&&(a.templates&&0<a.templates.length)&&(w=a.templates[0]),n=1<C?null:t||A||x,this._buildRow_Renderer(a,s.symbol,v,y.encode(n?this._getRampTitle(1<C?null:l||f||u,a):s.label),w,r),w=l?null:s.symbol,n&&(t=A=x=null));if(q){if(l&&(l.field||l.valueExpression))this._showGradientRamp(a,b,s,null,d,l,t,null,u?!0:!1);if(u&&(u.field||u.valueExpression))q=l||s instanceof G?!1:!0,this._showSizeLegend(a,b,s,u,v,d,x,null,q);if(f&&(f.field||f.valueExpression))x=w&&!w.url&&w.color?w.color:this.transparencyRampColor,
this._showGradientRamp(a,b,s,x,d,f,A,null,!1)}E||(E=this._displayDefaultSymbol(a,s,d));p=p||E}p&&(m.set(k.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<e&&(m.set(k.byId(this.id+"_"+a.id+"_"+e+"_group"),"display","block"),this._findParentGroup(a.id,e)));return p},_isUnclassedRenderer:function(a,b){var c;if(a instanceof I&&a.infos&&1===a.infos.length){c=a.attributeField;var d=a.normalizationField;c=b?c===b:!!this._getVariables(a,c,d).length}return c},_displayDefaultSymbol:function(a,b,d){var e;
!a._hideDefaultSymbol&&b.defaultSymbol&&(e=!0,d=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d),d=c.create("tbody",{},d),this._buildRow_Renderer(a,b.defaultSymbol,null,y.encode(b.defaultLabel)||"others",null,d));return e},_showGradientRamp:function(a,b,d,e,f,k,m,l,q){q=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(!q?" esriLegendSubFragment":"")},f);f=c.create("tbody",{},q);(a._hoverLabel||a._hoverLabels||l)&&this._createHoverAction(q,
a,b,l);(m||k.valueExpression)&&this._addSubHeader(f,this._getRampTitle(k,a));b=k.field;var h;b&&(h=g.isFunction(b)?null:a.getField(b));(k=this._getRampStops(d,k,e,h&&"esriFieldTypeDate"===h.type))&&k.length&&this._drawGradientRamp(f,k,!0,a,this._getRampBorderColor(d),!!e)},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c,d){var e,
f,g,k,m=!1;b.colors||b.opacityValues?(f=b.maxDataValue-b.minDataValue,e=h.map([0,0.25,0.5,0.75,1],function(a){g=b.minDataValue+a*f;return Number(g.toFixed(6))}),this._checkPrecision(0,4,e)):b.stops&&(e=h.map(b.stops,function(a){return a.value}),(m=h.some(b.stops,function(a){return!!a.label}))&&(k=h.map(b.stops,function(a){return a.label})));var l=e[0],q,p;f=e[e.length-1]-l;return h.map(e,function(g,h){c?(q=new r(c.toRgba()),p=a.getOpacity(g,{opacityInfo:b}),null!=p&&(q.a=p)):q=a.getColor(g,{colorInfo:b});
var s="";if(m)s=k[h];else{var s=d?D.formatDate(g,D.timelineDateFormatOptions):E.format(g),n="";0===h?n=this._specialChars.lt+" ":h===e.length-1&&(n=this._specialChars.gt+" ");s=n+s}return{value:g,color:q,offset:1-(g-l)/f,label:s}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,e=c[a],f=c[d],g=c[b],k=Math.floor(e),m=Math.floor(f),l=Math.floor(g);k===e&&(l===g&&m!==f&&k!==m&&l!==m)&&(c[d]=m);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;
if(a instanceof B)b=a.symbol;else if(a instanceof G||a instanceof I)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,b,d,e,f,g){var k=c.create("tr",{},a),q,p,s,n,w,t=b.length-1,x;n=0;this.alignRight?(a=c.create("td",{align:this._isRightToLeft?"left":"right"},k),q=c.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},k)):(q=c.create("td",{width:this.gradientWidth,align:"center"},k),a=c.create("td",
{},k));k=f&&0<f.a&&!(240<=f.r&&240<=f.g&&240<=f.b);p=c.create("div",{"class":k?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},q);q=c.create("div",{"class":"esriLegendColorRamp"+(g?" esriLegendTransparencyRamp":"")},p);g=m.get(q,"width");k&&(f=9>l("ie")?f.toHex():"rgba("+f.toRgba().join(",")+")",m.set(q,"border",this.colorRampBorder+" "+f));d?(f=this.gradientHeight*t,m.set(q,"height",f+"px")):f=m.get(q,"height");m.set(p,"height",f+"px");k=v.createSurface(q,
g,f);9>l("ie")&&(n=k.getEventSource(),m.set(n,"position","relative"),m.set(n.parentNode,"position","relative"),n=1);try{d&&h.forEach(b,function(a,b){a.offset=b/t}),w=k.createRect({x:-n,y:-n,width:g+n,height:f+n}),w.setFill({type:"linear",x1:0,y1:0,x2:0,y2:f,colors:b}).setStroke(null),k.createRect({width:g,height:f}).setFill(new r([255,255,255,1-e.opacity])).setStroke(null),this._surfaceItems.push(k)}catch(u){k.clear(),k.destroy()}h.forEach(b,function(a,d){if(a.label){x="top:"+100*a.offset+"%;";var e=
"";0===d&&(e+=" esriLegendColorRampTickFirst");d===b.length-1&&(e+=" esriLegendColorRampTickLast");c.create("div",{"class":"esriLegendColorRampTick"+e,innerHTML:"\x26nbsp;",style:x},p)}});s=c.create("div",{"class":"esriLegendColorRampLabels",style:{height:f+this.gradientHeight+"px"}},a);d?h.forEach(b,function(a){c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:y.encode(a.label)||"\x26nbsp;"},s)}):(c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},s),c.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(f+this.gradientHeight-2*this.gradientHeight)+"px;"},s))},_showHeatRamp:function(a,b,d,e,f){var g,k=d.field;g=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=c.create("tbody",{},g);(a._hoverLabel||a._hoverLabels||f)&&this._createHoverAction(g,a,b,f);(k=k&&a.getField(k))&&this._addSubHeader(e,this._getFieldAlias(k.name,a));b=this._getHeatmapStops(d);b.length&&this._drawGradientRamp(e,
b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,d,e,f;if(b&&b[0])if(c=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[c])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),c++}else d=b[0].value,e=b[c].value-d,b=h.map(b,function(a){return{color:a.color,ratio:(a.value-d)/e}});else a&&a[0]&&(c=a.length-1,f=1/(a.length-1),b=h.map(a,function(a,b){return{color:a,ratio:b*f}}));b=h.map(b,function(a,b){var d="";0===b?d="Low":b===c&&(d="High");return{color:a.color,label:d,offset:1-
a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,b,d,e){var f=d.legendOptions,k,m,l,q,p,r,s,n=this.dotDensitySwatchSize,v=Math.round(n/2);f&&(m=f.backgroundColor,l=f.outline,q=f.valueUnit,p=f.dotCoverage);p=(p||this.dotCoverage)/100;s=Math.round(n*n/Math.pow(d.dotSize,2)*p);e=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);r=c.create("tbody",{},e);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(e,a,b);this._addSubHeader(r,u.substitute({value:d.dotValue,
unit:q||""},this.NLS_dotValue));h.forEach(d.fields,function(b){b=g.mixin({},b);b.numPoints=s;k=new H(d._generateImageSrc(n,n,[b],{x:0,y:0},{x:n,y:n},m),l||d.outline,n,n);b=a.getField(b.name)||b;this._buildRow_Renderer(a,k,null,y.encode(this._getFieldAlias(b.name,a)),null,r,{type:"path",path:"M "+-v+","+-v+" L "+v+","+-v+" L "+v+","+v+" L "+-v+","+v+" L "+-v+","+-v+" E"})},this)},_showSizeLegend:function(a,b,d,e,f,k,m,l,q){var h=e.legendOptions,h=h&&h.customValues;f=this._getSizeSymbol(d,f);if(!(e.valueUnit&&
"unknown"!==e.valueUnit||!f||!h&&(null==e.minSize||null==e.maxSize))){q=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(!q?" esriLegendSubFragment":"")},k);k=c.create("tbody",{},q);(a._hoverLabel||a._hoverLabels||l)&&this._createHoverAction(q,a,b,l);(m||e.valueExpression)&&this._addSubHeader(k,this._getRampTitle(e,a));b=e.field;var p;b&&(p=g.isFunction(b)?null:a.getField(b));p=p&&"esriFieldTypeDate"===p.type;h=h||this._getDataValues(d,f,e,p);for(b=q=h.length-1;0<=
b;b--)m=h[b],f=L.fromJson(f.toJson()),this._applySize(f,d,e,m),m=p?D.formatDate(m,D.timelineDateFormatOptions):E.format(m),l="",b===q?l=this._specialChars.gt+" ":0===b&&(l=this._specialChars.lt+" "),l="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+y.encode(l+m)+"\x3c/span\x3e",this._buildRow_Renderer(a,f,null,l,null,k)}},_getSizeSymbol:function(a,b){var c,d;if(a instanceof B)c=a.symbol;else if(a instanceof P)c=a.defaultSymbol;else if(a instanceof G||a instanceof I)c=a.infos[0].symbol,d=1<a.infos.length;
if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=L.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?c.setColor(new r(this.sizeRampDarkColor)):(c.setColor(new r(this.sizeRampLightColor)),c.setOutline&&(d=new O,d.setColor(new r(this.sizeRampDarkColor)),d.setWidth(1.5),c.setOutline(d)));return c},_getDataValues:function(a,b,c,d,e,f){e=null==e?5:e;f=null==f?20:f;var g=a.getSizeRangeAtScale(c,this.map.getScale());e=this._interpolateSizeRange(g,e);var k=h.map(e,function(a){return this._getDataValueFromSize(a,
c,g)},this);if(!d){var m,k=E.round(k);for(d=1;d<k.length-1;d++)if(m=this._roundDataValue(a,b,c,k[d],k[d-1],f))k[d]=m[0],e[d]=m[1]}return k},_interpolateSizeRange:function(a,b){var c=a.minSize,d=(a.maxSize-c)/(b-1),e,f=[];for(e=0;e<b;e++)f.push(c+d*e);return f},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var e=b.minDataValue;b=b.maxDataValue;return a=a<=d?e:a>=c?b:(a-d)/(c-d)*(b-e)+e},_roundDataValue:function(a,b,c,d,e,f){var g=this._getSize(b,a,c,d);e=this._getSize(b,a,c,e);
var k,m=E.getDigits(d),l=m.integer,m=m.fractional,q,h,p,r,s,n,v,w,t,y,x;0<d&&1>d&&(k=Math.pow(10,m),d*=k,l=E.getDigits(d).integer);for(l-=1;0<=l&&!(q=Math.pow(10,l),m=Math.floor(d/q)*q,q*=Math.ceil(d/q),null!=k&&(m/=k,q/=k),h=(m+q)/2,h=E.round([m,h,q],{indexes:[1]})[1],p=this._getSize(b,a,c,m),r=this._getSize(b,a,c,q),s=this._getSize(b,a,c,h),n=E.getPctChange(g,p,e,null),v=E.getPctChange(g,r,e,null),w=E.getPctChange(g,s,e,null),t=n.prev<=f,y=v.prev<=f,t&&y&&(n.prev<=v.prev?(t=!0,y=!1):(y=!0,t=!1)),
t?x=[m,p]:y?x=[q,r]:w.prev<=f&&(x=[h,s]),x);l--);return x},_applySize:function(a,b,c,d){var e=a.type;b=this._getSize(a,b,c,d);switch(e){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":e=a.width;c=a.height;a.setHeight(b);a.setWidth(b*(e/c));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?
a.style:null})},_buildRow_Renderer:function(a,b,d,e,f,g,k){var m=c.create("tr",{},g),l;this.alignRight?(g=c.create("td",{align:this._isRightToLeft?"left":"right"},m),b&&(l=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},m))):(b&&(l=c.create("td",{width:35,align:"center"},m)),g=c.create("td",{},m));var q=m=30,h;if(b){if("simplemarkersymbol"==b.type)m=Math.min(Math.max(m,b.size+12),125),q=Math.min(Math.max(q,b.size+12),125);else if("picturemarkersymbol"==b.type)m=Math.min(Math.max(m,
b.width),125),q=Math.min(b.height||q,125);else if("textsymbol"==b.type){var p,r;b.text||(p=b.text,r=!0,b.setText(this.defaultText));m=Math.min(Math.max(m,b.getWidth()+12),125);q=Math.min(Math.max(q,b.getHeight()+12),125);r&&b.setText(p)}h=c.create("div",{style:"width:"+m+"px;height:"+q+"px;"},l)}u.isDefined(e)&&"number"===typeof e&&(e=""+e);c.create("td",{innerHTML:e||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},g))));b&&(a=this._drawSymbol(h,b,d,m,q,f,
a,k),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var d=c.create("tr",{},a),d=c.create("td",{align:this._align,colspan:2},d);c.create("td",{innerHTML:y.encode(b)||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},d))))},_drawSymbol:function(a,b,c,d,e,f,k,q){b=L.fromJson(b.toJson());var h=k.opacity;c&&b.setColor(new r(c.toRgba()));if("simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type){if(!b.color)return;c=b.color.toRgba();
c[3]*=h;b.color.setColor(c)}else"simplemarkersymbol"===b.type||"simplefillsymbol"===b.type?(b.color&&(c=b.color.toRgba(),c[3]*=h,b.color.setColor(c)),b.outline&&b.outline.color&&(c=b.outline.color.toRgba(),c[3]*=h,b.outline.color.setColor(c))):"picturemarkersymbol"===b.type&&(a.style.opacity=h,a.style.filter="alpha(opacity\x3d("+100*h+"))");a=v.createSurface(a,d,e);9>l("ie")&&(c=a.getEventSource(),m.set(c,"position","relative"),m.set(c.parentNode,"position","relative"));f=this._getDrawingToolShape(b,
f)||L.getShapeDescriptors(b);var p,h=(c=f.defaultShape)&&"text"===c.type;try{h&&!c.text&&(c.text=this.defaultText),p=a.createShape(q||c).setFill(f.fill).setStroke(f.stroke),h&&p.setFont(f.font)}catch(s){a.clear();a.destroy();return}var n=p.getBoundingBox();q=n.width;f=n.height;var h=-(n.x+q/2),w=-(n.y+f/2);c=a.getDimensions();h={dx:h+c.width/2,dy:w+c.height/2};if("simplemarkersymbol"===b.type&&"path"===b.style)d=k._getScaleMatrix(n,b.size),p.applyTransform(x.scaleAt(d.xx,d.yy,{x:c.width/2,y:c.height/
2}));else if(q>d||f>e)k=q/d>f/e,d=((k?d:e)-5)/(k?q:f),g.mixin(h,{xx:d,yy:d});p.applyTransform(h);return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};
break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){h.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&g.isArray(a.children)&&
h.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,d,f){if(f=b._hoverLabel||b._hoverLabels&&b._hoverLabels[d.id]||f)f=y.encode(f),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[d.id]=e.connect(a,"onmousemove",g.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,m.set(k.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(g.hitch(this,function(a,b,d){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=
!0,k.byId(this.id+"_hoverLabel")){var e=k.byId(this.id+"_hoverLabel");e.innerHTML="\x3cspan\x3e"+d+"\x3c/span\x3e";m.set(e,"top",b+"px");m.set(e,"left",a+15+"px");m.set(e,"display","")}else c.create("div",{innerHTML:"\x3cspan\x3e"+d+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},f)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[d.id]=e.connect(a,"onmouseout",g.hitch(this,function(a){this.mouseY=
this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,m.set(k.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;h.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)e.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)e.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;h.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();
var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(f=a.layerDrawingOptions[d.id]);f&&(c.drawingInfo=f.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=
b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(m.set(k.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,d){var e=a.layer.dynamicLayerInfos||a.layer.layerInfos,f,g;for(f=0;f<e.length;f++)if(e[f].id===c&&e[f].subLayerIds)for(g=0;g<e[f].subLayerIds.length;g++){var k=e[f].subLayerIds[g];-1===h.indexOf(d,k)&&(d.push(k),b(k,d))}}a.layer.layerInfos&&
h.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var f=a.legendResponse.layers[d];if(b.id==f.layerId){var g,k;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==f.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(k=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,
f.minScale)||a.minScale||f.minScale,k=Math.max(a.maxScale,f.maxScale));if(0<g&&g<c||k>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],u.isDefined(a)&&(b+=" ("+a+")"));return y.encode(b)},_getEffectiveScale:function(a,
b){var c=b.minScale,d=b.maxScale;if(u.isDefined(b.parentLayerId)){var e=a.layerInfos,f=b.parentLayerId,g;for(g=e.length-1;0<=g;g--)if(e[g].id==f)if(0==c&&0<e[g].minScale?c=e[g].minScale:0<c&&0==e[g].minScale||0<c&&0<e[g].minScale&&(c=Math.min(c,e[g].minScale)),d=Math.max(d||0,e[g].maxScale||0),-1<e[g].parentLayerId)f=e[g].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});g.mixin(Q,{ALIGN_LEFT:0,ALIGN_RIGHT:1});
return Q})},"dojo/debounce":function(){define([],function(){return function(n,f){var g;return function(){g&&clearTimeout(g);var h=this,e=arguments;g=setTimeout(function(){n.apply(h,e)},f)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(n,f,g,h){var e=function(e,a){return e-a},p={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(e){var a=String(e),f=a.match(p._reNumber);e={integer:0,fractional:0};f&&f[1]?(e.integer=f[1].split("").length,
e.fractional=f[3]?f[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&(f=a.split("e"),a=f[0],f=f[1],a&&f&&(a=Number(a),f=Number(f),(e=0<f)||(f=Math.abs(f)),a=p.getDigits(a),e?(a.integer+=f,a.fractional=f>a.fractional?0:a.fractional-f):(a.fractional+=f,a.integer=f>a.integer?1:a.integer-f),e=a));return e},getFixedNumbers:function(e,a){var f,d;f=Number(e.toFixed(a));f<e?d=f+1/Math.pow(10,a):(d=f,f-=1/Math.pow(10,a));f=Number(f.toFixed(a));d=Number(d.toFixed(a));return[f,d]},getPctChange:function(e,
a,f,d){var g={prev:null,next:null},q;null!=f&&(q=e-f,f=a-f-q,g.prev=Math.floor(Math.abs(100*f/q)));null!=d&&(q=d-e,f=d-a-q,g.next=Math.floor(Math.abs(100*f/q)));return g},round:function(f,a){var g=f.slice(0),d,h,q,k,c,m,n,b,v,x=!a||null==a.tolerance?2:a.tolerance,y=a&&a.indexes,A=!a||null==a.strictBounds?!1:a.strictBounds;if(y)y.sort(e);else{y=[];for(m=0;m<g.length;m++)y.push(m)}for(m=0;m<y.length;m++)if(v=y[m],d=g[v],h=0===v?null:g[v-1],q=v===g.length-1?null:g[v+1],k=p.getDigits(d),k=k.fractional){n=
0;for(b=!1;n<=k&&!b;)c=p.getFixedNumbers(d,n),c=A&&0===m?c[1]:c[0],b=p.hasMinimalChange(d,c,h,q,x),n++;b&&(g[v]=c)}return g},hasMinimalChange:function(e,a,f,d,g){e=p.getPctChange(e,a,f,d);a=null==e.prev||e.prev<=g;f=null==e.next||e.next<=g;return a&&f||e.prev+e.next<=2*g},_reAllZeros:RegExp("\\"+g.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(e,a){a=a||{places:20,round:-1};var g=f.format(e,a);g&&(g=g.replace(p._reSomeZeros,"$1").replace(p._reAllZeros,""));return g}};return p})},
"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(n,f,g,h,e,p,r,a,l){function d(a){return a&&f.map(a,function(a){return new r(a)})}function s(a,b,c){var d="";0===b?d=k.lt+" ":b===c&&(d=k.gt+" ");return d+a}var q={},k={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},c={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},
m={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},t={formatLength:"short",
fullYear:!0},b={formatLength:"short"};n.mixin(q,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,c){var d,e=[];null!=a&&!(a instanceof Date)&&(a=new Date(a));c=c||{};c=n.mixin({},c);var g=c.selector?c.selector.toLowerCase():null;d=!g||-1<g.indexOf("time");g=!g||-1<g.indexOf("date");d&&(c.timeOptions=c.timeOptions||b,c.timeOptions&&(c.timeOptions=n.mixin({},c.timeOptions),c.timeOptions.selector=c.timeOptions.selector||"time",e.push(c.timeOptions)));
g&&(c.dateOptions=c.dateOptions||t,c.dateOptions&&(c.dateOptions=n.mixin({},c.dateOptions),c.dateOptions.selector=c.dateOptions.selector||"date",e.push(c.dateOptions)));e&&e.length?(e=f.map(e,function(b){return h.format(a,b)}),d=1==e.length?e[0]:l["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,b){return e[b]})):d=h.format(a);return d},createColorStops:function(a){var b=a.values,c=a.colors,d=a.labelIndexes,e=a.isDate,g=a.dateFormatOptions;a=[];return a=f.map(b,function(a,
k){var m=null;if(!d||-1<f.indexOf(d,k)){var l;(l=e?q.formatDate(a,g):p.format(a))&&(m=s(l,k,b.length-1))}return{value:a,color:c[k],label:m}})},updateColorStops:function(a){var b=a.stops,c=a.changes,d=a.isDate,e=a.dateFormatOptions,g=[],k,m=f.map(b,function(a){return a.value});f.forEach(c,function(a){g.push(a.index);m[a.index]=a.value});k=p.round(m,{indexes:g});f.forEach(b,function(a,c){a.value=m[c];if(null!=a.label){var f,g=null;(f=d?q.formatDate(k[c],e):p.format(k[c]))&&(g=s(f,c,b.length-1));a.label=
g}})},createClassBreakLabel:function(b){var c=b.minValue,d=b.maxValue,e=b.isFirstBreak?"":k.gt+" ";b="percent-of-total"===b.normalizationType?k.pct:"";c=null==c?"":p.format(c);d=null==d?"":p.format(d);return e+c+b+" "+a.smartMapping.minToMax+" "+d+b},setLabelsForClassBreaks:function(a){var b=a.classBreaks,c=a.classificationMethod,d=a.normalizationType,e=[];b&&b.length&&("standard-deviation"===c?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):
a.round?(e.push(b[0].minValue),f.forEach(b,function(a){e.push(a.maxValue)}),e=p.round(e),f.forEach(b,function(a,b){a.label=q.createClassBreakLabel({minValue:0===b?e[0]:e[b],maxValue:e[b+1],isFirstBreak:0===b,normalizationType:d})})):f.forEach(b,function(a,b){a.label=q.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===b,normalizationType:d})}))},updateClassBreak:function(a){var b=a.classBreaks,c=a.normalizationType,d=a.change,e=d.index,d=d.value,f=-1,g=-1,k=b.length;"standard-deviation"===
a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===e?f=e:e===k?g=e-1:(g=e-1,f=e),-1<f&&f<k&&(a=b[f],a.minValue=d,a.label=q.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===f,normalizationType:c})),-1<g&&g<k&&(a=b[g],a.maxValue=d,a.label=q.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===g,normalizationType:c})))},calculateDateFormatInterval:function(a){var b,
d,e=a.length,g,k,m,q,l,h,p=Infinity,r;a=f.map(a,function(a){return new Date(a)});for(b=0;b<e-1;b++){g=a[b];m=[];l=Infinity;h="";for(d=b+1;d<e;d++)k=a[d],k=g.getFullYear()!==k.getFullYear()&&"year"||g.getMonth()!==k.getMonth()&&"month"||g.getDate()!==k.getDate()&&"day"||g.getHours()!==k.getHours()&&"hour"||g.getMinutes()!==k.getMinutes()&&"minute"||g.getSeconds()!==k.getSeconds()&&"second"||"millisecond",q=c[k],q<l&&(l=q,h=k),m.push(k);l<p&&(p=l,r=h)}return r},createUniqueValueLabel:function(a){var b=
a.value,c=a.fieldInfo,d=a.domain;a=a.dateFormatInterval;var e=String(b);(d=d&&d.codedValues?d.getName(b):null)?e=d:"number"===typeof b&&(e=c&&"esriFieldTypeDate"===c.type?q.formatDate(b,a&&m[a]):p.format(b));return e},cloneColorInfo:function(a){var b;a&&(b=n.mixin({},a),b.colors=d(b.colors),b.stops=b.stops&&f.map(b.stops,function(a){a=n.mixin({},a);a.color&&(a.color=new r(a.color));return a}),b.legendOptions&&(b.legendOptions=n.mixin({},b.legendOptions)));return b},cloneOpacityInfo:function(a){var b;
if(a){b=n.mixin({},a);if(a=b.opacityValues)b.opacityValues=a.slice(0);if(a=b.stops)b.stops=f.map(a,function(a){return n.mixin({},a)});if(a=b.legendOptions)b.legendOptions=n.mixin({},a)}return b},cloneSizeInfo:function(a){var b;if(a){b=n.mixin({},a);b.stops&&(b.stops=f.map(b.stops,function(a){return n.mixin({},a)}));if((a=b.minSize)&&"object"===typeof a)b.minSize=q.cloneSizeInfo(a);if((a=b.maxSize)&&"object"===typeof a)b.maxSize=q.cloneSizeInfo(a);if(a=b.legendOptions)if(b.legendOptions=n.mixin({},
a),a=a.customValues)b.legendOptions.customValues=a.slice(0)}return b}});return q})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define(["dojo/_base/declare","dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(n,f,g,h,e){return n(h,{constructor:function(){},getExtent:function(){var e=this.layerObject.items;if(0===e.length)return null;e=g.graphicsExtent(e);return this._convertGeometryToMapSpatialRef(e)},_resetLayerObjectVisiblity:function(e){var g=e?e[this.id]:null;
g&&(f.forEach(this.newSubLayers,function(a){var f=e?e[a.id]:null;f&&a.layerObject.setVisibility(f.visible)},this),this._setTopLayerVisible(g.visible))},initVisible:function(){var e=!1,f;for(f=0;f<this.newSubLayers.length;f++)e=e||this.newSubLayers[f].layerObject.visible;e&&(this._visible=!0)},_setTopLayerVisible:function(e){this._visible=e?!0:!1;f.forEach(this.newSubLayers,function(e){e.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var g=[],h=this.layerObject.getFeatureLayers();
f.forEach(h,function(a){a=e.getInstance().create({layerObject:a,title:a.label||a.title||a.name||a.id||" ",id:a.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});g.push(a);a.init()},this);return g},_obtainLayerIndexesInMap:function(){var e=[],f,a;for(a=0;a<this.newSubLayers.length;a++)(f=this._getLayerIndexesInMapByLayerId(this.newSubLayers[a].layerObject.id))&&e.push(f);return e},moveLeftOfIndex:function(e){var f;for(f=this.newSubLayers.length-1;0<=f;f--)this.map.reorderLayer(this.newSubLayers[f].layerObject,
e)},moveRightOfIndex:function(e){var f;for(f=0;f<this.newSubLayers.length;f++)this.map.reorderLayer(this.newSubLayers[f].layerObject,e)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS ./LayerInfoFactory esri/layers/FeatureLayer esri/lang".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q){return n(a,{constructor:function(a,c){},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.extent)},
_resetLayerObjectVisiblity:function(a){var c=a?a[this.id]:null;if(a){c&&this.layerObject.setVisibility(c.visible);var d=[],e=!1;f.forEach(this.layerObject.layerInfos,function(b){var c=this.id+"_"+b.name;q.isDefined(a[c])&&(e=!0,a[c].visible&&d.push(b.name))},this);if(0<d.length||e)this.layerObject.setVisibleLayers(d),this.traversal(function(a){a.initVisible()})}},initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){this.layerObject.setVisibility(a);this._visible=
a},setSubLayerVisible:function(a){var c=[],d,c=g.clone(this.originOperLayer.layerObject.visibleLayers),e;for(e in a)if(a.hasOwnProperty(e)&&"function"!==typeof a[e]){var b=a[e],q=e.toString();d=f.indexOf(c,q);b?0>d&&c.push(q):0<=d&&c.splice(d,1)}this.originOperLayer.layerObject.setVisibleLayers(c)},obtainNewSubLayers:function(){var a=[];f.forEach(this.layerObject.layerInfos,function(c,e){var f;f=d.getInstance().create({layerObject:this.layerObject,title:c.label||c.title||c.name||" ",id:this.id+"_"+
(c.name||" "),wms:{layerInfo:this,subId:c.name,wmsLayerInfo:c},selfType:"wms",parentLayerInfo:this});a.push(f);f.init()},this);return a},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&r.after(this.layerObject,"setVisibleLayers",g.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var a=[];this.traversal(function(c){c.initVisible();a.push(c)});h.publish("layerInfos/layerInfo/visibleChanged",a);this._isShowInMapChanged2()}})})},
"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),function(n,f,g,h,e,p,r){return n(r,{constructor:function(a,e){this.layerObject=a.layerObject},getExtent:function(){},_resetLayerObjectVisiblity:function(){},initVisible:function(){var a=[],a=!1,a=g.clone(this.originOperLayer.layerObject.visibleLayers);this._visible=a=0<=f.indexOf(a,this.originOperLayer.wms.subId)?
!0:!1},_setTopLayerVisible:function(a){var e=this.originOperLayer.wms;this._visible=a?!0:!1;var d={};d[e.subId]=a;e.layerInfo.setSubLayerVisible(d)},drawLegends:function(a){this._initLegendsNode(a)},_initLegendsNode:function(a){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var f=e.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});p(f,"load",function(){e.empty(a);var d=e.create("div",{"class":"legend-div"},a);h.place(f,d)})}else e.empty(a)},obtainNewSubLayers:function(){return[]},
getOpacity:function(){},setOpacity:function(a){},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo ./LayerInfoFactory".split(" "),function(n,f,g,h,e,p,r){return n(p,{constructor:function(a,e,d){this.noLegend=d},getExtent:function(){},initVisible:function(){var a=
!1,e=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<e.layerInfo.subLayerVisible[e.subId]&&(a=!0);this._visible=a},_setTopLayerVisible:function(a){var e;if(this.originOperLayer.mapService&&(e=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){a?e.layerInfo.subLayerVisible[e.subId]++:e.layerInfo.subLayerVisible[e.subId]--;this._visible=a;var d={};this.traversal(function(a){0===a.getSubLayers().length&&(d[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});
e.layerInfo.setSubLayerVisible(d)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(a){},_sevVisible:function(a){this.visible=a},obtainNewSubLayers:function(){var a=[];f.forEach(this.originOperLayer.subLayers,function(e){e.parentLayerInfo=this;e=r.getInstance().create(e);a.push(e);e.init()},this);return a},getOpacity:function(){},setOpacity:function(a){},getLayerObject:function(){var a=new h;this.layerObject.empty?e({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",
timeout:1E5,content:{f:"json"}}).then(g.hitch(this,function(e){var d=this.layerObject.url;this.layerObject=e;this.layerObject.url=d;this.layerObject.id=this.id;a.resolve(this.layerObject)}),function(e){a.reject(e)}):a.resolve(this.layerObject);return a},getLayerType:function(){var a=new h;a.resolve("GroupLayer");return a},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getScaleRange:function(){var a=
this.originOperLayer.mapService;return(a=a.layerInfo._getJsapiLayerInfoById(a.subId))&&0<=a.minScale&&0<=a.maxScale?{minScale:a.minScale,maxScale:a.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(n,f){return n(f,{constructor:function(f,h){},initVisible:function(){var f=!1,h=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<h.layerInfo.subLayerVisible[h.subId]&&(f=
!0);this._visible=f},_setTopLayerVisible:function(f){var h;this.originOperLayer.mapService&&(h=this.originOperLayer.mapService,f?h.layerInfo.subLayerVisible[h.subId]++:h.layerInfo.subLayerVisible[h.subId]--,this._visible=f,this.visbleOrInvisilbe())},visbleOrInvisilbe:function(){var f=this.originOperLayer.mapService,h={};h[f.subId]=this.isVisbleOrInvisilbe();f.layerInfo.setSubLayerVisible(h)},isVisbleOrInvisilbe:function(){for(var f=this.originOperLayer.mapService,h=-1,e=f.subId,p=0;;){h++;p+=f.layerInfo.subLayerVisible[e];
e=f.layerInfo._getJsapiLayerInfoById(e);if(-1===e.parentLayerId)return p>h?!0:!1;e=e.parentLayerId}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct ./LayerInfoForDefault esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),function(n,f,g,h,e,p,r,a,l,d,s){return n(p,{_legendsNode:null,
_layerObjectLoadingIndicator:null,constructor:function(){this._layerObjectLoadingIndicator={loadingFlag:!1,loadedDef:new h}},_resetLayerObjectVisiblity:function(){},_loadLegends:function(a){var d=new h;this.originOperLayer.mapService.layerInfo.getLegendInfo(a).then(g.hitch(this,function(a){d.resolve(a)}));return d},drawLegends:function(a,d){this._loadLegends(d).then(g.hitch(this,function(c){this._initLegendsNode(c,a)}))},_initLegendsNode:function(a,d){var c=this.originOperLayer.mapService;if(a){e.empty(d);
for(var g=null,l=0;l<a.length;l++)if(a[l].layerId===c.subId){g=a[l];break}if(g){var b=e.create("table",{"class":"legend-table",style:"font-size: 12px"},d);f.forEach(g.legend,function(a){if("\x3call other values\x3e"!==a.label){var c=e.create("tr",{"class":"legend-tr",style:"border: 1px solid"},b),d=e.create("td",{"class":"legend-symbol-td",style:""},c),f=null,f=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;e.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",
src:f},d);e.create("td",{"class":"legend-label-td",innerHTML:a.label||" ",style:"padding-left: 5px"},c)}},this)}}},_initControlPopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,d=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:a.infoTemplates&&a.infoTemplates[d]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,d=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&
a.infoTemplates&&delete a.infoTemplates[d]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getLayerObject:function(){var e=new h,f,c;this.getLayerType().then(g.hitch(this,function(m){this.layerObject.empty?("RasterLayer"===m?this.layerObject=new a(this.layerObject.url):"FeatureLayer"===m?this.layerObject=new r(this.layerObject.url):"StreamLayer"===m?this.layerObject=new l(this.layerObject.url):
"ArcGISImageServiceLayer"===m?this.layerObject=new d(this.layerObject.url):"ArcGISImageServiceVectorLayer"===m&&(this.layerObject=new s(this.layerObject.url)),this.layerObject.empty?e.resolve():(this._layerObjectLoadingIndicator.loadingFlag=!0,f=this.layerObject.on("load",g.hitch(this,function(){this.layerObject.id=this.id;e.resolve(this.layerObject);this._layerObjectLoadingIndicator.loadedDef.resolve(this.layerObject);f.remove&&f.remove()})),c=this.layerObject.on("error",g.hitch(this,function(){e.resolve(null);
this._layerObjectLoadingIndicator.loadedDef.resolve(null);c.remove&&c.remove()})))):this._layerObjectLoadingIndicator.loadingFlag?this._layerObjectLoadingIndicator.loadedDef.then(g.hitch(this,function(a){e.resolve(a)})):e.resolve(this.layerObject)}),g.hitch(this,function(){e.resolve(null)}));return e},getPopupInfo:function(){var a=null,d=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(d)for(var c=0;c<d.length;c++)if(d[c].id===this.originOperLayer.mapService.subId){a=d[c].popupInfo;
break}return a},getFilterOfWebmap:function(){var a=null,d=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(d)for(var c=0;c<d.length;c++)if(d[c].id===this.originOperLayer.mapService.subId){a=d[c].layerDefinition?d[c].layerDefinition.definitionExpression:null;break}return a},getFilter:function(){var a=this.originOperLayer.mapService;return a.layerInfo.layerObject&&a.layerInfo.layerObject.layerDefinitions?a.layerInfo.layerObject.layerDefinitions[a.subId]:null},setFilter:function(a){var d,
c=this.originOperLayer.mapService;c.layerInfo.layerObject&&c.layerInfo.layerObject.setLayerDefinitions&&(d=c.layerInfo.layerObject.layerDefinitions?f.map(c.layerInfo.layerObject.layerDefinitions,function(a){return a}):[],d[c.subId]=a,c.layerInfo.layerObject.setLayerDefinitions(d))},getLayerType:function(){var a=new h,d=this.originOperLayer.mapService;d.layerInfo._getSublayerDefinition(d.subId).then(g.hitch(this,function(c){c?a.resolve(c.type.replace(/\ /g,"")):a.resolve(null)}),function(){a.resolve(null)});
return a},getSupportTableInfo:function(){var a=new h,d={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(g.hitch(this,function(c){d.layerType=c;0<=this._getLayerTypesOfSupportTable().indexOf(c)&&(d.isSupportedLayer=!0);c=this.originOperLayer.mapService;c.layerInfo._getSublayerDefinition(c.subId).then(g.hitch(this,function(c){c&&0<=c.capabilities.indexOf("Data")&&(d.isSupportQuery=!0);a.resolve(d)}),function(){a.resolve(d)})}),function(){a.resolve(d)});return a},enablePopup:function(){var a=
this.originOperLayer.mapService.layerInfo,d=a.layerObject,c=this.originOperLayer.mapService.subId;return this.loadInfoTemplate().then(g.hitch(this,function(){return a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[c]?(this.controlPopupInfo.enablePopup=!0,d.infoTemplates||(d.infoTemplates={}),d.infoTemplates[c]=a.controlPopupInfo.infoTemplates[c],!0):!1}))},disablePopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,d=this.originOperLayer.mapService.subId;
this.controlPopupInfo.enablePopup=!1;a.infoTemplates&&delete a.infoTemplates[d]},loadInfoTemplate:function(){var a=new h,d=this.originOperLayer.mapService.layerInfo,c=this.originOperLayer.mapService.subId;d.controlPopupInfo.infoTemplates&&d.controlPopupInfo.infoTemplates[c]&&d.controlPopupInfo.infoTemplates[c].infoTemplate?a.resolve(d.controlPopupInfo.infoTemplates[c].infoTemplate):(d.controlPopupInfo.infoTemplates||(d.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(g.hitch(this,function(e){e=
this._getDefaultPopupTemplate(e);d.controlPopupInfo.infoTemplates[c]={infoTemplate:e,layerUrl:null};a.resolve(e)}),g.hitch(this,function(){a.resolve(null)})));return a},getInfoTemplate:function(){var a=this.originOperLayer.mapService.layerInfo,d=this.originOperLayer.mapService.subId;return a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[d]&&a.controlPopupInfo.infoTemplates[d].infoTemplate?a.controlPopupInfo.infoTemplates[d].infoTemplate:null},getScaleRange:function(){var a=this.originOperLayer.mapService;
return(a=a.layerInfo._getJsapiLayerInfoById(a.subId))&&0<=a.minScale&&0<=a.maxScale?{minScale:a.minScale,maxScale:a.maxScale}:{minScale:0,maxScale:0}},_onVisibilityChanged:function(){}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ../SpatialReference ../geometry/Point".split(" "),function(n,f,g,h,e,p,r,a,
l,d,s,q,k,c){return n([s,q],{declaredClass:"esri.layers.RasterLayer",constructor:function(a,c){this.pixelData=null;(null===this.format||void 0===this.format)&&this.setImageFormat("LERC",!0)}})})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(n,f,g,h,e,p,r,a,l,d,s){return n([s],{declaredClass:"esri.layers.BaseRasterLayer",
managedSuspension:!0,opacity:1,constructor:function(a,d){this.drawMode=d&&void 0!==d.drawMode?d.drawMode:!0;this.drawType=d&&d.drawType?d.drawType:"2d";this.pixelData=null;this._initialize(a,d)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>e("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&
this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();this._displayTimer=this._displayTimer||setTimeout(f.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);
this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new d((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,d){this.pixelFilter=a;d||this.redraw()},_toggleTime:function(){},_setMap:function(d,e){this.inherited(arguments);var c=this._canvas=p.create("canvas",{id:"canvas",width:d.width+"px",height:d.height+"px",style:"position: absolute; left: 0px; top: 0px;"},
e);a.isDefined(this.opacity)&&r.set(c,"opacity",this.opacity);(this._context=c.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=d.width;this._mapHeight=d.height;this._connects=[];this._connects.push(g.connect(d,"onPan",this,this._panHandler));this._connects.push(g.connect(d,"onPanEnd",this,this._panEndHandler));this._connects.push(g.connect(d,"onZoom",this,this._onZoomHandler));this._connects.push(g.connect(d,
"onZoomEnd",this,this._onZoomEndHandler));this._connects.push(g.connect(d,"onResize",this,this._onResizeHandler));this._connects.push(g.connect(d,"onExtentChange",this,this._extentChangeHandler));this._connects.push(g.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(g.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:d.width,height:d.height};this.evaluateSuspension();if(this.suspended&&!d.loaded)var f=g.connect(d,
"onLoad",this,function(){g.disconnect(f);f=null;this.evaluateSuspension()});return c},_unsetMap:function(a,d){h.forEach(this._connects,g.disconnect,this);this._canvas&&d.removeChild(this._canvas);this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!(!this._map||!this._canvas||!this._context)},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},
_drawPixelData:function(){r.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};if(this._canDraw&&this.drawMode)if(this._useBrowserDecoding())this._fireUpdateEnd();else if(this.drawMode)if(!this.pixelData||!this.pixelData.pixelBlock)this.clear();else{var a=this.pixelData.pixelBlock,d=this._context,c=d.createImageData(a.width,a.height);c.data.set(a.getAsRGBA());var e=this.pixelData.extent,
f=this._map.extent,b=this.getCurrentResolution(),g=0,l=0;Math.abs(e.xmin-f.xmin)>b.x&&(g=Math.round((e.xmin-f.xmin)/b.x));Math.abs(f.ymax-e.ymax)>b.y&&(l=Math.round((f.ymax-e.ymax)/b.y));this.clear();d.putImageData(c,g,l,0,0,a.width,a.height);this._fireUpdateEnd()}},_panHandler:function(a,d){r.set(this._canvas,{left:this._startRect.left+d.x+"px",top:this._startRect.top+d.y+"px"})},_panEndHandler:function(a,d){d&&(this._startRect.left+=d.x,this._startRect.top+=d.y)},_onZoomHandler:function(a,d,c){var e=
this._startRect;a=e.width*d;d*=e.height;var f=e.left-(a-e.width)*(c.x-e.left)/e.width;c=e.top-(d-e.height)*(c.y-e.top)/e.height;r.set(this._canvas,{left:f+"px",top:c+"px",width:a+"px",height:d+"px"});this._endRect={left:f,top:c,width:a,height:d}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,d,c){r.set(this._canvas,{width:d+"px",height:c+"px"});this._startRect.width=this._canvas.width=d;this._startRect.height=this._canvas.height=c},_extentChangeHandler:function(a,
d,c,e){if(!this.suspended&&(!d||!(0===d.x&&0===d.y&&!c)))this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height)},_visibilityChangeHandler:function(a){a?l.show(this._canvas):l.hide(this._canvas)},_opacityChangeHandler:function(a){r.set(this._canvas,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A,w,C,u,E,D,B,G,I,K){return n(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0,"spatial-reference-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,b){this._url=m.urlToObject(a);this.raster=new w(a);this.infoTemplate=b&&b.infoTemplate;
var c=b&&b.imageServiceParameters;this.format=c&&c.format;this.compressionTolerance=c&&c.compressionTolerance?c.compressionTolerance:0.01;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this.useMapDimensionValue=b&&b.hasOwnProperty("useMapDimensionValue")?!!b.useMapDimensionValue:!0;this.activeMapDimensions=b&&b.activeMapDimensions;this._params=
f.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this.pixelFilter=b&&b.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=f.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=f.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=f.hitch(this,this._initLayer);
this._queryVisibleRastersHandler=f.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):k({url:this._url.path,content:f.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},
disableClientCaching:!1,_initLayer:function(a,b){if(!(null===a||void 0===a)){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,d=this.maxScale;f.mixin(this,a);this.minScale=c;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=new t(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var e=this.minValues,g=this.maxValues,
k=this.meanValues,m=this.stdvValues,l=this.bands=[],c=0,d=this.bandCount;c<d;c++)l[c]={min:e[c],max:g[c],mean:k[c],stddev:m[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new D(c):null;d=this.fields=[];if(e=a.fields)for(c=0;c<e.length;c++)d.push(new B(e[c]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);q.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);q.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);
c={};a.defaultMosaicMethod?(c.method=a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=x.METHOD_NONE;this.defaultMosaicRule=new x(c);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType&&!this.hasRasterAttributeTable;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&
this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(f.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=f.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=f.clone(a.fields))}));this._isVectorData()&&!q.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new u,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===
this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(f.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)}},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new g(c._dfdCanceller);10<this.version?(b._pendingDfd=k({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=p.isDebug,b.errback(a));return b},getRasterAttributeTable:function(a){var b=this._url.path+"/rasterAttributeTable",d=new g(c._dfdCanceller),f={f:"json"},m=this.hasRasterAttributeTable;a&&a.renderingRule&&(f.renderingRule=e.toJson(a.renderingRule.toJson()),m=!0);10<this.version&&m?(d._pendingDfd=k({url:b,content:f,handleAs:"json",callbackParamName:"callback"}),d._pendingDfd.then(function(a){d.callback(a)},function(a){d.errback(a)})):
(a=Error("Layer does not support raster attribute table"),a.log=p.isDebug,d.errback(a));return d},_getRenderingRuleAttributeTable:function(a){var b=new g(c._dfdCanceller);if(!a||!a.renderingRule)return b.errback(Error("Rendering rule is not specified")),b;a=a.renderingRule;var d=a.functionName;this._renderingRuleAttributeTable&&d&&this._renderingRuleAttributeTable.hasOwnProperty(d)?b.resolve(this._renderingRuleAttributeTable[d]):b=this.getRasterAttributeTable({renderingRule:a}).then(f.hitch(this,
function(a){var b;a&&(a.features&&a.features.length&&a.fields&&a.fields.length)&&(b={features:f.clone(a.features),fields:f.clone(a.fields)},d&&(this._renderingRuleAttributeTable[d]=b));return b}));return b},_getRasterAttributeTableFeatures:function(){var a=new g;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(f.hitch(this,
function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=f.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return!a?(a=new g,a.errback(Error("Rendering rule is not specified")),a):this._getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features})},getCustomRasterFields:function(a){var b=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;
a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var c={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},d={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},e={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},g=this.fields?f.clone(this.fields):[];a=g.length;
g[a]=d;if(10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none")))a++,g[a]=e;if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,g[a]=c;if(q.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType))c={name:this._rasterFieldPrefix+
"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},d={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,g[a]=c,a++,g[a]=d;a=this._rasterAttributeTableFields;if((c=this.renderingRule&&this.renderingRule.functionName)&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(c))a=this._renderingRuleAttributeTable[c].fields;a&&0<a.length&&(a=h.filter(a,function(a){return"esriFieldTypeOID"!==
a.type&&"value"!==a.name.toLowerCase()}),a=h.map(a,function(a){var c=f.clone(a);c.name=b+a.name;return c}),g=g.concat(a));var k=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&h.forEach(this.rasterFunctionInfos,function(a){a&&(a.name&&"none"!==a.name.toLowerCase())&&(a={name:k+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},g.push(a))});return g},_prepareGetImageParameters:function(a,b,c,d){d=q.isDefined(d)?
d:this._params;var g=a.spatialReference.wkid||e.toJson(a.spatialReference.toJson(!1));delete d._ts;f.mixin(d,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:g,bboxSR:g,size:b+","+c},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete d.compressionTolerance;d.format&&"LERC"===d.format.toUpperCase()&&(d.compressionTolerance=this.compressionTolerance);d.token=this._getToken()},getImageUrl:function(a,b,c,d,e){e=q.isDefined(e)?e:this._params;this._prepareGetImageParameters(a,b,c,e);a=
f.clone(e);this._cleanupRequestParams(a);b=this._url.path+"/exportImage?";c=m.addProxy(b+l.objectToQuery(f.mixin(a,{f:"image"})));var g=a.token;c.length>s.defaults.io.postLength||this.useMapImage?this._jsonRequest=k({url:b,content:f.mixin(a,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;g&&(c+=-1===c.indexOf("?")?"?token\x3d"+g:"\x26token\x3d"+g);d(m.addProxy(c))},error:this._errorHandler}):d(c)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;
a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=e.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?e.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&this._getRenderingRuleAttributeTable({renderingRule:a});
if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=x.METHOD_NONE);c.where=a;c=new x(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:
null},setPixelFilter:function(a){this.pixelFilter=a},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},queryVisibleRasters:function(a,d,e,k){var m=this._map,l=c._fixDfd(new g(c._dfdCanceller));this._visibleRasters=[];var q,
p,r=!0,n=this.infoTemplate?this.infoTemplate.info:null,s=n?f.clone(this.infoTemplate.info.fieldInfos):null;d=d||{};if(n&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var w=[];h.forEach(this.infoTemplate.info.mediaInfos,function(a){w=w.concat(a&&a.value&&a.value.fields||[])});w.length&&h.forEach(s,function(a){a&&-1<w.indexOf(a.fieldName)&&(a.visible=!0)})}if(s&&0<s.length){r=!1;for(q=0;q<s.length;q++)if((p=s[q])&&p.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+
"servicepixelvalue"&&(p.visible||n.title&&-1<n.title.toLowerCase().indexOf(p.fieldName.toLowerCase()))){r=!0;break}}var t=(p=this._removeVisualizationStretchFunction(this.renderingRule))&&p.functionName,v=[];if(10.4<=this.version){var u=!1;if(this.rasterFunctionInfos&&s){var x=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;h.forEach(this.rasterFunctionInfos,function(a){var b=x+a.name.replace(/ /gi,"_");h.some(s,function(a){return a.visible&&a.fieldName===b})&&(u=u||t&&t===a.name,v.push(new y({rasterFunction:a.name})))})}p&&
!u&&v.push(p)}q=new K;q.geometry=a.geometry;q.returnGeometry=this._map.spatialReference.equals(this.spatialReference);q.returnCatalogItems=r;q.timeExtent=a.timeExtent;q.mosaicRule=this.mosaicRule||null;q.renderingRule=10.4>this.version&&p||null;q.renderingRules=v||null;m&&(a=new b((m.extent.xmax-m.extent.xmin)/(2*m.width),(m.extent.ymax-m.extent.ymin)/(2*m.height),m.extent.spatialReference),q.pixelSize=a);d.requestParams=q;var A=this;a=new I(this.url);(l._pendingDfd=a.execute(q)).addCallbacks(function(a){A._queryVisibleRastersHandler(a,
d,e,k,l)},function(a){A._resolve([a],null,k,l,!0)});return l},_queryVisibleRastersHandler:function(a,b,c,d,g){function m(){var a=this.getCustomRasterFields(b),d=this._getDomainFields(a),e=b?b.returnDomainValues:!1,k=b&&b.rasterAttributeTableFieldPrefix,s,w,y,v,u,x,A,B,E,R;this._useRenderingRuleAttributeTable&&this.renderingRule?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),R=l):a=this._getRasterAttributeTableFeatures();a.then(f.hitch(this,function(a){for(s=0;s<
n.length;s++){S=n[s];S.setInfoTemplate(this.infoTemplate);S._layer=this;if(l){E=l.replace(/ /gi,"").split(",");w=l;y=E;r&&r.length>=s&&(w=r[s].replace(/ /gi,", "),y=r[s].split(" "));S.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=y;S.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=E;p&&(S.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=p.replace(/ /gi,"").split(","));if(this.pixelFilter){var b=new C({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});h.forEach(y,
function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,extent:new t(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)S.attributes[this._rasterFieldPrefix+"Magnitude"]=b.pixels[0][0],S.attributes[this._rasterFieldPrefix+"Direction"]=b.pixels[1][0]}h.forEach(D,function(a){S.attributes[a.name]=a.value});var m=R||w;if(a&&0<
a.length&&(v=h.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==m:a.attributes.VALUE==m}),0<v.length&&(u=f.clone(v[0]),k&&u))){B={};for(x in u.attributes)u.attributes.hasOwnProperty(x)&&(A=k+x,B[A]=u.attributes[x]);u.attributes=B;S.attributes=f.mixin(S.attributes,u.attributes)}}e&&(d&&0<d.length)&&h.forEach(d,function(a){if(a){var b=S.attributes[a.name];q.isDefined(b)&&(b=this._getDomainValue(a.domain,b),q.isDefined(b)&&(S.attributes[a.name]=
b))}},this);Z.push(S);this._visibleRasters.push(S)}this._resolve([Z,null,!0],null,c,g)}))}var l=a.value,p=a.value,r,n,s=0,w=0,y=this,u=this.objectIdField,x,A,D=[];d=b.requestParams.renderingRules;var B=a.processedValues,E=this.renderingRule&&dojo.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(d&&B&&d.length===B.length){var K=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;h.forEach(d,function(a,b){if(a.functionName){var c={name:K+a.functionName.replace(/ /gi,
"_"),value:B[b].replace(/ /gi,"").split(",")};D.push(c);E&&E===dojo.toJson(a.toJson())&&(l=B[b])}})}d=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var I=0,$,V,X=a.catalogItems.features.length;A=0;n=Array(X);r=Array(X);x=Array(X);for(s=0;s<X;s++)-1<a.properties.Values[s].toLowerCase().indexOf("nodata")&&A++;$=X-A;for(s=
0;s<X;s++)A=!0,-1<a.properties.Values[s].toLowerCase().indexOf("nodata")?(V=$++,d||(A=!1,n.length--,r.length--,x.length--)):V=I++,A&&(n[V]=a.catalogItems.features[s],r[V]=a.properties.Values[s],x[V]=n[V].attributes[u])}this._visibleRasters=[];var S;if((a=-1<l.toLowerCase().indexOf("nodata"))&&!d)n=[],r=[],x=[];l&&(!n&&!a)&&(u="ObjectId",n=[],S=new G(new t(this.fullExtent),null,{ObjectId:0}),n.push(S));var Z=[];n?!this._map.spatialReference.equals(this.spatialReference)&&x&&0<x.length?k({url:this._url.path+
"/query",content:{f:"json",objectIds:x.join(","),returnGeometry:!0,outSR:e.toJson(y._map.spatialReference.toJson()),outFields:u},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)y._resolve([Z,null,null],null,c,g);else{for(s=0;s<a.features.length;s++)for(w=0;w<n.length;w++)n[w].attributes[u]==a.features[s].attributes[u]&&(n[w].geometry=new v(a.features[s].geometry),n[w].geometry.setSpatialReference(y._map.spatialReference));m.call(y)}},error:function(a){y._resolve([Z,
null,null],null,c,g)}}):m.call(this):this._resolve([Z,null,null],null,c,g)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];h.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;h.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,
b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=f.clone(a);var d=a._normalize(!0);this._prepareGetImageParameters(d,b,c);b=f.clone(this._params);this._cleanupRequestParams(b);b.extent=a;c=null;this._useBrowserDecoding()&&(c=new E({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?f.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){if(!this._rasterReadPromise||
!this._rasterReadPromise.isCanceled())this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a)},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this._drawPixelData(),this._rasterReadPromise=null},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=f.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=
a.clone();return b},_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;for(var d=b*c,e=0,f=0,g=new Uint8Array(d),k=new Uint8Array(d),m=new Uint8Array(d),l=new Uint8Array(d),q=Infinity,h=Infinity,p=Infinity,r=-Infinity,n=-Infinity,s=-Infinity,w,t,y,e=0;e<d;e++)w=a[f++],t=a[f++],y=a[f++],q=q<w?q:w,r=r>w?r:w,h=h<t?h:t,n=n>t?n:t,p=p<y?p:y,s=s>y?s:y,g[e]=w,k[e]=t,m[e]=y,l[e]=a[f++]&1;return new C({width:b,height:c,pixels:[g,k,m],pixelType:"U8",mask:l,statistics:[{minValue:q,maxValue:r},
{minValue:h,maxValue:n},{minValue:p,maxValue:s}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=this._url.path+"/multiDimensionalInfo",b=new g(c._dfdCanceller);if(this._multidimensionalInfo)return b.resolve(this._multidimensionalInfo),b;10.3<=this.version&&this.hasMultidimensions?(b._pendingDfd=
k({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(f.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;b.callback(a.multidimensionalInfo)}),function(a){b.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=p.isDebug,b.errback(a));return b},getDefaultMultidimensionalDefinition:function(){var a,b,d,e=[],k=new g(c._dfdCanceller);if(this._defaultMultidimensionalDefinition)return k.resolve(this._defaultMultidimensionalDefinition),
k;k._pendingDfd=this.getMultidimensionalInfo();k._pendingDfd.then(f.hitch(this,function(c){a=c;b=a.variables[0].dimensions;for(d in b)b.hasOwnProperty(d)&&(b[d].hasRanges&&!0==b[d].hasRanges?e.push(new A({variableName:"",dimensionName:b[d].name,isSlice:!1,values:[b[d].values[0]]})):e.push(new A({variableName:"",dimensionName:b[d].name,isSlice:!0,values:[b[d].extent[0]]})));this._defaultMultidimensionalDefinition=e;k.callback(e)}),function(a){k.errback(a)});return k},_setDefaultMultidimensionalDefinition:function(a){var b,
c={};this.getDefaultMultidimensionalDefinition().then(f.hitch(this,function(d){b=d;0<b.length&&(this.mosaicRule?(c=f.clone(this.mosaicRule),c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=f.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new x({multidimensionalDefinition:b}),this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&
"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=this.rasterFunctionInfos[0].name;else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version){var c="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:c,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new y(b),this.setRenderingRule(this.defaultRenderingRule,
a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=new x(e.fromJson(a.mosaicRule));if(b&&b.multidimensionalDefinition&&0<b.multidimensionalDefinition.length){var c=h.filter(b.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});b.multidimensionalDefinition=c;a.mosaicRule=e.toJson(b.toJson())}}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),d;for(d in b)a.hasOwnProperty(b[d])&&delete a[b[d]];
return a},_removeVisualizationStretchFunction:function(a){var b=a&&a.functionName;if(!b||"stretch"!==b.toLowerCase())return a;var c=a.functionArguments.Raster;return c&&c.functionName&&h.some(this.rasterFunctionInfos,function(a){return c.functionName===a.name})?c:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===
this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_isRasterFunctionInfoAvailable:function(a){return h.some(a&&(this.rasterFunctionInfos||[]),function(b){return b&&b.name&&b.name.toLowerCase()===a.toLowerCase()})},_createPixelData:function(a){a=new C({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new t(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:b}},_resolve:function(a,
b,d,e,f){b&&this[b].apply(this,a);d&&d.apply(null,a);e&&c._resDfd(e,a,f)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=r.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(r.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&
(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(n,f,g,h,e,p){var r=n(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,
viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){f.isObject(a)&&(f.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&
(this.viewpoint=new p(a.viewpoint)),this.multidimensionalDefinition=a.multidimensionalDefinition||[])},toJson:function(){var a=null,f=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(f)for(var a=[],d=0;d<f;d++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[d].declaredClass?this.multidimensionalDefinition[d].toJson():this.multidimensionalDefinition[d]);a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,
ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return e.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var e=r.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":e=r.METHOD_ATTRIBUTE;break;case "center":e=r.METHOD_CENTER;break;case "lockraster":e=r.METHOD_LOCKRASTER;break;case "nadir":e=r.METHOD_NADIR;break;case "northwest":e=
r.METHOD_NORTHWEST;break;case "seamline":e=r.METHOD_SEAMLINE;break;case "viewpoint":e=r.METHOD_VIEWPOINT}return e}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return r.OPERATION_FIRST;case "last":return r.OPERATION_LAST;case "max":return r.OPERATION_MAX;case "min":return r.OPERATION_MIN;case "blend":return r.OPERATION_BLEND;case "mean":return r.OPERATION_MEAN;case "sum":return r.OPERATION_SUM}}});f.mixin(r,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",
METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});return r})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has",
"../kernel","../lang"],function(n,f,g,h,e){var p=n(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(e){if(f.isObject(e)){var a=0;this.functionName=e.rasterFunction;this.functionArguments=f.clone(e.rasterFunctionArguments||e.arguments);f.mixin(this,e);if(e=this.functionArguments)if(e.Raster=this._toRasterFunction(e.Raster),e.Raster2=this._toRasterFunction(e.Raster2),e.DEM=this._toRasterFunction(e.DEM),
e.FillRaster=this._toRasterFunction(e.FillRaster),e.Rasters&&e.Rasters.length)for(a=0;a<e.Rasters.length;a++)e.Rasters[a]=this._toRasterFunction(e.Rasters[a])}},_toRasterFunction:function(e){return e&&(e.rasterFunction||e.functionName)?new p(e):e},_rfToJson:function(e){e&&"esri.layers.RasterFunction"===e.declaredClass&&(e=e.toJson());return e},toJson:function(){var g=f.clone(this.functionArguments||this.arguments);if(g&&(g.Raster=this._rfToJson(g.Raster),g.Raster2=this._rfToJson(g.Raster2),g.DEM=
this._rfToJson(g.DEM),g.FillRaster=this._rfToJson(g.FillRaster),g.Rasters&&g.Rasters.length)){var a,l=[];for(a=0;a<g.Rasters.length;a++)l.push(this._rfToJson(g.Rasters[a]));g.Rasters=l}return e.filter({rasterFunction:this.functionName,rasterFunctionArguments:g,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});return p})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel","../lang"],function(n,f,g,h,e){return n(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(e){f.isObject(e)&&f.mixin(this,e)},toJson:function(){return e.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(e){return null!==e})}})})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t){var b,v,x,y,A,w,C=null,u=null,E=function(a){"U1"===a||"U2"===a||"U4"===a||"U8"===a?(a="U8",u=Math.pow(2,8)-1,C=Uint8Array):"U16"===a?(u=u||Math.pow(2,16)-1,C=Uint16Array):"U32"===a?(u=u||Math.pow(2,32)-1,C=Uint32Array):"S8"===a?(u=u||0-Math.pow(2,7),C=Int8Array):"S16"===a?(u=u||0-Math.pow(2,15),C=Int16Array):"S32"===a?(u=u||0-Math.pow(2,31),C=Int32Array):C=Float32Array;return a};return f(d,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),
validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(b,d,f){var k=this,m=new h(c._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";if(!b.imageServiceParameters)throw"Insufficient parameters to read data";var l=g.clone(b.imageServiceParameters),q=b.pixelType;e.some(this.validPixelTypes,
function(a){return a===q})||(l.pixelType="F32");e.some(this.validFormats,function(a){return a.toLowerCase()===l.format.toLowerCase()})||(l.format="lerc");var p=b.decodeFunc,n;this._prepareGetImageParameters(l);m._pendingDfd=s({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:g.mixin(l,{f:"image"}),load:function(a){k.decode(a,{width:l.width,height:l.height,planes:null,pixelType:q,noDataValue:l.noData,format:l.format,decodeFunc:p}).then(function(a){n={pixelBlock:a,extent:l.extent};
k._resolve([n,l],"onRasterReadComplete",d,m)},function(a){k._resolve([a],null,f,m,!0)})},error:function(a){k._resolve([a],null,f,m,!0)}});return m.promise},decode:function(a,b){if(void 0===b||null===b)throw"missing decode options";var c,d;b.format&&(c=b.format.toUpperCase());"BSQ"!==c&&"BIP"!==c&&(c=this._getFormat(a));d=b.decodeFunc;if(void 0===d||null===d)d=this._getFormatDecoderDfd(c);return d(a,b)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var b=
a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new q(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new k(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var b=a.extent,c=b.spatialReference.wkid||r.toJson(b.spatialReference.toJson());delete a._ts;
g.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,e=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+e*b/c:(e=d*c/b,a.xmax=a.xmin+e);return a},_resolve:function(a,b,d,e,f){b&&this[b].apply(this,a);d&&d.apply(null,a);e&&c._resDfd(e,a,f)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;break;case "JPEG":b=this._decodeJpeg;
break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip;break;case "TIFF":b=this._decodeTiff;break;default:b=function(a,b){throw"The raster format is not supported";}}b=g.hitch(this,b);return function(c,d){var e=new h;try{var f;"LERC"===a||!0===A?(f=b(c,d),e.resolve(f)):w.then(function(){f=b(c,d);e.resolve(f)})}catch(g){e.reject(g)}return e}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";if(255===a[0]&&216===a[1])b="JPEG";else if(137===a[0]&&
80===a[1]&&78===a[2]&&71===a[3])b="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])b="LERC";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))b="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])b="TIFF";return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==
a.width)throw"Width not provided.";},_decodeJpeg:function(a,c){if(!b)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(c);var d=(new b).decode(a);if(d.height!==c.height||d.width!==c.width)throw"The decoded image dimensions are incorrect.";var e=[],f,g;for(f=0;f<d.pixels.length;f++)g=d.pixels[f],e.push(this._calculateBandStatistics(g));return new m({width:d.width,height:d.height,pixels:d.pixels,pixelType:"U8",mask:d.mask,statistics:e})},_decodePng:function(a,b){if(!v)throw"The png decoder module is not loaded.";
this._validateDecodeParams(b);var c=new Uint8Array(a),d=new v(c),c=new Uint8Array(4*b.width*b.height);d.copyToImageData(c,d.decodePixels());for(var e=d=0,f,e=new Uint8Array(b.width*b.height),d=0;d<b.width*b.height;d++)e[d]=c[4*d+3];for(var g=new m({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:e,statistics:[]}),d=0;3>d;d++){f=new Uint8Array(b.width*b.height);for(e=0;e<b.width*b.height;e++)f[e]=c[4*e+d];g.addData({pixels:f,statistics:this._calculateBandStatistics(f)})}return g},_decodeBsq:function(a,
b){if(!x)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);u=b.noDataValue;b.pixelType=E(b.pixelType);var c=x.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:C,noDataValue:u}),d=[],e,f=null;for(e=0;e<c.pixels.length;e++)f=c.pixels[e],d.push(this._calculateBandStatistics(f));return new m({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeBip:function(a,b){this._validateDecodeParams(b);u=b.noDataValue;
b.pixelType=E(b.pixelType);var c=x.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:C,noDataValue:u}),d=[],e,f=null;for(e=0;e<c.pixels.length;e++)f=c.pixels[e],d.push(this._calculateBandStatistics(f));return new m({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeTiff:function(a,b){this._validateDecodeParams(b);u=b.noDataValue;b.pixelType=E(b.pixelType);var c=y.decode(a),d=[],e,f=null;for(e=0;e<c.pixels.length;e++)f=
c.pixels[e],d.push(this._calculateBandStatistics(f,c.maskData));return new m({width:c.width,height:c.height,pixels:c.pixels,pixelType:c.pixelType,mask:c.maskData,statistics:d})},_decodeLerc:function(a,b){this._validateDecodeParams(b);u=b.noDataValue;b.pixelType=E(b.pixelType);for(var c=0,d,e=0,f,g=a.byteLength-10;e<g;){var k=t.decode(a,{inputOffset:e,encodedMaskData:d,returnMask:0===c?!0:!1,returnEncodedMask:0===c?!0:!1,returnFileInfo:!0,pixelType:C,noDataValue:u}),e=k.fileInfo.eofOffset;0===c&&(d=
k.encodedMaskData,f=new m({width:b.width,height:b.height,pixels:[],pixelType:b.pixelType,mask:k.maskData,statistics:[]}));c++;if(k.height!==b.height||k.width!==b.width)throw"The decoded image dimensions are incorrect";f.addData({pixels:k.pixelData,statistics:{minValue:k.minValue,maxValue:k.maxValue,noDataValue:k.noDataValue}})}return f},_calculateBandStatistics:function(a,b){var c=Infinity,d=-Infinity,e=a.length,f,g=0;if(b)for(f=0;f<e;f++)b[f]&&(g=a[f],c=g<c?g:c,d=g>d?g:d);else for(f=0;f<e;f++)g=
a[f],c=g<c?g:c,d=g>d?g:d;return{minValue:c,maxValue:d}},_loadRasterFormatModules:function(){w=new h;10>a("ie")?w.reject("unsupported browser version"):n(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,c,d,e){b=a;v=c;x=d;y=e;A=!0;w.resolve(!0)})}})})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,f,g,h){return n([],{declaredClass:"esri.layers.PixelBlock",
planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(e){if(e){if(!e.width||Math.floor(e.width)!==e.width)throw"PixelBlock: incorrect width";if(!e.height||Math.floor(e.height)!==e.height)throw"PixelBlock: incorrect height";if(!e.pixels||!e.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=e.width;this.height=e.height;this.pixels=e.pixels;this.pixelType=e.pixelType||null;this.statistics=e.statistics;this.mask=e.mask||null}},getPlaneCount:function(){return this.pixels.length!==
this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(e){if(!e.pixels||!e.statistics)throw"Pixel data or statistics are not present";if(e.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(e.statistics);this.pixels.push(e.pixels)},getAsRGBA:function(){var e=new ArrayBuffer(4*this.width*this.height);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(e);
break;default:this._fillFrom8Bit(e)}return new Uint8ClampedArray(e)},getAsRGBAFloat:function(){var e=new Float32Array(4*this.width*this.height);this._fillFrom32Bit(e);return e},clone:function(){var e=new this.constructor;e.width=this.width;e.height=this.height;e.pixelType=this.pixelType;this.mask&&(e.mask=new Uint8Array(this.mask));var g,h;if(this.pixels){e.pixels=[];h=this.pixels.length;for(g=0;g<h;g++)e.pixels[g]=new Float32Array(this.pixels[g])}if(this.statistics){e.statistics=[];h=this.statistics.length;
for(g=0;g<h;g++)e.statistics[g]=f.clone(this.statistics[g])}return e},_fillFrom8Bit:function(e){var f=this.pixels,g=this.mask;if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,l,d;a=l=d=f[0];3<=f.length&&(l=f[1],d=f[2]);var f=new Uint32Array(e),h=this.width*this.height;if(a.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(g&&g.length===h)for(e=0;e<h;e++)g[e]&&(f[e]=-16777216|d[e]<<16|l[e]<<8|a[e]);
else for(e=0;e<h;e++)f[e]=-16777216|d[e]<<16|l[e]<<8|a[e]},_fillFromNon8Bit:function(e){var f=this.pixels,g=this.mask,a=this.statistics;if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var l=1,d=0;a&&0<a.length?(d=a[0].minValue,l=255/(a[0].maxValue-a[0].minValue)):(l=255,"S8"===this.pixelType?(d=-128,l=127):"U16"===this.pixelType?l=65535:"S16"===this.pixelType?(d=-32768,l=32767):"U32"===this.pixelType?l=4294967295:"S32"===this.pixelType?(d=-2147483648,
l=2147483647):"F32"===this.pixelType?(d=-3.4*1E39,l=3.4*1E39):"F64"===this.pixelType&&(d=-Number.MAX_VALUE,l=Number.MAX_VALUE),l=255/(l-d));e=new Uint32Array(e);var a=this.width*this.height,h,q,k;h=f[0];if(h.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=f.length)if(q=f[1],k=f[2],g&&g.length===a)for(f=0;f<a;f++)g[f]&&(e[f]=-16777216|(k[f]-d)*l<<16|(q[f]-d)*l<<8|(h[f]-d)*l);else for(f=0;f<a;f++)e[f]=-16777216|(k[f]-d)*l<<16|(q[f]-d)*l<<8|(h[f]-d)*l;else if(g&&
g.length===a)for(f=0;f<a;f++)q=(h[f]-d)*l,g[f]&&(e[f]=-16777216|q<<16|q<<8|q);else for(f=0;f<a;f++)q=(h[f]-d)*l,e[f]=-16777216|q<<16|q<<8|q},_fillFrom32Bit:function(e){var f=this.pixels,g=this.mask;if(!e||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,l,d;a=l=d=f[0];3<=f.length&&(l=f[1],d=f[2]);var h=this.width*this.height;if(a.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var q=0;if(g&&g.length===h)for(f=
0;f<h;f++)e[q++]=a[f],e[q++]=l[f],e[q++]=d[f],e[q++]=g[f];else for(f=0;f<h;f++)e[q++]=a[f],e[q++]=l[f],e[q++]=d[f],e[q++]=255}})})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var n={defaultNoDataValue:-3.4027999387901484E38,decode:function(g,h){var e;h=h||{};var p=h.inputOffset||0,r=h.encodedMaskData||null===h.encodedMaskData,a={},l=new Uint8Array(g,p,10);a.fileIdentifierString=String.fromCharCode.apply(null,l);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+
a.fileIdentifierString;var p=p+10,d=new DataView(g,p,24);a.fileVersion=d.getInt32(0,!0);a.imageType=d.getInt32(4,!0);a.height=d.getUint32(8,!0);a.width=d.getUint32(12,!0);a.maxZError=d.getFloat64(16,!0);p+=24;if(!r)if(d=new DataView(g,p,16),a.mask={},a.mask.numBlocksY=d.getUint32(0,!0),a.mask.numBlocksX=d.getUint32(4,!0),a.mask.numBytes=d.getUint32(8,!0),a.mask.maxValue=d.getFloat32(12,!0),p+=16,0<a.mask.numBytes){var r=new Uint8Array(Math.ceil(a.width*a.height/8)),d=new DataView(g,p,a.mask.numBytes),
l=d.getInt16(0,!0),s=2,q=0;do{if(0<l)for(;l--;)r[q++]=d.getUint8(s++);else for(var k=d.getUint8(s++),l=-l;l--;)r[q++]=k;l=d.getInt16(s,!0);s+=2}while(s<a.mask.numBytes);if(-32768!==l||q<r.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=r;p+=a.mask.numBytes}else 0==(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(r=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=r);d=new DataView(g,p,16);a.pixels={};a.pixels.numBlocksY=d.getUint32(0,!0);a.pixels.numBlocksX=d.getUint32(4,
!0);a.pixels.numBytes=d.getUint32(8,!0);a.pixels.maxValue=d.getFloat32(12,!0);p+=16;r=a.pixels.numBlocksX;l=a.pixels.numBlocksY;r+=0<a.width%r?1:0;l+=0<a.height%l?1:0;a.pixels.blocks=Array(r*l);s=1E9;for(k=q=0;k<l;k++)for(var c=0;c<r;c++){var m=0,d=new DataView(g,p,Math.min(10,g.byteLength-p)),t={};a.pixels.blocks[q++]=t;var b=d.getUint8(0);m++;t.encoding=b&63;if(3<t.encoding)throw"Invalid block encoding ("+t.encoding+")";if(2===t.encoding)p++,s=Math.min(s,0);else{if(0!==b&&2!==b){b>>=6;t.offsetType=
b;if(2===b)t.offset=d.getInt8(1),m++;else if(1===b)t.offset=d.getInt16(1,!0),m+=2;else if(0===b)t.offset=d.getFloat32(1,!0),m+=4;else throw"Invalid block offset type";s=Math.min(t.offset,s);if(1===t.encoding)if(b=d.getUint8(m),m++,t.bitsPerPixel=b&63,b>>=6,t.numValidPixelsType=b,2===b)t.numValidPixels=d.getUint8(m),m++;else if(1===b)t.numValidPixels=d.getUint16(m,!0),m+=2;else if(0===b)t.numValidPixels=d.getUint32(m,!0),m+=4;else throw"Invalid valid pixel count type";}p+=m;if(3!=t.encoding)if(0===
t.encoding){d=(a.pixels.numBytes-1)/4;if(d!==Math.floor(d))throw"uncompressed block has invalid length";m=new ArrayBuffer(4*d);b=new Uint8Array(m);b.set(new Uint8Array(g,p,4*d));m=new Float32Array(m);for(b=0;b<m.length;b++)s=Math.min(s,m[b]);t.rawData=m;p+=4*d}else 1===t.encoding&&(d=Math.ceil(t.numValidPixels*t.bitsPerPixel/8),m=Math.ceil(d/4),m=new ArrayBuffer(4*m),b=new Uint8Array(m),b.set(new Uint8Array(g,p,d)),t.stuffedData=new Uint32Array(m),p+=d)}}a.pixels.minValue=s;a.eofOffset=p;var p=null!=
h.noDataValue?h.noDataValue:n.defaultNoDataValue,l=h.encodedMaskData,m=h.returnMask,s=0,q=a.pixels.numBlocksX,k=a.pixels.numBlocksY,c=Math.floor(a.width/q),t=Math.floor(a.height/k),d=2*a.maxZError,l=l||(a.mask?a.mask.bitset:null),v,r=new (h.pixelType||Float32Array)(a.width*a.height);m&&l&&(v=new Uint8Array(a.width*a.height));for(var m=new Float32Array(c*t),x,y,b=0;b<=k;b++){var A=b!==k?t:a.height%k;if(0!==A)for(var w=0;w<=q;w++){var C=w!==q?c:a.width%q;if(0!==C){var u=b*a.width*t+w*c,E=a.width-C,
D=a.pixels.blocks[s],B,G;if(2>D.encoding){if(0===D.encoding)B=D.rawData;else{B=D.stuffedData;G=D.bitsPerPixel;x=D.numValidPixels;y=D.offset;var I=d,K=m,R=a.pixels.maxValue,N=(1<<G)-1,P=0,J=void 0,H=0,O=void 0,L=void 0,M=Math.ceil((R-y)/I),J=4*B.length-Math.ceil(G*x/8);B[B.length-1]<<=8*J;for(J=0;J<x;J++)0===H&&(L=B[P++],H=32),H>=G?(O=L>>>H-G&N,H-=G):(H=G-H,O=(L&N)<<H&N,L=B[P++],H=32-H,O+=L>>>H),K[J]=O<M?y+O*I:R;B=m}G=0}else e=2===D.encoding?0:D.offset;var F;if(l)for(y=0;y<A;y++){u&7&&(F=l[u>>3],F<<=
u&7);for(x=0;x<C;x++)u&7||(F=l[u>>3]),F&128?(v&&(v[u]=1),r[u++]=2>D.encoding?B[G++]:e):(v&&(v[u]=0),r[u++]=p),F<<=1;u+=E}else if(2>D.encoding)for(y=0;y<A;y++){for(x=0;x<C;x++)r[u++]=B[G++];u+=E}else for(y=0;y<A;y++){for(x=0;x<C;x++)r[u++]=e;u+=E}if(1===D.encoding&&G!==D.numValidPixels)throw"Block and Mask do not match";s++}}}e=v;v={width:a.width,height:a.height,pixelData:r,minValue:a.pixels.minValue,maxValue:a.pixels.maxValue,noDataValue:p};e&&(v.maskData=e);h.returnEncodedMask&&a.mask&&(v.encodedMaskData=
a.mask.bitset?a.mask.bitset:null);if(h.returnFileInfo&&(v.fileInfo=f(a),h.computeUsedBitDepths)){e=v.fileInfo;F=a.pixels.numBlocksX*a.pixels.numBlocksY;B={};for(G=0;G<F;G++)p=a.pixels.blocks[G],0===p.encoding?B.float32=!0:1===p.encoding?B[p.bitsPerPixel]=!0:B[0]=!0;a=Object.keys(B);e.bitDepths=a}return v}},f=function(f){return{fileIdentifierString:f.fileIdentifierString,fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?
{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,minValue:f.pixels.minValue,noDataValue:this.noDataValue}}};return n})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(n,f,g,h,e,p){return n(null,
{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(e){f.mixin(this,e);this.isDataUV=e&&e.isDataUV?e.isDataUV:!1;this.computeMagnitudeAndDirection=f.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(e,a){this.inputUnit=e;this.outputUnit=a;this.unitConversionFactor=1;this._updateUnitConvFactor()},
_updateUnitConvFactor:function(){var e=p.indexOf(this.speedUnits,this.inputUnit),a=p.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=e&&0<=a){var f=[1,0.277778,0.514444,0.3048,0.44704,0];this.unitConversionFactor=f[e]/f[a]}},computeMagnitudeAndDirection:function(f){if(!e.isDefined(f))throw"Could not compute magnitude and direction. No pixel data is available.";var a=f.pixelBlock;if(!e.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var g=f.extent,d=(g.xmax-g.xmin)/a.width,h=(g.ymax-g.ymin)/a.height,q=g.xmin+d/2,g=g.ymax-h/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var k=180/Math.PI,c=[],m=0,p=0,b=0,n=!e.isDefined(a.mask),x,y,A,w,C,u,E,D;C=E=Infinity;u=D=-Infinity;for(m=0;m<a.height;m++)for(p=0;p<a.width;p++,b++)if(c.push([q+d*p,g-h*m]),n||a.mask[b])A=x=a.pixels[0][b]*this.unitConversionFactor,w=y=a.pixels[1][b],this.isDataUV&&(A=Math.sqrt(x*x+y*y),w=90-k*Math.atan2(y,x),a.pixels[0][b]=A*this.unitConversionFactor,
a.pixels[1][b]=w),A>u&&(u=A),A<C&&(C=A),w>D&&(D=w),w<E&&(E=w);a.statistics[0].maxValue=u;a.statistics[0].minValue=C;a.statistics[1].maxValue=D;a.statistics[1].minValue=E;f.locations=c;return f}})})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(n,f,g,h){var e;return f(null,{constructor:function(e){this.ctx=e.ctx;this._loadRasterFormatModule()},decode:function(e,f){if(!f.width||!f.height)throw"Native decoding requires the image format, width and height";
var a=new g,l,d=new Uint8Array(e),h=this._getFormat(e);if("error"===h)throw"invalid format";"jpeg"===h&&(l=this._getMask(d,f));var q="",k,c;for(k=0;k<d.length;k+=65535)c=d.subarray(k,k+65535>d.length-1?d.length-1:k+65535),q+=String.fromCharCode.apply(null,c);var d="data:image/"+h+";base64,"+window.btoa(q),m=new Image,n;m.src=d;var b=this;m.onload=function(){b.ctx.clearRect(0,0,f.width,f.height);b.ctx.drawImage(m,0,0);var c=b.ctx.getImageData(0,0,m.width,m.height);n=c.data;if(l)for(k=0;k<l.length;k++)n[4*
k+3]=l[k]?255:0;b.ctx.putImageData(c,0,0);a.resolve(null)};m.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(e){e=new Uint8Array(e,0,10);var f="error";255===e[0]&&216===e[1]?f="jpeg":137===e[0]&&(80===e[1]&&78===e[2]&&71===e[3])&&(f="png");return f},_getMask:function(f,g){var a;try{if(!e)throw"The zlib decoder module is not loaded.";var l=0,d=0,h=Math.round(f.length/2);1===h%2&&(h+=1);for(var q=f.length-2,l=h;l<q&&!(255===f[l]&&217===f[l+1]);l++);h=l+=2;if(h<f.length-
1){var k=(new e(f.subarray(h))).getBytes();a=new Uint8Array(g.width*g.height);for(l=h=0;l<k.length;l++)for(d=7;0<=d;d--)a[h++]=k[l]>>d&1}}catch(c){}return a},_loadRasterFormatModule:function(){10>h("ie")||n(["./Zlib"],function(f){e=f})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(n,f,g,h,e,p,r,a){n=n(r,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(a){this._url.path+="/identify";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(e,d,f,g,k){try{var c=new a(e);this._successHandler([c],"onComplete",f,k)}catch(m){this._errorHandler(m,g,k)}},execute:function(a,d,g,h){var k=h.assembly;a=this._encode(f.mixin({},this._url.query,{f:"json"},a.toJson(k&&k[0])));var c=this._handler,m=this._errorHandler;return e({url:this._url.path,content:a,callbackParamName:"callback",
load:function(a,b){c(a,b,d,g,h.dfd)},error:function(a){m(a,g,h.dfd)}})},onComplete:function(){}});p._createWrappers(n);return n})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(n,f,g,h,e,p){return n(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(f){f.catalogItems&&(this.catalogItems=new p(f.catalogItems));f.location&&(this.location=e.fromJson(f.location));
this.catalogItemVisibilities=f.catalogItemVisibilities;this.name=f.name;this.objectId=f.objectId;this.value=f.value;this.processedValues=f.processedValues;this.properties=f.properties}})})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(n,f,g,h,e,p,r,a){return n(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,
renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(e){var d=e&&e.geometry||this.geometry;e={geometry:d,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?g.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?g.toJson(this.renderingRule.toJson()):null};d&&(e.geometryType=a.getJsonType(d));d=this.timeExtent;e.time=d?d.toJson().join(","):
null;r.isDefined(this.pixelSizeX)&&r.isDefined(this.pixelSizeY)?e.pixelSize=g.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(e.pixelSize=this.pixelSize?g.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(e.renderingRules=g.toJson(h.map(this.renderingRules,function(a){return a.toJson()})));return e}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A){return n([k],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(a,b){b=b||{};if(!b.mode||b.mode===k.MODE_STREAM)this._isStream=!0,this.currentMode=this.mode=k.MODE_STREAM,this._mode=new c(this);this.purgeOptions=new A(this,b.purgeOptions||{});this.purgeInterval=b.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=
null;this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=e.hitch(this,this._attemptReconnect);this._purge=e.hitch(this,this._purge);this._processServiceJson=e.hitch(this,this._processServiceJson);if(e.isObject(a)&&a.layerDefinition)this._initFeatureLayer(a,b);else{var d=this;s({url:a,content:e.mixin({f:"json"}),callbackParamName:"callback"}).then(function(a){d._processServiceJson(a,b)},function(a){d._errorHandler(a)})}},_processServiceJson:function(a,
b){var c=this;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField?(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=a.relatedFeatures.joinField,s({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(d){d=d.fields||[];var e=g.map(a.fields,function(a){return a.name});g.forEach(d,function(b){-1===g.indexOf(e,b.name)&&a.fields.push(b)});b.resourceInfo=a;c._initFeatureLayer(c._url,b)},function(a){c.onError({error:a})})):
(b.resourceInfo=a,this._initFeatureLayer(this._url,b))},_initLayer:function(a,b){this.inherited(arguments);if(a){var c;if(a.layerDefinition)this.purgeOptions=new A(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||a.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var d=this._getWebsocketConnectionInfo(a),e=d.urls;e&&e.length?(this._socketUrls=e,this.socketUrl=e[0],this.socketDirection="broadcast"===this._params.socketDirection?
"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=d.token,e.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=e.length)):(this.socketUrl=void 0,d="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(d+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(d)))}if(this._params.filter)try{this._filter=c=this._makeFilter(this._params.filter)}catch(f){this.onError(Error("Error trying to create filter object: "+
f+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){c=c||{};c.geometry=this._params.geometryDefinition;c.outFields=this._outFields;c.where=this._defnExpr;try{this._filter=c=this._makeFilter(c)}catch(g){this.onError(Error("Error trying to create filter object: "+g+". Layer will not have filter applied")),this._filter=null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:
1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=a.keepLatestArchive?a.keepLatestArchive.featuresUrl:null;a.relatedFeatures&&(a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField)&&(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=a.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&(this.socketUrl&&!this._connected)&&
this.connect()}},_setMap:function(a){var b=this.inherited(arguments),c=this._getRenderer();if(this.timeInfo&&(this._trackIdField||c&&(c.latestObservationRenderer||c.trackRenderer)))this._trackManager=new m(this),this._trackManager.initialize(a);this.socketUrl&&(!this._connected&&this._map)&&this.connect();return b},_unsetMap:function(a,b){g.forEach(this._connects,f.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=
null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&this._mode._clearFeatureMap(),this._trackManager&&this._trackManager.clearTracks()}catch(a){}this.inherited(arguments)},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&
this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(a){this.setFilter({where:a})},getDefinitionExpression:function(){var a;this._filter&&(a=this._filter.where);return a},destroy:function(){this.disconnect();this.inherited(arguments)},onResume:function(a){this.inherited(arguments)},setGeometryDefinition:function(a){this.setFilter({geometry:a})},getGeometryDefinition:function(){var a;this._filter&&(a=this._filter.geometry);return a},connect:function(a){var b=this,
c={},d=this._filter,e,f,g=this.socketUrl,k;try{if(!this._connected){if(this._map){var m;if(this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive)return m=this.on("update-end",function(a){b._relatedQueried=!0;m.remove();m=null;a&&a.error?console.log("Not connecting. Error fetching related features"):b.connect()}),this._mode._fetchArchive(this._relatedUrl),!1;if(this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive)return m=this.on("update-end",function(a){b._keepLatestQueried=
!0;m.remove();m=null;a&&a.error?console.log("Not connecting. Error fetching archived features"):b.connect()}),this._mode._fetchArchive(this._keepLatestUrl),!1}this._websocketToken&&(c.token=this._websocketToken);this._map&&(this._map.spatialReference&&this.spatialReference)&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(c.outSR=this._map.spatialReference.wkid);if(d)for(f in d)null!==d[f]&&(e="geometry"===f?JSON.stringify(d[f]):d[f],c[f]=e);g+="?"+r.objectToQuery(c);return k=this._createConnection(g,
a)}}catch(l){console.log("Error connecting to data stream: ",l),a&&a(l,!1),this.onConnectionError({error:l})}},disconnect:function(a){var b=this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",c=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:c,message:b});a&&a(null,!0)},setFilter:function(b){var c,
d;if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;try{if(void 0!==b.outFields)return d=Error("Outfields property cannot be changed after layer is created"),this.onFilterChange({filter:this.getFilter(),error:d}),!1;c=this._makeFilter(b)}catch(e){return d=Error(e),this.onFilterChange({filter:this.getFilter(),error:d}),!1}if(this.socket)b={filter:c},this.socket.send(JSON.stringify(b));else a.once(this,"connect",function(a){this.setFilter(c)});
return!0},getFilter:function(){var a=this._filter,b={},c=["geometry","outFields","where"];a&&g.forEach(c,function(c){var d=a[c];d&&("geometry"===c?d=t.fromJson(d):"outFields"===c&&(d=d.split(",")),b[c]=d)});return b},setMaximumTrackPoints:function(a){if(!a&&0!==a)return!1;this.maximumTrackPoints=a;this._mode.propertyChangeHandler(3)},getUniqueValues:function(a){var b,c={},d=[];b=this._getField(a,!0);if(!b)return d;a=b.name;g.forEach(this.graphics||[],function(b){b=(b.attributes||{})[a];void 0!==b&&
!c[b]&&(c[b]=1,d.push(b))});d.sort(function(a,b){return a<b?-1:a>b?1:0});return d},getLatestObservations:function(){var a=[];return a=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(a){var b=this.purgeInterval;this.purgeInterval=a;this._togglePurgeT();a&&this._togglePurgeT(!0);if(b!==a)this.onPurgeIntervalChange();return this},_togglePurgeT:function(a){if(a&&this.purgeInterval){var b=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&
(this._purgeT=setTimeout(function(){!b.updating&&!b.suspended&&(b._mode._flushDrawBuffer(),b._togglePurgeT(!0))},6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._refreshT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(a,b){var c=this,d=new WebSocket(a);d.onopen=function(){c.socket=d;c._connected=
!0;c._reconnecting=!1;c._reconnectAttempts=0;c._bind();c.onConnect();b&&b(null,!0)};d.onclose=function(a){var b,d=!0,e=c._connected,f=null;if(c._connected||c._reconnecting){if(a.code)if(b="Connection failed: ",1001===a.code)b+=a.reason||"Service is going away.",d=!1;else if(4400===a.code)b+=a.reason||"Invalid url parameters. Check filter properties.",d=!1;else if(4404===a.code)b+="Service not found",d=!1;else if(4401===a.code||4403===a.code)b+="Not authorized",d=!1;d&&(c._reconnectAttempts+=1,c._reconnectAttempts>
c.maxReconnectAttempts&&(b="Maximum reconnect attempts exceeded",d=!1,e=!0));c._connected=!1;e&&(b&&(f=Error(b)),c.onDisconnect({error:f,willReconnect:d}));d?c._attemptReconnect():c.socket=null}else c.socket||(f=Error("Could not make connection to service"),c.onConnectionError({error:f})),c.socket=null,c._connected=!1};d.onerror=function(a){console.log("Socket error")};return d},_purge:function(){var a,b=[],c;if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(a=
0;a<this.graphics.length-this.purgeOptions.displayCount;a++)c=this.graphics[a],b.push(c);0<b.length&&(this._mode._removeFeatures(b),this._trackManager&&this._trackManager.removeFeatures(b))},_bind:function(){var a=this;this.socket.onmessage=function(b){a._onMessage(JSON.parse(b.data))}},_onMessage:function(a){var b=this;this.onMessage(a);var c={create:function(a){b._create(a)},update:function(a){b._update(a)},"delete":function(a){b._delete(a)}};if(a.type)c[a.type](a.feature);else a.hasOwnProperty("filter")?
b._handleFilterMessage(a):this._create(a)},_create:function(a){function b(a){if(!c._featureHasOID(a,d)){if(!a.geometry)return!1;a.attributes=a.attributes||{};a.attributes[d]=c._nextId++}a=a.declaredClass?a:new q(a);c._mode.drawFeature(a)}var c=this,d=c.objectIdField;a.length?a.forEach(function(a){a&&b(a)}):a&&b(a)},_delete:function(a){var b=this,c=a[b.objectIdField]||a.attributes[b.objectIdField],d=!1;this.graphics.forEach(function(a){a.attributes[b.objectIdField]==c&&(d=a)});d&&this.remove(d)},_update:function(a){var b=
this,c=!1;this.graphics.forEach(function(d){d.attributes[b.objectIdField]==a.attributes[b.objectIdField]&&(c=d)});c&&(a.attributes&&c.setAttributes(a.attributes),a.geometry&&c.setGeometry(t.fromJson(a.geometry)))},_makeFilter:function(a){var b,c=null;a=a||{};if(void 0!==a.geometry)if(c=c||{},null===a.geometry)c.geometry=null;else{b="string"===typeof a.geometry?t.fromJson(JSON.parse(a.geometry)):a.geometry.declaredClass?a.geometry:t.fromJson(a.geometry);if(!b||"point"===b.type)throw"Query object contains invalid geometry";
"extent"!==b.type&&(b=b.getExtent());if(!b||0===b.getHeight()&&0===b.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";c.spatialRel="esriSpatialRelIntersects";c.geometryType="esriGeometryEnvelope";c.geometry=b.toJson()}void 0!==a.where&&(c=c||{},c.where=a.where);if(void 0!==a.outFields&&(c=c||{},a="string"===typeof a.outFields?"*"===a.outFields?null:a.outFields.replace(/,\s+/g,",").split(","):null===a.outFields?null:a.outFields,a=this._makeOutFields(a))){if(a.errors&&
0<a.errors.length)throw"Invalid filter outFields. "+a.errors.join(",");c.outFields=a.fields?a.fields.join(","):null}return c},_makeOutFields:function(a){var b=this,c=[],d=[],e={fields:null};if(!a||0===a.length)return e;g.forEach(a,function(a){if("*"===a)return e;var f=b._getField(a,!0);f?c.push(f.name):d.push("Field named "+a+" not found in schema.")});a=b._getOutFields();g.forEach(a,function(a){b._getField(a)&&-1===g.indexOf(c,a)&&c.push(a)});e.fields=c;e.errors=d;return e},_handleFilterMessage:function(a){a.error?
(a=Error(a.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:a})):(a=a.filter,a.geometry&&"string"===typeof a.geometry&&(a.geometry=JSON.parse(a.geometry)),this._filter=a,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(a){var b={urls:[]},c,d=[],e=[],f,k,m;a.streamUrls&&g.forEach(a.streamUrls,function(a){"ws"===a.transport&&(c=a.urls,b.token=a.token)});if(!c)return b;g.forEach(c,function(a){0===a.lastIndexOf("wss",0)?e.push(a):d.push(a)});a="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?e:0===d.length?e:d;if(1<a.length)for(f=0;f<a.length-1;f++)k=f+Math.floor(Math.random()*(a.length-f)),m=a[k],a[k]=a[f],a[f]=m;b.urls=a;return b},_attemptReconnect:function(){var a=this,b;this._reconnectTimeoutId=null;a._connected=!1;if(!a._socketUrls)return!1;if(!a._collection&&!a._reconnecting&&a.socket&&a.credential)return a._reconnecting=!0,a._getServiceConnectionMetadata(a._attemptReconnect),!1;a._reconnecting=!0;a.socket=null;if(a._reconnectAttempts>
a.maxReconnectAttempts)return a._reconnecting=!1;a.socketUrl=a._socketUrls[a._reconnectAttempts>a._socketUrls.length-1?a._reconnectAttempts%a._socketUrls.length:a._reconnectAttempts];a.socketUrl+="/"+a.socketDirection;b=a._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){a.onAttemptReconnect({count:a._reconnectAttempts,url:a.socketUrl});a.connect()},1E3*a._reconnectAttempts+b)},_getServiceConnectionMetadata:function(a){var b=this,c=b._url.path;a="function"===typeof a?a:
null;s({url:c,content:e.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(c){c=b._getWebsocketConnectionInfo(c);b._websocketToken=c.token;a&&a()},function(a){b.onError(Error(a))})},_setDefaultRenderer:function(){var a=this.geometryType,c=new h([5,112,176,0.8]),d=new h([255,255,255]),d=new v(v.STYLE_SOLID,d,1),e;if("esriGeometryPoint"===a||"esriGeometryMultipoint"===a)e=new x(x.STYLE_CIRCLE,10,d,c);else if("esriGeometryPolyline"===a)e=new v(v.STYLE_SOLID,c,2);else if("esriGeometryPolygon"===
a||"esriGeometryEnvelope"===a)c=new h([5,112,176,0.2]),d=new h([5,112,176,0.8]),d=new v(v.STYLE_SOLID,d,1),e=new b(b.STYLE_SOLID,d,c);e&&this.setRenderer(new y(e))},_makeObjectIdField:function(){var a=1,b,c,d=[];if(!this.objectIdField){b=this.fields.length;for(c=0;c<b;c++)d.push(this.fields[c].name.toLowerCase());for(;-1!==g.indexOf(d,"objectid_"+a);)a+=1;this.objectIdField="objectid_"+a;this.fields.push({name:"objectid_"+a,type:"esriFieldTypeOID",alias:"objectid_"+a,nullable:!1})}},_featureHasOID:function(a,
b){return a.attributes&&(a.attributes[b]||0===a.attributes[b])},_randomIntFromInterval:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)}})})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./TrackManager".split(" "),function(n,f,g,h,e,p,r,a){return n([a],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(a){this.inherited(arguments)},initialize:function(a){this.inherited(arguments)},
addFeatures:function(a,d){function e(a,b){var c,d,g,k;f[a]||(f[a]=[]);c=f[a];0<m&&(b.length>m&&b.splice(0,b.length-m),g=b.length+c.length,g>m&&(d=c.splice(0,g-m)));g=b.length;for(k=0;k<g;k+=1)c.push(b[k]);return{deletes:d,adds:b}}var f,k,c,m,h={},b={},p;if(d)return this.inherited(arguments),h;f=this.trackMap;k=this.layer;c=k._trackIdField;m=k.maximumTrackPoints||0;g.forEach(a,function(a){var d=a.attributes[c];a.visible&&(b[d]||(b[d]=[]),b[d].push(a))});for(p in b)b.hasOwnProperty(p)&&(k=e(p,b[p]),
h[p]=k);return h},removeFeatures:function(a){var d=[],e=this.layer.objectIdField,f=this.layer._trackIdField;a&&(g.forEach(a,function(a){var c,m,l,b;m=a.attributes[f];c=a.attributes[e];if(l=this.trackMap[m])for(a=0;a<l.length;a+=1)if(b=l[a],b.attributes[e]===c){this.trackMap[m].splice(a,1);-1===g.indexOf(m)&&d.push(m);break}},this),0<a.length&&this.refreshTracks(d))},drawTracks:function(a){function d(a){var d=k[a],g=d&&1<d.length,l,h,n;if((n=e.trackLineMap[a])&&!g)f.remove(n),delete e.trackLineMap[a],
n=null;if(!g)return!1;g=[];for(l=d.length-1;0<=l;l-=1)(h=d[l].geometry)&&g.push([h.x,h.y]);d={};d[m]=a;1<g.length&&(n?(a=n.geometry,a.removePath(0),a.addPath(g),n.setGeometry(a)):(n=new p(new r({paths:[g],spatialReference:c}),null,d),f.add(n),e.trackLineMap[a]=n))}var e=this,f=this.container,k,c,m,h;if(f)if(k=this.trackMap,c=this.map.spatialReference,m=this.layer._trackIdField,a)g.forEach(a,function(a){d(a)});else for(h in k)k.hasOwnProperty(h)&&d(h)},refreshTracks:function(a){function d(a){var d,
g;a=e[a]||[];d=a.length;for(g=0;g<d;g++)f._repaint(a[g],null,!0)}var e=this.trackMap,f=this.layer;f._getRenderer();var k;this.drawTracks(a);if(a)g.forEach(a,function(a){d(a)});else for(k in e)e.hasOwnProperty(k)&&d(k)},getLatestObservations:function(){var a,d,e=this.trackMap,f=[];for(a in e)e.hasOwnProperty(a)&&(d=e[a],f.push(d[d.length-1]));return f},destroy:function(){this.inherited(arguments);this.trackLineMap=null}})})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/Stateful","dojo/has","../kernel"],function(n,f,g,h,e){return n([g],{declaredClass:"esri.layers.PurgeOptions",constructor:function(e,f){this.parent=e;for(var a in f)this[a]=f[a]},_displayCountSetter:function(e){this.displayCount=e;this.parent.refresh()}})})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(n,f,g,h,e,p,r){return n([p,r],{declaredClass:"esri.layers.ArcGISImageServiceLayer",
constructor:function(a,e){this._initialize(a,e);this.useMapImage=e&&e.useMapImage||!1},refresh:function(a){if(a)this.inherited(arguments);else{var e=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=e}},exportMapImage:function(a,g){var d=e.defaults.map,d=f.mixin({size:d.width+","+d.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete d._ts;this._exportMapImage(this._url.path+"/exportImage",d,g)}})})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q,k,c){return n([a,l],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(a,c){this.symbolTileSize=c&&c.symbolTileSize?c.symbolTileSize:50;this._maxMag=this._minMag=null;this.setVectorRendererStyle(c&&c.rendererStyle?c.rendererStyle:d.STYLE_SINGLE_ARROW);var b=f.clone(this._params);delete b.imageServiceParameters;delete b.pixelFilter;delete b.rendererStyle;delete b.symbolTileSize;this._initialize(a,c);this.geometryType="esriGeometryPoint";
this.symbolTileSizeUnits="Pixels";f.mixin(this._params,b)},getField:function(a){return this._getField(a,!0)},setVectorRendererStyle:function(a){this.rendererStyle=a;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onRendererChange:function(){},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);
this._toggleTime()},_refresh:function(a){if(10>e("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(!1===this.hasMultidimensions)this.onError(Error("Unable to refresh. This layer does not have multi-dimensional info."));else{this.setImageFormat("LERC",!0);a=this.fullExtent.xmin;var c=this.fullExtent.ymax,b=f.clone(this._map.extent),d=this._map.width*(1/this.symbolTileSize),d=d?Math.ceil(d):50,g=this._map.height*(1/this.symbolTileSize),g=g?Math.ceil(g):
Math.ceil(d*((b.ymax-b.ymin)/(b.xmax-b.xmin))),k=(b.xmax-b.xmin)/d,h=(b.ymax-b.ymin)/g;b.xmin=a+Math.floor((b.xmin-a)/k)*k;b.xmax=a+Math.ceil((b.xmax-a)/k)*k;b.ymin=c+Math.floor((b.ymin-c)/h)*h;b.ymax=c+Math.ceil((b.ymax-c)/h)*h;this._requestData(b,d,g)}},_drawPixelData:function(){this.clear();if(this.pixelData){var a=this.pixelData.pixelBlock,d=this.pixelData.extent,b=this.pixelData.locations,e=r.isDefined(a.mask)&&0<a.mask.length;if(a&&d&&b){if(this.useDefaultRenderer&&this.renderer&&(!r.isDefined(this._minMag)||
!r.isDefined(this._maxMag))){var f=this._getServiceMinMaxStats();f?(this._minMag=f.min,this._maxMag=f.max):(this._minMag=a.statistics[0].minValue,this._maxMag=a.statistics[0].maxValue);var f={type:"sizeInfo",minSize:c.px2pt(0.2*this.symbolTileSize),maxSize:c.px2pt(0.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},g=[];g.push(f);g.push({type:"colorInfo"});this.renderer.setVisualVariables(g)}for(var l=g=f=0,p,n=d.spatialReference?d.spatialReference._getInfo():null,f=0;f<
a.height;f++)for(g=0;g<a.width;g++,l++)if(p=b[l],(!e||a.mask[l])&&p&&2===p.length){p=new s(p[0],p[1],d.spatialReference);n&&(p.x=q.prototype._normalizeX(p.x,n).x);var u={Magnitude:a.pixels[0][l],Direction:a.pixels[1][l],Location:h.toJson(p.toJson())};p=new k(p,null,u);this.add(p)}}}},_getServiceMinMaxStats:function(){if(!r.isDefined(this.minValues)||!r.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var a=this.minValues[0],c=this.maxValues[0],b=this.minValues[1],
d=this.maxValues[1];if(this.pixelFilter&&a&&c&&b&&d){var e=[];e.push([a,c]);e.push([b,d]);b=this._createPixelData(e);this.pixelFilter(b);b&&(b.pixelBlock&&b.pixelBlock.pixels&&0<b.pixelBlock.pixels.length)&&(a=b.pixelBlock.pixels[0][0],c=b.pixelBlock.pixels[0][1])}return a&&c?{min:a,max:c}:null},_updateVectorFieldRenderer:function(){var a={type:"sizeInfo",minSize:c.px2pt(0.2*this.symbolTileSize),maxSize:c.px2pt(0.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},e=[];e.push(a);
a=new d({style:this.rendererStyle,visualVariables:e,flowRepresentation:this._vectorFlowRepresentation});this.setRenderer(a)},_getField:function(a,c){if(r.isDefined(a))return c&&(a=a.toLowerCase()),"magnitude"!==a&&"direction"!==a?null:{name:a,alias:a,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_setFlowRepresentation:function(a){a&&(this.renderer&&r.isDefined(a.FlowDirection))&&(this._vectorFlowRepresentation=
"oceanographic"===a.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}})})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(n,f){return n(f,{constructor:function(f,h){this.noLegend=!0},getExtent:function(){},initVisible:function(){},_setTopLayerVisible:function(f){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},
setOpacity:function(f){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred ./LayerInfoForDefault esri/layers/FeatureLayer".split(" "),function(n,f,g,h,e,p){return n(e,{isTable:null,constructor:function(){this.newSubLayers=[];this.isTable=!0},init:function(){},getLayerObject:function(){var e=new h;if(this.layerObject.empty)if(this.layerObject.url){var a=
this._getLayerOptionsForCreateLayerObject();this.layerObject=new p(this.layerObject.url,f.mixin(a,this.originOperLayer.options||{})||{});this.layerObject.on("load",f.hitch(this,function(){e.resolve(this.layerObject)}));this.layerObject.on("error",f.hitch(this,function(){e.resolve(null)}))}else this.layerObject.featureCollectionData?(this.layerObject=new p(this.layerObject.featureCollectionData,this.originOperLayer.options||{}),e.resolve(this.layerObject)):e.resolve(null);else e.resolve(this.layerObject);
return e},getLayerType:function(){var e=new h;e.resolve("Table");return e},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return g.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplate:void 0}},getFilter:function(){return this.getFilterOfWebmap()}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault".split(" "),
function(n,f,g,h,e,p,r,a,l){return n(l,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=this.layerObject.serviceDataType&&("esriImageServiceDataTypeVector-UV"===this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.layerObject.serviceDataType)?"ArcGISImageServiceVectorLayer":"ArcGISImageServiceLayer"},_initLegendsNode:function(a){10.2<=this.layerObject.version?this._legendRequestServer().then(h.hitch(this,
function(e){f.empty(a);g.forEach(e.layers,function(e){g.forEach(e.legend,function(e){if("\x3call other values\x3e"!==e.label){var c=f.create("div",{"class":"legend-div"},a),g=f.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},c),h=null,h=e.imageData?"data:"+e.contentType+";base64,"+e.imageData:e.url;f.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:h},g);f.create("div",
{"class":"legend-label jimu-float-leading",innerHTML:e.label||" "},c)}},this)},this)}),h.hitch(this,function(){f.empty(a)})):f.empty(a)},_legendRequestServer:function(){var d=this.layerObject.url+"/legend",e={f:"json"};this.layerObject._params.bandIds&&(e.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(e.renderingRule=this.layerObject._params.renderingRule);return a({url:d,content:e,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var a=
new e,f={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},g=this.getLayerType(),k=this.getLayerObject();p({type:g,layerObject:k}).then(h.hitch(this,function(c){var e=c.type;c=c.layerObject;f.layerType=e;0<=this._getLayerTypesOfSupportTable().indexOf(e)&&(f.isSupportedLayer=!0);c.capabilities&&0<=c.capabilities.indexOf("Catalog")?f.isSupportQuery=!0:f.isSupportedLayer=!1;a.resolve(f)}),function(){a.resolve(f)});return a},_bindEvent:function(){var a;this.inherited(arguments);this.layerObject&&
!this.layerObject.empty&&(a=r.after(this.layerObject,"setRenderingRule",h.hitch(this,this._onRendererChanged)),this._eventHandles.push(a))}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(n,f,g,h,e){return n(e,{getSupportTableInfo:function(){var e=new g,n={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},a=this.getLayerType(),l=this.getLayerObject();
h({type:a,layerObject:l}).then(f.hitch(this,function(a){var f=a.type;a=a.layerObject;n.layerType=f;0<=this._getLayerTypesOfSupportTable().indexOf(f)&&(n.isSupportedLayer=!0);if((f=a.getLatestObservations())&&0<f.length)n.otherReasonCanNotSupport=!1;e.resolve(n)}),function(){e.resolve(n)});return e}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(n,
f,g,h,e,p,r,a,l){return p("dijit.layout._LayoutWidget",[f,g,h],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);r.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var a=this.getParent&&this.getParent();if(!a||!a.isLayoutContainer)this.resize(),this.own(e.on("resize",n.hitch(this,"resize")))}},resize:function(d,e){var f=this.domNode;d&&a.setMarginBox(f,d);var g=e||{};n.mixin(g,
d||{});if(!("h"in g)||!("w"in g))g=n.mixin(a.getMarginBox(f),g);var c=l.getComputedStyle(f),m=a.getMarginExtents(f,c),h=a.getBorderExtents(f,c),g=this._borderBox={w:g.w-(m.w+h.w),h:g.h-(m.h+h.h)},m=a.getPadExtents(f,c);this._contentBox={l:l.toPixelValue(f,c.paddingLeft),t:l.toPixelValue(f,c.paddingTop),w:g.w-m.w,h:g.h-m.h};this.layout()},layout:function(){},_setupChild:function(a){r.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,e){this.inherited(arguments);
this._started&&this._setupChild(a)},removeChild:function(a){r.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t){s("dijit-legacy-requires")&&
t(0,function(){n(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return g("dijit.Menu",m,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):f.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return k.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(b){b=h.byId(b,this.ownerDocument);var c;if("iframe"==b.tagName.toLowerCase()){var f=b;c=this._iframeContentWindow(f);c=q.body(c.document)}else c=b==q.body(this.ownerDocument)?this.ownerDocument.documentElement:b;var g={node:b,
iframe:f};e.set(b,"_dijitMenu"+this.id,this._bindings.push(g));var k=l.hitch(this,function(b){var c=this.selector,e=c?function(a){return d.selector(c,a)}:function(a){return a},g=this;return[d(b,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<g._lastKeyDown+500||g._scheduleOpen(this,f,{x:a.pageX,y:a.pageY},a.target)}),d(b,e("keydown"),function(b){if(93==b.keyCode||b.shiftKey&&b.keyCode==a.F10||g.leftClickToOpen&&b.keyCode==a.SPACE)b.stopPropagation(),
b.preventDefault(),g._scheduleOpen(this,f,null,b.target),g._lastKeyDown=(new Date).getTime()})]});g.connects=c?k(c):[];f&&(g.onloadHandler=l.hitch(this,function(){var a=this._iframeContentWindow(f),a=q.body(a.document);g.connects=k(a)}),f.addEventListener?f.addEventListener("load",g.onloadHandler,!1):f.attachEvent("onload",g.onloadHandler))},unBindDomNode:function(a){var c;try{c=h.byId(a,this.ownerDocument)}catch(d){return}a="_dijitMenu"+this.id;if(c&&e.has(c,a)){for(var f=e.get(c,a)-1,g=this._bindings[f],
k;k=g.connects.pop();)k.remove();(k=g.iframe)&&(k.removeEventListener?k.removeEventListener("load",g.onloadHandler,!1):k.detachEvent("onload",g.onloadHandler));e.remove(c,a);delete this._bindings[f]}},_scheduleOpen:function(a,c,d,e){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:e,delegatedTarget:a,iframe:c,coords:d})},1))},_openMyself:function(a){function d(){n.refocus&&t&&t.focus();c.close(n)}var e=a.target,f=a.iframe,g=a.coords,k=!g;this.currentTarget=
a.delegatedTarget;if(g){if(f){a=p.position(f,!0);var e=this._iframeContentWindow(f),e=p.docScroll(e.document),m=r.getComputedStyle(f),l=r.toPixelValue,q=(s("ie")&&s("quirks")?0:l(f,m.paddingLeft))+(s("ie")&&s("quirks")?l(f,m.borderLeftWidth):0),f=(s("ie")&&s("quirks")?0:l(f,m.paddingTop))+(s("ie")&&s("quirks")?l(f,m.borderTopWidth):0);g.x+=a.x+q-e.x;g.y+=a.y+f-e.y}}else g=p.position(e,!0),g.x+=10,g.y+=10;var n=this,f=this._focusManager.get("prevNode");a=this._focusManager.get("curNode");var t=!a||
h.isDescendant(a,this.domNode)?f:a;c.open({popup:this,x:g.x,y:g.y,onExecute:d,onCancel:d,orient:this.isLeftToRight()?"L":"R"});this.focus();k||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);c.close(this)}},destroy:function(){f.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(n,f,g){return n("dgrid.OnDemandGrid",[f,g],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(n,f,g,h,e,p,r){function a(a,d){d&&d.nodeType&&a.appendChild(d)}function l(a,d,e,c){if(this.formatter){c=this.formatter;var f=this.grid.formatterScope;e.innerHTML="string"===typeof c&&f?f[c](d,a):this.formatter(d,a)}else null!=d&&e.appendChild(document.createTextNode(d))}var d=8>h("ie")&&
!h("quirks");f=f("dgrid.Grid",p,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!=typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,d){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);var e;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var c=a.columnId;if(c){d=c;e=a;break}a=a.parentNode}while(a&&a!=this.domNode)}if(!e&&"undefined"!=typeof d){var f=this.row(a);if(c=f&&f.element)for(var c=c.getElementsByTagName("td"),
g=0;g<c.length;g++)if(c[g].columnId==d){e=c[g];break}}if(null!=a)return{row:f||this.row(a),column:d&&this.column(d),element:e}},createRowCells:function(a,f,g,c){var m=e("table.dgrid-row-table[role\x3dpresentation]"),l=9>h("ie")||h("quirks")?e(m,"tbody"):m,b,p,n,y,A,w,C,u,E,D;g=g||this.subRows;p=0;for(n=g.length;p<n;p++){w=g[p];b=e(l,"tr");w.className&&e(b,"."+w.className);y=0;for(A=w.length;y<A;y++){C=w[y];u=C.id;E=C.field?".field-"+r.escapeCssIdentifier(C.field,"-"):"";(D="function"===typeof C.className?
C.className(c):C.className)&&(E+="."+D);E=e(a+(".dgrid-cell.dgrid-cell-padding"+(u?".dgrid-column-"+r.escapeCssIdentifier(u,"-"):"")+E.replace(/ +/g,"."))+"[role\x3d"+("th"===a?"columnheader":"gridcell")+"]");E.columnId=u;d?(u=e(E,"!dgrid-cell-padding div.dgrid-cell-padding"),E.contents=u):u=E;if(D=C.colSpan)E.colSpan=D;if(D=C.rowSpan)E.rowSpan=D;f(u,C);b.appendChild(E)}}return m},left:function(a,d){a.element||(a=this.cell(a));return this.cell(this._move(a,-(d||1),"dgrid-cell"))},right:function(a,
d){a.element||(a=this.cell(a));return this.cell(this._move(a,d||1,"dgrid-cell"))},renderRow:function(d,f){var g=this.createRowCells("td",function(c,e){var g=d;e.get?g=e.get(d):"field"in e&&"_item"!=e.field&&(g=g[e.field]);e.renderCell?a(c,e.renderCell(d,g,c,f)):l.call(e,d,g,c,f)},f&&f.subRows,d);return e("div[role\x3drow]\x3e",g)},renderHeader:function(){var f=this,l=this.headerNode,k=l.childNodes.length;for(l.setAttribute("role","row");k--;)e(l.childNodes[k],"!");k=this.createRowCells("th",function(c,
e){var f=e.headerNode=c;d&&(c=c.parentNode);var b=e.field;b&&(c.field=b);if(e.renderHeaderCell)a(f,e.renderHeaderCell(f));else if("label"in e||e.field)f.appendChild(document.createTextNode("label"in e?e.label:e.field));!1!==e.sortable&&(b&&"_item"!=b)&&(c.sortable=!0,c.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[k.id=this.id+"-header"]=this.columns;l.appendChild(k);this._sortListener&&this._sortListener.remove();this._sortListener=g(k,"click,keydown",
function(a){if("click"==a.type||32==a.keyCode||!h("opera")&&13==a.keyCode){var d=a.target,e,b,k;do if(d.sortable){k=[{attribute:e=d.field||d.columnId,descending:(b=f._sort[0])&&b.attribute==e&&!b.descending}];e={bubbles:!0,cancelable:!0,grid:f,parentType:a.type,sort:k};g.emit(a.target,"dgrid-sort",e)&&(f._sortNode=d,f.set("sort",k));break}while((d=d.parentNode)&&d!=l)}})},resize:function(){var a=this.headerNode.firstChild,d=this.contentNode,e;this.inherited(arguments);if(!h("ie")||7<h("ie")&&!h("quirks"))if(d.style.width=
"",d&&a&&(e=a.offsetWidth)!=d.offsetWidth)d.style.width=e+"px"},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(a,d){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(a){var d=this.columns,e;for(e in d){var c=d[e];if(c.field==a)return c.headerNode}},updateSortArrow:function(a,d){this._lastSortedArrow&&(e(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),e(this._lastSortedArrow,
"!"),delete this._lastSortedArrow);d&&(this._sort=a);if(a[0]){var f=a[0].attribute,c=a[0].descending,f=this._sortNode||this._findSortArrowParent(f),g;delete this._sortNode;f&&(f=f.contents||f,g=this._lastSortedArrow=e("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),g.innerHTML="\x26nbsp;",f.insertBefore(g,f.firstChild),e(f,c?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(a,d){return this.addCssRule("#"+r.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+r.escapeCssIdentifier(a,
"-"),d)},_configColumns:function(a,d){var e=[],c=d instanceof Array;r.each(d,function(f,g){"string"==typeof f&&(d[g]=f={label:f});!c&&!f.field&&(f.field=g);g=f.id=f.id||(isNaN(g)?g:a+g);this._configColumn&&(this._configColumn(f,g,d,a),g=f.id);c&&(this.columns[g]=f);f.grid=this;"function"===typeof f.init&&f.init();e.push(f)},this);return c?d:e},_destroyColumns:function(){var a=this.subRows,d=a&&a.length,e,c,f,g;this.cleanup();for(e=0;e<d;e++){c=0;for(g=a[e].length;c<g;c++)f=a[e][c],"function"===typeof f.destroy&&
f.destroy()}},configStructure:function(){var a=this.subRows,d=this._columns=this.columns;this.columns=!d||d instanceof Array?{}:d;if(a)for(d=0;d<a.length;d++)a[d]=this._configColumns(d+"-",a[d]);else this.subRows=[this._configColumns("",d)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=a;this._updateColumns()},setColumns:function(a){n.deprecated("setColumns(...)",
'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",a)},setSubRows:function(a){n.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",a)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});f.appendIfNode=a;f.defaultRenderCell=l;return f})},"put-selector/put":function(){(function(n){var f,
g=/[-+,> ]/;n([],f=function(h,e){function p(e){function f(){b&&(t&&b!=t)&&(t==e&&(k||(k=g.test(A)&&h.createDocumentFragment()))?k:t).insertBefore(b,m||null)}for(var k,c,m,t,b,v=arguments,x=v[0],y=0;y<v.length;y++){var A=v[y];if("object"==typeof A){c=!1;if(A instanceof Array){b=h.createDocumentFragment();for(var w=0;w<A.length;w++)b.appendChild(p(A[w]));A=b}if(A.nodeType)b=A,f(),t=A,m=0;else for(w in A)b[w]=A[w]}else if(c)c=!1,b.appendChild(h.createTextNode(A));else{1>y&&(e=null);c=!0;if(x=A.replace(n,
function(c,g,k,n,r,x){g&&(f(),"-"==g||"+"==g?(t=(m=b||t).parentNode,b=null,"+"==g&&(m=m.nextSibling)):("\x3c"==g?t=b=(b||t).parentNode:(","==g?t=e:b&&(t=b),b=null),m=0),b&&(t=b));if((c=!k&&n)||!b&&(k||r))"$"==c?(c=v[++y],t.appendChild(h.createTextNode(c))):(c=c||p.defaultTag,(g=d&&v[y+1]&&v[y+1].name)&&(c="\x3c"+c+' name\x3d"'+g+'"\x3e'),b=l&&~(a=c.indexOf("|"))?h.createElementNS(l[c.slice(0,a)],c.slice(a+1)):h.createElement(c));if(k)if("$"==n&&(n=v[++y]),"#"==k)b.id=n;else if(g=(c=b.className)&&
(" "+c+" ").replace(" "+n+" "," "),"."==k)b.className=c?(g+n).substring(1):n;else if("!"==A){var w;d?p("div",b,"\x3c").innerHTML="":(w=b.parentNode)&&w.removeChild(b)}else g=g.substring(1,g.length-1),g!=c&&(b.className=g);r&&("$"==x&&(x=v[++y]),"style"==r?b.style.cssText=x:(k="!"==r.charAt(0)?(r=r.substring(1))&&"removeAttribute":"setAttribute",x=""===x?r:x,l&&~(a=r.indexOf("|"))?b[k+"NS"](l[r.slice(0,a)],r.slice(a+1),x):b[k](r,x)));return""}))throw new SyntaxError("Unexpected char "+x+" in "+A);
f();t=x=b||t}}e&&k&&e.appendChild(k);return x}g=e||g;var n=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,a,l=!1;h=h||document;var d="object"==typeof h.createElement;p.addNamespace=function(a,d){h.createElementNS?(l||(l={}))[a]=d:h.namespaces.add(a,d)};p.defaultTag="div";p.forDocument=f;return p})})(function(n,f,g){g=g||f;"function"===typeof define?define([],function(){return g()}):"undefined"==typeof window?require("./node-html")(module,g):put=
g()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(n,f,g,h,e,p,r,a,l){function d(a,b){l(document.body,a,".dgrid-scrollbar-measure");var c=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return c}function s(a){var b=a?"."+a.replace(v,"."):"";this._class&&(b="!"+this._class.replace(v,"!")+
b);l(this.domNode,b);this._class=a}function q(){return this._class}function k(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function c(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}a("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var m,t;e.add("dom-scrollbar-width",function(a,b,c){return d(c,"Width")});e.add("dom-scrollbar-height",function(a,b,c){return d(c,"Height")});e.add("dom-rtl-scrollbar-left",
function(a,b,c){a=l("div");l(document.body,c,".dgrid-scrollbar-measure[dir\x3drtl]");l(c,a);b=!!e("ie")||!!e("trident")||a.offsetLeft>=e("dom-scrollbar-width");c.className="";document.body.removeChild(c);l(a,"!");c.removeAttribute("dir");return b});var b=0,v=/ +/g,x=7>e("ie")&&!e("quirks")?function(){var a,b,c;if(this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==a))this.resize(),this._prevWinDims=[b,a]}:function(){this._started&&this.resize()};
return f("dgrid.List",e("touch")?r:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,c){var d=
this.domNode=c||l("div"),g;a?(this.params=a,f.safeMixin(this,a),g=a["class"]||a.className||d.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=d.id=d.id||this.id||"dgrid_"+b++;null===this.useTouchScroll&&(this.useTouchScroll=!e("dom-scrollbar-width"));this.buildRendering();g&&s.call(this,g);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&
this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,c=this,d,f,g,k;k=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";l(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));d=this.headerNode=l(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(e("quirks")||8>e("ie"))&&l(a,"div.dgrid-spacer");f=this.bodyNode=l(a,"div.dgrid-scroller");
e("ff")&&(f.tabIndex=-1);this.headerScrollNode=l(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));g=this.footerNode=l("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));l(a,g);k&&(a.className+=" dgrid-rtl"+(e("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));h(f,"scroll",function(b){c.showHeader&&(d.scrollLeft=b.scrollLeft||f.scrollLeft);b.stopPropagation();h.emit(a,"scroll",{scrollTarget:f})});this.configStructure();this.renderHeader();this.contentNode=
this.touchNode=l(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=h(window,"resize",p.throttleDelayed(x,this)))},postCreate:e("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,b=this.headerNode,c=this.footerNode,d=b.offsetHeight,
f=this.showFooter?c.offsetHeight:0,g=e("quirks")||7>e("ie");this.headerScrollNode.style.height=a.style.marginTop=d+"px";a.style.marginBottom=f+"px";g&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-d-f,0)+"px",f&&(c.style.bottom="1px",setTimeout(function(){c.style.bottom=""},0)));m||(m=e("dom-scrollbar-width"),t=e("dom-scrollbar-height"),e("ie")&&(m++,t++),p.addCssRule(".dgrid-scrollbar-width","width: "+m+"px"),p.addCssRule(".dgrid-scrollbar-height","height: "+t+"px"),17!=m&&
!g&&(p.addCssRule(".dgrid-header-row","right: "+m+"px"),p.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+m+"px")));g&&(b.style.width=a.clientWidth+"px",setTimeout(function(){b.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,b){var c=p.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(c);return c},on:function(a,b){var c=h(this.domNode,a,b);e("dom-addeventlistener")||this._listeners.push(c);return c},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=
this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();l(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";
this.scrollTo({x:0,y:0})},newRow:function(a,b,c,d,e){if(b){var f=this.insertRow(a,b,c,d,e);l(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){l(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&l(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=
b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<n)for(var f=0;f<b.length;f++){var g=b[f],k=q[g?0:q.length-1];if(k=k&&e(k)){var h=k[g?"previousSibling":"nextSibling"];h&&(h=m.row(h));h&&h.element!=k&&(g=g?"unshift":"push",a[g](h.data),q[g](h.element),c.count++)}}}function e(a){return!g.isDescendant(a,m.domNode)&&document.getElementById(a.id)?m.row(a.id.slice(m.id.length+5)).element:a}function f(a){v=m.insertRow(a,s,null,h++,c);v.observerIndex=
n;return v}function k(a){t=a.slice(0);(p=b?b.parentNode:m.contentNode)&&p.parentNode&&(p!==m.contentNode||a.length)?(p.insertBefore(s,b||null),(v=a[a.length-1])&&m.adjustRowIndices(v)):l[n]&&m.cleanEmptyObservers&&"undefined"!==typeof n&&(l[n].cancel(),l[n]=0,m._numObservers--);q=a;r&&(r.rows=q)}c=c||{};var m=this,h=c.start||0,l=this.observers,q,p,n;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){m._numObservers++;var r=a.observe(function(f,g,k){var h,l,r;-1<g&&q[g]&&(h=q.splice(g,
1)[0],h.parentNode==p&&((l=h.nextSibling)&&g!=k&&l.rowIndex--,m.removeRow(h)),c.count--,m._processScroll&&m._processScroll());if(-1<k){if(q.length)if(0===k)r=(r=q[k])&&e(r);else{if(r=q[k-1])r=e(r),r=(r.connected||r).nextSibling}else r=m._getFirstRowSibling&&m._getFirstRowSibling(p);h&&(r&&h.id===r.id)&&(r=(r.connected||r).nextSibling);r&&!r.parentNode&&(r=document.getElementById(r.id));h=b&&b.parentNode||r&&r.parentNode||m.contentNode;if(h=m.newRow(f,h,r,c.start+k,c))if(h.observerIndex=n,q.splice(k,
0,h),!l||k<g)l=h.previousSibling,l=!l||l.rowIndex+1==h.rowIndex||0==h.rowIndex?h:l;c.count++}0===g?d(1,1):g===a.length-(-1===k?0:1)&&d(0,0);g!=k&&l&&m.adjustRowIndices(l);m._onNotification(q,f,g,k)},!0);n=l.push(r)-1}var s=document.createDocumentFragment(),v,t;if(a.map){if(q=a.map(f,console.error),q.then)return a.then(function(b){a=b;return q.then(function(a){k(a);d(1,1,0,0);return t})})}else{q=[];for(var x=0,M=a.length;x<M;x++)q[x]=f(a[x])}k(q);d(1,1,0,0);return t},_onNotification:function(a,b,c,
d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),k=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,
c||null);k&&this.adjustRowIndices(k);g.rowIndex=d;return g},renderRow:function(a,b){return l("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||l(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):
(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||
(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:e("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):c.call(this,a)}:c,getScrollPosition:e("touch")?function(){return this.useTouchScroll?this.inherited(arguments):k.call(this)}:k,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,
1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:q,_setClass:s,_getClassName:q,_setClassName:s,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,
d){var e=c[a],f=d[a];void 0===e&&(e="");void 0===f&&(f="");return e==f?0:e>f==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){n.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;l(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){n.deprecated("setShowHeader(...)",
'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;l(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(n,f){n.add("dom-contains",function(a,d,e){return!!e.contains});var g=[],h,e,p,r=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,a={defaultDelay:15,throttle:function(e,d,f){var g=!1;f=f||a.defaultDelay;return function(){g||(g=!0,e.apply(d,arguments),
setTimeout(function(){g=!1},f))}},throttleDelayed:function(e,d,f){var g=!1;f=f||a.defaultDelay;return function(){if(!g){g=!0;var a=arguments;setTimeout(function(){g=!1;e.apply(d,a)},f)}}},debounce:function(e,d,f){var g;f=f||a.defaultDelay;return function(){g&&(clearTimeout(g),g=null);var a=arguments;g=setTimeout(function(){e.apply(d,a)},f)}},each:function(a,d,e){var f,g;if(a)if("number"===typeof a.length){f=0;for(g=a.length;f<g;f++)d.call(e,a[f],f,a)}else for(f in a)d.call(e,a[f],f,a)},contains:function(a,
d){return n("dom-contains")?a.contains(d):a.compareDocumentPosition(d)&8},addCssRule:function(a,d){h||(h=f(document.getElementsByTagName("head")[0],"style"),h=h.sheet||h.styleSheet,e=h.deleteRule?"deleteRule":"removeRule",p=h.cssRules?"cssRules":"rules");var n=g.length;g[n]=(h.cssRules||h.rules).length;h.addRule?h.addRule(a,d):h.insertRule(a+"{"+d+"}",g[n]);return{get:function(a){return h[p][g[n]].style[a]},set:function(a,d){"undefined"!==typeof g[n]&&(h[p][g[n]].style[a]=d)},remove:function(){var a=
g[n],d,c;if(void 0!==a){h[e](a);g[n]=void 0;d=n+1;for(c=g.length;d<c;d++)g[d]>a&&g[d]--}}}},escapeCssIdentifier:function(a,d){return"string"===typeof a?a.replace(r,d||"\\$1"):a}};return a})},"xstyle/has-class":function(){define(["dojo/has"],function(n){var f={};return function(){for(var g,h=arguments,e=0;e<h.length;e++)if(g=h[e],!f[g]){f[g]=!0;var p=g.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),r=n(p[2]),a=-p[4];if((0<a?a<=r&&(-p[5]||a)>=r:!!r)==!p[1])document.documentElement.className+=" has-"+
g}}})},"xstyle/css":function(){define(["require"],function(n){function f(f,h,e){var p=document.documentElement;f=p.insertBefore(document.createElement(f),p.firstChild);f.id=h;h=(f.currentStyle||getComputedStyle(f,null)||{})[e];p.removeChild(f);return h}return{load:function(g,h,e,p){function r(a){var d=f("x-parse",null,"content"),g=a&&(a.sheet||a.styleSheet);d&&"none"!=d&&"normal"!=d?h([eval(d)],function(c){a?c.process(a,e):(c.processAll(),e(g))}):e(g)}var a=h.toUrl(g),l;a.match(/!$/)&&(l={wait:!1},
a=a.slice(0,-1));var d=h.cache&&h.cache["url:"+a];if(d)d.xCss&&(d=d.cssText),n(["./core/load-css"],function(a){r(a.insertCss(d))});else{if("none"==f("div",g.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return r();n(["./core/load-css"],function(d){d(a,r,l)})}}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(n,f,g,h,e,p,r,a,l){return g("dgrid.OnDemandList",
[n,f],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:a.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var d=this;r(this.bodyNode,"scroll",a[this.pagingMethod](function(a){d._processScroll(a)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(a,f){function g(a){l(y,
"!");if(a)throw k._refreshDeferred&&(k._refreshDeferred.reject(a),delete k._refreshDeferred),a;}var k=this,c=f&&f.container||this.contentNode,m={query:a,count:0,options:f},p,b=this.preload,n,r={node:l(c,"div.dgrid-preload",{rowIndex:0}),count:0,query:a,next:m,options:f};r.node.style.height="0";m.node=p=l(c,"div.dgrid-preload");m.previous=r;p.rowIndex=this.minRowsPerPage;b?((m.next=b.next)&&p.offsetTop>=b.node.offsetTop?m.previous=b:(m.next=b,m.previous=b.previous),m.previous.next=m,m.next.previous=
m):this.preload=m;var y=l(p,"-div.dgrid-loading");l(y,"div.dgrid-below").innerHTML=this.loadingMessage;f=h.mixin(this.get("queryOptions"),f,{start:0,count:this.minRowsPerPage},"level"in a?{queryLevel:a.level}:null);this._trackError(function(){return n=a(f)});if("undefined"===typeof n)g();else return e.when(k.renderArray(n,p,f),function(a){return e.when("undefined"===typeof n.total?n.length:n.total,function(b){var c=a.length,d=p.parentNode,e=k.noDataNode;l(y,"!");"queryLevel"in f||(k._total=b);0===
b&&d&&(e&&(l(e,"!"),delete k.noDataNode),k.noDataNode=e=l("div.dgrid-no-data"),d.insertBefore(e,k._getFirstRowSibling(d)),e.innerHTML=k.noDataMessage);for(e=d=0;e<c;e++)d+=k._calcRowHeight(a[e]);c&&d&&(k.rowHeight=d/c);d=k.rowHeight*k.bufferRows;d>k.farOffRemoval&&(k.farOffRemoval=d);b-=c;m.count=b;p.rowIndex=c;b?p.style.height=Math.min(b*k.rowHeight,k.maxEmptySpace)+"px":(p.style.display="none",f.count++);k._previousScrollPosition&&(k.scrollTo(k._previousScrollPosition),delete k._previousScrollPosition);
k._processScroll();k._refreshDeferred&&(k._refreshDeferred.resolve(n),delete k._refreshDeferred);return a},g)},g),n},refresh:function(a){var f=this,g=a&&a.keepScrollPosition,k;"undefined"===typeof g&&(g=this.keepScrollPosition);g&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return g=this._refreshDeferred=new e,k=f.renderQuery(function(a){return f.store.query(f.query,a)}),"undefined"===typeof k&&g.reject(),g.then(function(a){f._refreshTimeout=setTimeout(function(){r.emit(f.domNode,
"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:f,results:a});f._refreshTimeout=null},0);delete f._refreshDeferred;return a},function(a){delete f._refreshDeferred;throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var e=a.nextSibling;return e&&!/\bdgrid-preload\b/.test(e.className)?e.offsetTop-a.offsetTop:a.offsetHeight},lastScrollTop:0,_processScroll:function(a){function f(a,b,d,e){var k=
c.farOffRemoval,m=a.node;if(b>2*k){for(var h,p=m[d],n=0,r=0,s=[];h=p;){var t=c._calcRowHeight(h);if(n+t+k>b||0>p.className.indexOf("dgrid-row")&&0>p.className.indexOf("dgrid-loading"))break;p=h[d];n+=t;r+=h.count||1;c.removeRow(h,!0);s.push(h)}a.count+=r;e?(m.rowIndex-=r,g(a)):m.style.height=m.offsetHeight+n+"px";var v=l("div",s);setTimeout(function(){l(v,"!")},1)}}function g(a,b){a.node.style.height=Math.min(a.count*c.rowHeight,b?Infinity:c.maxEmptySpace)+"px"}function k(a,b){do a=b?a.next:a.previous;
while(a&&!a.node.offsetWidth);return a}var c=this,m=c.bodyNode;a=a&&a.scrollTop||this.getScrollPosition().y;var m=m.offsetHeight+a,p,b,n=c.preload,r=c.lastScrollTop,y=c.bufferRows*c.rowHeight,A=y-c.rowHeight,w,C,u,E=!0;for(c.lastScrollTop=a;n&&!n.node.offsetWidth;)n=n.previous;for(;n&&n!=p;){p=c.preload;c.preload=n;b=n.node;var D=b.offsetTop;if(m+1+A<D)n=k(n,E=!1);else if(a-1-A>D+b.offsetHeight)n=k(n,E=!0);else{var B=((b.rowIndex?a-y:m)-D)/c.rowHeight,D=(m-a+2*y)/c.rowHeight,G=Math.max(Math.min((a-
r)*c.rowHeight,c.maxRowsPerPage/2),c.maxRowsPerPage/-2),D=D+Math.min(Math.abs(G),10);0==b.rowIndex&&(B-=D);B=Math.max(B,0);10>B&&(0<B&&D+B<c.maxRowsPerPage)&&(D+=Math.max(0,B),B=0);D=Math.min(Math.max(D,c.minRowsPerPage),c.maxRowsPerPage,n.count);if(0==D)n=k(n,E);else{var D=Math.ceil(D),B=Math.min(Math.floor(B),n.count-D),I=h.mixin(c.get("queryOptions"),n.options);n.count-=D;var K=b,R,N=c.queryRowsOverlap;if(G=(0<b.rowIndex||b.offsetTop>a)&&n){var P=n.previous;P&&(f(P,a-(P.node.offsetTop+P.node.offsetHeight),
"nextSibling"),0<B&&P.node==b.previousSibling?(B=Math.min(n.count,B),n.previous.count+=B,g(n.previous,!0),b.rowIndex+=B,N=0):D+=B,n.count-=B);I.start=b.rowIndex-N;I.count=Math.min(D+N,c.maxRowsPerPage);b.rowIndex=I.start+I.count}else n.next&&(f(n.next,n.next.node.offsetTop-m,"previousSibling",!0),K=b.nextSibling,K==n.next.node?(n.next.count+=n.count-B,n.next.node.rowIndex=B+D,g(n.next),n.count=B,N=0):R=!0),I.start=n.count,I.count=Math.min(D+N,c.maxRowsPerPage);R&&(K&&K.offsetWidth)&&(R=K.offsetTop);
g(n);"level"in n.query&&(I.queryLevel=n.query.level);if("queryLevel"in I||!(I.start>c._total||0>I.count)){b=l(K,"-div.dgrid-loading[style\x3dheight:"+D*c.rowHeight+"px]");l(b,"div.dgrid-"+(G?"below":"above")).innerHTML=c.loadingMessage;b.count=D;var J=n.query(I);if(void 0===c._trackError(function(){return J})){l(b,"!");return}(function(a,b,d,f){u=e.when(c.renderArray(f,a,I),function(k){C=f;K=a.nextSibling;l(a,"!");if(d&&K&&K.offsetWidth){var m=c.getScrollPosition();c.scrollTo({x:m.x,y:m.y+K.offsetTop-
d,preserveMomentum:!0})}e.when(f.total||f.length,function(a){"queryLevel"in I||(c._total=a);b&&(b.count=a-b.node.rowIndex,0===b.count&&I.count++,g(b))});c._processScroll();return k},function(b){l(a,"!");throw b;})}).call(this,b,G,R,J);n=n.previous}}}}if(u&&(w=this._refreshDeferred))delete this._refreshDeferred,e.when(u,function(){w.resolve(C)})},removeRow:function(a,e){if(a){var f=a.previousSibling,g=a.nextSibling,f=f&&(null!=f.observerIndex?f.observerIndex:f.previousObserverIndex),c=g&&(null!=g.observerIndex?
g.observerIndex:g.nextObserverIndex),g=a.observerIndex;a.observerIndex=void 0;e&&(a.nextObserverIndex=c,a.previousObserverIndex=f);if(this.cleanEmptyObservers&&(-1<g&&g!==f&&g!==c)&&(f=this.observers,c=f[g])){if(!e)for(var m=c.rows,h=0;h<m.length;h++)if(m[h]!=a&&p.isDescendant(m[h],this.domNode))return this.inherited(arguments);c.cancel();this._numObservers--;f[g]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),
function(n,f,g,h,e,p,r){function a(a){return a}function l(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;a.grid=this;e.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return f("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};p.before(this,"configStructure",
g.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_updateNotifyHandle:function(a){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);a&&("function"===typeof a.notify&&this.shouldObserveStore)&&
(this._notifyHandle=p.after(a,"notify",g.hitch(this,"_onNotify"),!0),a=this.get("sort"),(!a||!a.length)&&console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(a,e,f){this._updateNotifyHandle(a);this.store=a;this.dirty={};this.set("query",e,f)},_setQuery:function(a,e){var f=e&&e.sort;this.query=void 0!==a?a:this.query;this.queryOptions=e||
this.queryOptions;this._started&&(f?this.set("sort",f):this.refresh())},setStore:function(a,e,f){n.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",a,e,f)},setQuery:function(a,e){n.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",a,e)},_getQueryOptions:function(){var a=g.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;
return"object"==typeof a&&null!=a?g.delegate(a,{}):a},_setSort:function(a,e){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(a,e){this.inherited(arguments);a&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var a=this.inherited(arguments);this.store||(this.noDataNode=r(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return a},renderArray:function(){var a=this,e=this.inherited(arguments);this.store||
h.when(e,function(e){e.length&&a.noDataNode&&r(a.noDataNode,"!")});return e},insertRow:function(a,e,f,k,c){var m=this.store,h=this.dirty,m=m&&m.getIdentity(a),b;m in h&&!(m in this._updating)&&(b=h[m]);b&&(a=g.delegate(a,b));return this.inherited(arguments)},updateDirty:function(a,e,f){var g=this.dirty,c=g[a];c||(c=g[a]={});c[e]=f},setDirty:function(a,e,f){n.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(a,e,f)},save:function(){function a(b,c){return function(a){var d=
e._columnsWithSet,m=e._updating,l,p;if("function"===typeof a.set)a.set(c);else for(l in c)a[l]=c[l];for(l in d)p=d[l].set(a),void 0!==p&&(a[l]=p);m[b]=!0;return h.when(f.put(a),function(){delete g[b];delete m[b]})}}var e=this,f=this.store,g=this.dirty,c=new h,m=c.promise,l=function(a){var b;return e.getBeforePut||!(b=e.row(a).data)?function(){return f.get(a)}:function(){return b}},b;for(b in g)var p=a(b,g[b]),m=m.then(l(b)).then(p);c.resolve();return m},revert:function(){this.dirty={};this.refresh()},
_trackError:function(d){var e;"string"==typeof d&&(d=g.hitch(this,d));try{e=d()}catch(f){l.call(this,f)}return h.when(e,a,g.hitch(this,l))},newRow:function(){var a=this.inherited(arguments);this.noDataNode&&(r(this.noDataNode,"!"),delete this.noDataNode);return a},removeRow:function(a,e){var f={element:a};!e&&(this.noDataMessage&&this.up(f).element===a&&this.down(f).element===a)&&(this.noDataNode=r(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},
"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(n,f,g,h,e,p,r,a,l){function d(a,c){for(var d=a.unselectable=c?"on":"",e=a.getElementsByTagName("*"),f=e.length;--f;)"INPUT"===e[f].tagName||"TEXTAREA"===e[f].tagName||(e[f].unselectable=d)}function s(a,c){var f=a.bodyNode,g=c?"text":21>e("ff")?"-moz-none":"none";k&&"msUserSelect"!==
k?f.style[k]=g:e("dom-selectstart")?!c&&!a._selectstartHandle?a._selectstartHandle=h(f,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):c&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):(d(f,!c),!c&&!a._unselectableHandle?a._unselectableHandle=p.after(a,"renderRow",function(a){d(a,!0);return a}):c&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle))}e.add("dom-comparedocumentposition",
function(a,c,d){return!!d.compareDocumentPosition});e.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});e.add("css-user-select",function(a,c,d){a=d.style;c=["Khtml","O","ms","Moz","Webkit"];d=c.length;var e="userSelect";do if("undefined"!==typeof a[e])return e;while(d--&&(e=c[d]+"UserSelect"));return!1});e.add("dom-selectstart","undefined"!==typeof document.onselectstart);var q=e("mac")?"metaKey":"ctrlKey",k=e("css-user-select"),c=(r=e("pointer"))&&
"MS"===r.slice(0,2),m=r?r+(c?"Down":"down"):"mousedown",t=r?r+(c?"Up":"up"):"mouseup";"WebkitUserSelect"===k&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(k=!1);return f("dgrid.Selection",null,{selectionDelegate:".dgrid-row",selectionEvents:m+","+t+",dgrid-cellfocusin",selectionTouchEvents:e("touch")?a.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};
return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=
a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){n.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?s(this,a):s(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,c){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(c))&&!("dgrid-cellfocusin"===
a.type&&"mousedown"===a.parentType||a.type===t&&c!=this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===m&&this.isSelected(c))this._waitForMouseUp=c;else this[this._selectionHandlerName](a,c);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,c){var d=a.keyCode?a.ctrlKey:a[q];this._lastSelected===c?this.select(c,null,!d||!this.isSelected(c)):(this.clearSelection(),this.select(c),this._lastSelected=
c)},_multipleSelectionHandler:function(a,c){var d=this._lastSelected,e=a.keyCode?a.ctrlKey:a[q],f;a.shiftKey||(f=e?null:!0,d=null);this.select(c,d,f);d||(this._lastSelected=c)},_extendedSelectionHandler:function(a,c){(2===a.button?!this.isSelected(c):!(a.keyCode?a.ctrlKey:a[q]))&&this.clearSelection(null,!0);this._multipleSelectionHandler(a,c)},_toggleSelectionHandler:function(a,c){this.select(c,null,null)},_initSelectionEvents:function(){var b=this,c=this.contentNode,d=this.selectionDelegate;this._selectionEventQueues=
{deselect:[],select:[]};e("touch")&&!e("pointer")&&this.selectionTouchEvents?(h(c,a.selector(d,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),h(c,h.selector(d,this.selectionEvents),function(a){b._ignoreMouseSelect!==this?b._handleSelect(a,this):a.type===t&&(b._ignoreMouseSelect=null)})):h(c,h.selector(d,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",
function(a){a[q]&&(65==a.keyCode&&!/\bdgrid-input\b/.test(a.target.className))&&(a.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setStore&&p.after(this,"_setStore",function(){b._updateDeselectionAspect()});this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(b,d,e){b=d||b&&b[c.idProperty||"id"];if(null!=b&&(d=(b=c.row(b))&&c.selection[b.id]))c[e](b,null,d)}var c=this,d=this.store,e,f;this._removeDeselectSignals&&this._removeDeselectSignals();
d&&d.notify?(e=p.before(d,"notify",function(c,d){c||a(c,d,"deselect")}),f=p.after(d,"notify",function(c,d){a(c,d,"select")},!0),this._removeDeselectSignals=function(){e.remove();f.remove()}):(e=p.before(this,"removeRow",function(a,b){var c;b||(c=this.row(a))&&c.id in this.selection&&this.deselect(c)}),this._removeDeselectSignals=function(){e.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var c=this._selectionEventQueues[a],d=this._selectionTriggerEvent,e;e={bubbles:!0,
grid:this};d&&(e.parentType=d.type);e[this._selectionTargetType]=c;this._selectionEventQueues[a]=[];h.emit(this.contentNode,"dgrid-"+a,e)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,c;for(c in a)a[c].length&&this._fireSelectionEvent(c)},_select:function(a,c,d){var e,f,g;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(e=this.selection,f=!!e[a.id],null===d&&(d=!f),g=a.element,!d&&!this.allSelected?delete this.selection[a.id]:e[a.id]=
d,g&&(d?l(g,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):l(g,"!dgrid-selected!ui-state-active")),d!==f&&g&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),c)if(c.element||(c=this.row(c)),c){if(c=c.element){e=this._determineSelectionDirection(g,c);e||(c=document.getElementById(c.id),e=this._determineSelectionDirection(g,c));for(;a.element!=c&&(a=this[e](a));)this._select(a,null,d)}}else this._lastSelected=g,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},
_determineSelectionDirection:e("dom-comparedocumentposition")?function(a,c){var d=c.compareDocumentPosition(a);return d&1?!1:2===d?"down":"up"}:function(a,c){return 1>c.sourceIndex?!1:c.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,c,d){this._select(a,c,d);this._fireSelectionEvents()},deselect:function(a,c){this.select(a,c,!1)},clearSelection:function(a,c){this.allSelected=!1;for(var d in this.selection)a!==d&&this._select(d,null,!1);c||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var c=this.row(this._rowIdToObject[a]);this._select(c.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this,c=this.inherited(arguments);g.when(c,function(c){var d=a.selection,e,f,g;for(e=0;e<c.length;e++)f=a.row(c[e]),(g=f.id in d?d[f.id]:a.allSelected)&&a._select(f,null,g);a._fireSelectionEvents()});return c}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(n,f,g,h,e){function p(d){d=document.getElementsByTagName(d);for(var e=0;e<d.length;e++)a(d[e])}function r(){p("link");
p("style")}function a(d,e,f){function g(){n(["xstyle/core/load-imports"],function(b){b(d,function(){a(d,e,!0)})})}function c(a){for(var b=a.cssRules,c=0;c<b.length;c++){var d=b[c];if(d.selectorText&&"x-"==d.selectorText.substring(0,2)&&(h=!0,/^'/.test(d.style.content)))return l(eval(d.style.content),a,e),!0}}var m=d.sheet||d.styleSheet;if(m&&(!m.processed||f)){m.processed=!0;var h=m.needsParsing,b=m.rules||m.cssRules;if((m.href||m.imports&&m.imports.length)&&!f)return g();if(!h)for(var p=0;p<b.length;p++){var r=
b[p];if(r.href&&!f){if(!c(r.styleSheet))return g();return}}l(m.localSource||(m.ownerNode||m.owningElement).innerHTML,m,e)}}function l(a,e,h){e.addRule||(e.addRule=function(a,d,e){return this.insertRule(a+"{"+d+"}",0<=e?e:this.cssRules.length)});e.deleteRule||(e.deleteRule=e.removeRule);var k=1;(e.href||location.href).replace(/[^\/]+$/,"");g.css=a;f(g,a,e);0==--k&&h&&h(e);return g}h.ready(r);f.getStyleSheet=function(a,e){return a.styleSheet||a};return{process:a,processAll:r,parse:l,generate:e,update:h.update,
load:function(d,e,f,g){e(["xstyle/css"],function(c){c.load(d,e,function(c){c?a({sheet:c},f):(r(),f())},g)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function n(){this.push.apply(this,arguments)}function f(a){this.value=a}function g(){var a,d=this.args[0];if("string"==typeof d)a=d.split(/\s*,\s*/);else if(d){a=[];for(var c=0,e=0;e<d.length+1;e++){var f=d[e];if("string"==typeof f||void 0===f)if(f=f&&f.split(/\s*,\s*/),1<a.length||void 0===f){var b=d.slice(c,e);
0<c&&b.unshift(a.pop());c=e+1;a.push(b);f&&a.push.apply(a,f.slice(1))}}}else return[];return a}function h(q,k,c){function m(c,k){function A(a){E=!1;var c=b.lastIndex;a.then(function(){E=!0;d&&(b.lastIndex=c,w())});var d=!0}function w(){function q(a){a&&("string"==typeof a&&P)&&(a=P+a);F?F.push?"string"==typeof F[F.length-1]&&"string"==typeof a?F[F.length-1]+=a:a&&F.push(a):"string"==typeof F&&"string"==typeof a?F+=a:F=new n(F,a):F=a}for(E=!0;E;){var r=b.exec(c);if(!r)break;var w=r[5],P=r[1],J=r[2],
H=r[3],O=r[4],L,M,F,Q,O=O&&d(O),J=J&&d(J);I?(H?(M=J,L=H.charAt(0),Q="?"==H.charAt(1),-1<H.indexOf("\n")&&(O=H.slice(1))):O=J,F=O,I=!1):(O=H?J+H:J,q(O));"{"!=w&&(G+=r[0]);switch(w){case "'":case '"':var U="'"==w?e:p;U.lastIndex=b.lastIndex;(w=U.exec(c))||C("unterminated string");J=w[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});b.lastIndex=U.lastIndex;q(new f(J));G+=w[0];continue;case "\\":w=U.lastIndex++;q(c.charAt(w));continue;case "(":case "{":case "[":if("{"==
w){I=!0;":"==L&&H&&(J+=H);G=d((G+J).replace(/\s+/g," "));q(H=u.newRule(G));"\x3d"==L&&(B=!1,F.creating=!0);var z=null,aa=D;if(r[6]&&(O=k.cssRules||k.rules,H.cssRule=z=O[r[6].slice(1)]))G=z.selectorText;if(u.root&&B)for(O=k.cssRules||k.rules;z=O[D++];)if(z.selectorText==G||z.selectorText&&z.selectorText.replace(/::/g,":").replace(/'/g,'"')==G.replace(/::/g,":").replace(/'/g,'"')){H.cssRule=z;break}z||(H.ruleIndex=D=aa);H.styleSheet=k;F.creating?(H.selector="."+("\x3d"==L?J.match(/[\w-]*$/g,"")[0]:
"")+"-x-"+l++,H.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(G)?H.setMediaSelector(G):H.selector=u.root?G:u.selector+" "+G;G=""}else J=O.match(/(.*?)([\w-]*)$/),q(H=u.newCall(J[2],F,u)),H.ref=u.getDefinition(J[2]),H.getArgs=g,(F.calls||(F.calls=[])).push(H);u.currentName=M;u.currentSequence=F;u.assignmentOperator=L;var W;if("{"==w&&(W=H.selector.match(/[@:]\w+/)))W=W[0],(M=u.getDefinition(W))&&M.selector&&M.selector(H);v.push(u=H);u.operator=w;u.start=b.lastIndex;F=M=null;continue}if(F)if(J="string"==
typeof F?F:F[0],J.charAt&&"@"==J.charAt(0))if(r=J.match(/\w+/)[0],"import"==r)J=h.getStyleSheet((k.cssRules||k.imports)[D++],F,k),r=b.lastIndex,m(J.localSource,J),b.lastIndex=r;else{if("xstyle"==r){if("start"==J.slice(8,13))H=u?u.newRule(""):Y,H.root=u.root,v.push(u=H);else{var Y=u||Y;v.pop();u=v[v.length-1]}b=u?s:/(@[\w\s])/g}}else if("\x3d"===L)try{var T=u.declareDefinition(M,F,Q);T&&T.then&&A(T)}catch(ba){C(ba)}switch(w){case ":":"\x3d"==L?(I=!0,L=":"):q(":");break;case "}":if(M&&!u.root&&!u.isMediaBlock)try{u[":"==
L?"setValue":"declareDefinition"](M,F,Q)}catch(ca){C(ca)}case ")":case "]":a[u.operator]!=w&&C("Incorrect opening operator "+u.operator+" with closing operator "+w);M=null;M=c.slice(u.start,b.lastIndex-1);u.cssText=u.cssText?u.cssText+";"+M:M;if("}"==w){"}"==V&&(V=u.parent.selector)&&"@"==!V.charAt(0)&&C("A nested rule must end with a semicolon");if(u.root)C("Unmatched "+w);else{try{u.onRule(u.selector,u)}catch(da){C(da)}B=!0}G=""}if(")"==w||"]"==w)u.args=[F];if(")"==w&&!L){try{T=v[v.length-2].onArguments(u)}catch(ea){C(ea)}T&&
T.then&&A(T)}v.pop();u=v[v.length-1];F=u.currentSequence;M=u.currentName;L=u.assignmentOperator;if(u.root&&"}"==w){if(L)try{u[":"==L?"setValue":"declareDefinition"](M,F,Q)}catch(fa){C(fa)}I=!0;L=!1}break;case "":case void 0:return;case ";":if(u&&M){try{(T=u[":"==L?"setValue":"declareDefinition"](M,F,Q))&&T.then&&A(T)}catch($){C($)}M}F=null;I=!0;L=B=!1;G=""}var V=w}}function C(a){var d=c.slice(0,b.lastIndex).split("\n"),e=d[d.length-1],d=(k.href||"in-page stylesheet")+":"+d.length+":"+e.length+" near:\n"+
e.slice(-40);if(m.onerror)m.onerror(a,d);console.error(a.message||a,d);a.stack&&console.error(a.stack)}c=c.replace(r,function(a){return a.replace(/[^\n]/g,"")});var u=q;b.lastIndex=0;var E,D=0,B=!0,G="",I=!0;w()}c=c||{addRule:function(){},cssRules:[]};var s,b=s=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,v=[q];q.parse=m;m(k,c)}var e=/((?:\\.|[^'])*)'/g,p=/((?:\\.|[^"])*)"/g,r=/\/\*[\w\W]*?\*\//g,
a={"{":"}","[":"]","(":")"},l=0,d="".trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},s=n.prototype=[];s.toString=function(){return this.join("")};s.isSequence=!0;f.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};f.prototype.isLiteralString=!0;return h})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),
function(n,f,g,h,e,p,r){function a(c,d,e){function f(a){return{selectElement:function(d){e.newElement&&(d=d.parentNode);if(a&&a.selector)for(;!b(d,a);)if(d=d.parentNode,!d)throw Error("Rule not found");if(e.inherit)for(;!(c in d);)if(d=d.parentNode,!d)throw Error(c?c+" not found":"Property was never defined");return d},forElement:function(b){var d=b;b=this.selectElement(b);e.newElement&&(b["_"+c+"Node"]=d);b=e.get?e.get(b,c):b[c];return void 0===b&&a?q(c).valueOf().forRule(a):b},forRule:e.inherit&&
function(a){return f(a)}}}var k=new g(function(){return f(d)});k.define=function(b,d){return a(c||d,b,e)};k.keepCSSValue=!0;k.put=e.inherit?function(a,b){return q(c).put(a,b,c)}:function(a){return{forElement:function(f){if(d&&d.selector)for(;!b(f,d);)if(f=f.parentNode,!f)throw Error("Rule not found");e.set?e.set(f,c,a):f[c]=a;k.invalidate({elements:[f]})}}};return k}function l(a,b,c,d){return h.when(f.evaluate(a,c),function(b){b.forElement?n.addRenderer(a,function(a){d(b.forElement(a),a)}):d(b)})}
function d(a,b){return{apply:function(c,d,e){l(c,e,d[0],function(d,f){d.observe(function(d){d=d?a:b;value.toString().replace(RegExp(a+"\\([^)]+\\)","g"),d);f?f.style[e]=d:c.setStyle(e,d)})})}}}function s(a,b){var c=a.variables;if(c&&b in c)return c[b];if(c=a.bases)for(var d=0;d<c.length;d++){var e=s(c[d],b);if(void 0!==e)return e}}function q(a){var b=v[a];b||(b=v[a]=new g(function(){return{forRule:function(b){a:{do{var c=s(b,a);if(void 0!==c){b=c;break a}b=b.parent}while(b);b=void 0}return b}}}),
b.put=function(a,c,d){return{forRule:function(c){function e(a){f.push(a);for(var b in a.rules)e(a.rules[b])}(c.variables||(c.variables={}))[d]=a;for(var f=[];c;)e(c),c=c.parent;b.invalidate({rules:f})}}});return b}var k=e("div"),c=navigator.userAgent,m=-1<c.indexOf("WebKit")?"-webkit-":-1<c.indexOf("Firefox")?"-moz-":-1<c.indexOf("MSIE")?"-ms-":-1<c.indexOf("Opera")?"-o-":"",t;p=new p;var b=n.matchesRule;p.root=!0;var v={};p.definitions={Math:Math,window:window,global:window,module:f.selfResolving(function(a,
b){a[0].value&&(a=a[0].value);b||require([a]);return{then:function(b){return(new r.Promise(function(b){require([a],function(a){b(a)})})).then(b)}}}),item:a("item",null,{inherit:!0}),pageContent:new g,content:a("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:a(null,null,{}),elementClass:a(null,null,{get:function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")},set:function(a,b,c){this.get(a,b)!=c&&(a.className=c?a.className+(" "+b):(" "+a.className+" ").replace(" "+
b+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(c){for(;!b(c,a);)if(c=c.parentNode,!c)throw Error("Rule not found");return c}}}},event:{observe:function(a){a(t)},valueOf:function(){return t}},each:{put:function(a){return{forRule:function(b){b.each=a}}}},prefix:{put:function(a,b,c){return{forRule:function(b){if("string"==typeof k.style[m+c])return b._setStyleFromValue(m+c,a),!0}}}},"var":{define:function(a,b){return q(b)},
selfResolving:!0,apply:function(a,b){return q(h.convertCssNameToJs(b[0]))}},inline:d("inline","none"),block:d("block","none"),visible:d("visible","hidden"),"extends":{apply:function(a,b){for(;0<b.length;)return h.extend(a,b[0],console.error)}},set:{selfExecuting:!0,apply:function(a,b){return b[0].put(b[1].valueOf())}},get:{apply:function(a,b){return b[0]},put:function(a,b){f.evaluate(b,a)}},toggle:{selfExecuting:!0,apply:function(a,b){return b[0].put(!b[0].valueOf())}},on:{put:function(a,b,c){return{forRule:function(b){n.on(document,
c.charAt(2).toLowerCase()+c.slice(3),b,function(d){t=d;try{h.when(f.evaluate(b,a).valueOf(),function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&a.forElement(d.target);t=null},function(b){console.error("Error in "+c+" event handler, executing "+a,b)})}catch(e){console.error("Error in "+c+" event handler, executing "+a,e)}})}}}},title:{put:function(a){return{forRule:function(b){f.observe(f.evaluate(b,a),function(a){document.title=a})}}}},"@supports":{selector:function(a){function b(a){var c;
if(c=a.match(/^\s*not(.*)/))return!b(c[1]);if(c=a.match(/\((.*)\)/))return b(c[1]);if(c=a.match(/([^:]*):(.*)/))return a=h.convertCssNameToJs(c[1]),c=k.style[a]=c[2],k.style[a]==c;if(c=a.match(/\w+\[(.*)=(.*)\]/))return e(c[0])[c[1]]==c[2];if(c=a.match(/\w+/))return h.isTagSupported(c);throw Error("can't parse @supports string");}b(a.selector.slice(10))?a.selector="":a.disabled=!0}},"true":!0,"false":!1,"null":null};p.elementProperty=a;return p})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",
["put-selector/put","xstyle/core/utils"],function(n,f){function g(a,b,c,d){function e(a){if(!c)return d(a);var b=a.target;do if(w(b,c))return d(a);while((b=b.parentNode)&&1===b.nodeType)}q?a.addEventListener(b,e,!!k[b]):h(a,k[b]||b,e)}function h(a,b,c){b="on"+b;var d=a[b];a[b]=function(a){a=a||window.event;a.target=a.target||a.srcElement;d&&d(a);c(a)}}function e(a){/e/.test(d.readyState||"")?a():d.addEventListener("DOMContentLoaded",a)}function p(a){for(var b=d.querySelectorAll(a.selector),c=a.name,
e=0,f=b.length;e<f;e++){var g=b[e],k=g.elementalStyle;k||(k=g.elementalStyle={},g.elementalSpecificities={});var m=g.renderings;m||(m=g.renderings=[],x.push(g));m.push({name:c,rendered:k[c]==a.propertyValue,renderer:a});k[c]=a.propertyValue}}function r(){for(;x.length;){for(var a=x.shift(),b=a.renderings,c=a.elementalStyle;b.length;){var d=b.shift(),e=d.renderer,f=e.rendered;A=c[d.name]==e.propertyValue;if(!f&&A)try{e.render(a)}catch(g){console.error(g,g.stack),n(a,"div.error",g.toString())}f&&(!A&&
e.unrender)&&e.unrender(a)}a.renderings=void 0}}function a(a,c){for(var d=0,e=b.length;d<e;d++){var f=b[d];(!c||c==f.selector)&&w(a,f.rule)&&f.render(a)}}function l(a,c){var d={selector:a.selector,rule:a,render:c};b.push(d);y&&p(d);r();return{remove:function(){b.splice(b.indexOf(d),1)}}}var d=document,s=1,q=!!d.addEventListener,k={blur:"focusout",focus:"focusin"};g(d,"change",null,function(a){a=a.target;for(var b=0,c=v.length;b<c;b++){var d=v[b];if(-1<(" "+a.className+" ").indexOf(d.rule.selector.slice(1))){var e=
d.definition.valueOf();e&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&(e=e.forElement(a));var f="checkbox"===a.type?a.checked:a.value;"number"===typeof e&&isFinite(f)&&(f=+f);(e=d.definition.put(f))&&e.forRule&&(e=e.forRule(d.rule));e&&e.forElement&&e.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&g(d,"keydown",null,function(a){if(13==a.keyCode){var b=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),b.dispatchEvent(a);else document.onchange({target:b})}});
var c=d.createElement("div"),m={"dom-qsa2.1":!!c.querySelectorAll},t=c.matches||c.matchesSelector||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector,b=[],v=[],x=[],y;e(function(){if(!y)if(y=!0,m["dom-qsa2.1"]){for(var c=0,e=b.length;c<e;c++)p(b[c]);r()}else for(var f=d.all,c=0,e=f.length;c<e;c++)a(f[c])});var A,w=t?function(a,b){return t.call(a,b.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId="x-ie-"+s++,"true");return!!a.currentStyle[b.ieId]};return{ready:e,
on:g,matchesRule:w,addRenderer:l,addInputConnector:function(a,b){v.push({rule:a,definition:b})},update:a,clearRenderers:function(){b=[]},observeForElement:function(a,b,c){return f.when(a,function(a){function d(a){a.observe?a.observe(c):c(a)}a.forElement?l(b,function(b){d(a.forElement(b))}):d(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function n(e,f){for(var g=0,a=e.length;g<a;g++){var h=e[g];if(h&&"object"==typeof h&&f in h)return!0}}function f(e,f){return f.toUpperCase()}
var g="div"==document.createElement("div").tagName,h={};return{when:function(e,f,g){return e&&e.then?e.then(f,g)||e:f(e)},whenAll:function(e,f){return n(e,"then")?{then:function(g,a){function h(){d--;d||g(f(n))}for(var d=1,n=[],q=0;q<e.length;q++){var k=e[q];d++;k&&k.then?function(c){k.then(function(a){n[c]=a;h()},a)}(q):(n[q]=k,h())}h()},inputs:e}:f(e)},convertCssNameToJs:function(e){return e.replace(/-(\w)/g,f)},isTagSupported:function(e){if(e in h)return h[e];var f=document.createElement(e);g?
(f=f.toString(),f=!("[object HTMLUnknownElement]"==f||"[object]"==f)):f=f.tagName==e.toUpperCase();return h[e]=f},extend:function(e,f){var g=f.split(".");f=g[0];var a=e.getDefinition(f,"rules");g[0]="";e.selector+=e.extraSelector=g.join(".");if(a)return this.when(a,function(a){if(a.extend)a.extend(e,!0);else for(var d in a)e[d]=a[d]});e.tagName=f;if(!this.isTagSupported(f))throw Error("Extending undefined definition "+f);},someHasProperty:n}})},"xstyle/core/expression":function(){define("xstyle/core/expression",
["xstyle/core/utils","xstyle/core/Definition"],function(n,f){function g(a,d){var e=d[0];return e&&a?(e=l(e),g(a.property?a.property(e):a[e],d.slice(1))):a}function h(a,e,f){if(d(e,a)){var b={};b[a]=function(b){for(var d=[],g=0,k=e.length;g<k;g++){var h=e[g];h&&"function"==typeof h[a]&&(h=h[a](b));d[g]=h}return f(d)};return b}return f(e)}function e(a,d){return{apply:function(e,b,f){for(var g=0,k=b.length;g<k;g++){var l=b[g];l.dependencyOf&&l.dependencyOf(f)}g=function(){var d=[];if(a.selfExecuting)return a.apply(e,
b,f);for(var g=0,k=b.length;g<k;g++)d[g]=b[g].valueOf();if(a.selfWaiting)return a.apply(e,d,f);d.push(e);return n.whenAll(d,function(b){var d=b.pop();return h("forRule",b,function(b){return h("forElement",b,function(b){return a.apply(d,b,f)})})})};g.reverse=function(a){return d(a,b)};return g}}}function p(a){return q[a]||(q[a]=new Function("a","b","return "+a))}function r(a,d,f,b,g){function h(a){a.skipResolve=!0;a.precedence=d;a.infix=!1!==g}var l=function(a,c){var d=c[0],e=c[1];if(d&&d.put)e=b(a,
e&&e.valueOf()),e!==s&&d.put(e);else if(e&&e.put)e.put(g(a,d&&d.valueOf()));else throw new TypeError("Can not put");},q={apply:function(d,m,q){var n;f=p(f);b=b&&p(b);g=g&&p(g);k[a]=n=e(f,l);h(n);return n.apply(d,m,q)}};h(q);k[a]=q}function a(c,d){function h(a){for(;p<=a.precedence;){var b=r.pop(),c=k[r.pop()],d=new f;d.setCompute(c.apply(null,c.infix?[r.pop(),b]:[b],d));s=r.length?r[r.length-1]:void 0;r.push(d);p=s&&k[s]&&k[s].precedence}}var b,l;d=d.join?d.slice():[d];for(b=0;b<d.length;b++)if(l=
d[b],"string"==typeof l){var q=l.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);l=[b,1];q&&l.push.apply(l,q);d.splice.apply(d,l);b+=l.length-3}var p,r=[],s,q={};for(b=0;b<d.length;b++){l=d[b];if("("==l.operator){var C=r[r.length-1];void 0===C||k.hasOwnProperty(C)?l=a(c,l.getArgs()[0]):(r.pop(),l=function(b,d){function g(f){return n.when(b.valueOf(),function(g){var l=b.parent&&b.parent.valueOf();if(!g.selfResolving){if(!k){k=[];for(var q=0,p=d.length;q<p;q++)k[q]=a(c,d[q]);h=g.selfReacting?
g.apply(l,k,m):e(g).apply(l,k,m)}return h()}g=g.apply(l,d,m);return f?g:g.valueOf()})}var k,h,m=new f(g);m.setReverseCompute(function(){var a=arguments;return n.when(g(!0),function(b){return b.put.apply(b,a)})});return m}(C,l.getArgs()))}else if(k.hasOwnProperty(l))C=k[l],h(C),p=(s||C).precedence;else if(-1<l)l=+l;else if(l.isLiteralString)l=l.value;else{l=l.split(/\s*\/\s*/);var C=l[0],u=c.getDefinition(C);if("string"==typeof u||u instanceof Array)u=a(c,u);else if(void 0===u)throw Error('Could not find reference "'+
C+'"');q[C]=u;1<l.length&&(u=g(u,l.slice(1)));l=u}r.push(l)}h({precedence:100});if(1<r.length)throw Error("Could not reduce expression");l=r[0];l.inputs=q;return l}var l=n.convertCssNameToJs,d=n.someHasProperty,s={},q={},k={};r("+",6,"a+b","a-b","a-b");r("-",6,"a-b","a+b","b-a");r("*",5,"a*b","a/b","a/b");r("/",5,"a/b","a*b","b/a");r("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");r(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");r("!",4,"!a","!a",!1);r("%",5,"a%b");r("\x3e",
8,"a\x3eb");r("\x3e\x3d",8,"a\x3e\x3db");r("\x3c",8,"a\x3cb");r("\x3c\x3d",8,"a\x3c\x3db");r("\x3d\x3d",9,"a\x3d\x3d\x3db");r("\x26",8,"a\x26\x26b");r("|",8,"a||b");return{react:e,evaluate:a,selfResolving:function(a){a.selfResolving=!0;return a}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(n,f){function g(a){(this.computeValue=a)&&a.reverse&&this.setReverseCompute(a.reverse)}function h(a,g,d){if(g&&g.forElement)return{forElement:function(h){h=g.selectElement?
g.selectElement(h):h;var q=["_cache_"+a.id];if(q in h){var k=h[q+"observe"];k.addKey&&k.addKey(d);return h[q][d]}var c=h[q]=g.forElement(h),m=h[q+"observe"]=e(a,c,d,{elements:[h]});h.xcleanup=function(a){a&&f.unobserve(c,m)};return c[d]}}}function e(a,e,d,g){var h=a._properties,k;"object"==typeof e&&(k=function(a){for(var d=0;d<a.length;d++){var e=h[a[d].name];e&&e.invalidate&&e.invalidate(g)}},f.observe(e,k),k.addKey&&k.addKey(d));return k}var p={},r=1;g.prototype={id:"x-variable-"+r++,cache:p,valueOf:function(){if((this.dependents||
this._properties)&&this.cache!==p)return this.cache;var a=this,e=this.computeValue;if(e.then)return this.cache=e.then(function(d){a.computeValue=d;(d=a.cache=d())&&d.then&&d.then(function(d){a.cache=d});return d});(e=a.cache=e())&&e.then&&e.then(function(d){a.cache=d});return e},property:function(a){var f=this._properties||(this._properties={}),d=f[a];if(!d){var p=this,d=f[a]=new g(function(){return n.when(p.valueOf(),function(d){if(d&&d.forRule)return{forRule:function(c){c=d.selectRule?d.selectRule(c):
c;var f=["_cache_"+p.id],g;if((g=f in c?c[f]:c[f]=d.forRule(c))&&g.forElement)return h(p,g,a);var b=c[f+"observe"];b&&(b.addKey?b.addKey(a):c[f+"observe"]=e(p,g,a,{rules:[c]}));return g[a]}};if(d&&d.forElement)return h(p,d,a);var f=p.cacheObserve;f?f.addKey&&f.addKey(a):f=p.cacheObserve=e(p,d,a);return d[a]})});d.key=a;d.parent=this;d.put=function(d){return n.when(p.valueOf(),function(e){function c(c){if(c.forElement)return{forElement:function(e){c.forElement(e)[a]=d}};c[a]=d}if(e.forRule)return{forRule:function(a){return c(e.forRule(a))}};
c(e)})};d.id=this.id+"-"+a}return d},invalidate:function(a){var e=this.cacheObserve;e&&(f.unobserve(this.cache,e),this.cacheObserve=null);this.cache=p;var d,e=this._properties;for(d in e)e[d].invalidate(a);var g=this.dependents||0;d=0;for(e=g.length;d<e;d++)try{g[d].invalidate(a)}catch(h){console.error(h,"invalidating a definition")}},dependencyOf:function(a){(this.dependents||(this.dependents=[])).push(a)},notDependencyOf:function(a){for(var e=this.dependents||0,d=0;d<e.length;d++)e[d]===a&&e.splice(d--,
1)},setReverseCompute:function(a){this.put=function(){var e=a.apply(this,arguments);this.invalidate();return e}},setCompute:function(a){(this.computeValue=a)&&a.reverse&&this.setReverseCompute(a.reverse);this.invalidate()},setSource:function(a){this.computeValue=function(){return a};this.invalidate()},observe:function(a){this.computeValue&&a(this.valueOf());var e=this;return this.dependencyOf({invalidate:function(){a(e.valueOf())}})},newElement:function(){return n.when(this.valueOf(),function(a){return a&&
a.newElement&&a.newElement()})}};return g})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function n(a,d,e){r?-1===r.indexOf(a)&&r.push(a):(r=[a],setTimeout(function(){r.forEach(function(a){var c=[];a.properties.forEach(function(d){c.push({target:a.object,name:d})});a(c);a.object=null;a.properties=null});r=null},0));a.object=d;a=a.properties||(a.properties=[]);-1===a.indexOf(e)&&a.push(e)}function f(){return f}var g=Object.observe,h;if(h=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});h=!0;break a}catch(e){}h=void 0}var p={observe:g,defineProperty:h,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},g=p.observe?Object.observe:p.defineProperty?function(a,d){d.addKey=function(e){var b="key"+e;if(!this[b]){this[b]=!0;var f=a[e];if((b=Object.getOwnPropertyDescriptor(a,e))&&b.set){var g=b.set,k=b.get;Object.defineProperty(a,e,{get:function(){return f=k.call(this)},set:function(a){g.call(this,a);f!==a&&(f=a,d&&n(d,this,e))}})}else Object.defineProperty(a,
e,{get:function(){return f},set:function(a){f!==a&&(f=a,d&&n(d,this,e))}})}};d.remove=function(){d=null}}:function(c,e){s||(s=!0,setInterval(function(){for(var b=0,c=a.length;b<c;b++){var e=l[b],f=a[b],g=d[b],k=void 0,h=void 0;for(h in e)e.hasOwnProperty(h)&&e[h]!==f[h]&&(e[h]=f[h],(k||(k=[])).push({name:h}));for(h in f)f.hasOwnProperty(h)&&!e.hasOwnProperty(h)&&(e[h]=f[h],(k||(k=[])).push({name:h}));k&&g(k)}},20));var f={},b;for(b in c)c.hasOwnProperty(b)&&(f[b]=c[b]);a.push(c);l.push(f);d.push(e)},
r;h=p.observe?Object.unobserve:function(c,e){e.remove&&e.remove();for(var f=0,b=a.length;f<b;f++)if(a[f]===c&&d[f]===e){a.splice(f,1);l.splice(f,1);d.splice(f,1);break}};var a=[],l=[],d=[],s=!1,q=1,k=function(){};k.prototype.toJSON=f;return{Promise:p.promise?Promise:function(){function a(d){function e(a){a&&a.then?a.then(e,b):(k=a,f())}function b(a){h=a;f()}function f(){g=!0;for(var a=0,b=l.length;a<b;a++)l[a]();l=0}var g,k,h,l=0;d(e,b);return{then:function(b,d){return new a(function(a,c){function e(){try{h&&
!d?c(h):a(h?d(h):b?b(k):k)}catch(f){c(f)}}g?e():(l||(l=[])).push(e)})}}}return a}(),WeakMap:p.WeakMap?WeakMap:function(a,d){var e="__"+(d||"")+q++;return p.defineProperty?{get:function(a){return a[e]},set:function(a,c){Object.defineProperty(a,e,{value:c,enumerable:!1})}}:{get:function(a){return(a=a[e])&&a.value},set:function(a,c){(a[e]||(a[e]=new k)).value=c}}},observe:g,unobserve:h,copy:function(a,d){for(var e in d)a[e]=d[e];return a}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(n,f,g,h,e){function p(a,c,d){try{a[c]=d}catch(e){}}function r(){}function a(a,c,d,e){if(a.calls){var g;for(d=0;d<a.length;d++){var k=a[d];if(k instanceof l){a.hasOwnProperty(d)||(a[d]=k=q(k));var h=k.ref&&(k.ref.selfResolving?k.ref.apply(c,k.getArgs(),c):n.evaluate(c,[k.caller,k]));void 0!==h&&((g||(g=[])).push(h),k.evaluated=!0)}}}if(g)return c=n.react(function(){for(var c=0,d=a.slice(),e=0;e<a.length;e++){var f=
a[e];f instanceof l&&f.evaluated&&(d[e-1]=a[e-1].slice(0,-f.caller.length),d[e]=arguments[c++])}return d.join("")}),c.skipResolve=!0,e=new f,e.setCompute(c.apply(e,g,e)),e;if(!e)return a.toString()}function l(a){this.caller=a;this.args=[]}function d(a,c,d,f){return e.when(c,function(c){var e=c;c&&c.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=e.forRule(a,!0);b&&b.forElement?s(a,b,f):d&&d(b)}),c=c.forRule(a));if(c&&c.forElement)return s(a,c,f);d&&d(c)})}function s(a,
c,d){return require(["xstyle/core/elemental"],function(e){e.addRenderer(a,function(a){var b=c.forElement(a);d&&d(b,a)})})}var q=Object.create||function(a){function c(){}c.prototype=a;return new c},k=e.convertCssNameToJs,c={"{":"}","[":"]","(":")"},m=g("div").style;r.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var c=this.values||0,d=0;d<c.length;d++){var e=c[d];a.call(this,e||"unnamed",
c[e])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new r;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new l(a);a.parent=this;return a},addSheetRule:function(a,c){if("@"!=a.charAt(0)){var d=this.styleSheet,e=d.cssRules||d.rules,f=-1<this.ruleIndex?this.ruleIndex:e.length;try{d.addRule(a,c||" ",f)}catch(g){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,c)}return e[f]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var c=0;c<this.installStyles.length;c++){var d=this.installStyles[c];p(a.style,d[0],d[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,c){this.cssRule?p(this.cssRule.style,a,c):(this.installStyles||(this.installStyles=[])).push([a,c])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var c=this;require(["xstyle/core/elemental"],function(d){d.addRenderer(c,function(c){a(c)})})},declareDefinition:function(a,c,d){a=a&&k(a);if(!this.disabled){var f=this;if(c.length)if("\x3e"==c[0].toString().charAt(0))a||(this.generator=c,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,b){c=a.forSelector(c,f);b.addRenderer(f,c)}));else{var g=a in m||this.getDefinition(a);if(!d||!g){d=this.definitions||(this.definitions={});var h=c[0];if(h.indexOf&&-1<h.indexOf(","))for(var h=
c.join("").split(/\s*,\s*/),l=[],q=0;q<h.length;q++)l[q]=n.evaluate(this,h[q]);c[0]&&"{"==c[0].operator?l=c[0]:c[1]&&"{"==c[1].operator&&(l=c[1],e.extend(l,c[0]));l=l||n.evaluate(this,c);if(l.then)var p=l,l={then:function(a){return p.then(function(b){return a(r(b))})}};var r=function(c){c.define&&(c=c.define(f,a));return c};g&&console.warn('Overriding existing property "'+a+'"');return d[a]=r(l)}}else return d=this.definitions||(this.definitions={}),d[a]=c}},onArguments:function(a){var c=a.ref;return c&&
c.apply(this,a.getArgs(),this)},setValue:function(a,c,e){var f=k(a);if(!this.disabled){var g=this.values||(this.values=[]);g.push(a);g[a]=c;if(a){do{g=(e||this).getDefinition(a);if(void 0!==g){if(this.cssRule&&(!g||!g.keepCSSValue)){var h=this.cssRule.style;f in h&&p(h,f,"")}d(this,g.put(c,this,f))}a=a.substring(0,a.lastIndexOf("-"))}while(a)}f in m&&this._setStyleFromValue(f,c,!0)}},_setStyleFromValue:function(b,c,d){var f=c[0];if(f instanceof r){d=f.values;for(f=0;f<d.length;f++){var g=d[f];this._setStyleFromValue(b+
("main"==g?"":g.charAt(0).toUpperCase()+g.slice(1)),d[g])}}else{if(c.calls){var k=this;if(c.expression=a(c,this,b,!0)){var h=c.expression&&c.expression.valueOf(),m=function(a,c){var d=h&&h.forRule?h.forRule(a,!0):h;if(d&&d.forElement){var e=c&&c.elements;if(e)for(var f=0;f<e.length;f++)for(var g=e[f].querySelectorAll(a.selector),k=0;k<g.length;k++){var m=g[k];p(m.style,b,d.forElement(m))}else s(a,d,function(a,c){p(c.style,b,a)})}else a.setStyle(b,d)},l=[k];e.when(h,function(a){if((h=a)&&h.forRule)(k._subRuleListeners||
(k._subRuleListeners=[])).push(function(a){l.push(a);m(a)});m(k)});c.expression.dependencyOf({invalidate:function(a){e.when(c.expression.valueOf(),function(b){h=b;for(b=0;b<l.length;b++){var c=!0,d=l[b];if(a&&a.rules)for(var c=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===d){c=!0;break}c&&m(d,a)}})}})}}d||this.setStyle(b,c)}},put:function(a){var c=this;return{forRule:function(d){c.extend(d);if("defaults"!=a&&a&&"string"==typeof a&&c.values)for(var e=a.toString().split(/,\s*/),f=0;f<e.length;f++){var g=
c.values[f];g&&d.setValue(g,e[f],c)}}}},extend:function(a,c){(this.derivatives||(this.derivatives=[])).push(a);var d=this.extraSelector;d&&(a.selector+=d);for(var e=this.cssRule.style,f=a.getCssRule().style,g=a.inheritedStyles||(a.inheritedStyles={}),d=0;d<e.length;d++){var l=k(e[d]);if(!f[l]||g[l])f[l]=e[l],g[l]=!0}if(d=this.values){var d=q(d),p=a.values;a.values=p?h.copy(d,p):d}if(c){if(d=this.definitions){var d=q(d),n=a.definitions;a.definitions=n?h.copy(d,n):d}a.tagName=this.tagName||a.tagName}(a.bases||
(a.bases=[])).push(this);l=this._subRuleListeners||0;for(d=0;d<l.length;d++)l[d](a);var r=a.getCssRule().style;this.eachProperty(function(c,d){var e=k(c);"object"==typeof d&&(d=q(d));e in m&&!r[e]&&a._setStyleFromValue(e,d)});if(p&&a.definitions){d=0;for(e=p.length;d<e;d++)l=p[d],f=k(l),a.definitions[f]!==(n&&n[f])&&a.setValue(l,p[f])}if(p=this.generator){if(p instanceof Array){p=p.slice(0);for(d=0;d<p.length;d++)n=p[d],"{"===n.operator&&(l=a.newRule(),l.selector=n.selector+a.selector.slice(1),l.styleSheet=
a.styleSheet||a.cssRule.parentStyleSheet,n.extend(l,!0),p[d]=l)}a.declareDefinition(null,p)}},getDefinition:function(a,c){a=k(a);var d=this;do{var e=d.definitions&&d.definitions[a];void 0===e&&(c&&d[c])&&(e=d[c][a]);d=d.parent}while(void 0===e&&d);return e},newElement:function(){return g((this.tagName||"span")+(this.selector||""))},cssText:""};n.evaluateText=a;var t=l.prototype=new r;t.declareDefinition=t.setValue=function(a,c){this.args.push(c)};t.toString=function(){var a=this.operator;return a+
this.args+c[a]};r.updateStaleProperties=function(){};return r})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(n,f,g,h,e){function p(a,c){a=a.sort?a:[a];return function(e,k,h){var q=e,p;"content"in e||(e.content=void 0);if(void 0===h){var s=(e._contentNode||e).childNodes||0,t=s[0];if(t){var D=m.createDocumentFragment();do D.appendChild(t);while(t=s[0]);e.content=
D}if(e._contentNode){e._contentNode=void 0;try{e.innerHTML=""}catch(B){}}}for(var G=0,I=[e],K=[],s=0,t=a.length;s<t;s++){var R=N,N=a[s];try{if(N.eachProperty){if(N.args)if("("==N.operator){var P=a[s+1];r(N,P,q,function(a,b,e){d(a,b,e,c)})}else{var J=N.args[0];if("string"===typeof J){var H=J.split("\x3d");try{q.setAttribute(H[0],H[1])}catch(O){console.error(O)}}else{var L=J[0].replace(/=$/,""),M=J[1];"("==M.operator?r(J[1],L,q,function(a,b,d){l(a,b,d,c)}):q.setAttribute(L,M.value)}}}else if("string"==
typeof N){"\x3d"==N.charAt(0)&&(N=N.slice(1));var F=q,P=a[s+1],H=[];N.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){H.push(arguments)});for(var Q=0;Q<H.length;Q++)(function(a,b,d,m,l,n,r){function s(){var a=F._contentNode;a&&(a.innerHTML="",F=a)}b?(a=d?d.length:0,a>G?(s(),I[a]=F):F=I[a]||F,G=a):s();var t;if(m)t=(R&&R.args?"":"span")+m+l;else{m=l.match(/^[-\w]+/);if(!m)throw new SyntaxError("Unable to parse selector",l);m=m[0];var u;Q===H.length-
1&&P&&P.selector?(P.bases||g.extend(P,m),u=P):u=c.getDefinition(m);u&&(u.then||u.newElement)?F=function(a,b,c,d){var e,k;g.when(u&&u.newElement&&u.newElement(),function(a){(e=a)?(c=c.slice(d.length))&&f(e,c):e=f(c);if(k){k.parentNode.replaceChild(e,k);a=k.childNodes;var b;for(e=e._contentNode||e;b=a[0];)e.appendChild(b)}});if(e)return a.insertBefore(e,b||null);k=f("span");return a.insertBefore(k,b||null)}(F,h,l,m):t=l}t&&(F=f(h||F,(h?"-":"")+t));h=null;n&&F.setAttribute(n,""===r?n:r);k&&(F.item=k);
p=p||F;(Q<H.length-1||F!=q&&F!=e)&&K.push(Q==H.length-1&&P&&P.selector,F);q=F}).apply(this,H[Q])}else q.appendChild(m.createTextNode(N.value))}catch(U){console.error(U,U.stack),q.innerHTML&&(q.innerHTML=""),q.appendChild(m.createTextNode(U))}}for(;N=K.pop();)n.update(N,K.pop());return p}}function r(a,c,d,e){var g,k;c&&c.eachProperty?(f(d,g=c.selector),k=c):(f(d,g=a.selector||(a.selector=".-xbind-"+t++)),k=a);var m=a.getArgs()[0],l=a.expressionResult,q=a.expressionDefinition;q||(q=a.expressionDefinition=
h.evaluate(a.parent,m),l=q.valueOf(),n.addInputConnector(k,q),function(c,d,f){a.expressionResult=l;f.dependencyOf&&f.dependencyOf({invalidate:function(a){a=a?n.matchesRule(a.elements[0],k)?a.elements:a.elements[0].querySelectorAll(d):document.querySelectorAll(d);for(var b=0,g=a.length;b<g;b++)e(a[b],c,f.valueOf())}})}(c,g,q));e(d,c,l)}function a(a,c,d,e){return g.when(a,function(a){a&&a.forRule&&(a=a.forRule(c));a&&a.forElement&&(a=a.forElement(d));e(a)})}function l(b,c,d,e){a(d,e,b,function(a){b.setAttribute(c,
a)})}function d(b,d,e,g){b._defaultBinding=!0;if(e&&e.then&&"INPUT"!==b.tagName)try{b.appendChild(m.createTextNode("Loading"))}catch(h){}a(e,g,b,function(a){if(b._defaultBinding)if(s(b),b.childNodes.length&&(b.innerHTML=""),a&&a.sort)if(a.isSequence)p(a,g)(b);else{var e=d&&d.definitions&&d.definitions.each,h=g.newRule(),e=e?p(e,h):function(a,b,c){return f(c||a,(c?"-":"")+(k[a.tagName]||"span"),""+b)},l=[],q;a.track&&(a=a.track(),q=a.tracking);a.forEach(function(a){l.push(e(b,a,null))});if(a.on)var n=
a.on("add,delete,update",function(a){var c=a.target,d=a.previousIndex;a=a.index;if(-1<d){var f=l[d];s(f,!0);f.parentNode.removeChild(f);l.splice(d,1)}-1<a&&l.splice(a,0,e(b,c,l[a]||null))});if(q=q||n)b.xcleanup=function(){q.remove()}}else a&&a.nodeType?b.appendChild(a):(a=void 0===a?"":a,b.tagName in c?"checkbox"===b.type?b.checked=a:b.value=a:b.appendChild(m.createTextNode(a)))})}function s(a,c){a.xcleanup&&a.xcleanup(c);for(var d=a.getElementsByTagName("*"),e=0,f=d.length;e<f;e++){var g=d[e];g.xcleanup&&
g.xcleanup(!0)}}function q(a,c){return p(c,e)(a)}var k={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},c={INPUT:1,TEXTAREA:1,SELECT:1},m=document,t=1;q.forSelector=p;return q})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(n,f,g){return n("dojo.store.Memory",null,{constructor:function(f){for(var e in f)this[e]=f[e];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:g,get:function(f){return this.data[this.index[f]]},
getIdentity:function(f){return f[this.idProperty]},put:function(f,e){var g=this.data,n=this.index,a=this.idProperty,a=f[a]=e&&"id"in e?e.id:a in f?f[a]:Math.random();if(a in n){if(e&&!1===e.overwrite)throw Error("Object already exists");g[n[a]]=f}else n[a]=g.push(f)-1;return a},add:function(f,e){(e=e||{}).overwrite=!1;return this.put(f,e)},remove:function(f){var e=this.index,g=this.data;if(f in e)return g.splice(e[f],1),this.setData(g),!0},query:function(g,e){return f(this.queryEngine(g,e)(this.data))},
setData:function(f){f.items?(this.idProperty=f.identifier||this.idProperty,f=this.data=f.items):this.data=f;this.index={};for(var e=0,g=f.length;e<g;e++)this.index[f[e][this.idProperty]]=e}})})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(n){return function(f,g){function h(e){e=n.filter(e,f);var h=g&&g.sort;h&&e.sort("function"==typeof h?h:function(a,d){for(var e,f=0;e=h[f];f++){var g=a[e.attribute],c=d[e.attribute],g=null!=g?g.valueOf():g,c=null!=c?c.valueOf():
c;if(g!=c)return!!e.descending==(null==g||g>c)?-1:1}return 0});if(g&&(g.start||g.count)){var a=e.length;e=e.slice(g.start||0,(g.start||0)+(g.count||Infinity));e.total=a}return e}switch(typeof f){default:throw Error("Can not query with a "+typeof f);case "object":case "undefined":var e=f;f=function(f){for(var g in e){var a=e[g];if(a&&a.test){if(!a.test(f[g],f))return!1}else if(a!=f[g])return!1}return!0};break;case "string":if(!this[f])throw Error("No filter function "+f+" was found in store");f=this[f];
case "function":}h.matches=f;return h}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q){g.isAsync||a(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var k=f("dojo.dnd.Source",s,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],
generateText:!0,constructor:function(a,d){h.mixin(this,h.mixin({},d));var f=this.accept;if(f.length){this.accept={};for(var b=0;b<f.length;++b)this.accept[f[b]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&e.add(this.node,"dojoDndSource");this.targetState="";this.accept&&e.add(this.node,"dojoDndTarget");this.horizontal&&e.add(this.node,"dojoDndHorizontal");this.topics=[l.subscribe("/dnd/source/over",
h.hitch(this,"onDndSourceOver")),l.subscribe("/dnd/start",h.hitch(this,"onDndStart")),l.subscribe("/dnd/drop",h.hitch(this,"onDndDrop")),l.subscribe("/dnd/cancel",h.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,d){if(this==a)return!this.copyOnly||this.selfAccept;for(var e=0;e<d.length;++e){for(var b=a.getItem(d[e].id).type,f=!1,g=0;g<b.length;++g)if(b[g]in this.accept){f=!0;break}if(!f)return!1}return!0},copyState:function(a,d){if(a)return!0;2>arguments.length&&(d=this==q.manager().target);
if(d){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){k.superclass.destroy.call(this);n.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!(this.isDragging&&"Disabled"==this.targetState)){k.superclass.onMouseMove.call(this,a);var e=q.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var f=this.getSelectedNodes();
f.length&&e.startDrag(this,f,this.copyState(d.getCopyKeyState(a),!0))}if(this.isDragging){f=!1;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current)this.targetBox=p.position(this.current,!0);f=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==p.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2}if(this.current!=this.targetAnchor||f!=this.before)this._markTargetAnchor(f),e.canDrop(!this.current||e.source!=this||!(this.current.id in this.selection))}}},
onMouseDown:function(a){if(!this.mouseDown&&this._legalMouseDown(a)&&(!this.skipForm||!d.isFormElement(a)))this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,k.superclass.onMouseDown.call(this,a)},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,k.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=q.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||
!(this.current.id in this.selection))))},onDndStart:function(a,d,e){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?e?"Copied":"Moved":"");d=this.accept&&this.checkAcceptance(a,d);this._changeState("Target",d?"":"Disabled");this==a&&q.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,d,e,b){if(this==b)this.onDrop(a,d,e);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=
this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,d,e){if(this!=a)this.onDropExternal(a,d,e);else this.onDropInternal(d,e)},onDropExternal:function(a,e,f){var b=this._normalizedCreator;this._normalizedCreator=this.creator?function(d,e){return b.call(this,a.getItem(d.id).data,e)}:f?function(b){var e=a.getItem(b.id);b=b.cloneNode(!0);b.id=d.getUniqueId();return{node:b,data:e.data,type:e.type}}:function(b){var d=a.getItem(b.id);a.delItem(b.id);return{node:b,
data:d.data,type:d.type}};this.selectNone();!f&&!this.creator&&a.selectNone();this.insertNodes(!0,e,this.before,this.current);!f&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=b},onDropInternal:function(a,e){var f=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(e)this._normalizedCreator=this.creator?function(a,c){return f.call(this,this.getItem(a.id).data,c)}:function(a){var c=this.getItem(a.id);a=a.cloneNode(!0);a.id=d.getUniqueId();return{node:a,
data:c.data,type:c.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var c=this.getItem(a.id);return{node:a,data:c.data,type:c.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=f}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){k.superclass.onOverEvent.call(this);q.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){k.superclass.onOutEvent.call(this);
q.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){this.current==this.targetAnchor&&this.before==a||(this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!r.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(e.contains(a,"dojoDndHandle"))return!0;if(e.contains(a,"dojoDndItem")||e.contains(a,"dojoDndIgnore"))break}return!1}});return k})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(n,f,g,h,e,p,r,a,l,d,s,q){var k=f("dojo.dnd.Selector",q,{constructor:function(a,e){e||(e={});this.singular=e.singular;this.autoSync=e.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(l(this.node,d.press,h.hitch(this,"onMouseDown")),l(this.node,d.release,h.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var c=new a,d=s._empty,f;for(f in this.selection)f in d||c.push(e.byId(f));return c},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(a,d){this._addItemClass(e.byId(d),"Selected");this.selection[d]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=s._empty,d;for(d in this.selection)if(!(d in a)){var f=e.byId(d);this.delItem(d);p.destroy(f)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,d){d=d||g.global;var e=this.selection,b=s._empty,f;for(f in e)f in b||a.call(d,this.getItem(f),f,this)},sync:function(){k.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],d=s._empty,e;for(e in this.selection)e in d||this.getItem(e)||a.push(e);n.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,d,e,b){var f=this._normalizedCreator;this._normalizedCreator=function(b,d){var e=f.call(this,b,d);a?(this.anchor?this.anchor!=e.node&&(this._removeItemClass(e.node,"Anchor"),this._addItemClass(e.node,"Selected")):(this.anchor=e.node,this._removeItemClass(e.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[e.node.id]=1):(this._removeItemClass(e.node,"Selected"),this._removeItemClass(e.node,"Anchor"));return e};k.superclass.insertNodes.call(this,d,e,b);this._normalizedCreator=f;return this},destroy:function(){k.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!s.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,r.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){s.getCopyKeyState(a)||this._removeSelection();var d=this.getAllNodes();if(d.length&&(this.anchor||(this.anchor=d[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var e=0,b;e<d.length&&!(b=d[e],b==this.anchor||b==this.current);++e);for(++e;e<d.length;++e){b=d[e];if(b==this.anchor||b==this.current)break;this._addItemClass(b,"Selected");this.selection[b.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?s.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):s.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=l(this.node,d.move,h.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=s._empty,d;for(d in this.selection)if(!(d in a)){var f=e.byId(d);f&&this._removeItemClass(f,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return k})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c){f=f("dojo.dnd.Container",l,{skipForm:!1,allowNested:!1,constructor:function(a,c){this.node=p.byId(a);
c||(c={});this.creator=c.creator||null;this.skipForm=c.skipForm;this.parent=c.dropParent&&p.byId(c.dropParent);this.map={};this.current=null;this.containerState="";r.add(this.node,"dojoDndContainer");(!c||!c._skipStartup)&&this.startup();this.events=[s(this.node,k.over,h.hitch(this,"onMouseOver")),s(this.node,k.out,h.hitch(this,"onMouseOut")),s(this.node,"dragstart",h.hitch(this,"onSelectStart")),s(this.node,"selectstart",h.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},
setItem:function(a,c){this.map[a]=c},delItem:function(a){delete this.map[a]},forInItems:function(a,d){d=d||g.global;var b=this.map,e=c._empty,f;for(f in b)f in e||a.call(d,b[f],f,this);return d},clearItems:function(){this.map={}},getAllNodes:function(){return q((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(d){if(d.id){var b=this.getItem(d.id);if(b){a[d.id]=b;return}}else d.id=c.getUniqueId();var b=d.getAttribute("dndType"),
e=d.getAttribute("dndData");a[d.id]={data:e||d.innerHTML,type:b?b.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,c,b){this.parent.firstChild?c?b||(b=this.parent.firstChild):b&&(b=b.nextSibling):b=null;var d;if(b)for(c=0;c<a.length;++c)d=this._normalizedCreator(a[c]),this.setItem(d.node.id,{data:d.data,type:d.type}),b.parentNode.insertBefore(d.node,b);else for(c=0;c<a.length;++c)d=this._normalizedCreator(a[c]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);
return this},destroy:function(){n.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,c,b){a._skipStartup=!0;return new b(c,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=c._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var c=a.relatedTarget;c&&
c!=this.node;)try{c=c.parentNode}catch(b){c=null}c||(this._changeState("Container","Over"),this.onOverEvent());c=this._getChildByEvent(a);this.current!=c&&(this.current&&this._removeItemClass(this.current,"Over"),c&&this._addItemClass(c,"Over"),this.current=c)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(c){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){if(!this.skipForm||
!c.isFormElement(a))a.stopPropagation(),a.preventDefault()},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,c){var b="dojoDnd"+a,d=a.toLowerCase()+"State";r.replace(this.node,b+c,b+this[d]);this[d]=c},_addItemClass:function(a,c){r.add(a,"dojoDndItem"+c)},_removeItemClass:function(a,c){r.remove(a,"dojoDndItem"+c)},_getChildByEvent:function(a){if(a=a.target)for(var c=a.parentNode;c;a=c,c=a.parentNode)if((c==this.parent||this.allowNested)&&r.contains(a,"dojoDndItem"))return a;
return null},_normalizedCreator:function(a,d){var b=(this.creator||this.defaultCreator).call(this,a,d);h.isArray(b.type)||(b.type=["text"]);b.node.id||(b.node.id=c.getUniqueId());r.add(b.node,"dojoDndItem");return b}});c._createNode=function(d){return!d?c._createSpan:function(c){return a.create(d,{innerHTML:c})}};c._createTrTd=function(c){var d=a.create("tr");a.create("td",{innerHTML:c},d);return d};c._createSpan=function(c){return a.create("span",{innerHTML:c})};c._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};c._defaultCreator=function(a){a=a.tagName.toLowerCase();var d="tbody"==a||"thead"==a?c._createTrTd:c._createNode(c._defaultCreatorNodes[a]);return function(a,e){var f=a&&h.isObject(a),g,k;f&&a.tagName&&a.nodeType&&a.getAttribute?(g=a.getAttribute("dndData")||a.innerHTML,f=(f=a.getAttribute("dndType"))?f.split(/\s*,\s*/):["text"],k=a):(g=f&&a.data?a.data:a,f=f&&a.type?a.type:["text"],k=("avatar"==e?c._createSpan:d)(String(g)));k.id||(k.id=c.getUniqueId());return{node:k,data:g,type:f}}};
return f})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c){var m=f("dojo.dnd.Manager",[p],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:r("touch")?0:16,OFFSET_Y:r("touch")?-64:16,overSource:function(a){this.avatar&&
(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=Boolean(this.target),this.avatar.update());d.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),d.publish("/dnd/source/over",null)):d.publish("/dnd/source/over",null)},startDrag:function(a,b,c){function f(a){a.preventDefault();a.stopPropagation()}k.autoScrollStart(h.doc);this.source=a;this.nodes=b;this.copy=Boolean(c);this.avatar=this.makeAvatar();
h.body().appendChild(this.avatar.node);d.publish("/dnd/start",a,b,this.copy);this.events=[l(h.doc,s.move,g.hitch(this,"onMouseMove")),l(h.doc,s.release,g.hitch(this,"onMouseUp")),l(h.doc,"keydown",g.hitch(this,"onKeyDown")),l(h.doc,"keyup",g.hitch(this,"onKeyUp")),l(h.doc,"dragstart",f),l(h.body(),"selectstart",f)];e.add(h.body(),"dojoDnd"+(c?"Copy":"Move"))},canDrop:function(a){a=Boolean(this.target&&a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){e.remove(h.body(),
["dojoDndCopy","dojoDndMove"]);n.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new c(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(k.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=Boolean(this.source.copyState(q.getCopyKeyState(a))),this.copy!=b&&this._setCopyStatus(b));
r("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var b=Boolean(this.source.copyState(q.getCopyKeyState(a)));d.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);d.publish("/dnd/drop",this.source,this.nodes,b,this.target,a)}else d.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(c){if(this.avatar)switch(c.keyCode){case a.CTRL:c=Boolean(this.source.copyState(!0));this.copy!=c&&this._setCopyStatus(c);break;case a.ESCAPE:d.publish("/dnd/cancel"),
this.stopDrag()}},onKeyUp:function(c){this.avatar&&c.keyCode==a.CTRL&&(c=Boolean(this.source.copyState(!1)),this.copy!=c&&this._setCopyStatus(c))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();e.replace(h.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});q._manager=null;m.manager=q.manager=function(){q._manager||(q._manager=new m);return q._manager};return m})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),
function(n,f,g,h,e,p,r,a){return n("dojo.dnd.Avatar",null,{constructor:function(a){this.manager=a;this.construct()},construct:function(){var a=p.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),d=this.manager.source,e,f=p.create("tbody",null,a),g=p.create("tr",null,f),c=p.create("td",null,g),m=Math.min(5,this.manager.nodes.length),n=0;r("highcontrast")&&p.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},c);p.create("span",{innerHTML:d.generateText?
this._generateText():""},c);for(h.set(g,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});n<m;++n)d.creator?e=d._normalizedCreator(d.getItem(this.manager.nodes[n].id).data,"avatar").node:(e=this.manager.nodes[n].cloneNode(!0),"tr"==e.tagName.toLowerCase()&&(g=p.create("table"),p.create("tbody",null,g).appendChild(e),e=g)),e.id="",g=p.create("tr",null,f),c=p.create("td",null,g),c.appendChild(e),h.set(g,{"class":"dojoDndAvatarItem",style:{opacity:(9-n)/10}});this.node=a},destroy:function(){p.destroy(this.node);
this.node=!1},update:function(){e.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(r("highcontrast")){var f=g.byId("a11yIcon"),d="+";this.manager.canDropFlag&&!this.manager.copy?d="\x3c ":!this.manager.canDropFlag&&!this.manager.copy?d="o":this.manager.canDropFlag||(d="x");f.innerHTML=d}a("tr.dojoDndAvatarHeader td span"+(r("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},
"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(n,f,g,h){return n("dijit.CheckedMenuItem",g,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:h,checked:!1,_setCheckedAttr:function(e){this.domNode.setAttribute("aria-checked",e?"true":"false");this._set("checked",e)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(e){this.disabled||
(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(e)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),function(n,f,g,h,e,p,r,a,l,d,s){var q=l("dijit.ColorPalette",[g,h,e],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:f,baseClass:"dijitColorPalette",_dyeFactory:function(a,c,d,e){return new this._dyeClass(a,c,d,e)},buildRendering:function(){this.inherited(arguments);this._dyeClass=l(q._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],r.getLocalization("dojo","colors",
this.lang))}});q._Color=l("dijit._Color",a,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":n.toUrl("./themes/a11y/colors7x10.png"),"3x4":n.toUrl("./themes/a11y/colors3x4.png")},constructor:function(d,c,e,f){this._title=f;this._row=c;this._col=e;this.setColor(a.named[d])},getValue:function(){return this.toHex()},fillCell:function(a,c){var e=s.substitute(p("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:c,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});d.place(e,a)}});return q})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(n,f,g,h,e,p,r,a,l,d,s){return n("dijit._PaletteMixin",a,{defaultTimeout:500,timeoutChangeRate:0.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?p.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,d){this._cells=[];var c=this._blankGif;this.own(r(this.gridNode,l,p.hitch(this,"_onCellClick")));for(var f=0;f<a.length;f++)for(var g=h.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),b=0;b<a[f].length;b++){var n=a[f][b];if(n){var x=this._dyeFactory(n,f,b,d[n]),n=h.create("td",{"class":this.cellClass,tabIndex:"-1",title:d[n],role:"gridcell"},g);x.fillCell(n,c);n.idx=this._cells.length;this._cells.push({node:n,
dye:x})}}this._xDim=a[0].length;this._yDim=a.length;var y={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},A;for(A in y)this.own(s.addKeyListener(this.domNode,{keyCode:e[A],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=y[A];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){d.focus(this._currentFocus)},
_onCellClick:function(a){for(var e=a.target;"TD"!=e.tagName;){if(!e.parentNode||e==this.gridNode)return;e=e.parentNode}var c=this._getDye(e).getValue();this._setCurrent(e);d.focus(e);this._setValueAttr(c,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&f.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&f.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,d){0<=this._selectedCell&&g.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var c=0;c<this._cells.length;c++)if(a==this._cells[c].dye.getValue()){this._selectedCell=c;g.add(this._cells[c].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(d||void 0===d)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,e){if(-1!=e){var c=this._currentFocus.idx+a;c<this._cells.length&&-1<c&&(c=this._cells[c].node,this._setCurrent(c),this.defer(p.hitch(d,"focus",c)))}},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(n){return n})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(n,f,g,h,e,p,r,a,l){h("dijit-legacy-requires")&&p(0,function(){n(["dijit/form/RadioButton"])});return f("dijit.form.CheckBox",[r,a],{templateString:l,baseClass:"dijitCheckBox",_setValueAttr:function(a,
e){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,e)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&e("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&e("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(n,f){return n("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(g){this._set("readOnly",g);f.set(this.focusNode,"readOnly",g)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==f||""===f?"on":f},_setValueAttr:function(g){g=this._getSubmitValue(g);this._set("value",g);f.set(this.focusNode,
"value",g)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));f.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(n,f,g){return n("dijit.form.ComboBox",[f,g],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(n,f,g,h,e,p,r,a,l){return n("dijit.form.ComboBoxMixin",[a,p],{dropDownClass:r,hasDownArrow:!0,templateString:l,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(a){a.get||h.mixin(a,{_oldAPI:!0,get:function(a){var d=new f;this.fetchItemByIdentity({identity:a,
onItem:function(a){d.resolve(a)},onError:function(a){d.reject(a)}});return d.promise},query:function(a,d){var g=new f(function(){c.abort&&c.abort()});g.total=new f;var c=this.fetch(h.mixin({query:a,onBegin:function(a){g.total.resolve(a)},onComplete:function(a){g.resolve(a)},onError:function(a){g.reject(a)}},d));return e(g)}});this._set("store",a)},postMixInProperties:function(){var a=this.params.store||this.store;a&&this._setStoreAttr(a);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var e=this.declaredClass;h.mixin(this.store,{getValue:function(a,d){g.deprecated(e+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[d]},getLabel:function(a){g.deprecated(e+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(a){g.deprecated(e+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
h.hitch(this,function(d){(new d({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(n,f,g,h,e,p,r,a,l,d,s){f=f("dijit.form._AutoCompleterMixin",s,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(d){var e=0;if("number"==typeof d.selectionStart)e=d.selectionStart;else if(a("ie")){var c=d.ownerDocument.selection.createRange().duplicate();d=d.createTextRange();c.move("character",0);d.move("character",0);try{d.setEndPoint("EndToEnd",c),e=String(d.text).replace(/\r/g,"").length}catch(f){}}return e},_setCaretPos:function(a,e){e=parseInt(e);d.selectInputText(a,e,e)},_setDisabledAttr:function(a){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var d=a.charCode||a.keyCode;if(!(d==h.ALT||d==h.CTRL||d==h.META||d==h.SHIFT)){var c=this.dropDown,e=null;this._abortQuery();this.inherited(arguments);if(!a.altKey&&!a.ctrlKey&&!a.metaKey)switch(this._opened&&(e=c.getHighlightedOption()),d){case h.PAGE_DOWN:case h.DOWN_ARROW:case h.PAGE_UP:case h.UP_ARROW:this._opened&&this._announceOption(e);a.stopPropagation();a.preventDefault();break;case h.ENTER:if(e){if(e==
c.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(e==c.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case h.TAB:d=this.get("displayedValue");if(c&&(d==c._messages.previousMessage||d==c._messages.nextMessage))break;e&&this._selectOption(e);case h.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(a){var e=this.focusNode;d.selectInputText(e,e.value.length);var c=this.ignoreCase?"toLowerCase":"substr";0==a[c](0).indexOf(this.focusNode.value[c](0))?(c=this.autoComplete?this._getCaretPos(e):e.value.length,c+1>e.value.length&&(e.value=a,d.selectInputText(e,c))):(e.value=a,d.selectInputText(e))},_openResultList:function(a,d,c){var f=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();!a.length&&0==c.start?this.closeDropDown():(this._nextSearch=this.dropDown.onPage=
e.hitch(this,function(c){a.nextPage(-1!==c);this.focus()}),this.dropDown.createOptions(a,c,e.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in c?(c.direction?this.dropDown.highlightFirstOption():c.direction||this.dropDown.highlightLastOption(),f&&this._announceOption(this.dropDown.getHighlightedOption())):this.autoComplete&&(!this._prev_key_backspace&&!/^[*]+$/.test(d[this.searchAttr].toString()))&&this._announceOption(this.dropDown.containerNode.firstChild.nextSibling))},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),d=this.dropDown;d&&(a==d._messages.previousMessage||a==d._messages.nextMessage)?this._setValueAttr(this._lastValueReported,
!0):"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState());this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,d,c){var e="";a&&(c||(c=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),e=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):c);this.set("value",e,d,c,a)},_announceOption:function(a){if(a){var d;if(a==
this.dropDown.nextButton||a==this.dropDown.previousButton)d=a.innerHTML,this.item=void 0,this.value="";else{var c=this.dropDown.items[a.getAttribute("item")];d=(this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]).toString();this.set("item",c,!1,d)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",g.get(a,"id"));this._autoCompleteText(d)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);
this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var d=this.id+"_popup";this.dropDown=new (e.isString(this.dropDownClass)?e.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:e.hitch(this,this._selectOption),id:d,
dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new l({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var d=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,d):a[d]}}},postCreate:function(){var a=p('label[for\x3d"'+this.id+'"]');a.length&&
(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);n.after(this,"onSearch",e.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var d=this.labelType;"none"!=this.highlightMatch&&("text"==this.labelType&&this._lastInput)&&(a=this.doHighlight(a,this._lastInput),d="html");return{html:"html"==d,label:a}},doHighlight:function(a,d){var c=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?
"g":""),e=this.queryExpr.indexOf("${0}");d=r.escapeString(d);return this._escapeHtml(a.replace(RegExp((0==e?"^":"")+"("+d+")"+(e==this.queryExpr.length-4?"$":""),c),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,
d){return(d._oldAPI?d.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,d,c,e){this._set("item",e||null);null==a&&(a="");this.inherited(arguments)}});a("dojo-bidi")&&f.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return f})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(n,
f,g,h,e,p){function r(a){return{id:a.value,value:a.value,name:g.trim(a.innerText||a.textContent||"")}}return n("dijit.form.DataList",e,{constructor:function(a,e){this.domNode=f.byId(e);g.mixin(this,a);this.id&&p.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:h("option",this.domNode).map(r)}])},destroy:function(){p.remove(this.id)},fetchSelectedItem:function(){var a=h("\x3e option[selected]",this.domNode)[0]||h("\x3e option",this.domNode)[0];return a&&r(a)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),
function(n,f,g,h,e,p,r){return n("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(a,d,e,f){return e?".*":f?".":d?d:"\\"+a})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&
(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(a){if(!this.disabled&&!this.readOnly){a=a.charOrCode;var e=!1;this._prev_key_backspace=!1;switch(a){case f.DELETE:case f.BACKSPACE:e=this._maskValidSubsetError=this._prev_key_backspace=
!0;break;default:e="string"==typeof a||229==a}if(e)if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var f=this,d=g.clone(this.query),h={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},n=e.substitute(this.queryExpr,[a.replace(/([\\\*\?])/g,"\\$1")]),k,c=function(){var a=f._fetchHandle=f.store.query(d,
h);!f.disabled&&!(f.readOnly||k!==f._lastQuery)&&p(a,function(e){f._fetchHandle=null;!f.disabled&&(!f.readOnly&&k===f._lastQuery)&&p(a.total,function(a){e.total=a;var g=f.pageSize;if(isNaN(g)||g>e.total)g=e.total;e.nextPage=function(a){h.direction=a=!1!==a;h.count=g;a?(h.start+=e.length,h.start>=e.total&&(h.count=0)):(h.start-=g,0>h.start&&(h.count=Math.max(g+h.start,0),h.start=0));0>=h.count?(e.length=0,f.onSearch(e,d,h)):c()};f.onSearch(e,d,h)})},function(a){f._fetchHandle=null;f._cancelingQuery||
console.error(f.declaredClass+" "+a.toString())})};g.mixin(h,this.fetchProperties);this.store._oldAPI?k=n:(k=this._patternToRegExp(n),k.toString=function(){return n});this._lastQuery=d[this.searchAttr]=k;this._queryDeferHandle=this.defer(c,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&(this.store=r.byId(a))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),
function(n,f,g,h,e,p,r,a){return n("dijit.form._ComboBoxMenu",[e,p,a,r],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(f.add(this.previousButton,"dijitMenuItemRtl"),f.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var a=this.ownerDocument.createElement("div");a.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");a.setAttribute("role","option");return a},onHover:function(a){f.add(a,"dijitMenuItemHover")},onUnhover:function(a){f.remove(a,
"dijitMenuItemHover")},onSelect:function(a){f.add(a,"dijitMenuItemSelected")},onDeselect:function(a){f.remove(a,"dijitMenuItemSelected")},_page:function(a){var d=0,e=this.domNode.scrollTop,f=g.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();d<f;){var h=this.getHighlightedOption();if(a){if(!h.previousSibling||"none"==h.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!h.nextSibling||"none"==h.nextSibling.style.display)break;this.selectNextNode()}h=
this.domNode.scrollTop;d+=(h-e)*(a?-1:1);e=h}},handleKey:function(a){switch(a.keyCode){case h.DOWN_ARROW:return this.selectNextNode(),!1;case h.PAGE_DOWN:return this._page(!1),!1;case h.UP_ARROW:return this.selectPreviousNode(),!1;case h.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(n,f,g,h,e){var p=f("dijit.form._ComboBoxMenuMixin"+
(h("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=e.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(e){this._set("value",e);this.onChange(e)},onClick:function(e){if(e==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(e==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(e)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(e,a){var f=this._createMenuItem(),d=a(e);d.html?f.innerHTML=d.label:f.appendChild(f.ownerDocument.createTextNode(d.label));""==f.innerHTML&&(f.innerHTML="\x26#160;");return f},createOptions:function(e,a,f){this.items=e;this.previousButton.style.display=0==a.start?"none":"";g.set(this.previousButton,"id",this.id+
"_prev");n.forEach(e,function(a,d){var e=this._createOption(a,f);e.setAttribute("item",d);g.set(e,"id",this.id+d);this.nextButton.parentNode.insertBefore(e,this.nextButton)},this);var d=!1;e.total&&!e.total.then&&-1!=e.total?a.start+a.count<e.total?d=!0:a.start+a.count>e.total&&a.count==e.length&&(d=!0):a.count==e.length&&(d=!0);this.nextButton.style.display=d?"":"none";g.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var e=this.containerNode;2<e.childNodes.length;)e.removeChild(e.childNodes[e.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});h("dojo-bidi")&&(p=f("dijit.form._ComboBoxMenuMixin",
p,{_createOption:function(){var e=this.inherited(arguments);this.applyTextDir(e);return e}}));return p})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(n,f,g,h){return n("dijit.form._ListMouseMixin",h,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(e,f){this._setSelectedAttr(f,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(f)})},_onMouseDown:function(e,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(f,!1)},_onMouseUp:function(e,f){this._isDragging=!1;var g=this.selected,a=this._hoveredNode;g&&f==g?this.defer(function(){this._onClick(e,
g)}):a&&this.defer(function(){this._onClick(e,a)})},_onMouseOut:function(e,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(e,f){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=f;this.onHover(f);this._isDragging&&this._setSelectedAttr(f,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(n,f,g){return n("dijit.form._ListBase",null,{selected:null,_listConnect:function(g,e){var n=this;return n.own(f(n.containerNode,f.selector(function(e,a,f){return e.parentNode==f},g),function(f){n[e](f,this)}))},selectFirstNode:function(){for(var f=this.containerNode.firstChild;f&&"none"==f.style.display;)f=f.nextSibling;this._setSelectedAttr(f,!0)},selectLastNode:function(){for(var f=this.containerNode.lastChild;f&&"none"==f.style.display;)f=f.previousSibling;this._setSelectedAttr(f,
!0)},selectNextNode:function(){var f=this.selected;if(f){for(f=f.nextSibling;f&&"none"==f.style.display;)f=f.nextSibling;f?this._setSelectedAttr(f,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var f=this.selected;if(f){for(f=f.previousSibling;f&&"none"==f.style.display;)f=f.previousSibling;f?this._setSelectedAttr(f,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(f,e){if(this.selected!=f){var n=this.selected;if(n)this.onDeselect(n);
f&&(e&&g.scrollIntoView(f),this.onSelect(f));this._set("selected",f)}else if(f)this.onSelect(f)}})})},"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'0\' selected\x3d"selected"\x3e${nls.basic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'1\'\x3eA-Z\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'2\'\x3e${nls.arrows}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'3\'\x3e${nls.business}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'4\'\x3e${nls.cartographic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'5\'\x3e${nls.nationalParkService}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'6\'\x3e${nls.outdoorRecreation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'7\'\x3e${nls.peoplePlaces}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'8\'\x3e${nls.safetyHealth}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'9\'\x3e${nls.shapes}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'10\'\x3e${nls.transportation}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e0%\x3c/li\x3e\r\n      \x3cli\x3e50%\x3c/li\x3e\r\n      \x3cli\x3e100%\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(n){n(['dojo/i18n!*preload*jimu/nls/main*["ar","cs","da","de","en","el","es","et","fi","fr","he","hr","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(n,f,g,h,e,p,r,a,l,d,s,q,k,c,m,t,b,v,x,y,A,w,C,u,E,D){function B(a){G=a}c={};var G;v.defaults.io.timeout=
18E4;"function"!==typeof k.getAll&&(k.getAll=function(a){var b=[];(a=k(a))&&b.push(a);return b});window.jimuNls=D;A.setProtocolErrorHandler(function(){return!0});v=C.getAncestorWindow();var I=!1;try{I=0===v.location.href.indexOf("https://")}catch(K){console.log(K),I="https:"===window.location.protocol}x.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);I&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));-1!==a.url.indexOf("/queryRelatedRecords?")&&!C.isHostedService(a.url)&&
(a.url=a.url.replace("FeatureServer","MapServer"));!window.isBuilder&&(G&&!G.mode&&G.appProxies&&0<G.appProxies.length)&&l.some(G.appProxies,function(b){if(0<=a.url.indexOf(b.sourceUrl))return a.url=a.url.replace(b.sourceUrl,b.proxyUrl),!0});return a});d(window,"mousedown",function(a){if(s.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-
a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=a.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.2";window.productVersion="Online 4.3";window.isBuilder?(q.subscribe("app/appConfigLoaded",B),q.subscribe("app/appConfigChanged",B)):(q.subscribe("appConfigLoaded",B),q.subscribe("appConfigChanged",
B));c.initApp=function(){var a,b;console.log("jimu.js init...");a=window.location.search;a=""===a?{}:t.queryToObject(a.substr(1));if(a.mobileBreakPoint)try{b=parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=b}catch(c){console.error("mobileBreakPoint URL parameter must be a number.",c)}g.getInstance(h.getInstance());e.getInstance();p.getInstance();r.setStyle(jimuConfig.loadingId,"display","none");r.setStyle(jimuConfig.mainPageId,"display","block");b=f.getInstance({mapId:jimuConfig.mapId,urlParams:a},
jimuConfig.layoutId);a=n.getInstance(a);b.startup();a.loadConfig();u(["dynamic-modules/preload"])};return c});